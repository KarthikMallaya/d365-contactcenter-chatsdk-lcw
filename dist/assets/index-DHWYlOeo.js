var dq=Object.defineProperty;var hq=(t,e,n)=>e in t?dq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ye=(t,e,n)=>hq(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var _e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ov(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Hs(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var hx={exports:{}},Mv={},fx={exports:{}},Pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gf=Symbol.for("react.element"),fq=Symbol.for("react.portal"),pq=Symbol.for("react.fragment"),gq=Symbol.for("react.strict_mode"),mq=Symbol.for("react.profiler"),vq=Symbol.for("react.provider"),yq=Symbol.for("react.context"),Cq=Symbol.for("react.forward_ref"),Sq=Symbol.for("react.suspense"),Tq=Symbol.for("react.memo"),Eq=Symbol.for("react.lazy"),PR=Symbol.iterator;function wq(t){return t===null||typeof t!="object"?null:(t=PR&&t[PR]||t["@@iterator"],typeof t=="function"?t:null)}var px={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gx=Object.assign,mx={};function qu(t,e,n){this.props=t,this.context=e,this.refs=mx,this.updater=n||px}qu.prototype.isReactComponent={};qu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function vx(){}vx.prototype=qu.prototype;function dI(t,e,n){this.props=t,this.context=e,this.refs=mx,this.updater=n||px}var hI=dI.prototype=new vx;hI.constructor=dI;gx(hI,qu.prototype);hI.isPureReactComponent=!0;var OR=Array.isArray,yx=Object.prototype.hasOwnProperty,fI={current:null},Cx={key:!0,ref:!0,__self:!0,__source:!0};function Sx(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)yx.call(e,r)&&!Cx.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var c=Array(l),a=0;a<l;a++)c[a]=arguments[a+2];i.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:gf,type:t,key:o,ref:s,props:i,_owner:fI.current}}function Iq(t,e){return{$$typeof:gf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function pI(t){return typeof t=="object"&&t!==null&&t.$$typeof===gf}function bq(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var MR=/\/+/g;function pC(t,e){return typeof t=="object"&&t!==null&&t.key!=null?bq(""+t.key):e.toString(36)}function um(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case gf:case fq:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+pC(s,0):r,OR(i)?(n="",t!=null&&(n=t.replace(MR,"$&/")+"/"),um(i,e,n,"",function(a){return a})):i!=null&&(pI(i)&&(i=Iq(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(MR,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",OR(t))for(var l=0;l<t.length;l++){o=t[l];var c=r+pC(o,l);s+=um(o,e,n,c,i)}else if(c=wq(t),typeof c=="function")for(t=c.call(t),l=0;!(o=t.next()).done;)o=o.value,c=r+pC(o,l++),s+=um(o,e,n,c,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function kp(t,e,n){if(t==null)return t;var r=[],i=0;return um(t,r,"","",function(o){return e.call(n,o,i++)}),r}function _q(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gi={current:null},dm={transition:null},Aq={ReactCurrentDispatcher:gi,ReactCurrentBatchConfig:dm,ReactCurrentOwner:fI};function Tx(){throw Error("act(...) is not supported in production builds of React.")}Pt.Children={map:kp,forEach:function(t,e,n){kp(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return kp(t,function(){e++}),e},toArray:function(t){return kp(t,function(e){return e})||[]},only:function(t){if(!pI(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Pt.Component=qu;Pt.Fragment=pq;Pt.Profiler=mq;Pt.PureComponent=dI;Pt.StrictMode=gq;Pt.Suspense=Sq;Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Aq;Pt.act=Tx;Pt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=gx({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=fI.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)yx.call(e,c)&&!Cx.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var a=0;a<c;a++)l[a]=arguments[a+2];r.children=l}return{$$typeof:gf,type:t.type,key:i,ref:o,props:r,_owner:s}};Pt.createContext=function(t){return t={$$typeof:yq,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vq,_context:t},t.Consumer=t};Pt.createElement=Sx;Pt.createFactory=function(t){var e=Sx.bind(null,t);return e.type=t,e};Pt.createRef=function(){return{current:null}};Pt.forwardRef=function(t){return{$$typeof:Cq,render:t}};Pt.isValidElement=pI;Pt.lazy=function(t){return{$$typeof:Eq,_payload:{_status:-1,_result:t},_init:_q}};Pt.memo=function(t,e){return{$$typeof:Tq,type:t,compare:e===void 0?null:e}};Pt.startTransition=function(t){var e=dm.transition;dm.transition={};try{t()}finally{dm.transition=e}};Pt.unstable_act=Tx;Pt.useCallback=function(t,e){return gi.current.useCallback(t,e)};Pt.useContext=function(t){return gi.current.useContext(t)};Pt.useDebugValue=function(){};Pt.useDeferredValue=function(t){return gi.current.useDeferredValue(t)};Pt.useEffect=function(t,e){return gi.current.useEffect(t,e)};Pt.useId=function(){return gi.current.useId()};Pt.useImperativeHandle=function(t,e,n){return gi.current.useImperativeHandle(t,e,n)};Pt.useInsertionEffect=function(t,e){return gi.current.useInsertionEffect(t,e)};Pt.useLayoutEffect=function(t,e){return gi.current.useLayoutEffect(t,e)};Pt.useMemo=function(t,e){return gi.current.useMemo(t,e)};Pt.useReducer=function(t,e,n){return gi.current.useReducer(t,e,n)};Pt.useRef=function(t){return gi.current.useRef(t)};Pt.useState=function(t){return gi.current.useState(t)};Pt.useSyncExternalStore=function(t,e,n){return gi.current.useSyncExternalStore(t,e,n)};Pt.useTransition=function(){return gi.current.useTransition()};Pt.version="18.3.1";fx.exports=Pt;var pt=fx.exports;const Rq=Ov(pt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kq=pt,Pq=Symbol.for("react.element"),Oq=Symbol.for("react.fragment"),Mq=Object.prototype.hasOwnProperty,Dq=kq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nq={key:!0,ref:!0,__self:!0,__source:!0};function Ex(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Mq.call(e,r)&&!Nq.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Pq,type:t,key:o,ref:s,props:i,_owner:Dq.current}}Mv.Fragment=Oq;Mv.jsx=Ex;Mv.jsxs=Ex;hx.exports=Mv;var pe=hx.exports;typeof globalThis.global>"u"&&(globalThis.global=globalThis);typeof globalThis.process>"u"&&(globalThis.process={env:{}});var DT={},wx={exports:{}},Wi={},Ix={exports:{}},bx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(T,_){var N=T.length;T.push(_);e:for(;0<N;){var I=N-1>>>1,A=T[I];if(0<i(A,_))T[I]=_,T[N]=A,N=I;else break e}}function n(T){return T.length===0?null:T[0]}function r(T){if(T.length===0)return null;var _=T[0],N=T.pop();if(N!==_){T[0]=N;e:for(var I=0,A=T.length,S=A>>>1;I<S;){var H=2*(I+1)-1,L=T[H],C=H+1,y=T[C];if(0>i(L,N))C<A&&0>i(y,L)?(T[I]=y,T[C]=N,I=C):(T[I]=L,T[H]=N,I=H);else if(C<A&&0>i(y,N))T[I]=y,T[C]=N,I=C;else break e}}return _}function i(T,_){var N=T.sortIndex-_.sortIndex;return N!==0?N:T.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],a=[],u=1,d=null,f=3,h=!1,g=!1,E=!1,D=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(T){for(var _=n(a);_!==null;){if(_.callback===null)r(a);else if(_.startTime<=T)r(a),_.sortIndex=_.expirationTime,e(c,_);else break;_=n(a)}}function j(T){if(E=!1,b(T),!g)if(n(c)!==null)g=!0,P(K);else{var _=n(a);_!==null&&v(j,_.startTime-T)}}function K(T,_){g=!1,E&&(E=!1,w(G),G=-1),h=!0;var N=f;try{for(b(_),d=n(c);d!==null&&(!(d.expirationTime>_)||T&&!X());){var I=d.callback;if(typeof I=="function"){d.callback=null,f=d.priorityLevel;var A=I(d.expirationTime<=_);_=t.unstable_now(),typeof A=="function"?d.callback=A:d===n(c)&&r(c),b(_)}else r(c);d=n(c)}if(d!==null)var S=!0;else{var H=n(a);H!==null&&v(j,H.startTime-_),S=!1}return S}finally{d=null,f=N,h=!1}}var M=!1,ne=null,G=-1,oe=5,J=-1;function X(){return!(t.unstable_now()-J<oe)}function B(){if(ne!==null){var T=t.unstable_now();J=T;var _=!0;try{_=ne(!0,T)}finally{_?q():(M=!1,ne=null)}}else M=!1}var q;if(typeof p=="function")q=function(){p(B)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,x=F.port2;F.port1.onmessage=B,q=function(){x.postMessage(null)}}else q=function(){D(B,0)};function P(T){ne=T,M||(M=!0,q())}function v(T,_){G=D(function(){T(t.unstable_now())},_)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(T){T.callback=null},t.unstable_continueExecution=function(){g||h||(g=!0,P(K))},t.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<T?Math.floor(1e3/T):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(T){switch(f){case 1:case 2:case 3:var _=3;break;default:_=f}var N=f;f=_;try{return T()}finally{f=N}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(T,_){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var N=f;f=T;try{return _()}finally{f=N}},t.unstable_scheduleCallback=function(T,_,N){var I=t.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?I+N:I):N=I,T){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=N+A,T={id:u++,callback:_,priorityLevel:T,startTime:N,expirationTime:A,sortIndex:-1},N>I?(T.sortIndex=N,e(a,T),n(c)===null&&T===n(a)&&(E?(w(G),G=-1):E=!0,v(j,N-I))):(T.sortIndex=A,e(c,T),g||h||(g=!0,P(K))),T},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(T){var _=f;return function(){var N=f;f=_;try{return T.apply(this,arguments)}finally{f=N}}}})(bx);Ix.exports=bx;var xq=Ix.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lq=pt,$i=xq;function Be(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _x=new Set,qh={};function Ql(t,e){yu(t,e),yu(t+"Capture",e)}function yu(t,e){for(qh[t]=e,t=0;t<e.length;t++)_x.add(e[t])}var Ds=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),NT=Object.prototype.hasOwnProperty,Uq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,DR={},NR={};function Fq(t){return NT.call(NR,t)?!0:NT.call(DR,t)?!1:Uq.test(t)?NR[t]=!0:(DR[t]=!0,!1)}function Bq(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function $q(t,e,n,r){if(e===null||typeof e>"u"||Bq(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function mi(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Nr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Nr[t]=new mi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Nr[e]=new mi(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Nr[t]=new mi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Nr[t]=new mi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Nr[t]=new mi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Nr[t]=new mi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Nr[t]=new mi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Nr[t]=new mi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Nr[t]=new mi(t,5,!1,t.toLowerCase(),null,!1,!1)});var gI=/[\-:]([a-z])/g;function mI(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(gI,mI);Nr[e]=new mi(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(gI,mI);Nr[e]=new mi(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(gI,mI);Nr[e]=new mi(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Nr[t]=new mi(t,1,!1,t.toLowerCase(),null,!1,!1)});Nr.xlinkHref=new mi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Nr[t]=new mi(t,1,!1,t.toLowerCase(),null,!0,!0)});function vI(t,e,n,r){var i=Nr.hasOwnProperty(e)?Nr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&($q(e,n,i,r)&&(n=null),r||i===null?Fq(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var qs=Lq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pp=Symbol.for("react.element"),$c=Symbol.for("react.portal"),Hc=Symbol.for("react.fragment"),yI=Symbol.for("react.strict_mode"),xT=Symbol.for("react.profiler"),Ax=Symbol.for("react.provider"),Rx=Symbol.for("react.context"),CI=Symbol.for("react.forward_ref"),LT=Symbol.for("react.suspense"),UT=Symbol.for("react.suspense_list"),SI=Symbol.for("react.memo"),ua=Symbol.for("react.lazy"),kx=Symbol.for("react.offscreen"),xR=Symbol.iterator;function Ed(t){return t===null||typeof t!="object"?null:(t=xR&&t[xR]||t["@@iterator"],typeof t=="function"?t:null)}var vn=Object.assign,gC;function dh(t){if(gC===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);gC=e&&e[1]||""}return`
`+gC+t}var mC=!1;function vC(t,e){if(!t||mC)return"";mC=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var r=a}Reflect.construct(t,[],e)}else{try{e.call()}catch(a){r=a}t.call(e.prototype)}else{try{throw Error()}catch(a){r=a}t()}}catch(a){if(a&&r&&typeof a.stack=="string"){for(var i=a.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,l=o.length-1;1<=s&&0<=l&&i[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(i[s]!==o[l]){if(s!==1||l!==1)do if(s--,l--,0>l||i[s]!==o[l]){var c=`
`+i[s].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=s&&0<=l);break}}}finally{mC=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?dh(t):""}function Hq(t){switch(t.tag){case 5:return dh(t.type);case 16:return dh("Lazy");case 13:return dh("Suspense");case 19:return dh("SuspenseList");case 0:case 2:case 15:return t=vC(t.type,!1),t;case 11:return t=vC(t.type.render,!1),t;case 1:return t=vC(t.type,!0),t;default:return""}}function FT(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Hc:return"Fragment";case $c:return"Portal";case xT:return"Profiler";case yI:return"StrictMode";case LT:return"Suspense";case UT:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Rx:return(t.displayName||"Context")+".Consumer";case Ax:return(t._context.displayName||"Context")+".Provider";case CI:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case SI:return e=t.displayName||null,e!==null?e:FT(t.type)||"Memo";case ua:e=t._payload,t=t._init;try{return FT(t(e))}catch{}}return null}function qq(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return FT(e);case 8:return e===yI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ba(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Px(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jq(t){var e=Px(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Op(t){t._valueTracker||(t._valueTracker=jq(t))}function Ox(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Px(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Dm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function BT(t,e){var n=e.checked;return vn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function LR(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ba(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Mx(t,e){e=e.checked,e!=null&&vI(t,"checked",e,!1)}function $T(t,e){Mx(t,e);var n=Ba(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?HT(t,e.type,n):e.hasOwnProperty("defaultValue")&&HT(t,e.type,Ba(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function UR(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function HT(t,e,n){(e!=="number"||Dm(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var hh=Array.isArray;function au(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ba(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function qT(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Be(91));return vn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function FR(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Be(92));if(hh(n)){if(1<n.length)throw Error(Be(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ba(n)}}function Dx(t,e){var n=Ba(e.value),r=Ba(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function BR(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Nx(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function jT(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Nx(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Mp,xx=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Mp=Mp||document.createElement("div"),Mp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Mp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function jh(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Eh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vq=["Webkit","ms","Moz","O"];Object.keys(Eh).forEach(function(t){Vq.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Eh[e]=Eh[t]})});function Lx(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Eh.hasOwnProperty(t)&&Eh[t]?(""+e).trim():e+"px"}function Ux(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Lx(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var zq=vn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VT(t,e){if(e){if(zq[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Be(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Be(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Be(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Be(62))}}function zT(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var GT=null;function TI(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var WT=null,lu=null,cu=null;function $R(t){if(t=yf(t)){if(typeof WT!="function")throw Error(Be(280));var e=t.stateNode;e&&(e=Uv(e),WT(t.stateNode,t.type,e))}}function Fx(t){lu?cu?cu.push(t):cu=[t]:lu=t}function Bx(){if(lu){var t=lu,e=cu;if(cu=lu=null,$R(t),e)for(t=0;t<e.length;t++)$R(e[t])}}function $x(t,e){return t(e)}function Hx(){}var yC=!1;function qx(t,e,n){if(yC)return t(e,n);yC=!0;try{return $x(t,e,n)}finally{yC=!1,(lu!==null||cu!==null)&&(Hx(),Bx())}}function Vh(t,e){var n=t.stateNode;if(n===null)return null;var r=Uv(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Be(231,e,typeof n));return n}var KT=!1;if(Ds)try{var wd={};Object.defineProperty(wd,"passive",{get:function(){KT=!0}}),window.addEventListener("test",wd,wd),window.removeEventListener("test",wd,wd)}catch{KT=!1}function Gq(t,e,n,r,i,o,s,l,c){var a=Array.prototype.slice.call(arguments,3);try{e.apply(n,a)}catch(u){this.onError(u)}}var wh=!1,Nm=null,xm=!1,JT=null,Wq={onError:function(t){wh=!0,Nm=t}};function Kq(t,e,n,r,i,o,s,l,c){wh=!1,Nm=null,Gq.apply(Wq,arguments)}function Jq(t,e,n,r,i,o,s,l,c){if(Kq.apply(this,arguments),wh){if(wh){var a=Nm;wh=!1,Nm=null}else throw Error(Be(198));xm||(xm=!0,JT=a)}}function Xl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function jx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function HR(t){if(Xl(t)!==t)throw Error(Be(188))}function Qq(t){var e=t.alternate;if(!e){if(e=Xl(t),e===null)throw Error(Be(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return HR(i),t;if(o===r)return HR(i),e;o=o.sibling}throw Error(Be(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s)throw Error(Be(189))}}if(n.alternate!==r)throw Error(Be(190))}if(n.tag!==3)throw Error(Be(188));return n.stateNode.current===n?t:e}function Vx(t){return t=Qq(t),t!==null?zx(t):null}function zx(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=zx(t);if(e!==null)return e;t=t.sibling}return null}var Gx=$i.unstable_scheduleCallback,qR=$i.unstable_cancelCallback,Xq=$i.unstable_shouldYield,Yq=$i.unstable_requestPaint,Pn=$i.unstable_now,Zq=$i.unstable_getCurrentPriorityLevel,EI=$i.unstable_ImmediatePriority,Wx=$i.unstable_UserBlockingPriority,Lm=$i.unstable_NormalPriority,ej=$i.unstable_LowPriority,Kx=$i.unstable_IdlePriority,Dv=null,ss=null;function tj(t){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(Dv,t,void 0,(t.current.flags&128)===128)}catch{}}var xo=Math.clz32?Math.clz32:ij,nj=Math.log,rj=Math.LN2;function ij(t){return t>>>=0,t===0?32:31-(nj(t)/rj|0)|0}var Dp=64,Np=4194304;function fh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Um(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,s=n&268435455;if(s!==0){var l=s&~i;l!==0?r=fh(l):(o&=s,o!==0&&(r=fh(o)))}else s=n&~i,s!==0?r=fh(s):o!==0&&(r=fh(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-xo(e),i=1<<n,r|=t[n],e&=~i;return r}function oj(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sj(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-xo(o),l=1<<s,c=i[s];c===-1?(!(l&n)||l&r)&&(i[s]=oj(l,e)):c<=e&&(t.expiredLanes|=l),o&=~l}}function QT(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Jx(){var t=Dp;return Dp<<=1,!(Dp&4194240)&&(Dp=64),t}function CC(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function mf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xo(e),t[e]=n}function aj(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-xo(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function wI(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-xo(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var jt=0;function Qx(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Xx,II,Yx,Zx,eL,XT=!1,xp=[],Ea=null,wa=null,Ia=null,zh=new Map,Gh=new Map,pa=[],lj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jR(t,e){switch(t){case"focusin":case"focusout":Ea=null;break;case"dragenter":case"dragleave":wa=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":zh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gh.delete(e.pointerId)}}function Id(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=yf(e),e!==null&&II(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function cj(t,e,n,r,i){switch(e){case"focusin":return Ea=Id(Ea,t,e,n,r,i),!0;case"dragenter":return wa=Id(wa,t,e,n,r,i),!0;case"mouseover":return Ia=Id(Ia,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return zh.set(o,Id(zh.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Gh.set(o,Id(Gh.get(o)||null,t,e,n,r,i)),!0}return!1}function tL(t){var e=wl(t.target);if(e!==null){var n=Xl(e);if(n!==null){if(e=n.tag,e===13){if(e=jx(n),e!==null){t.blockedOn=e,eL(t.priority,function(){Yx(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function hm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=YT(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);GT=r,n.target.dispatchEvent(r),GT=null}else return e=yf(n),e!==null&&II(e),t.blockedOn=n,!1;e.shift()}return!0}function VR(t,e,n){hm(t)&&n.delete(e)}function uj(){XT=!1,Ea!==null&&hm(Ea)&&(Ea=null),wa!==null&&hm(wa)&&(wa=null),Ia!==null&&hm(Ia)&&(Ia=null),zh.forEach(VR),Gh.forEach(VR)}function bd(t,e){t.blockedOn===e&&(t.blockedOn=null,XT||(XT=!0,$i.unstable_scheduleCallback($i.unstable_NormalPriority,uj)))}function Wh(t){function e(i){return bd(i,t)}if(0<xp.length){bd(xp[0],t);for(var n=1;n<xp.length;n++){var r=xp[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ea!==null&&bd(Ea,t),wa!==null&&bd(wa,t),Ia!==null&&bd(Ia,t),zh.forEach(e),Gh.forEach(e),n=0;n<pa.length;n++)r=pa[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<pa.length&&(n=pa[0],n.blockedOn===null);)tL(n),n.blockedOn===null&&pa.shift()}var uu=qs.ReactCurrentBatchConfig,Fm=!0;function dj(t,e,n,r){var i=jt,o=uu.transition;uu.transition=null;try{jt=1,bI(t,e,n,r)}finally{jt=i,uu.transition=o}}function hj(t,e,n,r){var i=jt,o=uu.transition;uu.transition=null;try{jt=4,bI(t,e,n,r)}finally{jt=i,uu.transition=o}}function bI(t,e,n,r){if(Fm){var i=YT(t,e,n,r);if(i===null)kC(t,e,r,Bm,n),jR(t,r);else if(cj(i,t,e,n,r))r.stopPropagation();else if(jR(t,r),e&4&&-1<lj.indexOf(t)){for(;i!==null;){var o=yf(i);if(o!==null&&Xx(o),o=YT(t,e,n,r),o===null&&kC(t,e,r,Bm,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else kC(t,e,r,null,n)}}var Bm=null;function YT(t,e,n,r){if(Bm=null,t=TI(r),t=wl(t),t!==null)if(e=Xl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=jx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Bm=t,null}function nL(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zq()){case EI:return 1;case Wx:return 4;case Lm:case ej:return 16;case Kx:return 536870912;default:return 16}default:return 16}}var ya=null,_I=null,fm=null;function rL(){if(fm)return fm;var t,e=_I,n=e.length,r,i="value"in ya?ya.value:ya.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return fm=i.slice(t,1<r?1-r:void 0)}function pm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Lp(){return!0}function zR(){return!1}function Ki(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Lp:zR,this.isPropagationStopped=zR,this}return vn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Lp)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Lp)},persist:function(){},isPersistent:Lp}),e}var ju={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},AI=Ki(ju),vf=vn({},ju,{view:0,detail:0}),fj=Ki(vf),SC,TC,_d,Nv=vn({},vf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RI,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==_d&&(_d&&t.type==="mousemove"?(SC=t.screenX-_d.screenX,TC=t.screenY-_d.screenY):TC=SC=0,_d=t),SC)},movementY:function(t){return"movementY"in t?t.movementY:TC}}),GR=Ki(Nv),pj=vn({},Nv,{dataTransfer:0}),gj=Ki(pj),mj=vn({},vf,{relatedTarget:0}),EC=Ki(mj),vj=vn({},ju,{animationName:0,elapsedTime:0,pseudoElement:0}),yj=Ki(vj),Cj=vn({},ju,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Sj=Ki(Cj),Tj=vn({},ju,{data:0}),WR=Ki(Tj),Ej={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ij={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bj(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Ij[t])?!!e[t]:!1}function RI(){return bj}var _j=vn({},vf,{key:function(t){if(t.key){var e=Ej[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=pm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?wj[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RI,charCode:function(t){return t.type==="keypress"?pm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?pm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Aj=Ki(_j),Rj=vn({},Nv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),KR=Ki(Rj),kj=vn({},vf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RI}),Pj=Ki(kj),Oj=vn({},ju,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mj=Ki(Oj),Dj=vn({},Nv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Nj=Ki(Dj),xj=[9,13,27,32],kI=Ds&&"CompositionEvent"in window,Ih=null;Ds&&"documentMode"in document&&(Ih=document.documentMode);var Lj=Ds&&"TextEvent"in window&&!Ih,iL=Ds&&(!kI||Ih&&8<Ih&&11>=Ih),JR=" ",QR=!1;function oL(t,e){switch(t){case"keyup":return xj.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sL(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var qc=!1;function Uj(t,e){switch(t){case"compositionend":return sL(e);case"keypress":return e.which!==32?null:(QR=!0,JR);case"textInput":return t=e.data,t===JR&&QR?null:t;default:return null}}function Fj(t,e){if(qc)return t==="compositionend"||!kI&&oL(t,e)?(t=rL(),fm=_I=ya=null,qc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return iL&&e.locale!=="ko"?null:e.data;default:return null}}var Bj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function XR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Bj[t.type]:e==="textarea"}function aL(t,e,n,r){Fx(r),e=$m(e,"onChange"),0<e.length&&(n=new AI("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var bh=null,Kh=null;function $j(t){yL(t,0)}function xv(t){var e=zc(t);if(Ox(e))return t}function Hj(t,e){if(t==="change")return e}var lL=!1;if(Ds){var wC;if(Ds){var IC="oninput"in document;if(!IC){var YR=document.createElement("div");YR.setAttribute("oninput","return;"),IC=typeof YR.oninput=="function"}wC=IC}else wC=!1;lL=wC&&(!document.documentMode||9<document.documentMode)}function ZR(){bh&&(bh.detachEvent("onpropertychange",cL),Kh=bh=null)}function cL(t){if(t.propertyName==="value"&&xv(Kh)){var e=[];aL(e,Kh,t,TI(t)),qx($j,e)}}function qj(t,e,n){t==="focusin"?(ZR(),bh=e,Kh=n,bh.attachEvent("onpropertychange",cL)):t==="focusout"&&ZR()}function jj(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return xv(Kh)}function Vj(t,e){if(t==="click")return xv(e)}function zj(t,e){if(t==="input"||t==="change")return xv(e)}function Gj(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ho=typeof Object.is=="function"?Object.is:Gj;function Jh(t,e){if(Ho(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!NT.call(e,i)||!Ho(t[i],e[i]))return!1}return!0}function ek(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function tk(t,e){var n=ek(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ek(n)}}function uL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?uL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function dL(){for(var t=window,e=Dm();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Dm(t.document)}return e}function PI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Wj(t){var e=dL(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&uL(n.ownerDocument.documentElement,n)){if(r!==null&&PI(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=tk(n,o);var s=tk(n,r);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Kj=Ds&&"documentMode"in document&&11>=document.documentMode,jc=null,ZT=null,_h=null,eE=!1;function nk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;eE||jc==null||jc!==Dm(r)||(r=jc,"selectionStart"in r&&PI(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),_h&&Jh(_h,r)||(_h=r,r=$m(ZT,"onSelect"),0<r.length&&(e=new AI("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=jc)))}function Up(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Vc={animationend:Up("Animation","AnimationEnd"),animationiteration:Up("Animation","AnimationIteration"),animationstart:Up("Animation","AnimationStart"),transitionend:Up("Transition","TransitionEnd")},bC={},hL={};Ds&&(hL=document.createElement("div").style,"AnimationEvent"in window||(delete Vc.animationend.animation,delete Vc.animationiteration.animation,delete Vc.animationstart.animation),"TransitionEvent"in window||delete Vc.transitionend.transition);function Lv(t){if(bC[t])return bC[t];if(!Vc[t])return t;var e=Vc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in hL)return bC[t]=e[n];return t}var fL=Lv("animationend"),pL=Lv("animationiteration"),gL=Lv("animationstart"),mL=Lv("transitionend"),vL=new Map,rk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ya(t,e){vL.set(t,e),Ql(e,[t])}for(var _C=0;_C<rk.length;_C++){var AC=rk[_C],Jj=AC.toLowerCase(),Qj=AC[0].toUpperCase()+AC.slice(1);Ya(Jj,"on"+Qj)}Ya(fL,"onAnimationEnd");Ya(pL,"onAnimationIteration");Ya(gL,"onAnimationStart");Ya("dblclick","onDoubleClick");Ya("focusin","onFocus");Ya("focusout","onBlur");Ya(mL,"onTransitionEnd");yu("onMouseEnter",["mouseout","mouseover"]);yu("onMouseLeave",["mouseout","mouseover"]);yu("onPointerEnter",["pointerout","pointerover"]);yu("onPointerLeave",["pointerout","pointerover"]);Ql("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ql("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ql("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ql("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ql("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ql("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ph="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xj=new Set("cancel close invalid load scroll toggle".split(" ").concat(ph));function ik(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Jq(r,e,void 0,t),t.currentTarget=null}function yL(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,a=l.currentTarget;if(l=l.listener,c!==o&&i.isPropagationStopped())break e;ik(i,l,a),o=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,a=l.currentTarget,l=l.listener,c!==o&&i.isPropagationStopped())break e;ik(i,l,a),o=c}}}if(xm)throw t=JT,xm=!1,JT=null,t}function an(t,e){var n=e[oE];n===void 0&&(n=e[oE]=new Set);var r=t+"__bubble";n.has(r)||(CL(e,t,2,!1),n.add(r))}function RC(t,e,n){var r=0;e&&(r|=4),CL(n,t,r,e)}var Fp="_reactListening"+Math.random().toString(36).slice(2);function Qh(t){if(!t[Fp]){t[Fp]=!0,_x.forEach(function(n){n!=="selectionchange"&&(Xj.has(n)||RC(n,!1,t),RC(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Fp]||(e[Fp]=!0,RC("selectionchange",!1,e))}}function CL(t,e,n,r){switch(nL(e)){case 1:var i=dj;break;case 4:i=hj;break;default:i=bI}n=i.bind(null,e,n,t),i=void 0,!KT||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function kC(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;s=s.return}for(;l!==null;){if(s=wl(l),s===null)return;if(c=s.tag,c===5||c===6){r=o=s;continue e}l=l.parentNode}}r=r.return}qx(function(){var a=o,u=TI(n),d=[];e:{var f=vL.get(t);if(f!==void 0){var h=AI,g=t;switch(t){case"keypress":if(pm(n)===0)break e;case"keydown":case"keyup":h=Aj;break;case"focusin":g="focus",h=EC;break;case"focusout":g="blur",h=EC;break;case"beforeblur":case"afterblur":h=EC;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=GR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=gj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Pj;break;case fL:case pL:case gL:h=yj;break;case mL:h=Mj;break;case"scroll":h=fj;break;case"wheel":h=Nj;break;case"copy":case"cut":case"paste":h=Sj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=KR}var E=(e&4)!==0,D=!E&&t==="scroll",w=E?f!==null?f+"Capture":null:f;E=[];for(var p=a,b;p!==null;){b=p;var j=b.stateNode;if(b.tag===5&&j!==null&&(b=j,w!==null&&(j=Vh(p,w),j!=null&&E.push(Xh(p,j,b)))),D)break;p=p.return}0<E.length&&(f=new h(f,g,null,n,u),d.push({event:f,listeners:E}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==GT&&(g=n.relatedTarget||n.fromElement)&&(wl(g)||g[Ns]))break e;if((h||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,h?(g=n.relatedTarget||n.toElement,h=a,g=g?wl(g):null,g!==null&&(D=Xl(g),g!==D||g.tag!==5&&g.tag!==6)&&(g=null)):(h=null,g=a),h!==g)){if(E=GR,j="onMouseLeave",w="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(E=KR,j="onPointerLeave",w="onPointerEnter",p="pointer"),D=h==null?f:zc(h),b=g==null?f:zc(g),f=new E(j,p+"leave",h,n,u),f.target=D,f.relatedTarget=b,j=null,wl(u)===a&&(E=new E(w,p+"enter",g,n,u),E.target=b,E.relatedTarget=D,j=E),D=j,h&&g)t:{for(E=h,w=g,p=0,b=E;b;b=mc(b))p++;for(b=0,j=w;j;j=mc(j))b++;for(;0<p-b;)E=mc(E),p--;for(;0<b-p;)w=mc(w),b--;for(;p--;){if(E===w||w!==null&&E===w.alternate)break t;E=mc(E),w=mc(w)}E=null}else E=null;h!==null&&ok(d,f,h,E,!1),g!==null&&D!==null&&ok(d,D,g,E,!0)}}e:{if(f=a?zc(a):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var K=Hj;else if(XR(f))if(lL)K=zj;else{K=jj;var M=qj}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(K=Vj);if(K&&(K=K(t,a))){aL(d,K,n,u);break e}M&&M(t,f,a),t==="focusout"&&(M=f._wrapperState)&&M.controlled&&f.type==="number"&&HT(f,"number",f.value)}switch(M=a?zc(a):window,t){case"focusin":(XR(M)||M.contentEditable==="true")&&(jc=M,ZT=a,_h=null);break;case"focusout":_h=ZT=jc=null;break;case"mousedown":eE=!0;break;case"contextmenu":case"mouseup":case"dragend":eE=!1,nk(d,n,u);break;case"selectionchange":if(Kj)break;case"keydown":case"keyup":nk(d,n,u)}var ne;if(kI)e:{switch(t){case"compositionstart":var G="onCompositionStart";break e;case"compositionend":G="onCompositionEnd";break e;case"compositionupdate":G="onCompositionUpdate";break e}G=void 0}else qc?oL(t,n)&&(G="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(G="onCompositionStart");G&&(iL&&n.locale!=="ko"&&(qc||G!=="onCompositionStart"?G==="onCompositionEnd"&&qc&&(ne=rL()):(ya=u,_I="value"in ya?ya.value:ya.textContent,qc=!0)),M=$m(a,G),0<M.length&&(G=new WR(G,t,null,n,u),d.push({event:G,listeners:M}),ne?G.data=ne:(ne=sL(n),ne!==null&&(G.data=ne)))),(ne=Lj?Uj(t,n):Fj(t,n))&&(a=$m(a,"onBeforeInput"),0<a.length&&(u=new WR("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:a}),u.data=ne))}yL(d,e)})}function Xh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function $m(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Vh(t,n),o!=null&&r.unshift(Xh(t,o,i)),o=Vh(t,e),o!=null&&r.push(Xh(t,o,i))),t=t.return}return r}function mc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ok(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var l=n,c=l.alternate,a=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&a!==null&&(l=a,i?(c=Vh(n,o),c!=null&&s.unshift(Xh(n,c,l))):i||(c=Vh(n,o),c!=null&&s.push(Xh(n,c,l)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var Yj=/\r\n?/g,Zj=/\u0000|\uFFFD/g;function sk(t){return(typeof t=="string"?t:""+t).replace(Yj,`
`).replace(Zj,"")}function Bp(t,e,n){if(e=sk(e),sk(t)!==e&&n)throw Error(Be(425))}function Hm(){}var tE=null,nE=null;function rE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var iE=typeof setTimeout=="function"?setTimeout:void 0,eV=typeof clearTimeout=="function"?clearTimeout:void 0,ak=typeof Promise=="function"?Promise:void 0,tV=typeof queueMicrotask=="function"?queueMicrotask:typeof ak<"u"?function(t){return ak.resolve(null).then(t).catch(nV)}:iE;function nV(t){setTimeout(function(){throw t})}function PC(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Wh(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Wh(e)}function ba(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function lk(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Vu=Math.random().toString(36).slice(2),is="__reactFiber$"+Vu,Yh="__reactProps$"+Vu,Ns="__reactContainer$"+Vu,oE="__reactEvents$"+Vu,rV="__reactListeners$"+Vu,iV="__reactHandles$"+Vu;function wl(t){var e=t[is];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ns]||n[is]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=lk(t);t!==null;){if(n=t[is])return n;t=lk(t)}return e}t=n,n=t.parentNode}return null}function yf(t){return t=t[is]||t[Ns],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function zc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Be(33))}function Uv(t){return t[Yh]||null}var sE=[],Gc=-1;function Za(t){return{current:t}}function ln(t){0>Gc||(t.current=sE[Gc],sE[Gc]=null,Gc--)}function nn(t,e){Gc++,sE[Gc]=t.current,t.current=e}var $a={},Jr=Za($a),Ri=Za(!1),Ll=$a;function Cu(t,e){var n=t.type.contextTypes;if(!n)return $a;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function ki(t){return t=t.childContextTypes,t!=null}function qm(){ln(Ri),ln(Jr)}function ck(t,e,n){if(Jr.current!==$a)throw Error(Be(168));nn(Jr,e),nn(Ri,n)}function SL(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Be(108,qq(t)||"Unknown",i));return vn({},n,r)}function jm(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$a,Ll=Jr.current,nn(Jr,t),nn(Ri,Ri.current),!0}function uk(t,e,n){var r=t.stateNode;if(!r)throw Error(Be(169));n?(t=SL(t,e,Ll),r.__reactInternalMemoizedMergedChildContext=t,ln(Ri),ln(Jr),nn(Jr,t)):ln(Ri),nn(Ri,n)}var _s=null,Fv=!1,OC=!1;function TL(t){_s===null?_s=[t]:_s.push(t)}function oV(t){Fv=!0,TL(t)}function el(){if(!OC&&_s!==null){OC=!0;var t=0,e=jt;try{var n=_s;for(jt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}_s=null,Fv=!1}catch(i){throw _s!==null&&(_s=_s.slice(t+1)),Gx(EI,el),i}finally{jt=e,OC=!1}}return null}var Wc=[],Kc=0,Vm=null,zm=0,ro=[],io=0,Ul=null,As=1,Rs="";function yl(t,e){Wc[Kc++]=zm,Wc[Kc++]=Vm,Vm=t,zm=e}function EL(t,e,n){ro[io++]=As,ro[io++]=Rs,ro[io++]=Ul,Ul=t;var r=As;t=Rs;var i=32-xo(r)-1;r&=~(1<<i),n+=1;var o=32-xo(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,As=1<<32-xo(e)+i|n<<i|r,Rs=o+t}else As=1<<o|n<<i|r,Rs=t}function OI(t){t.return!==null&&(yl(t,1),EL(t,1,0))}function MI(t){for(;t===Vm;)Vm=Wc[--Kc],Wc[Kc]=null,zm=Wc[--Kc],Wc[Kc]=null;for(;t===Ul;)Ul=ro[--io],ro[io]=null,Rs=ro[--io],ro[io]=null,As=ro[--io],ro[io]=null}var Bi=null,Ui=null,un=!1,Ao=null;function wL(t,e){var n=oo(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function dk(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Bi=t,Ui=ba(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Bi=t,Ui=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ul!==null?{id:As,overflow:Rs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=oo(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Bi=t,Ui=null,!0):!1;default:return!1}}function aE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function lE(t){if(un){var e=Ui;if(e){var n=e;if(!dk(t,e)){if(aE(t))throw Error(Be(418));e=ba(n.nextSibling);var r=Bi;e&&dk(t,e)?wL(r,n):(t.flags=t.flags&-4097|2,un=!1,Bi=t)}}else{if(aE(t))throw Error(Be(418));t.flags=t.flags&-4097|2,un=!1,Bi=t}}}function hk(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Bi=t}function $p(t){if(t!==Bi)return!1;if(!un)return hk(t),un=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!rE(t.type,t.memoizedProps)),e&&(e=Ui)){if(aE(t))throw IL(),Error(Be(418));for(;e;)wL(t,e),e=ba(e.nextSibling)}if(hk(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Be(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ui=ba(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ui=null}}else Ui=Bi?ba(t.stateNode.nextSibling):null;return!0}function IL(){for(var t=Ui;t;)t=ba(t.nextSibling)}function Su(){Ui=Bi=null,un=!1}function DI(t){Ao===null?Ao=[t]:Ao.push(t)}var sV=qs.ReactCurrentBatchConfig;function Ad(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Be(309));var r=n.stateNode}if(!r)throw Error(Be(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var l=i.refs;s===null?delete l[o]:l[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(Be(284));if(!n._owner)throw Error(Be(290,t))}return t}function Hp(t,e){throw t=Object.prototype.toString.call(e),Error(Be(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fk(t){var e=t._init;return e(t._payload)}function bL(t){function e(w,p){if(t){var b=w.deletions;b===null?(w.deletions=[p],w.flags|=16):b.push(p)}}function n(w,p){if(!t)return null;for(;p!==null;)e(w,p),p=p.sibling;return null}function r(w,p){for(w=new Map;p!==null;)p.key!==null?w.set(p.key,p):w.set(p.index,p),p=p.sibling;return w}function i(w,p){return w=ka(w,p),w.index=0,w.sibling=null,w}function o(w,p,b){return w.index=b,t?(b=w.alternate,b!==null?(b=b.index,b<p?(w.flags|=2,p):b):(w.flags|=2,p)):(w.flags|=1048576,p)}function s(w){return t&&w.alternate===null&&(w.flags|=2),w}function l(w,p,b,j){return p===null||p.tag!==6?(p=FC(b,w.mode,j),p.return=w,p):(p=i(p,b),p.return=w,p)}function c(w,p,b,j){var K=b.type;return K===Hc?u(w,p,b.props.children,j,b.key):p!==null&&(p.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ua&&fk(K)===p.type)?(j=i(p,b.props),j.ref=Ad(w,p,b),j.return=w,j):(j=Tm(b.type,b.key,b.props,null,w.mode,j),j.ref=Ad(w,p,b),j.return=w,j)}function a(w,p,b,j){return p===null||p.tag!==4||p.stateNode.containerInfo!==b.containerInfo||p.stateNode.implementation!==b.implementation?(p=BC(b,w.mode,j),p.return=w,p):(p=i(p,b.children||[]),p.return=w,p)}function u(w,p,b,j,K){return p===null||p.tag!==7?(p=Al(b,w.mode,j,K),p.return=w,p):(p=i(p,b),p.return=w,p)}function d(w,p,b){if(typeof p=="string"&&p!==""||typeof p=="number")return p=FC(""+p,w.mode,b),p.return=w,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Pp:return b=Tm(p.type,p.key,p.props,null,w.mode,b),b.ref=Ad(w,null,p),b.return=w,b;case $c:return p=BC(p,w.mode,b),p.return=w,p;case ua:var j=p._init;return d(w,j(p._payload),b)}if(hh(p)||Ed(p))return p=Al(p,w.mode,b,null),p.return=w,p;Hp(w,p)}return null}function f(w,p,b,j){var K=p!==null?p.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return K!==null?null:l(w,p,""+b,j);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Pp:return b.key===K?c(w,p,b,j):null;case $c:return b.key===K?a(w,p,b,j):null;case ua:return K=b._init,f(w,p,K(b._payload),j)}if(hh(b)||Ed(b))return K!==null?null:u(w,p,b,j,null);Hp(w,b)}return null}function h(w,p,b,j,K){if(typeof j=="string"&&j!==""||typeof j=="number")return w=w.get(b)||null,l(p,w,""+j,K);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Pp:return w=w.get(j.key===null?b:j.key)||null,c(p,w,j,K);case $c:return w=w.get(j.key===null?b:j.key)||null,a(p,w,j,K);case ua:var M=j._init;return h(w,p,b,M(j._payload),K)}if(hh(j)||Ed(j))return w=w.get(b)||null,u(p,w,j,K,null);Hp(p,j)}return null}function g(w,p,b,j){for(var K=null,M=null,ne=p,G=p=0,oe=null;ne!==null&&G<b.length;G++){ne.index>G?(oe=ne,ne=null):oe=ne.sibling;var J=f(w,ne,b[G],j);if(J===null){ne===null&&(ne=oe);break}t&&ne&&J.alternate===null&&e(w,ne),p=o(J,p,G),M===null?K=J:M.sibling=J,M=J,ne=oe}if(G===b.length)return n(w,ne),un&&yl(w,G),K;if(ne===null){for(;G<b.length;G++)ne=d(w,b[G],j),ne!==null&&(p=o(ne,p,G),M===null?K=ne:M.sibling=ne,M=ne);return un&&yl(w,G),K}for(ne=r(w,ne);G<b.length;G++)oe=h(ne,w,G,b[G],j),oe!==null&&(t&&oe.alternate!==null&&ne.delete(oe.key===null?G:oe.key),p=o(oe,p,G),M===null?K=oe:M.sibling=oe,M=oe);return t&&ne.forEach(function(X){return e(w,X)}),un&&yl(w,G),K}function E(w,p,b,j){var K=Ed(b);if(typeof K!="function")throw Error(Be(150));if(b=K.call(b),b==null)throw Error(Be(151));for(var M=K=null,ne=p,G=p=0,oe=null,J=b.next();ne!==null&&!J.done;G++,J=b.next()){ne.index>G?(oe=ne,ne=null):oe=ne.sibling;var X=f(w,ne,J.value,j);if(X===null){ne===null&&(ne=oe);break}t&&ne&&X.alternate===null&&e(w,ne),p=o(X,p,G),M===null?K=X:M.sibling=X,M=X,ne=oe}if(J.done)return n(w,ne),un&&yl(w,G),K;if(ne===null){for(;!J.done;G++,J=b.next())J=d(w,J.value,j),J!==null&&(p=o(J,p,G),M===null?K=J:M.sibling=J,M=J);return un&&yl(w,G),K}for(ne=r(w,ne);!J.done;G++,J=b.next())J=h(ne,w,G,J.value,j),J!==null&&(t&&J.alternate!==null&&ne.delete(J.key===null?G:J.key),p=o(J,p,G),M===null?K=J:M.sibling=J,M=J);return t&&ne.forEach(function(B){return e(w,B)}),un&&yl(w,G),K}function D(w,p,b,j){if(typeof b=="object"&&b!==null&&b.type===Hc&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Pp:e:{for(var K=b.key,M=p;M!==null;){if(M.key===K){if(K=b.type,K===Hc){if(M.tag===7){n(w,M.sibling),p=i(M,b.props.children),p.return=w,w=p;break e}}else if(M.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ua&&fk(K)===M.type){n(w,M.sibling),p=i(M,b.props),p.ref=Ad(w,M,b),p.return=w,w=p;break e}n(w,M);break}else e(w,M);M=M.sibling}b.type===Hc?(p=Al(b.props.children,w.mode,j,b.key),p.return=w,w=p):(j=Tm(b.type,b.key,b.props,null,w.mode,j),j.ref=Ad(w,p,b),j.return=w,w=j)}return s(w);case $c:e:{for(M=b.key;p!==null;){if(p.key===M)if(p.tag===4&&p.stateNode.containerInfo===b.containerInfo&&p.stateNode.implementation===b.implementation){n(w,p.sibling),p=i(p,b.children||[]),p.return=w,w=p;break e}else{n(w,p);break}else e(w,p);p=p.sibling}p=BC(b,w.mode,j),p.return=w,w=p}return s(w);case ua:return M=b._init,D(w,p,M(b._payload),j)}if(hh(b))return g(w,p,b,j);if(Ed(b))return E(w,p,b,j);Hp(w,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,p!==null&&p.tag===6?(n(w,p.sibling),p=i(p,b),p.return=w,w=p):(n(w,p),p=FC(b,w.mode,j),p.return=w,w=p),s(w)):n(w,p)}return D}var Tu=bL(!0),_L=bL(!1),Gm=Za(null),Wm=null,Jc=null,NI=null;function xI(){NI=Jc=Wm=null}function LI(t){var e=Gm.current;ln(Gm),t._currentValue=e}function cE(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function du(t,e){Wm=t,NI=Jc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(_i=!0),t.firstContext=null)}function uo(t){var e=t._currentValue;if(NI!==t)if(t={context:t,memoizedValue:e,next:null},Jc===null){if(Wm===null)throw Error(Be(308));Jc=t,Wm.dependencies={lanes:0,firstContext:t}}else Jc=Jc.next=t;return e}var Il=null;function UI(t){Il===null?Il=[t]:Il.push(t)}function AL(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,UI(e)):(n.next=i.next,i.next=n),e.interleaved=n,xs(t,r)}function xs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var da=!1;function FI(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function RL(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Os(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function _a(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,xt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,xs(t,n)}return i=r.interleaved,i===null?(e.next=e,UI(r)):(e.next=i.next,i.next=e),r.interleaved=e,xs(t,n)}function gm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wI(t,n)}}function pk(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Km(t,e,n,r){var i=t.updateQueue;da=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,a=c.next;c.next=null,s===null?o=a:s.next=a,s=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==s&&(l===null?u.firstBaseUpdate=a:l.next=a,u.lastBaseUpdate=c))}if(o!==null){var d=i.baseState;s=0,u=a=c=null,l=o;do{var f=l.lane,h=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:h,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var g=t,E=l;switch(f=e,h=n,E.tag){case 1:if(g=E.payload,typeof g=="function"){d=g.call(h,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=E.payload,f=typeof g=="function"?g.call(h,d,f):g,f==null)break e;d=vn({},d,f);break e;case 2:da=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[l]:f.push(l))}else h={eventTime:h,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(a=u=h,c=d):u=u.next=h,s|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;f=l,l=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=a,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Bl|=s,t.lanes=s,t.memoizedState=d}}function gk(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Be(191,i));i.call(r)}}}var Cf={},as=Za(Cf),Zh=Za(Cf),ef=Za(Cf);function bl(t){if(t===Cf)throw Error(Be(174));return t}function BI(t,e){switch(nn(ef,e),nn(Zh,t),nn(as,Cf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:jT(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=jT(e,t)}ln(as),nn(as,e)}function Eu(){ln(as),ln(Zh),ln(ef)}function kL(t){bl(ef.current);var e=bl(as.current),n=jT(e,t.type);e!==n&&(nn(Zh,t),nn(as,n))}function $I(t){Zh.current===t&&(ln(as),ln(Zh))}var gn=Za(0);function Jm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var MC=[];function HI(){for(var t=0;t<MC.length;t++)MC[t]._workInProgressVersionPrimary=null;MC.length=0}var mm=qs.ReactCurrentDispatcher,DC=qs.ReactCurrentBatchConfig,Fl=0,mn=null,Zn=null,dr=null,Qm=!1,Ah=!1,tf=0,aV=0;function $r(){throw Error(Be(321))}function qI(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ho(t[n],e[n]))return!1;return!0}function jI(t,e,n,r,i,o){if(Fl=o,mn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,mm.current=t===null||t.memoizedState===null?dV:hV,t=n(r,i),Ah){o=0;do{if(Ah=!1,tf=0,25<=o)throw Error(Be(301));o+=1,dr=Zn=null,e.updateQueue=null,mm.current=fV,t=n(r,i)}while(Ah)}if(mm.current=Xm,e=Zn!==null&&Zn.next!==null,Fl=0,dr=Zn=mn=null,Qm=!1,e)throw Error(Be(300));return t}function VI(){var t=tf!==0;return tf=0,t}function rs(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?mn.memoizedState=dr=t:dr=dr.next=t,dr}function ho(){if(Zn===null){var t=mn.alternate;t=t!==null?t.memoizedState:null}else t=Zn.next;var e=dr===null?mn.memoizedState:dr.next;if(e!==null)dr=e,Zn=t;else{if(t===null)throw Error(Be(310));Zn=t,t={memoizedState:Zn.memoizedState,baseState:Zn.baseState,baseQueue:Zn.baseQueue,queue:Zn.queue,next:null},dr===null?mn.memoizedState=dr=t:dr=dr.next=t}return dr}function nf(t,e){return typeof e=="function"?e(t):e}function NC(t){var e=ho(),n=e.queue;if(n===null)throw Error(Be(311));n.lastRenderedReducer=t;var r=Zn,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var l=s=null,c=null,a=o;do{var u=a.lane;if((Fl&u)===u)c!==null&&(c=c.next={lane:0,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null}),r=a.hasEagerState?a.eagerState:t(r,a.action);else{var d={lane:u,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null};c===null?(l=c=d,s=r):c=c.next=d,mn.lanes|=u,Bl|=u}a=a.next}while(a!==null&&a!==o);c===null?s=r:c.next=l,Ho(r,e.memoizedState)||(_i=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,mn.lanes|=o,Bl|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function xC(t){var e=ho(),n=e.queue;if(n===null)throw Error(Be(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);Ho(o,e.memoizedState)||(_i=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function PL(){}function OL(t,e){var n=mn,r=ho(),i=e(),o=!Ho(r.memoizedState,i);if(o&&(r.memoizedState=i,_i=!0),r=r.queue,zI(NL.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||dr!==null&&dr.memoizedState.tag&1){if(n.flags|=2048,rf(9,DL.bind(null,n,r,i,e),void 0,null),vr===null)throw Error(Be(349));Fl&30||ML(n,e,i)}return i}function ML(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=mn.updateQueue,e===null?(e={lastEffect:null,stores:null},mn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function DL(t,e,n,r){e.value=n,e.getSnapshot=r,xL(e)&&LL(t)}function NL(t,e,n){return n(function(){xL(e)&&LL(t)})}function xL(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ho(t,n)}catch{return!0}}function LL(t){var e=xs(t,1);e!==null&&Lo(e,t,1,-1)}function mk(t){var e=rs();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nf,lastRenderedState:t},e.queue=t,t=t.dispatch=uV.bind(null,mn,t),[e.memoizedState,t]}function rf(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=mn.updateQueue,e===null?(e={lastEffect:null,stores:null},mn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function UL(){return ho().memoizedState}function vm(t,e,n,r){var i=rs();mn.flags|=t,i.memoizedState=rf(1|e,n,void 0,r===void 0?null:r)}function Bv(t,e,n,r){var i=ho();r=r===void 0?null:r;var o=void 0;if(Zn!==null){var s=Zn.memoizedState;if(o=s.destroy,r!==null&&qI(r,s.deps)){i.memoizedState=rf(e,n,o,r);return}}mn.flags|=t,i.memoizedState=rf(1|e,n,o,r)}function vk(t,e){return vm(8390656,8,t,e)}function zI(t,e){return Bv(2048,8,t,e)}function FL(t,e){return Bv(4,2,t,e)}function BL(t,e){return Bv(4,4,t,e)}function $L(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function HL(t,e,n){return n=n!=null?n.concat([t]):null,Bv(4,4,$L.bind(null,e,t),n)}function GI(){}function qL(t,e){var n=ho();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qI(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function jL(t,e){var n=ho();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qI(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function VL(t,e,n){return Fl&21?(Ho(n,e)||(n=Jx(),mn.lanes|=n,Bl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,_i=!0),t.memoizedState=n)}function lV(t,e){var n=jt;jt=n!==0&&4>n?n:4,t(!0);var r=DC.transition;DC.transition={};try{t(!1),e()}finally{jt=n,DC.transition=r}}function zL(){return ho().memoizedState}function cV(t,e,n){var r=Ra(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},GL(t))WL(e,n);else if(n=AL(t,e,n,r),n!==null){var i=ci();Lo(n,t,r,i),KL(n,e,r)}}function uV(t,e,n){var r=Ra(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(GL(t))WL(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,l=o(s,n);if(i.hasEagerState=!0,i.eagerState=l,Ho(l,s)){var c=e.interleaved;c===null?(i.next=i,UI(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=AL(t,e,i,r),n!==null&&(i=ci(),Lo(n,t,r,i),KL(n,e,r))}}function GL(t){var e=t.alternate;return t===mn||e!==null&&e===mn}function WL(t,e){Ah=Qm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function KL(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wI(t,n)}}var Xm={readContext:uo,useCallback:$r,useContext:$r,useEffect:$r,useImperativeHandle:$r,useInsertionEffect:$r,useLayoutEffect:$r,useMemo:$r,useReducer:$r,useRef:$r,useState:$r,useDebugValue:$r,useDeferredValue:$r,useTransition:$r,useMutableSource:$r,useSyncExternalStore:$r,useId:$r,unstable_isNewReconciler:!1},dV={readContext:uo,useCallback:function(t,e){return rs().memoizedState=[t,e===void 0?null:e],t},useContext:uo,useEffect:vk,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,vm(4194308,4,$L.bind(null,e,t),n)},useLayoutEffect:function(t,e){return vm(4194308,4,t,e)},useInsertionEffect:function(t,e){return vm(4,2,t,e)},useMemo:function(t,e){var n=rs();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=rs();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=cV.bind(null,mn,t),[r.memoizedState,t]},useRef:function(t){var e=rs();return t={current:t},e.memoizedState=t},useState:mk,useDebugValue:GI,useDeferredValue:function(t){return rs().memoizedState=t},useTransition:function(){var t=mk(!1),e=t[0];return t=lV.bind(null,t[1]),rs().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=mn,i=rs();if(un){if(n===void 0)throw Error(Be(407));n=n()}else{if(n=e(),vr===null)throw Error(Be(349));Fl&30||ML(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,vk(NL.bind(null,r,o,t),[t]),r.flags|=2048,rf(9,DL.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=rs(),e=vr.identifierPrefix;if(un){var n=Rs,r=As;n=(r&~(1<<32-xo(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=tf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=aV++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},hV={readContext:uo,useCallback:qL,useContext:uo,useEffect:zI,useImperativeHandle:HL,useInsertionEffect:FL,useLayoutEffect:BL,useMemo:jL,useReducer:NC,useRef:UL,useState:function(){return NC(nf)},useDebugValue:GI,useDeferredValue:function(t){var e=ho();return VL(e,Zn.memoizedState,t)},useTransition:function(){var t=NC(nf)[0],e=ho().memoizedState;return[t,e]},useMutableSource:PL,useSyncExternalStore:OL,useId:zL,unstable_isNewReconciler:!1},fV={readContext:uo,useCallback:qL,useContext:uo,useEffect:zI,useImperativeHandle:HL,useInsertionEffect:FL,useLayoutEffect:BL,useMemo:jL,useReducer:xC,useRef:UL,useState:function(){return xC(nf)},useDebugValue:GI,useDeferredValue:function(t){var e=ho();return Zn===null?e.memoizedState=t:VL(e,Zn.memoizedState,t)},useTransition:function(){var t=xC(nf)[0],e=ho().memoizedState;return[t,e]},useMutableSource:PL,useSyncExternalStore:OL,useId:zL,unstable_isNewReconciler:!1};function bo(t,e){if(t&&t.defaultProps){e=vn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function uE(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:vn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $v={isMounted:function(t){return(t=t._reactInternals)?Xl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=ci(),i=Ra(t),o=Os(r,i);o.payload=e,n!=null&&(o.callback=n),e=_a(t,o,i),e!==null&&(Lo(e,t,i,r),gm(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=ci(),i=Ra(t),o=Os(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=_a(t,o,i),e!==null&&(Lo(e,t,i,r),gm(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ci(),r=Ra(t),i=Os(n,r);i.tag=2,e!=null&&(i.callback=e),e=_a(t,i,r),e!==null&&(Lo(e,t,r,n),gm(e,t,r))}};function yk(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Jh(n,r)||!Jh(i,o):!0}function JL(t,e,n){var r=!1,i=$a,o=e.contextType;return typeof o=="object"&&o!==null?o=uo(o):(i=ki(e)?Ll:Jr.current,r=e.contextTypes,o=(r=r!=null)?Cu(t,i):$a),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$v,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function Ck(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&$v.enqueueReplaceState(e,e.state,null)}function dE(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},FI(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=uo(o):(o=ki(e)?Ll:Jr.current,i.context=Cu(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(uE(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&$v.enqueueReplaceState(i,i.state,null),Km(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function wu(t,e){try{var n="",r=e;do n+=Hq(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function LC(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function hE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var pV=typeof WeakMap=="function"?WeakMap:Map;function QL(t,e,n){n=Os(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Zm||(Zm=!0,EE=r),hE(t,e)},n}function XL(t,e,n){n=Os(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){hE(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){hE(t,e),typeof r!="function"&&(Aa===null?Aa=new Set([this]):Aa.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function Sk(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new pV;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=RV.bind(null,t,e,n),e.then(t,t))}function Tk(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ek(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Os(-1,1),e.tag=2,_a(n,e,1))),n.lanes|=1),t)}var gV=qs.ReactCurrentOwner,_i=!1;function si(t,e,n,r){e.child=t===null?_L(e,null,n,r):Tu(e,t.child,n,r)}function wk(t,e,n,r,i){n=n.render;var o=e.ref;return du(e,i),r=jI(t,e,n,r,o,i),n=VI(),t!==null&&!_i?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ls(t,e,i)):(un&&n&&OI(e),e.flags|=1,si(t,e,r,i),e.child)}function Ik(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!eb(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,YL(t,e,o,r,i)):(t=Tm(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:Jh,n(s,r)&&t.ref===e.ref)return Ls(t,e,i)}return e.flags|=1,t=ka(o,r),t.ref=e.ref,t.return=e,e.child=t}function YL(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(Jh(o,r)&&t.ref===e.ref)if(_i=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(_i=!0);else return e.lanes=t.lanes,Ls(t,e,i)}return fE(t,e,n,r,i)}function ZL(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nn(Xc,xi),xi|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nn(Xc,xi),xi|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,nn(Xc,xi),xi|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,nn(Xc,xi),xi|=r;return si(t,e,i,n),e.child}function eU(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function fE(t,e,n,r,i){var o=ki(n)?Ll:Jr.current;return o=Cu(e,o),du(e,i),n=jI(t,e,n,r,o,i),r=VI(),t!==null&&!_i?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ls(t,e,i)):(un&&r&&OI(e),e.flags|=1,si(t,e,n,i),e.child)}function bk(t,e,n,r,i){if(ki(n)){var o=!0;jm(e)}else o=!1;if(du(e,i),e.stateNode===null)ym(t,e),JL(e,n,r),dE(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,l=e.memoizedProps;s.props=l;var c=s.context,a=n.contextType;typeof a=="object"&&a!==null?a=uo(a):(a=ki(n)?Ll:Jr.current,a=Cu(e,a));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==a)&&Ck(e,s,r,a),da=!1;var f=e.memoizedState;s.state=f,Km(e,r,s,i),c=e.memoizedState,l!==r||f!==c||Ri.current||da?(typeof u=="function"&&(uE(e,n,u,r),c=e.memoizedState),(l=da||yk(e,n,l,r,f,c,a))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),s.props=r,s.state=c,s.context=a,r=l):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,RL(t,e),l=e.memoizedProps,a=e.type===e.elementType?l:bo(e.type,l),s.props=a,d=e.pendingProps,f=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=uo(c):(c=ki(n)?Ll:Jr.current,c=Cu(e,c));var h=n.getDerivedStateFromProps;(u=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==d||f!==c)&&Ck(e,s,r,c),da=!1,f=e.memoizedState,s.state=f,Km(e,r,s,i);var g=e.memoizedState;l!==d||f!==g||Ri.current||da?(typeof h=="function"&&(uE(e,n,h,r),g=e.memoizedState),(a=da||yk(e,n,a,r,f,g,c)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),s.props=r,s.state=g,s.context=c,r=a):(typeof s.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return pE(t,e,n,r,o,i)}function pE(t,e,n,r,i,o){eU(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&uk(e,n,!1),Ls(t,e,o);r=e.stateNode,gV.current=e;var l=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=Tu(e,t.child,null,o),e.child=Tu(e,null,l,o)):si(t,e,l,o),e.memoizedState=r.state,i&&uk(e,n,!0),e.child}function tU(t){var e=t.stateNode;e.pendingContext?ck(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ck(t,e.context,!1),BI(t,e.containerInfo)}function _k(t,e,n,r,i){return Su(),DI(i),e.flags|=256,si(t,e,n,r),e.child}var gE={dehydrated:null,treeContext:null,retryLane:0};function mE(t){return{baseLanes:t,cachePool:null,transitions:null}}function nU(t,e,n){var r=e.pendingProps,i=gn.current,o=!1,s=(e.flags&128)!==0,l;if((l=s)||(l=t!==null&&t.memoizedState===null?!1:(i&2)!==0),l?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),nn(gn,i&1),t===null)return lE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=jv(s,r,0,null),t=Al(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=mE(n),e.memoizedState=gE,t):WI(e,s));if(i=t.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return mV(t,e,s,r,l,i,n);if(o){o=r.fallback,s=e.mode,i=t.child,l=i.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ka(i,c),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?o=ka(l,o):(o=Al(o,s,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=t.child.memoizedState,s=s===null?mE(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~n,e.memoizedState=gE,r}return o=t.child,t=o.sibling,r=ka(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function WI(t,e){return e=jv({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function qp(t,e,n,r){return r!==null&&DI(r),Tu(e,t.child,null,n),t=WI(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function mV(t,e,n,r,i,o,s){if(n)return e.flags&256?(e.flags&=-257,r=LC(Error(Be(422))),qp(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=jv({mode:"visible",children:r.children},i,0,null),o=Al(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Tu(e,t.child,null,s),e.child.memoizedState=mE(s),e.memoizedState=gE,o);if(!(e.mode&1))return qp(t,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,o=Error(Be(419)),r=LC(o,r,void 0),qp(t,e,s,r)}if(l=(s&t.childLanes)!==0,_i||l){if(r=vr,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,xs(t,i),Lo(r,t,i,-1))}return ZI(),r=LC(Error(Be(421))),qp(t,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=kV.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Ui=ba(i.nextSibling),Bi=e,un=!0,Ao=null,t!==null&&(ro[io++]=As,ro[io++]=Rs,ro[io++]=Ul,As=t.id,Rs=t.overflow,Ul=e),e=WI(e,r.children),e.flags|=4096,e)}function Ak(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),cE(t.return,e,n)}function UC(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function rU(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(si(t,e,r.children,n),r=gn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ak(t,n,e);else if(t.tag===19)Ak(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(nn(gn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Jm(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),UC(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Jm(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}UC(e,!0,n,null,o);break;case"together":UC(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ym(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ls(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Bl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Be(153));if(e.child!==null){for(t=e.child,n=ka(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ka(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function vV(t,e,n){switch(e.tag){case 3:tU(e),Su();break;case 5:kL(e);break;case 1:ki(e.type)&&jm(e);break;case 4:BI(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;nn(Gm,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(nn(gn,gn.current&1),e.flags|=128,null):n&e.child.childLanes?nU(t,e,n):(nn(gn,gn.current&1),t=Ls(t,e,n),t!==null?t.sibling:null);nn(gn,gn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return rU(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),nn(gn,gn.current),r)break;return null;case 22:case 23:return e.lanes=0,ZL(t,e,n)}return Ls(t,e,n)}var iU,vE,oU,sU;iU=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};vE=function(){};oU=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,bl(as.current);var o=null;switch(n){case"input":i=BT(t,i),r=BT(t,r),o=[];break;case"select":i=vn({},i,{value:void 0}),r=vn({},r,{value:void 0}),o=[];break;case"textarea":i=qT(t,i),r=qT(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Hm)}VT(n,r);var s;n=null;for(a in i)if(!r.hasOwnProperty(a)&&i.hasOwnProperty(a)&&i[a]!=null)if(a==="style"){var l=i[a];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else a!=="dangerouslySetInnerHTML"&&a!=="children"&&a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(qh.hasOwnProperty(a)?o||(o=[]):(o=o||[]).push(a,null));for(a in r){var c=r[a];if(l=i!=null?i[a]:void 0,r.hasOwnProperty(a)&&c!==l&&(c!=null||l!=null))if(a==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(a,n)),n=c;else a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(a,c)):a==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(a,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&(qh.hasOwnProperty(a)?(c!=null&&a==="onScroll"&&an("scroll",t),o||l===c||(o=[])):(o=o||[]).push(a,c))}n&&(o=o||[]).push("style",n);var a=o;(e.updateQueue=a)&&(e.flags|=4)}};sU=function(t,e,n,r){n!==r&&(e.flags|=4)};function Rd(t,e){if(!un)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Hr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function yV(t,e,n){var r=e.pendingProps;switch(MI(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hr(e),null;case 1:return ki(e.type)&&qm(),Hr(e),null;case 3:return r=e.stateNode,Eu(),ln(Ri),ln(Jr),HI(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($p(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ao!==null&&(bE(Ao),Ao=null))),vE(t,e),Hr(e),null;case 5:$I(e);var i=bl(ef.current);if(n=e.type,t!==null&&e.stateNode!=null)oU(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Be(166));return Hr(e),null}if(t=bl(as.current),$p(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[is]=e,r[Yh]=o,t=(e.mode&1)!==0,n){case"dialog":an("cancel",r),an("close",r);break;case"iframe":case"object":case"embed":an("load",r);break;case"video":case"audio":for(i=0;i<ph.length;i++)an(ph[i],r);break;case"source":an("error",r);break;case"img":case"image":case"link":an("error",r),an("load",r);break;case"details":an("toggle",r);break;case"input":LR(r,o),an("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},an("invalid",r);break;case"textarea":FR(r,o),an("invalid",r)}VT(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="children"?typeof l=="string"?r.textContent!==l&&(o.suppressHydrationWarning!==!0&&Bp(r.textContent,l,t),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Bp(r.textContent,l,t),i=["children",""+l]):qh.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&an("scroll",r)}switch(n){case"input":Op(r),UR(r,o,!0);break;case"textarea":Op(r),BR(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Hm)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Nx(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[is]=e,t[Yh]=r,iU(t,e,!1,!1),e.stateNode=t;e:{switch(s=zT(n,r),n){case"dialog":an("cancel",t),an("close",t),i=r;break;case"iframe":case"object":case"embed":an("load",t),i=r;break;case"video":case"audio":for(i=0;i<ph.length;i++)an(ph[i],t);i=r;break;case"source":an("error",t),i=r;break;case"img":case"image":case"link":an("error",t),an("load",t),i=r;break;case"details":an("toggle",t),i=r;break;case"input":LR(t,r),i=BT(t,r),an("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=vn({},r,{value:void 0}),an("invalid",t);break;case"textarea":FR(t,r),i=qT(t,r),an("invalid",t);break;default:i=r}VT(n,i),l=i;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?Ux(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&xx(t,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&jh(t,c):typeof c=="number"&&jh(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(qh.hasOwnProperty(o)?c!=null&&o==="onScroll"&&an("scroll",t):c!=null&&vI(t,o,c,s))}switch(n){case"input":Op(t),UR(t,r,!1);break;case"textarea":Op(t),BR(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ba(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?au(t,!!r.multiple,o,!1):r.defaultValue!=null&&au(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Hm)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Hr(e),null;case 6:if(t&&e.stateNode!=null)sU(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Be(166));if(n=bl(ef.current),bl(as.current),$p(e)){if(r=e.stateNode,n=e.memoizedProps,r[is]=e,(o=r.nodeValue!==n)&&(t=Bi,t!==null))switch(t.tag){case 3:Bp(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Bp(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[is]=e,e.stateNode=r}return Hr(e),null;case 13:if(ln(gn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(un&&Ui!==null&&e.mode&1&&!(e.flags&128))IL(),Su(),e.flags|=98560,o=!1;else if(o=$p(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(Be(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Be(317));o[is]=e}else Su(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Hr(e),o=!1}else Ao!==null&&(bE(Ao),Ao=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||gn.current&1?tr===0&&(tr=3):ZI())),e.updateQueue!==null&&(e.flags|=4),Hr(e),null);case 4:return Eu(),vE(t,e),t===null&&Qh(e.stateNode.containerInfo),Hr(e),null;case 10:return LI(e.type._context),Hr(e),null;case 17:return ki(e.type)&&qm(),Hr(e),null;case 19:if(ln(gn),o=e.memoizedState,o===null)return Hr(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)Rd(o,!1);else{if(tr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=Jm(t),s!==null){for(e.flags|=128,Rd(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return nn(gn,gn.current&1|2),e.child}t=t.sibling}o.tail!==null&&Pn()>Iu&&(e.flags|=128,r=!0,Rd(o,!1),e.lanes=4194304)}else{if(!r)if(t=Jm(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Rd(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!un)return Hr(e),null}else 2*Pn()-o.renderingStartTime>Iu&&n!==1073741824&&(e.flags|=128,r=!0,Rd(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(n=o.last,n!==null?n.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Pn(),e.sibling=null,n=gn.current,nn(gn,r?n&1|2:n&1),e):(Hr(e),null);case 22:case 23:return YI(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?xi&1073741824&&(Hr(e),e.subtreeFlags&6&&(e.flags|=8192)):Hr(e),null;case 24:return null;case 25:return null}throw Error(Be(156,e.tag))}function CV(t,e){switch(MI(e),e.tag){case 1:return ki(e.type)&&qm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Eu(),ln(Ri),ln(Jr),HI(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $I(e),null;case 13:if(ln(gn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Be(340));Su()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ln(gn),null;case 4:return Eu(),null;case 10:return LI(e.type._context),null;case 22:case 23:return YI(),null;case 24:return null;default:return null}}var jp=!1,Wr=!1,SV=typeof WeakSet=="function"?WeakSet:Set,it=null;function Qc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){wn(t,e,r)}else n.current=null}function yE(t,e,n){try{n()}catch(r){wn(t,e,r)}}var Rk=!1;function TV(t,e){if(tE=Fm,t=dL(),PI(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,l=-1,c=-1,a=0,u=0,d=t,f=null;t:for(;;){for(var h;d!==n||i!==0&&d.nodeType!==3||(l=s+i),d!==o||r!==0&&d.nodeType!==3||(c=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++a===i&&(l=s),f===o&&++u===r&&(c=s),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nE={focusedElem:t,selectionRange:n},Fm=!1,it=e;it!==null;)if(e=it,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,it=t;else for(;it!==null;){e=it;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var E=g.memoizedProps,D=g.memoizedState,w=e.stateNode,p=w.getSnapshotBeforeUpdate(e.elementType===e.type?E:bo(e.type,E),D);w.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Be(163))}}catch(j){wn(e,e.return,j)}if(t=e.sibling,t!==null){t.return=e.return,it=t;break}it=e.return}return g=Rk,Rk=!1,g}function Rh(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&yE(e,n,o)}i=i.next}while(i!==r)}}function Hv(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function CE(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function aU(t){var e=t.alternate;e!==null&&(t.alternate=null,aU(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[is],delete e[Yh],delete e[oE],delete e[rV],delete e[iV])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function lU(t){return t.tag===5||t.tag===3||t.tag===4}function kk(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||lU(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function SE(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Hm));else if(r!==4&&(t=t.child,t!==null))for(SE(t,e,n),t=t.sibling;t!==null;)SE(t,e,n),t=t.sibling}function TE(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(TE(t,e,n),t=t.sibling;t!==null;)TE(t,e,n),t=t.sibling}var br=null,_o=!1;function na(t,e,n){for(n=n.child;n!==null;)cU(t,e,n),n=n.sibling}function cU(t,e,n){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(Dv,n)}catch{}switch(n.tag){case 5:Wr||Qc(n,e);case 6:var r=br,i=_o;br=null,na(t,e,n),br=r,_o=i,br!==null&&(_o?(t=br,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):br.removeChild(n.stateNode));break;case 18:br!==null&&(_o?(t=br,n=n.stateNode,t.nodeType===8?PC(t.parentNode,n):t.nodeType===1&&PC(t,n),Wh(t)):PC(br,n.stateNode));break;case 4:r=br,i=_o,br=n.stateNode.containerInfo,_o=!0,na(t,e,n),br=r,_o=i;break;case 0:case 11:case 14:case 15:if(!Wr&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&yE(n,e,s),i=i.next}while(i!==r)}na(t,e,n);break;case 1:if(!Wr&&(Qc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){wn(n,e,l)}na(t,e,n);break;case 21:na(t,e,n);break;case 22:n.mode&1?(Wr=(r=Wr)||n.memoizedState!==null,na(t,e,n),Wr=r):na(t,e,n);break;default:na(t,e,n)}}function Pk(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SV),e.forEach(function(r){var i=PV.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Co(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,s=e,l=s;e:for(;l!==null;){switch(l.tag){case 5:br=l.stateNode,_o=!1;break e;case 3:br=l.stateNode.containerInfo,_o=!0;break e;case 4:br=l.stateNode.containerInfo,_o=!0;break e}l=l.return}if(br===null)throw Error(Be(160));cU(o,s,i),br=null,_o=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(a){wn(i,e,a)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)uU(e,t),e=e.sibling}function uU(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Co(e,t),Qo(t),r&4){try{Rh(3,t,t.return),Hv(3,t)}catch(E){wn(t,t.return,E)}try{Rh(5,t,t.return)}catch(E){wn(t,t.return,E)}}break;case 1:Co(e,t),Qo(t),r&512&&n!==null&&Qc(n,n.return);break;case 5:if(Co(e,t),Qo(t),r&512&&n!==null&&Qc(n,n.return),t.flags&32){var i=t.stateNode;try{jh(i,"")}catch(E){wn(t,t.return,E)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=n!==null?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&Mx(i,o),zT(l,s);var a=zT(l,o);for(s=0;s<c.length;s+=2){var u=c[s],d=c[s+1];u==="style"?Ux(i,d):u==="dangerouslySetInnerHTML"?xx(i,d):u==="children"?jh(i,d):vI(i,u,d,a)}switch(l){case"input":$T(i,o);break;case"textarea":Dx(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var h=o.value;h!=null?au(i,!!o.multiple,h,!1):f!==!!o.multiple&&(o.defaultValue!=null?au(i,!!o.multiple,o.defaultValue,!0):au(i,!!o.multiple,o.multiple?[]:"",!1))}i[Yh]=o}catch(E){wn(t,t.return,E)}}break;case 6:if(Co(e,t),Qo(t),r&4){if(t.stateNode===null)throw Error(Be(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(E){wn(t,t.return,E)}}break;case 3:if(Co(e,t),Qo(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Wh(e.containerInfo)}catch(E){wn(t,t.return,E)}break;case 4:Co(e,t),Qo(t);break;case 13:Co(e,t),Qo(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(QI=Pn())),r&4&&Pk(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Wr=(a=Wr)||u,Co(e,t),Wr=a):Co(e,t),Qo(t),r&8192){if(a=t.memoizedState!==null,(t.stateNode.isHidden=a)&&!u&&t.mode&1)for(it=t,u=t.child;u!==null;){for(d=it=u;it!==null;){switch(f=it,h=f.child,f.tag){case 0:case 11:case 14:case 15:Rh(4,f,f.return);break;case 1:Qc(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(E){wn(r,n,E)}}break;case 5:Qc(f,f.return);break;case 22:if(f.memoizedState!==null){Mk(d);continue}}h!==null?(h.return=f,it=h):Mk(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,a?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=d.stateNode,c=d.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Lx("display",s))}catch(E){wn(t,t.return,E)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=a?"":d.memoizedProps}catch(E){wn(t,t.return,E)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Co(e,t),Qo(t),r&4&&Pk(t);break;case 21:break;default:Co(e,t),Qo(t)}}function Qo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(lU(n)){var r=n;break e}n=n.return}throw Error(Be(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(jh(i,""),r.flags&=-33);var o=kk(t);TE(t,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,l=kk(t);SE(t,l,s);break;default:throw Error(Be(161))}}catch(c){wn(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function EV(t,e,n){it=t,dU(t)}function dU(t,e,n){for(var r=(t.mode&1)!==0;it!==null;){var i=it,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||jp;if(!s){var l=i.alternate,c=l!==null&&l.memoizedState!==null||Wr;l=jp;var a=Wr;if(jp=s,(Wr=c)&&!a)for(it=i;it!==null;)s=it,c=s.child,s.tag===22&&s.memoizedState!==null?Dk(i):c!==null?(c.return=s,it=c):Dk(i);for(;o!==null;)it=o,dU(o),o=o.sibling;it=i,jp=l,Wr=a}Ok(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,it=o):Ok(t)}}function Ok(t){for(;it!==null;){var e=it;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Wr||Hv(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Wr)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:bo(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&gk(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}gk(e,s,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var a=e.alternate;if(a!==null){var u=a.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Wh(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Be(163))}Wr||e.flags&512&&CE(e)}catch(f){wn(e,e.return,f)}}if(e===t){it=null;break}if(n=e.sibling,n!==null){n.return=e.return,it=n;break}it=e.return}}function Mk(t){for(;it!==null;){var e=it;if(e===t){it=null;break}var n=e.sibling;if(n!==null){n.return=e.return,it=n;break}it=e.return}}function Dk(t){for(;it!==null;){var e=it;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Hv(4,e)}catch(c){wn(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){wn(e,i,c)}}var o=e.return;try{CE(e)}catch(c){wn(e,o,c)}break;case 5:var s=e.return;try{CE(e)}catch(c){wn(e,s,c)}}}catch(c){wn(e,e.return,c)}if(e===t){it=null;break}var l=e.sibling;if(l!==null){l.return=e.return,it=l;break}it=e.return}}var wV=Math.ceil,Ym=qs.ReactCurrentDispatcher,KI=qs.ReactCurrentOwner,co=qs.ReactCurrentBatchConfig,xt=0,vr=null,jn=null,Pr=0,xi=0,Xc=Za(0),tr=0,of=null,Bl=0,qv=0,JI=0,kh=null,Ii=null,QI=0,Iu=1/0,ws=null,Zm=!1,EE=null,Aa=null,Vp=!1,Ca=null,ev=0,Ph=0,wE=null,Cm=-1,Sm=0;function ci(){return xt&6?Pn():Cm!==-1?Cm:Cm=Pn()}function Ra(t){return t.mode&1?xt&2&&Pr!==0?Pr&-Pr:sV.transition!==null?(Sm===0&&(Sm=Jx()),Sm):(t=jt,t!==0||(t=window.event,t=t===void 0?16:nL(t.type)),t):1}function Lo(t,e,n,r){if(50<Ph)throw Ph=0,wE=null,Error(Be(185));mf(t,n,r),(!(xt&2)||t!==vr)&&(t===vr&&(!(xt&2)&&(qv|=n),tr===4&&ga(t,Pr)),Pi(t,r),n===1&&xt===0&&!(e.mode&1)&&(Iu=Pn()+500,Fv&&el()))}function Pi(t,e){var n=t.callbackNode;sj(t,e);var r=Um(t,t===vr?Pr:0);if(r===0)n!==null&&qR(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&qR(n),e===1)t.tag===0?oV(Nk.bind(null,t)):TL(Nk.bind(null,t)),tV(function(){!(xt&6)&&el()}),n=null;else{switch(Qx(r)){case 1:n=EI;break;case 4:n=Wx;break;case 16:n=Lm;break;case 536870912:n=Kx;break;default:n=Lm}n=CU(n,hU.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function hU(t,e){if(Cm=-1,Sm=0,xt&6)throw Error(Be(327));var n=t.callbackNode;if(hu()&&t.callbackNode!==n)return null;var r=Um(t,t===vr?Pr:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=tv(t,r);else{e=r;var i=xt;xt|=2;var o=pU();(vr!==t||Pr!==e)&&(ws=null,Iu=Pn()+500,_l(t,e));do try{_V();break}catch(l){fU(t,l)}while(!0);xI(),Ym.current=o,xt=i,jn!==null?e=0:(vr=null,Pr=0,e=tr)}if(e!==0){if(e===2&&(i=QT(t),i!==0&&(r=i,e=IE(t,i))),e===1)throw n=of,_l(t,0),ga(t,r),Pi(t,Pn()),n;if(e===6)ga(t,r);else{if(i=t.current.alternate,!(r&30)&&!IV(i)&&(e=tv(t,r),e===2&&(o=QT(t),o!==0&&(r=o,e=IE(t,o))),e===1))throw n=of,_l(t,0),ga(t,r),Pi(t,Pn()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Be(345));case 2:Cl(t,Ii,ws);break;case 3:if(ga(t,r),(r&130023424)===r&&(e=QI+500-Pn(),10<e)){if(Um(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){ci(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=iE(Cl.bind(null,t,Ii,ws),e);break}Cl(t,Ii,ws);break;case 4:if(ga(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var s=31-xo(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Pn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wV(r/1960))-r,10<r){t.timeoutHandle=iE(Cl.bind(null,t,Ii,ws),r);break}Cl(t,Ii,ws);break;case 5:Cl(t,Ii,ws);break;default:throw Error(Be(329))}}}return Pi(t,Pn()),t.callbackNode===n?hU.bind(null,t):null}function IE(t,e){var n=kh;return t.current.memoizedState.isDehydrated&&(_l(t,e).flags|=256),t=tv(t,e),t!==2&&(e=Ii,Ii=n,e!==null&&bE(e)),t}function bE(t){Ii===null?Ii=t:Ii.push.apply(Ii,t)}function IV(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Ho(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ga(t,e){for(e&=~JI,e&=~qv,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-xo(e),r=1<<n;t[n]=-1,e&=~r}}function Nk(t){if(xt&6)throw Error(Be(327));hu();var e=Um(t,0);if(!(e&1))return Pi(t,Pn()),null;var n=tv(t,e);if(t.tag!==0&&n===2){var r=QT(t);r!==0&&(e=r,n=IE(t,r))}if(n===1)throw n=of,_l(t,0),ga(t,e),Pi(t,Pn()),n;if(n===6)throw Error(Be(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Cl(t,Ii,ws),Pi(t,Pn()),null}function XI(t,e){var n=xt;xt|=1;try{return t(e)}finally{xt=n,xt===0&&(Iu=Pn()+500,Fv&&el())}}function $l(t){Ca!==null&&Ca.tag===0&&!(xt&6)&&hu();var e=xt;xt|=1;var n=co.transition,r=jt;try{if(co.transition=null,jt=1,t)return t()}finally{jt=r,co.transition=n,xt=e,!(xt&6)&&el()}}function YI(){xi=Xc.current,ln(Xc)}function _l(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,eV(n)),jn!==null)for(n=jn.return;n!==null;){var r=n;switch(MI(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&qm();break;case 3:Eu(),ln(Ri),ln(Jr),HI();break;case 5:$I(r);break;case 4:Eu();break;case 13:ln(gn);break;case 19:ln(gn);break;case 10:LI(r.type._context);break;case 22:case 23:YI()}n=n.return}if(vr=t,jn=t=ka(t.current,null),Pr=xi=e,tr=0,of=null,JI=qv=Bl=0,Ii=kh=null,Il!==null){for(e=0;e<Il.length;e++)if(n=Il[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}Il=null}return t}function fU(t,e){do{var n=jn;try{if(xI(),mm.current=Xm,Qm){for(var r=mn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Qm=!1}if(Fl=0,dr=Zn=mn=null,Ah=!1,tf=0,KI.current=null,n===null||n.return===null){tr=1,of=e,jn=null;break}e:{var o=t,s=n.return,l=n,c=e;if(e=Pr,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var a=c,u=l,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var h=Tk(s);if(h!==null){h.flags&=-257,Ek(h,s,l,o,e),h.mode&1&&Sk(o,a,e),e=h,c=a;var g=e.updateQueue;if(g===null){var E=new Set;E.add(c),e.updateQueue=E}else g.add(c);break e}else{if(!(e&1)){Sk(o,a,e),ZI();break e}c=Error(Be(426))}}else if(un&&l.mode&1){var D=Tk(s);if(D!==null){!(D.flags&65536)&&(D.flags|=256),Ek(D,s,l,o,e),DI(wu(c,l));break e}}o=c=wu(c,l),tr!==4&&(tr=2),kh===null?kh=[o]:kh.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var w=QL(o,c,e);pk(o,w);break e;case 1:l=c;var p=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof p.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Aa===null||!Aa.has(b)))){o.flags|=65536,e&=-e,o.lanes|=e;var j=XL(o,l,e);pk(o,j);break e}}o=o.return}while(o!==null)}mU(n)}catch(K){e=K,jn===n&&n!==null&&(jn=n=n.return);continue}break}while(!0)}function pU(){var t=Ym.current;return Ym.current=Xm,t===null?Xm:t}function ZI(){(tr===0||tr===3||tr===2)&&(tr=4),vr===null||!(Bl&268435455)&&!(qv&268435455)||ga(vr,Pr)}function tv(t,e){var n=xt;xt|=2;var r=pU();(vr!==t||Pr!==e)&&(ws=null,_l(t,e));do try{bV();break}catch(i){fU(t,i)}while(!0);if(xI(),xt=n,Ym.current=r,jn!==null)throw Error(Be(261));return vr=null,Pr=0,tr}function bV(){for(;jn!==null;)gU(jn)}function _V(){for(;jn!==null&&!Xq();)gU(jn)}function gU(t){var e=yU(t.alternate,t,xi);t.memoizedProps=t.pendingProps,e===null?mU(t):jn=e,KI.current=null}function mU(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=CV(n,e),n!==null){n.flags&=32767,jn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{tr=6,jn=null;return}}else if(n=yV(n,e,xi),n!==null){jn=n;return}if(e=e.sibling,e!==null){jn=e;return}jn=e=t}while(e!==null);tr===0&&(tr=5)}function Cl(t,e,n){var r=jt,i=co.transition;try{co.transition=null,jt=1,AV(t,e,n,r)}finally{co.transition=i,jt=r}return null}function AV(t,e,n,r){do hu();while(Ca!==null);if(xt&6)throw Error(Be(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Be(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(aj(t,o),t===vr&&(jn=vr=null,Pr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Vp||(Vp=!0,CU(Lm,function(){return hu(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=co.transition,co.transition=null;var s=jt;jt=1;var l=xt;xt|=4,KI.current=null,TV(t,n),uU(n,t),Wj(nE),Fm=!!tE,nE=tE=null,t.current=n,EV(n),Yq(),xt=l,jt=s,co.transition=o}else t.current=n;if(Vp&&(Vp=!1,Ca=t,ev=i),o=t.pendingLanes,o===0&&(Aa=null),tj(n.stateNode),Pi(t,Pn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Zm)throw Zm=!1,t=EE,EE=null,t;return ev&1&&t.tag!==0&&hu(),o=t.pendingLanes,o&1?t===wE?Ph++:(Ph=0,wE=t):Ph=0,el(),null}function hu(){if(Ca!==null){var t=Qx(ev),e=co.transition,n=jt;try{if(co.transition=null,jt=16>t?16:t,Ca===null)var r=!1;else{if(t=Ca,Ca=null,ev=0,xt&6)throw Error(Be(331));var i=xt;for(xt|=4,it=t.current;it!==null;){var o=it,s=o.child;if(it.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var a=l[c];for(it=a;it!==null;){var u=it;switch(u.tag){case 0:case 11:case 15:Rh(8,u,o)}var d=u.child;if(d!==null)d.return=u,it=d;else for(;it!==null;){u=it;var f=u.sibling,h=u.return;if(aU(u),u===a){it=null;break}if(f!==null){f.return=h,it=f;break}it=h}}}var g=o.alternate;if(g!==null){var E=g.child;if(E!==null){g.child=null;do{var D=E.sibling;E.sibling=null,E=D}while(E!==null)}}it=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,it=s;else e:for(;it!==null;){if(o=it,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Rh(9,o,o.return)}var w=o.sibling;if(w!==null){w.return=o.return,it=w;break e}it=o.return}}var p=t.current;for(it=p;it!==null;){s=it;var b=s.child;if(s.subtreeFlags&2064&&b!==null)b.return=s,it=b;else e:for(s=p;it!==null;){if(l=it,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Hv(9,l)}}catch(K){wn(l,l.return,K)}if(l===s){it=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,it=j;break e}it=l.return}}if(xt=i,el(),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(Dv,t)}catch{}r=!0}return r}finally{jt=n,co.transition=e}}return!1}function xk(t,e,n){e=wu(n,e),e=QL(t,e,1),t=_a(t,e,1),e=ci(),t!==null&&(mf(t,1,e),Pi(t,e))}function wn(t,e,n){if(t.tag===3)xk(t,t,n);else for(;e!==null;){if(e.tag===3){xk(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Aa===null||!Aa.has(r))){t=wu(n,t),t=XL(e,t,1),e=_a(e,t,1),t=ci(),e!==null&&(mf(e,1,t),Pi(e,t));break}}e=e.return}}function RV(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=ci(),t.pingedLanes|=t.suspendedLanes&n,vr===t&&(Pr&n)===n&&(tr===4||tr===3&&(Pr&130023424)===Pr&&500>Pn()-QI?_l(t,0):JI|=n),Pi(t,e)}function vU(t,e){e===0&&(t.mode&1?(e=Np,Np<<=1,!(Np&130023424)&&(Np=4194304)):e=1);var n=ci();t=xs(t,e),t!==null&&(mf(t,e,n),Pi(t,n))}function kV(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),vU(t,n)}function PV(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Be(314))}r!==null&&r.delete(e),vU(t,n)}var yU;yU=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ri.current)_i=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return _i=!1,vV(t,e,n);_i=!!(t.flags&131072)}else _i=!1,un&&e.flags&1048576&&EL(e,zm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ym(t,e),t=e.pendingProps;var i=Cu(e,Jr.current);du(e,n),i=jI(null,e,r,t,i,n);var o=VI();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ki(r)?(o=!0,jm(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,FI(e),i.updater=$v,e.stateNode=i,i._reactInternals=e,dE(e,r,t,n),e=pE(null,e,r,!0,o,n)):(e.tag=0,un&&o&&OI(e),si(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ym(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=MV(r),t=bo(r,t),i){case 0:e=fE(null,e,r,t,n);break e;case 1:e=bk(null,e,r,t,n);break e;case 11:e=wk(null,e,r,t,n);break e;case 14:e=Ik(null,e,r,bo(r.type,t),n);break e}throw Error(Be(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:bo(r,i),fE(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:bo(r,i),bk(t,e,r,i,n);case 3:e:{if(tU(e),t===null)throw Error(Be(387));r=e.pendingProps,o=e.memoizedState,i=o.element,RL(t,e),Km(e,r,null,n);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=wu(Error(Be(423)),e),e=_k(t,e,r,n,i);break e}else if(r!==i){i=wu(Error(Be(424)),e),e=_k(t,e,r,n,i);break e}else for(Ui=ba(e.stateNode.containerInfo.firstChild),Bi=e,un=!0,Ao=null,n=_L(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Su(),r===i){e=Ls(t,e,n);break e}si(t,e,r,n)}e=e.child}return e;case 5:return kL(e),t===null&&lE(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,rE(r,i)?s=null:o!==null&&rE(r,o)&&(e.flags|=32),eU(t,e),si(t,e,s,n),e.child;case 6:return t===null&&lE(e),null;case 13:return nU(t,e,n);case 4:return BI(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Tu(e,null,r,n):si(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:bo(r,i),wk(t,e,r,i,n);case 7:return si(t,e,e.pendingProps,n),e.child;case 8:return si(t,e,e.pendingProps.children,n),e.child;case 12:return si(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,nn(Gm,r._currentValue),r._currentValue=s,o!==null)if(Ho(o.value,s)){if(o.children===i.children&&!Ri.current){e=Ls(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var l=o.dependencies;if(l!==null){s=o.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=Os(-1,n&-n),c.tag=2;var a=o.updateQueue;if(a!==null){a=a.shared;var u=a.pending;u===null?c.next=c:(c.next=u.next,u.next=c),a.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),cE(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Be(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),cE(s,n,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}si(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,du(e,n),i=uo(i),r=r(i),e.flags|=1,si(t,e,r,n),e.child;case 14:return r=e.type,i=bo(r,e.pendingProps),i=bo(r.type,i),Ik(t,e,r,i,n);case 15:return YL(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:bo(r,i),ym(t,e),e.tag=1,ki(r)?(t=!0,jm(e)):t=!1,du(e,n),JL(e,r,i),dE(e,r,i,n),pE(null,e,r,!0,t,n);case 19:return rU(t,e,n);case 22:return ZL(t,e,n)}throw Error(Be(156,e.tag))};function CU(t,e){return Gx(t,e)}function OV(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oo(t,e,n,r){return new OV(t,e,n,r)}function eb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function MV(t){if(typeof t=="function")return eb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===CI)return 11;if(t===SI)return 14}return 2}function ka(t,e){var n=t.alternate;return n===null?(n=oo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Tm(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")eb(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Hc:return Al(n.children,i,o,e);case yI:s=8,i|=8;break;case xT:return t=oo(12,n,e,i|2),t.elementType=xT,t.lanes=o,t;case LT:return t=oo(13,n,e,i),t.elementType=LT,t.lanes=o,t;case UT:return t=oo(19,n,e,i),t.elementType=UT,t.lanes=o,t;case kx:return jv(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ax:s=10;break e;case Rx:s=9;break e;case CI:s=11;break e;case SI:s=14;break e;case ua:s=16,r=null;break e}throw Error(Be(130,t==null?t:typeof t,""))}return e=oo(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function Al(t,e,n,r){return t=oo(7,t,r,e),t.lanes=n,t}function jv(t,e,n,r){return t=oo(22,t,r,e),t.elementType=kx,t.lanes=n,t.stateNode={isHidden:!1},t}function FC(t,e,n){return t=oo(6,t,null,e),t.lanes=n,t}function BC(t,e,n){return e=oo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function DV(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=CC(0),this.expirationTimes=CC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=CC(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tb(t,e,n,r,i,o,s,l,c){return t=new DV(t,e,n,l,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=oo(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},FI(o),t}function NV(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$c,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function SU(t){if(!t)return $a;t=t._reactInternals;e:{if(Xl(t)!==t||t.tag!==1)throw Error(Be(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ki(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Be(171))}if(t.tag===1){var n=t.type;if(ki(n))return SL(t,n,e)}return e}function TU(t,e,n,r,i,o,s,l,c){return t=tb(n,r,!0,t,i,o,s,l,c),t.context=SU(null),n=t.current,r=ci(),i=Ra(n),o=Os(r,i),o.callback=e??null,_a(n,o,i),t.current.lanes=i,mf(t,i,r),Pi(t,r),t}function Vv(t,e,n,r){var i=e.current,o=ci(),s=Ra(i);return n=SU(n),e.context===null?e.context=n:e.pendingContext=n,e=Os(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=_a(i,e,s),t!==null&&(Lo(t,i,s,o),gm(t,i,s)),s}function nv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Lk(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function nb(t,e){Lk(t,e),(t=t.alternate)&&Lk(t,e)}function xV(){return null}var EU=typeof reportError=="function"?reportError:function(t){console.error(t)};function rb(t){this._internalRoot=t}zv.prototype.render=rb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Be(409));Vv(t,e,null,null)};zv.prototype.unmount=rb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$l(function(){Vv(null,t,null,null)}),e[Ns]=null}};function zv(t){this._internalRoot=t}zv.prototype.unstable_scheduleHydration=function(t){if(t){var e=Zx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<pa.length&&e!==0&&e<pa[n].priority;n++);pa.splice(n,0,t),n===0&&tL(t)}};function ib(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Uk(){}function LV(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var a=nv(s);o.call(a)}}var s=TU(e,r,t,0,null,!1,!1,"",Uk);return t._reactRootContainer=s,t[Ns]=s.current,Qh(t.nodeType===8?t.parentNode:t),$l(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var a=nv(c);l.call(a)}}var c=tb(t,0,!1,null,null,!1,!1,"",Uk);return t._reactRootContainer=c,t[Ns]=c.current,Qh(t.nodeType===8?t.parentNode:t),$l(function(){Vv(e,c,n,r)}),c}function Wv(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var l=i;i=function(){var c=nv(s);l.call(c)}}Vv(e,s,t,i)}else s=LV(n,e,t,i,r);return nv(s)}Xx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=fh(e.pendingLanes);n!==0&&(wI(e,n|1),Pi(e,Pn()),!(xt&6)&&(Iu=Pn()+500,el()))}break;case 13:$l(function(){var r=xs(t,1);if(r!==null){var i=ci();Lo(r,t,1,i)}}),nb(t,1)}};II=function(t){if(t.tag===13){var e=xs(t,134217728);if(e!==null){var n=ci();Lo(e,t,134217728,n)}nb(t,134217728)}};Yx=function(t){if(t.tag===13){var e=Ra(t),n=xs(t,e);if(n!==null){var r=ci();Lo(n,t,e,r)}nb(t,e)}};Zx=function(){return jt};eL=function(t,e){var n=jt;try{return jt=t,e()}finally{jt=n}};WT=function(t,e,n){switch(e){case"input":if($T(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Uv(r);if(!i)throw Error(Be(90));Ox(r),$T(r,i)}}}break;case"textarea":Dx(t,n);break;case"select":e=n.value,e!=null&&au(t,!!n.multiple,e,!1)}};$x=XI;Hx=$l;var UV={usingClientEntryPoint:!1,Events:[yf,zc,Uv,Fx,Bx,XI]},kd={findFiberByHostInstance:wl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FV={bundleType:kd.bundleType,version:kd.version,rendererPackageName:kd.rendererPackageName,rendererConfig:kd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Vx(t),t===null?null:t.stateNode},findFiberByHostInstance:kd.findFiberByHostInstance||xV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zp.isDisabled&&zp.supportsFiber)try{Dv=zp.inject(FV),ss=zp}catch{}}Wi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UV;Wi.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ib(e))throw Error(Be(200));return NV(t,e,null,n)};Wi.createRoot=function(t,e){if(!ib(t))throw Error(Be(299));var n=!1,r="",i=EU;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tb(t,1,!1,null,null,n,!1,r,i),t[Ns]=e.current,Qh(t.nodeType===8?t.parentNode:t),new rb(e)};Wi.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Be(188)):(t=Object.keys(t).join(","),Error(Be(268,t)));return t=Vx(e),t=t===null?null:t.stateNode,t};Wi.flushSync=function(t){return $l(t)};Wi.hydrate=function(t,e,n){if(!Gv(e))throw Error(Be(200));return Wv(null,t,e,!0,n)};Wi.hydrateRoot=function(t,e,n){if(!ib(t))throw Error(Be(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=EU;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=TU(e,null,t,1,n??null,i,!1,o,s),t[Ns]=e.current,Qh(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new zv(e)};Wi.render=function(t,e,n){if(!Gv(e))throw Error(Be(200));return Wv(null,t,e,!1,n)};Wi.unmountComponentAtNode=function(t){if(!Gv(t))throw Error(Be(40));return t._reactRootContainer?($l(function(){Wv(null,null,t,!1,function(){t._reactRootContainer=null,t[Ns]=null})}),!0):!1};Wi.unstable_batchedUpdates=XI;Wi.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Gv(n))throw Error(Be(200));if(t==null||t._reactInternals===void 0)throw Error(Be(38));return Wv(t,e,n,!1,r)};Wi.version="18.3.1-next-f1338f8080-20240426";function wU(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wU)}catch(t){console.error(t)}}wU(),wx.exports=Wi;var BV=wx.exports,Fk=BV;DT.createRoot=Fk.createRoot,DT.hydrateRoot=Fk.hydrateRoot;var IU={},Us={};Object.defineProperty(Us,"__esModule",{value:!0});Us.ChatSDKError=Us.ChatSDKErrorName=void 0;var Bk;(function(t){t.ChatAdapterInitializationFailure="ChatAdapterInitializationFailure",t.UnsupportedLiveChatVersion="UnsupportedLiveChatVersion",t.OmnichannelClientInitializationFailure="OmnichannelClientInitializationFailure",t.MessagingClientCreationFailure="MessagingClientCreationFailure",t.ChatConfigRetrievalFailure="ChatConfigRetrievalFailure",t.UninitializedChatSDK="UninitializedChatSDK",t.ChatTokenRetrievalFailure="ChatTokenRetrievalFailure",t.ScriptLoadFailure="ScriptLoadFailure",t.UnsupportedPlatform="UnsupportedPlatform",t.FeatureDisabled="FeatureDisabled",t.ClosedConversation="ClosedConversation",t.InvalidConversation="InvalidConversation",t.AuthenticatedChatConversationRetrievalFailure="AuthenticatedChatConversationRetrievalFailure",t.PersistentChatConversationRetrievalFailure="PersistentChatConversationRetrievalFailure",t.WidgetUseOutsideOperatingHour="WidgetUseOutsideOperatingHour",t.ConversationInitializationFailure="ConversationInitializationFailure",t.ConversationClosureFailure="ConversationClosureFailure",t.MessagingClientInitializationFailure="MessagingClientInitializationFailure",t.MessagingClientConversationJoinFailure="MessagingClientConversationJoinFailure",t.LiveChatTranscriptRetrievalFailure="LiveChatTranscriptRetrievalFailure",t.ConversationDetailsRetrievalFailure="ConversationDetailsRetrievalFailure",t.AuthContactIdNotFoundFailure="AuthContactIdNotFoundFailure",t.GetAuthTokenNotFound="GetAuthTokenNotFound",t.GetAuthTokenFailed="GetAuthTokenFailed",t.UndefinedAuthToken="UndefinedAuthToken",t.UnknownAMSLoadState="UnknownAMSLoadState",t.ChatSDKSendMessageFailed="ChatSDKSendMessageFailed",t.AttachmentClientNotLoaded="AttachmentClientNotLoaded"})(Bk||(Us.ChatSDKErrorName=Bk={}));var $V=function(){function t(e,n,r){this.message=e,this.httpResponseStatusCode=n,this.exceptionDetails=r}return t.prototype.toString=function(){return this.message},t}();Us.ChatSDKError=$V;var Kv={},bU={exports:{}};(function(t){function e(n){return n&&n.__esModule?n:{default:n}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})(bU);var yn=bU.exports,$C={},HC={exports:{}},$k;function Yr(){return $k||($k=1,function(t){function e(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(HC)),HC.exports}var qC={exports:{}},jC={exports:{}},VC={exports:{}},Hk;function Ha(){return Hk||(Hk=1,function(t){function e(n){"@babel/helpers - typeof";return t.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(VC)),VC.exports}var zC={exports:{}},qk;function HV(){return qk||(qk=1,function(t){var e=Ha().default;function n(r,i){if(e(r)!="object"||!r)return r;var o=r[Symbol.toPrimitive];if(o!==void 0){var s=o.call(r,i||"default");if(e(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(r)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(zC)),zC.exports}var jk;function _U(){return jk||(jk=1,function(t){var e=Ha().default,n=HV();function r(i){var o=n(i,"string");return e(o)=="symbol"?o:o+""}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(jC)),jC.exports}var Vk;function po(){return Vk||(Vk=1,function(t){var e=_U();function n(i,o){for(var s=0;s<o.length;s++){var l=o[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,e(l.key),l)}}function r(i,o,s){return o&&n(i.prototype,o),s&&n(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(qC)),qC.exports}var zk;function qV(){return zk||(zk=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(po()),i=function(){function o(){(0,n.default)(this,o)}return(0,r.default)(o,null,[{key:"raiseCustomEvent",value:function(l,c){var a=o.createCustomEvent(l,c);window.dispatchEvent(a)}},{key:"createCustomEvent",value:function(l,c){var a=c?{detail:c}:void 0,u=null;try{u=new CustomEvent(l,a)}catch{u=document.createEvent("CustomEvent"),u.initCustomEvent(l,!0,!0,a)}return u}}]),o}();t.default=i}($C)),$C}var GC={},Gk;function jV(){return Gk||(Gk=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(po()),i=function(){function o(){(0,n.default)(this,o)}return(0,r.default)(o,null,[{key:"OCSDKLOAD",get:function(){return"oc:sdk:load"}}]),o}();t.default=i}(GC)),GC}var WC={},KC={},JC={exports:{}},Wk;function us(){return Wk||(Wk=1,function(t){var e=_U();function n(r,i,o){return(i=e(i))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(JC)),JC.exports}var Qt={},Kk;function zu(){if(Kk)return Qt;Kk=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.SDKError=Qt.LiveChatVersion=Qt.OCSDKTelemetryEvent=Qt.ChannelId=Qt.OperatingSystem=Qt.DeviceType=Qt.Browser=Qt.BrowserVendor=void 0;var t;Qt.BrowserVendor=t,function(c){c.IE="IE",c.CHROME="Chrome",c.FIREFOX="Firefox",c.SAFARI="Safari",c.EDGE="Edge",c.EDGE_CHROMIUM="Edg",c.OPERA="Opera",c.UNKNOWN="Unknown"}(t||(Qt.BrowserVendor=t={}));var e;Qt.Browser=e,function(c){c[c.Chrome=0]="Chrome",c[c.Firefox=1]="Firefox",c[c.Ie=2]="Ie",c[c.Edge=3]="Edge",c[c.Safari=4]="Safari",c[c.None=5]="None"}(e||(Qt.Browser=e={}));var n;Qt.DeviceType=n,function(c){c.Desktop="Desktop",c.Mobile="Mobile",c.Tablet="Tablet"}(n||(Qt.DeviceType=n={}));var r;Qt.OperatingSystem=r,function(c){c.WINDOWS="Windows",c.MACOSX="Mac OS X",c.WINDOWS_PHONE="Windows Phone",c.WINDOWS_RT="Windows RT",c.IOS="iOS",c.ANDROID="Android",c.LINUX="Linux",c.UNKNOWN="Unknown"}(r||(Qt.OperatingSystem=r={}));var i;Qt.ChannelId=i,function(c){c.LCW="lcw",c.SMS="sms",c.FACEBOOK="facebook",c.WECHAT="wechat"}(i||(Qt.ChannelId=i={}));var o;Qt.OCSDKTelemetryEvent=o,function(c){c.GETLCWFCSDETAILSSTARTED="GetLcwFcsDetailsStarted",c.GETLCWFCSDETAILSSUCCEEDED="GetLcwFcsDetailsSucceeded",c.GETLCWFCSDETAILSFAILED="GetLcwFcsDetailsFailed",c.GETCHATCONFIGFSTARTED="GetChatConfig",c.GETCHATCONFIGSUCCEEDED="GetChatConfigSucceeded",c.GETCHATCONFIGFAILED="GetChatConfigFailed",c.GETRECONNECTABLECHATSSTARTED="GetReconnnectableChatsStarted",c.GETRECONNECTABLECHATSSUCCEEDED="GetReconnnectableChatsSucceeded",c.GETRECONNECTABLECHATSFAILED="GetReconnnectableChatsFailed",c.GETRECONNECTAVAILABILITYSUCCEEDED="GetReconnnectableAvailabilitySucceeded",c.GETRECONNECTAVAILABILITYSTARTED="GetReconnnectableAvailabilityStarted",c.GETRECONNECTAVAILABILITYFAILED="GetReconnnectableAvailabilityFailed",c.GETCHATTOKENSTARTED="GetChatTokenStarted",c.GETCHATTOKENSUCCEEDED="GetChatTokenSucceeded",c.GETCHATTOKENFAILED="GetChatTokenFailed",c.GETLWISTATUSSTARTED="GetLwiStatusStarted",c.GETLWISTATUSSUCCEEDED="GetLwiStatusSucceeded",c.GETLWISTATUSFAILED="GetLwiStatusFailed",c.SESSIONINITSTARTED="SessionInitStarted",c.SESSIONINITSUCCEEDED="SessionInitSucceeded",c.SESSIONINITFAILED="SessionInitFailed",c.CREATESESSIONSTARTED="CreateSessionStarted",c.CREATESESSIONSUCCEEDED="CreateSessionSucceeded",c.CREATESESSIONFAILED="CreateSessionFailed",c.SESSIONCLOSESTARTED="SessionCloseStarted",c.SESSIONCLOSESUCCEEDED="SessionCloseSucceeded",c.SESSIONCLOSEFAILED="SessionCloseFailed",c.SUBMITPOSTCHATSTARTED="SubmitPostChatStarted",c.SUBMITPOSTCHATSUCCEEDED="SubmitPostChatSucceeded",c.SUBMITPOSTCHATFAILED="SubmitPostChatFailed",c.GETCHATTRANSCRIPTSTARTED="GetChatTranscriptStarted",c.GETCHATTRANSCRIPTSUCCEEDED="GetChatTranscriptSucceeded",c.GETCHATTRANSCRIPTFAILED="GetChatTranscriptFailed",c.EMAILTRANSCRIPTSTARTED="EmailTranscriptStarted",c.EMAILTRANSCRIPTSUCCEEDED="EmailTranscriptSucceeded",c.EMAILTRANSCRIPTFAILED="EmailTranscriptFailed",c.FETCHDATAMASKINGSTARTED="FetchDataMaskingStarted",c.FETCHDATAMASKINGSUCCEEDED="FetchDataMaskingSucceeded",c.FETCHDATAMASKINGFAILED="FetchDataMaskingFailed",c.SECONDARYCHANNELEVENTREQUESTSTARTED="SecondaryChannelEventRequestStarted",c.SECONDARYCHANNELEVENTREQUESTSUCCEEDED="SecondaryChannelEventRequestSucceeded",c.SECONDARYCHANNELEVENTREQUESTFAILED="SecondaryChannelEventRequestFailed",c.GETSURVEYINVITELINKSTARTED="GetSurveyInviteLinkStarted",c.GETSURVEYINVITELINKSUCCEEDED="GetSurveyInviteLinkSucceeded",c.GETSURVEYINVITELINKFAILED="GetSurveyInviteLinkFailed",c.VALIDATEAUTHCHATRECORDSTARTED="ValidateAuthChatRecordStarted",c.VALIDATEAUTHCHATRECORDSUCCEEDED="ValidateAuthChatRecordSucceeded",c.VALIDATEAUTHCHATRECORDFAILED="ValidateAuthChatRecordFailed",c.GETAGENTAVAILABILITYSTARTED="GetAgentAvailabilityStarted",c.GETAGENTAVAILABILITYSUCCEEDED="GetAgentAvailabilitySucceeded",c.GETAGENTAVAILABILITYFAILED="GetAgentAvailabilityFailed",c.SENDTYPINGINDICATORFAILED="SendTypingIndicatorFailed",c.SENDTYPINGINDICATORSUCCEEDED="SendTypingIndicatorSucceeded",c.GETPERSISTENTCHATHISTORYSTARTED="GetPersistentChatHistoryStarted",c.GETPERSISTENTCHATHISTORYSUCCEEDED="GetPersistentChatHistorySucceeded",c.GETPERSISTENTCHATHISTORYFAILED="GetPersistentChatHistoryFailed"}(o||(Qt.OCSDKTelemetryEvent=o={}));var s;Qt.LiveChatVersion=s,function(c){c[c.V1=1]="V1",c[c.V2=2]="V2",c[c.V3=3]="V3"}(s||(Qt.LiveChatVersion=s={}));var l;return Qt.SDKError=l,function(c){c.ClientHTTPTimeoutErrorName="ClientHTTPTimeoutError",c.ClientHTTPTimeoutErrorMessage="Server took too long to respond"}(l||(Qt.SDKError=l={})),Qt}var Jk;function Sf(){return Jk||(Jk=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(us()),i=zu(),o=function s(){(0,n.default)(this,s)};t.default=o,(0,r.default)(o,"requiredOmnichannelConfigurationParameters",["orgUrl","orgId","widgetId"]),(0,r.default)(o,"defaultHeaders",{"Content-Type":"application/json"}),(0,r.default)(o,"bypassCacheHeaders",{"Cache-Control":"no-store, must-revalidate, no-cache","X-Cache-Control":"no-store"}),(0,r.default)(o,"defaultChannelId",i.ChannelId.LCW),(0,r.default)(o,"defaultLocale","en-us"),(0,r.default)(o,"noContentStatusCode",204),(0,r.default)(o,"tooManyRequestsStatusCode",429),(0,r.default)(o,"notFoundStatusCode",404),(0,r.default)(o,"badRequestStatusCode",400),(0,r.default)(o,"outOfOfficeErrorCode",705),(0,r.default)(o,"sensitiveProperties",["AuthenticatedUserToken"]),(0,r.default)(o,"transactionid","transaction-id"),(0,r.default)(o,"customerDisplayName","customerDisplayName"),(0,r.default)(o,"hiddenContentPlaceholder","*content hidden*"),(0,r.default)(o,"axiosTimeoutErrorCode","ECONNABORTED")}(KC)),KC}var QC={},XC={},Qk;function VV(){return Qk||(Qk=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(po()),i=function(){function o(){(0,n.default)(this,o)}return(0,r.default)(o,null,[{key:"GETTELEMETRYEVENTDATA",value:function(l,c,a){var u={Description:a,ElapsedTimeInMilliseconds:c.ElapsedTimeInMilliseconds,HttpRequestResponseTime:c.HttpRequestResponseTime,Event:l,ExceptionDetails:c.ExceptionDetails,Region:c.Region,RequestId:c.RequestId,TransactionId:c.TransactionId,RequestHeaders:c.RequestHeaders,RequestPayload:c.RequestPayload,RequestPath:c.RequestPath,RequestMethod:c.RequestMethod,ResponseStatusCode:c.ResponseStatusCode,ResponseErrorcode:c.ResponseErrorcode,AuthTokenDetails:c.AuthTokenDetails};return u}}]),o}();t.default=i}(XC)),XC}var Xk;function zV(){return Xk||(Xk=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(po()),i=e(us()),o=e(VV()),s=function(){function l(c){(0,n.default)(this,l),(0,i.default)(this,"logger",void 0),this.logger=c}return(0,r.default)(l,[{key:"log",value:function(a,u,d,f){if(this.isLoggingEnabled()){var h=o.default.GETTELEMETRYEVENTDATA(u,d,f);this.logEvent(a,h)}}},{key:"logEvent",value:function(a,u){this.isLoggingEnabled()&&this.logger.logClientSdkTelemetryEvent(a,u)}},{key:"isLoggingEnabled",value:function(){return!this.isNullOrUndefined(this.logger)}},{key:"isNullOrUndefined",value:function(a){return a==null}}]),l}();t.default=s}(QC)),QC}var YC={},ZC={exports:{}},e0={exports:{}},Yk;function AU(){return Yk||(Yk=1,function(t){function e(n,r){this.v=n,this.k=r}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(e0)),e0.exports}var t0={exports:{}},n0={exports:{}},Zk;function RU(){return Zk||(Zk=1,function(t){function e(n,r,i,o){var s=Object.defineProperty;try{s({},"",{})}catch{s=0}t.exports=e=function(c,a,u,d){function f(h,g){e(c,h,function(E){return this._invoke(h,g,E)})}a?s?s(c,a,{value:u,enumerable:!d,configurable:!d,writable:!d}):c[a]=u:(f("next",0),f("throw",1),f("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,r,i,o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(n0)),n0.exports}var eP;function kU(){return eP||(eP=1,function(t){var e=RU();function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,i,o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",l=o.toStringTag||"@@toStringTag";function c(D,w,p,b){var j=w&&w.prototype instanceof u?w:u,K=Object.create(j.prototype);return e(K,"_invoke",function(M,ne,G){var oe,J,X,B=0,q=G||[],F=!1,x={p:0,n:0,v:r,a:P,f:P.bind(r,4),d:function(T,_){return oe=T,J=0,X=r,x.n=_,a}};function P(v,T){for(J=v,X=T,i=0;!F&&B&&!_&&i<q.length;i++){var _,N=q[i],I=x.p,A=N[2];v>3?(_=A===T)&&(X=N[(J=N[4])?5:(J=3,3)],N[4]=N[5]=r):N[0]<=I&&((_=v<2&&I<N[1])?(J=0,x.v=T,x.n=N[1]):I<A&&(_=v<3||N[0]>T||T>A)&&(N[4]=v,N[5]=T,x.n=A,J=0))}if(_||v>1)return a;throw F=!0,T}return function(v,T,_){if(B>1)throw TypeError("Generator is already running");for(F&&T===1&&P(T,_),J=T,X=_;(i=J<2?r:X)||!F;){oe||(J?J<3?(J>1&&(x.n=-1),P(J,X)):x.n=X:x.v=X);try{if(B=2,oe){if(J||(v="next"),i=oe[v]){if(!(i=i.call(oe,X)))throw TypeError("iterator result is not an object");if(!i.done)return i;X=i.value,J<2&&(J=0)}else J===1&&(i=oe.return)&&i.call(oe),J<2&&(X=TypeError("The iterator does not provide a '"+v+"' method"),J=1);oe=r}else if((i=(F=x.n<0)?X:M.call(ne,x))!==a)break}catch(N){oe=r,J=1,X=N}finally{B=1}}return{value:i,done:F}}}(D,p,b),!0),K}var a={};function u(){}function d(){}function f(){}i=Object.getPrototypeOf;var h=[][s]?i(i([][s]())):(e(i={},s,function(){return this}),i),g=f.prototype=u.prototype=Object.create(h);function E(D){return Object.setPrototypeOf?Object.setPrototypeOf(D,f):(D.__proto__=f,e(D,l,"GeneratorFunction")),D.prototype=Object.create(g),D}return d.prototype=f,e(g,"constructor",f),e(f,"constructor",d),d.displayName="GeneratorFunction",e(f,l,"GeneratorFunction"),e(g),e(g,l,"Generator"),e(g,s,function(){return this}),e(g,"toString",function(){return"[object Generator]"}),(t.exports=n=function(){return{w:c,m:E}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(t0)),t0.exports}var r0={exports:{}},i0={exports:{}},o0={exports:{}},tP;function PU(){return tP||(tP=1,function(t){var e=AU(),n=RU();function r(i,o){function s(c,a,u,d){try{var f=i[c](a),h=f.value;return h instanceof e?o.resolve(h.v).then(function(g){s("next",g,u,d)},function(g){s("throw",g,u,d)}):o.resolve(h).then(function(g){f.value=g,u(f)},function(g){return s("throw",g,u,d)})}catch(g){d(g)}}var l;this.next||(n(r.prototype),n(r.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),n(this,"_invoke",function(c,a,u){function d(){return new o(function(f,h){s(c,u,f,h)})}return l=l?l.then(d,d):d()},!0)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(o0)),o0.exports}var nP;function OU(){return nP||(nP=1,function(t){var e=kU(),n=PU();function r(i,o,s,l,c){return new n(e().w(i,o,s,l),c||Promise)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(i0)),i0.exports}var rP;function GV(){return rP||(rP=1,function(t){var e=OU();function n(r,i,o,s,l){var c=e(r,i,o,s,l);return c.next().then(function(a){return a.done?a.value:c.next()})}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(r0)),r0.exports}var s0={exports:{}},iP;function WV(){return iP||(iP=1,function(t){function e(n){var r=Object(n),i=[];for(var o in r)i.unshift(o);return function s(){for(;i.length;)if((o=i.pop())in r)return s.value=o,s.done=!1,s;return s.done=!0,s}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(s0)),s0.exports}var a0={exports:{}},oP;function KV(){return oP||(oP=1,function(t){var e=Ha().default;function n(r){if(r!=null){var i=r[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],o=0;if(i)return i.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length))return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}}}throw new TypeError(e(r)+" is not iterable")}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(a0)),a0.exports}var sP;function JV(){return sP||(sP=1,function(t){var e=AU(),n=kU(),r=GV(),i=OU(),o=PU(),s=WV(),l=KV();function c(){var a=n(),u=a.m(c),d=(Object.getPrototypeOf?Object.getPrototypeOf(u):u.__proto__).constructor;function f(E){var D=typeof E=="function"&&E.constructor;return!!D&&(D===d||(D.displayName||D.name)==="GeneratorFunction")}var h={throw:1,return:2,break:3,continue:3};function g(E){var D,w;return function(p){D||(D={stop:function(){return w(p.a,2)},catch:function(){return p.v},abrupt:function(j,K){return w(p.a,h[j],K)},delegateYield:function(j,K,M){return D.resultName=K,w(p.d,l(j),M)},finish:function(j){return w(p.f,j)}},w=function(j,K,M){p.p=D.prev,p.n=D.next;try{return j(K,M)}finally{D.next=p.n}}),D.resultName&&(D[D.resultName]=p.v,D.resultName=void 0),D.sent=p.v,D.next=p.n;try{return E.call(this,D)}finally{p.p=D.prev,p.n=D.next}}}return(t.exports=c=function(){return{wrap:function(w,p,b,j){return a.w(g(w),p,b,j&&j.reverse())},isGeneratorFunction:f,mark:a.m,awrap:function(w,p){return new e(w,p)},AsyncIterator:o,async:function(w,p,b,j,K){return(f(p)?i:r)(g(w),p,b,j,K)},keys:s,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports}(ZC)),ZC.exports}var l0,aP;function MU(){if(aP)return l0;aP=1;var t=JV()();l0=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}return l0}var c0={exports:{}},lP;function DU(){return lP||(lP=1,function(t){function e(r,i,o,s,l,c,a){try{var u=r[c](a),d=u.value}catch(f){return void o(f)}u.done?i(d):Promise.resolve(d).then(s,l)}function n(r){return function(){var i=this,o=arguments;return new Promise(function(s,l){var c=r.apply(i,o);function a(d){e(c,s,l,a,u,"next",d)}function u(d){e(c,s,l,a,u,"throw",d)}a(void 0)})}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(c0)),c0.exports}/*! Axios v1.13.2 Copyright (c) 2025 Matt Zabriskie and contributors */var u0,cP;function ob(){if(cP)return u0;cP=1;function t(ee,te){return function(){return ee.apply(te,arguments)}}const{toString:e}=Object.prototype,{getPrototypeOf:n}=Object,{iterator:r,toStringTag:i}=Symbol,o=(ee=>te=>{const de=e.call(te);return ee[de]||(ee[de]=de.slice(8,-1).toLowerCase())})(Object.create(null)),s=ee=>(ee=ee.toLowerCase(),te=>o(te)===ee),l=ee=>te=>typeof te===ee,{isArray:c}=Array,a=l("undefined");function u(ee){return ee!==null&&!a(ee)&&ee.constructor!==null&&!a(ee.constructor)&&g(ee.constructor.isBuffer)&&ee.constructor.isBuffer(ee)}const d=s("ArrayBuffer");function f(ee){let te;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?te=ArrayBuffer.isView(ee):te=ee&&ee.buffer&&d(ee.buffer),te}const h=l("string"),g=l("function"),E=l("number"),D=ee=>ee!==null&&typeof ee=="object",w=ee=>ee===!0||ee===!1,p=ee=>{if(o(ee)!=="object")return!1;const te=n(ee);return(te===null||te===Object.prototype||Object.getPrototypeOf(te)===null)&&!(i in ee)&&!(r in ee)},b=ee=>{if(!D(ee)||u(ee))return!1;try{return Object.keys(ee).length===0&&Object.getPrototypeOf(ee)===Object.prototype}catch{return!1}},j=s("Date"),K=s("File"),M=s("Blob"),ne=s("FileList"),G=ee=>D(ee)&&g(ee.pipe),oe=ee=>{let te;return ee&&(typeof FormData=="function"&&ee instanceof FormData||g(ee.append)&&((te=o(ee))==="formdata"||te==="object"&&g(ee.toString)&&ee.toString()==="[object FormData]"))},J=s("URLSearchParams"),[X,B,q,F]=["ReadableStream","Request","Response","Headers"].map(s),x=ee=>ee.trim?ee.trim():ee.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function P(ee,te,{allOwnKeys:de=!1}={}){if(ee===null||typeof ee>"u")return;let he,ge;if(typeof ee!="object"&&(ee=[ee]),c(ee))for(he=0,ge=ee.length;he<ge;he++)te.call(null,ee[he],he,ee);else{if(u(ee))return;const Ie=de?Object.getOwnPropertyNames(ee):Object.keys(ee),we=Ie.length;let xe;for(he=0;he<we;he++)xe=Ie[he],te.call(null,ee[xe],xe,ee)}}function v(ee,te){if(u(ee))return null;te=te.toLowerCase();const de=Object.keys(ee);let he=de.length,ge;for(;he-- >0;)if(ge=de[he],te===ge.toLowerCase())return ge;return null}const T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:_e,_=ee=>!a(ee)&&ee!==T;function N(){const{caseless:ee,skipUndefined:te}=_(this)&&this||{},de={},he=(ge,Ie)=>{const we=ee&&v(de,Ie)||Ie;p(de[we])&&p(ge)?de[we]=N(de[we],ge):p(ge)?de[we]=N({},ge):c(ge)?de[we]=ge.slice():(!te||!a(ge))&&(de[we]=ge)};for(let ge=0,Ie=arguments.length;ge<Ie;ge++)arguments[ge]&&P(arguments[ge],he);return de}const I=(ee,te,de,{allOwnKeys:he}={})=>(P(te,(ge,Ie)=>{de&&g(ge)?ee[Ie]=t(ge,de):ee[Ie]=ge},{allOwnKeys:he}),ee),A=ee=>(ee.charCodeAt(0)===65279&&(ee=ee.slice(1)),ee),S=(ee,te,de,he)=>{ee.prototype=Object.create(te.prototype,he),ee.prototype.constructor=ee,Object.defineProperty(ee,"super",{value:te.prototype}),de&&Object.assign(ee.prototype,de)},H=(ee,te,de,he)=>{let ge,Ie,we;const xe={};if(te=te||{},ee==null)return te;do{for(ge=Object.getOwnPropertyNames(ee),Ie=ge.length;Ie-- >0;)we=ge[Ie],(!he||he(we,ee,te))&&!xe[we]&&(te[we]=ee[we],xe[we]=!0);ee=de!==!1&&n(ee)}while(ee&&(!de||de(ee,te))&&ee!==Object.prototype);return te},L=(ee,te,de)=>{ee=String(ee),(de===void 0||de>ee.length)&&(de=ee.length),de-=te.length;const he=ee.indexOf(te,de);return he!==-1&&he===de},C=ee=>{if(!ee)return null;if(c(ee))return ee;let te=ee.length;if(!E(te))return null;const de=new Array(te);for(;te-- >0;)de[te]=ee[te];return de},y=(ee=>te=>ee&&te instanceof ee)(typeof Uint8Array<"u"&&n(Uint8Array)),k=(ee,te)=>{const he=(ee&&ee[r]).call(ee);let ge;for(;(ge=he.next())&&!ge.done;){const Ie=ge.value;te.call(ee,Ie[0],Ie[1])}},Y=(ee,te)=>{let de;const he=[];for(;(de=ee.exec(te))!==null;)he.push(de);return he},V=s("HTMLFormElement"),z=ee=>ee.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(de,he,ge){return he.toUpperCase()+ge}),W=(({hasOwnProperty:ee})=>(te,de)=>ee.call(te,de))(Object.prototype),le=s("RegExp"),re=(ee,te)=>{const de=Object.getOwnPropertyDescriptors(ee),he={};P(de,(ge,Ie)=>{let we;(we=te(ge,Ie,ee))!==!1&&(he[Ie]=we||ge)}),Object.defineProperties(ee,he)},$=ee=>{re(ee,(te,de)=>{if(g(ee)&&["arguments","caller","callee"].indexOf(de)!==-1)return!1;const he=ee[de];if(g(he)){if(te.enumerable=!1,"writable"in te){te.writable=!1;return}te.set||(te.set=()=>{throw Error("Can not rewrite read-only method '"+de+"'")})}})},m=(ee,te)=>{const de={},he=ge=>{ge.forEach(Ie=>{de[Ie]=!0})};return c(ee)?he(ee):he(String(ee).split(te)),de},R=()=>{},Z=(ee,te)=>ee!=null&&Number.isFinite(ee=+ee)?ee:te;function ie(ee){return!!(ee&&g(ee.append)&&ee[i]==="FormData"&&ee[r])}const se=ee=>{const te=new Array(10),de=(he,ge)=>{if(D(he)){if(te.indexOf(he)>=0)return;if(u(he))return he;if(!("toJSON"in he)){te[ge]=he;const Ie=c(he)?[]:{};return P(he,(we,xe)=>{const st=de(we,ge+1);!a(st)&&(Ie[xe]=st)}),te[ge]=void 0,Ie}}return he};return de(ee,0)},ue=s("AsyncFunction"),Te=ee=>ee&&(D(ee)||g(ee))&&g(ee.then)&&g(ee.catch),Se=((ee,te)=>ee?setImmediate:te?((de,he)=>(T.addEventListener("message",({source:ge,data:Ie})=>{ge===T&&Ie===de&&he.length&&he.shift()()},!1),ge=>{he.push(ge),T.postMessage(de,"*")}))(`axios@${Math.random()}`,[]):de=>setTimeout(de))(typeof setImmediate=="function",g(T.postMessage)),Q=typeof queueMicrotask<"u"?queueMicrotask.bind(T):typeof process<"u"&&process.nextTick||Se;var U={isArray:c,isArrayBuffer:d,isBuffer:u,isFormData:oe,isArrayBufferView:f,isString:h,isNumber:E,isBoolean:w,isObject:D,isPlainObject:p,isEmptyObject:b,isReadableStream:X,isRequest:B,isResponse:q,isHeaders:F,isUndefined:a,isDate:j,isFile:K,isBlob:M,isRegExp:le,isFunction:g,isStream:G,isURLSearchParams:J,isTypedArray:y,isFileList:ne,forEach:P,merge:N,extend:I,trim:x,stripBOM:A,inherits:S,toFlatObject:H,kindOf:o,kindOfTest:s,endsWith:L,toArray:C,forEachEntry:k,matchAll:Y,isHTMLForm:V,hasOwnProperty:W,hasOwnProp:W,reduceDescriptors:re,freezeMethods:$,toObjectSet:m,toCamelCase:z,noop:R,toFiniteNumber:Z,findKey:v,global:T,isContextDefined:_,isSpecCompliantForm:ie,toJSONObject:se,isAsyncFn:ue,isThenable:Te,setImmediate:Se,asap:Q,isIterable:ee=>ee!=null&&g(ee[r])};function ae(ee,te,de,he,ge){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=ee,this.name="AxiosError",te&&(this.code=te),de&&(this.config=de),he&&(this.request=he),ge&&(this.response=ge,this.status=ge.status?ge.status:null)}U.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:U.toJSONObject(this.config),code:this.code,status:this.status}}});const ce=ae.prototype,fe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(ee=>{fe[ee]={value:ee}}),Object.defineProperties(ae,fe),Object.defineProperty(ce,"isAxiosError",{value:!0}),ae.from=(ee,te,de,he,ge,Ie)=>{const we=Object.create(ce);U.toFlatObject(ee,we,function(He){return He!==Error.prototype},Ve=>Ve!=="isAxiosError");const xe=ee&&ee.message?ee.message:"Error",st=te==null&&ee?ee.code:te;return ae.call(we,xe,st,de,he,ge),ee&&we.cause==null&&Object.defineProperty(we,"cause",{value:ee,configurable:!0}),we.name=ee&&ee.name||"Error",Ie&&Object.assign(we,Ie),we};var ve=null;function Pe(ee){return U.isPlainObject(ee)||U.isArray(ee)}function Me(ee){return U.endsWith(ee,"[]")?ee.slice(0,-2):ee}function ke(ee,te,de){return ee?ee.concat(te).map(function(ge,Ie){return ge=Me(ge),!de&&Ie?"["+ge+"]":ge}).join(de?".":""):te}function Ne(ee){return U.isArray(ee)&&!ee.some(Pe)}const Oe=U.toFlatObject(U,{},null,function(te){return/^is[A-Z]/.test(te)});function Qe(ee,te,de){if(!U.isObject(ee))throw new TypeError("target must be an object");te=te||new FormData,de=U.toFlatObject(de,{metaTokens:!0,dots:!1,indexes:!1},!1,function(mt,ct){return!U.isUndefined(ct[mt])});const he=de.metaTokens,ge=de.visitor||He,Ie=de.dots,we=de.indexes,st=(de.Blob||typeof Blob<"u"&&Blob)&&U.isSpecCompliantForm(te);if(!U.isFunction(ge))throw new TypeError("visitor must be a function");function Ve(je){if(je===null)return"";if(U.isDate(je))return je.toISOString();if(U.isBoolean(je))return je.toString();if(!st&&U.isBlob(je))throw new ae("Blob is not supported. Use a Buffer instead.");return U.isArrayBuffer(je)||U.isTypedArray(je)?st&&typeof Blob=="function"?new Blob([je]):Buffer.from(je):je}function He(je,mt,ct){let Qn=je;if(je&&!ct&&typeof je=="object"){if(U.endsWith(mt,"{}"))mt=he?mt:mt.slice(0,-2),je=JSON.stringify(je);else if(U.isArray(je)&&Ne(je)||(U.isFileList(je)||U.endsWith(mt,"[]"))&&(Qn=U.toArray(je)))return mt=Me(mt),Qn.forEach(function(lr,Ci){!(U.isUndefined(lr)||lr===null)&&te.append(we===!0?ke([mt],Ci,Ie):we===null?mt:mt+"[]",Ve(lr))}),!1}return Pe(je)?!0:(te.append(ke(ct,mt,Ie),Ve(je)),!1)}const dt=[],Zt=Object.assign(Oe,{defaultVisitor:He,convertValue:Ve,isVisitable:Pe});function Br(je,mt){if(!U.isUndefined(je)){if(dt.indexOf(je)!==-1)throw Error("Circular reference detected in "+mt.join("."));dt.push(je),U.forEach(je,function(Qn,Qi){(!(U.isUndefined(Qn)||Qn===null)&&ge.call(te,Qn,U.isString(Qi)?Qi.trim():Qi,mt,Zt))===!0&&Br(Qn,mt?mt.concat(Qi):[Qi])}),dt.pop()}}if(!U.isObject(ee))throw new TypeError("data must be an object");return Br(ee),te}function et(ee){const te={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(ee).replace(/[!'()~]|%20|%00/g,function(he){return te[he]})}function Xe(ee,te){this._pairs=[],ee&&Qe(ee,this,te)}const Nt=Xe.prototype;Nt.append=function(te,de){this._pairs.push([te,de])},Nt.toString=function(te){const de=te?function(he){return te.call(this,he,et)}:et;return this._pairs.map(function(ge){return de(ge[0])+"="+de(ge[1])},"").join("&")};function kt(ee){return encodeURIComponent(ee).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Fr(ee,te,de){if(!te)return ee;const he=de&&de.encode||kt;U.isFunction(de)&&(de={serialize:de});const ge=de&&de.serialize;let Ie;if(ge?Ie=ge(te,de):Ie=U.isURLSearchParams(te)?te.toString():new Xe(te,de).toString(he),Ie){const we=ee.indexOf("#");we!==-1&&(ee=ee.slice(0,we)),ee+=(ee.indexOf("?")===-1?"?":"&")+Ie}return ee}class ps{constructor(){this.handlers=[]}use(te,de,he){return this.handlers.push({fulfilled:te,rejected:de,synchronous:he?he.synchronous:!1,runWhen:he?he.runWhen:null}),this.handlers.length-1}eject(te){this.handlers[te]&&(this.handlers[te]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(te){U.forEach(this.handlers,function(he){he!==null&&te(he)})}}var Jt=ps,Yt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Cd=typeof URLSearchParams<"u"?URLSearchParams:Xe,pn=typeof FormData<"u"?FormData:null,Go=typeof Blob<"u"?Blob:null,dc={isBrowser:!0,classes:{URLSearchParams:Cd,FormData:pn,Blob:Go},protocols:["http","https","file","blob","url","data"]};const Ys=typeof window<"u"&&typeof document<"u",gs=typeof navigator=="object"&&navigator||void 0,hc=Ys&&(!gs||["ReactNative","NativeScript","NS"].indexOf(gs.product)<0),fc=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ji=Ys&&window.location.href||"http://localhost";var ti=Object.freeze({__proto__:null,hasBrowserEnv:Ys,hasStandardBrowserWebWorkerEnv:fc,hasStandardBrowserEnv:hc,navigator:gs,origin:Ji}),me={...ti,...dc};function qe(ee,te){return Qe(ee,new me.classes.URLSearchParams,{visitor:function(de,he,ge,Ie){return me.isNode&&U.isBuffer(de)?(this.append(he,de.toString("base64")),!1):Ie.defaultVisitor.apply(this,arguments)},...te})}function Ke(ee){return U.matchAll(/\w+|\[(\w*)]/g,ee).map(te=>te[0]==="[]"?"":te[1]||te[0])}function ft(ee){const te={},de=Object.keys(ee);let he;const ge=de.length;let Ie;for(he=0;he<ge;he++)Ie=de[he],te[Ie]=ee[Ie];return te}function Bt(ee){function te(de,he,ge,Ie){let we=de[Ie++];if(we==="__proto__")return!0;const xe=Number.isFinite(+we),st=Ie>=de.length;return we=!we&&U.isArray(ge)?ge.length:we,st?(U.hasOwnProp(ge,we)?ge[we]=[ge[we],he]:ge[we]=he,!xe):((!ge[we]||!U.isObject(ge[we]))&&(ge[we]=[]),te(de,he,ge[we],Ie)&&U.isArray(ge[we])&&(ge[we]=ft(ge[we])),!xe)}if(U.isFormData(ee)&&U.isFunction(ee.entries)){const de={};return U.forEachEntry(ee,(he,ge)=>{te(Ke(he),ge,de,0)}),de}return null}function gt(ee,te,de){if(U.isString(ee))try{return(te||JSON.parse)(ee),U.trim(ee)}catch(he){if(he.name!=="SyntaxError")throw he}return(de||JSON.stringify)(ee)}const ni={transitional:Yt,adapter:["xhr","http","fetch"],transformRequest:[function(te,de){const he=de.getContentType()||"",ge=he.indexOf("application/json")>-1,Ie=U.isObject(te);if(Ie&&U.isHTMLForm(te)&&(te=new FormData(te)),U.isFormData(te))return ge?JSON.stringify(Bt(te)):te;if(U.isArrayBuffer(te)||U.isBuffer(te)||U.isStream(te)||U.isFile(te)||U.isBlob(te)||U.isReadableStream(te))return te;if(U.isArrayBufferView(te))return te.buffer;if(U.isURLSearchParams(te))return de.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),te.toString();let xe;if(Ie){if(he.indexOf("application/x-www-form-urlencoded")>-1)return qe(te,this.formSerializer).toString();if((xe=U.isFileList(te))||he.indexOf("multipart/form-data")>-1){const st=this.env&&this.env.FormData;return Qe(xe?{"files[]":te}:te,st&&new st,this.formSerializer)}}return Ie||ge?(de.setContentType("application/json",!1),gt(te)):te}],transformResponse:[function(te){const de=this.transitional||ni.transitional,he=de&&de.forcedJSONParsing,ge=this.responseType==="json";if(U.isResponse(te)||U.isReadableStream(te))return te;if(te&&U.isString(te)&&(he&&!this.responseType||ge)){const we=!(de&&de.silentJSONParsing)&&ge;try{return JSON.parse(te,this.parseReviver)}catch(xe){if(we)throw xe.name==="SyntaxError"?ae.from(xe,ae.ERR_BAD_RESPONSE,this,null,this.response):xe}}return te}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(te){return te>=200&&te<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};U.forEach(["delete","get","head","post","put","patch"],ee=>{ni.headers[ee]={}});var Er=ni;const Zs=U.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var vp=ee=>{const te={};let de,he,ge;return ee&&ee.split(`
`).forEach(function(we){ge=we.indexOf(":"),de=we.substring(0,ge).trim().toLowerCase(),he=we.substring(ge+1).trim(),!(!de||te[de]&&Zs[de])&&(de==="set-cookie"?te[de]?te[de].push(he):te[de]=[he]:te[de]=te[de]?te[de]+", "+he:he)}),te};const yp=Symbol("internals");function lt(ee){return ee&&String(ee).trim().toLowerCase()}function Ce(ee){return ee===!1||ee==null?ee:U.isArray(ee)?ee.map(Ce):String(ee)}function $e(ee){const te=Object.create(null),de=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let he;for(;he=de.exec(ee);)te[he[1]]=he[2];return te}const ot=ee=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ee.trim());function Wt(ee,te,de,he,ge){if(U.isFunction(he))return he.call(this,te,de);if(ge&&(te=de),!!U.isString(te)){if(U.isString(he))return te.indexOf(he)!==-1;if(U.isRegExp(he))return he.test(te)}}function ar(ee){return ee.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(te,de,he)=>de.toUpperCase()+he)}function En(ee,te){const de=U.toCamelCase(" "+te);["get","set","has"].forEach(he=>{Object.defineProperty(ee,he+de,{value:function(ge,Ie,we){return this[he].call(this,te,ge,Ie,we)},configurable:!0})})}class Jn{constructor(te){te&&this.set(te)}set(te,de,he){const ge=this;function Ie(xe,st,Ve){const He=lt(st);if(!He)throw new Error("header name must be a non-empty string");const dt=U.findKey(ge,He);(!dt||ge[dt]===void 0||Ve===!0||Ve===void 0&&ge[dt]!==!1)&&(ge[dt||st]=Ce(xe))}const we=(xe,st)=>U.forEach(xe,(Ve,He)=>Ie(Ve,He,st));if(U.isPlainObject(te)||te instanceof this.constructor)we(te,de);else if(U.isString(te)&&(te=te.trim())&&!ot(te))we(vp(te),de);else if(U.isObject(te)&&U.isIterable(te)){let xe={},st,Ve;for(const He of te){if(!U.isArray(He))throw TypeError("Object iterator must return a key-value pair");xe[Ve=He[0]]=(st=xe[Ve])?U.isArray(st)?[...st,He[1]]:[st,He[1]]:He[1]}we(xe,de)}else te!=null&&Ie(de,te,he);return this}get(te,de){if(te=lt(te),te){const he=U.findKey(this,te);if(he){const ge=this[he];if(!de)return ge;if(de===!0)return $e(ge);if(U.isFunction(de))return de.call(this,ge,he);if(U.isRegExp(de))return de.exec(ge);throw new TypeError("parser must be boolean|regexp|function")}}}has(te,de){if(te=lt(te),te){const he=U.findKey(this,te);return!!(he&&this[he]!==void 0&&(!de||Wt(this,this[he],he,de)))}return!1}delete(te,de){const he=this;let ge=!1;function Ie(we){if(we=lt(we),we){const xe=U.findKey(he,we);xe&&(!de||Wt(he,he[xe],xe,de))&&(delete he[xe],ge=!0)}}return U.isArray(te)?te.forEach(Ie):Ie(te),ge}clear(te){const de=Object.keys(this);let he=de.length,ge=!1;for(;he--;){const Ie=de[he];(!te||Wt(this,this[Ie],Ie,te,!0))&&(delete this[Ie],ge=!0)}return ge}normalize(te){const de=this,he={};return U.forEach(this,(ge,Ie)=>{const we=U.findKey(he,Ie);if(we){de[we]=Ce(ge),delete de[Ie];return}const xe=te?ar(Ie):String(Ie).trim();xe!==Ie&&delete de[Ie],de[xe]=Ce(ge),he[xe]=!0}),this}concat(...te){return this.constructor.concat(this,...te)}toJSON(te){const de=Object.create(null);return U.forEach(this,(he,ge)=>{he!=null&&he!==!1&&(de[ge]=te&&U.isArray(he)?he.join(", "):he)}),de}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([te,de])=>te+": "+de).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(te){return te instanceof this?te:new this(te)}static concat(te,...de){const he=new this(te);return de.forEach(ge=>he.set(ge)),he}static accessor(te){const he=(this[yp]=this[yp]={accessors:{}}).accessors,ge=this.prototype;function Ie(we){const xe=lt(we);he[xe]||(En(ge,we),he[xe]=!0)}return U.isArray(te)?te.forEach(Ie):Ie(te),this}}Jn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),U.reduceDescriptors(Jn.prototype,({value:ee},te)=>{let de=te[0].toUpperCase()+te.slice(1);return{get:()=>ee,set(he){this[de]=he}}}),U.freezeMethods(Jn);var _n=Jn;function Wo(ee,te){const de=this||Er,he=te||de,ge=_n.from(he.headers);let Ie=he.data;return U.forEach(ee,function(xe){Ie=xe.call(de,Ie,ge.normalize(),te?te.status:void 0)}),ge.normalize(),Ie}function pc(ee){return!!(ee&&ee.__CANCEL__)}function cn(ee,te,de){ae.call(this,ee??"canceled",ae.ERR_CANCELED,te,de),this.name="CanceledError"}U.inherits(cn,ae,{__CANCEL__:!0});function Sd(ee,te,de){const he=de.config.validateStatus;!de.status||!he||he(de.status)?ee(de):te(new ae("Request failed with status code "+de.status,[ae.ERR_BAD_REQUEST,ae.ERR_BAD_RESPONSE][Math.floor(de.status/100)-4],de.config,de.request,de))}function Cp(ee){const te=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return te&&te[1]||""}function jH(ee,te){ee=ee||10;const de=new Array(ee),he=new Array(ee);let ge=0,Ie=0,we;return te=te!==void 0?te:1e3,function(st){const Ve=Date.now(),He=he[Ie];we||(we=Ve),de[ge]=st,he[ge]=Ve;let dt=Ie,Zt=0;for(;dt!==ge;)Zt+=de[dt++],dt=dt%ee;if(ge=(ge+1)%ee,ge===Ie&&(Ie=(Ie+1)%ee),Ve-we<te)return;const Br=He&&Ve-He;return Br?Math.round(Zt*1e3/Br):void 0}}function VH(ee,te){let de=0,he=1e3/te,ge,Ie;const we=(Ve,He=Date.now())=>{de=He,ge=null,Ie&&(clearTimeout(Ie),Ie=null),ee(...Ve)};return[(...Ve)=>{const He=Date.now(),dt=He-de;dt>=he?we(Ve,He):(ge=Ve,Ie||(Ie=setTimeout(()=>{Ie=null,we(ge)},he-dt)))},()=>ge&&we(ge)]}const Sp=(ee,te,de=3)=>{let he=0;const ge=jH(50,250);return VH(Ie=>{const we=Ie.loaded,xe=Ie.lengthComputable?Ie.total:void 0,st=we-he,Ve=ge(st),He=we<=xe;he=we;const dt={loaded:we,total:xe,progress:xe?we/xe:void 0,bytes:st,rate:Ve||void 0,estimated:Ve&&xe&&He?(xe-we)/Ve:void 0,event:Ie,lengthComputable:xe!=null,[te?"download":"upload"]:!0};ee(dt)},de)},aR=(ee,te)=>{const de=ee!=null;return[he=>te[0]({lengthComputable:de,total:ee,loaded:he}),te[1]]},lR=ee=>(...te)=>U.asap(()=>ee(...te));var zH=me.hasStandardBrowserEnv?((ee,te)=>de=>(de=new URL(de,me.origin),ee.protocol===de.protocol&&ee.host===de.host&&(te||ee.port===de.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,GH=me.hasStandardBrowserEnv?{write(ee,te,de,he,ge,Ie,we){if(typeof document>"u")return;const xe=[`${ee}=${encodeURIComponent(te)}`];U.isNumber(de)&&xe.push(`expires=${new Date(de).toUTCString()}`),U.isString(he)&&xe.push(`path=${he}`),U.isString(ge)&&xe.push(`domain=${ge}`),Ie===!0&&xe.push("secure"),U.isString(we)&&xe.push(`SameSite=${we}`),document.cookie=xe.join("; ")},read(ee){if(typeof document>"u")return null;const te=document.cookie.match(new RegExp("(?:^|; )"+ee+"=([^;]*)"));return te?decodeURIComponent(te[1]):null},remove(ee){this.write(ee,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function WH(ee){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(ee)}function KH(ee,te){return te?ee.replace(/\/?\/$/,"")+"/"+te.replace(/^\/+/,""):ee}function cR(ee,te,de){let he=!WH(te);return ee&&(he||de==!1)?KH(ee,te):te}const uR=ee=>ee instanceof _n?{...ee}:ee;function ll(ee,te){te=te||{};const de={};function he(Ve,He,dt,Zt){return U.isPlainObject(Ve)&&U.isPlainObject(He)?U.merge.call({caseless:Zt},Ve,He):U.isPlainObject(He)?U.merge({},He):U.isArray(He)?He.slice():He}function ge(Ve,He,dt,Zt){if(U.isUndefined(He)){if(!U.isUndefined(Ve))return he(void 0,Ve,dt,Zt)}else return he(Ve,He,dt,Zt)}function Ie(Ve,He){if(!U.isUndefined(He))return he(void 0,He)}function we(Ve,He){if(U.isUndefined(He)){if(!U.isUndefined(Ve))return he(void 0,Ve)}else return he(void 0,He)}function xe(Ve,He,dt){if(dt in te)return he(Ve,He);if(dt in ee)return he(void 0,Ve)}const st={url:Ie,method:Ie,data:Ie,baseURL:we,transformRequest:we,transformResponse:we,paramsSerializer:we,timeout:we,timeoutMessage:we,withCredentials:we,withXSRFToken:we,adapter:we,responseType:we,xsrfCookieName:we,xsrfHeaderName:we,onUploadProgress:we,onDownloadProgress:we,decompress:we,maxContentLength:we,maxBodyLength:we,beforeRedirect:we,transport:we,httpAgent:we,httpsAgent:we,cancelToken:we,socketPath:we,responseEncoding:we,validateStatus:xe,headers:(Ve,He,dt)=>ge(uR(Ve),uR(He),dt,!0)};return U.forEach(Object.keys({...ee,...te}),function(He){const dt=st[He]||ge,Zt=dt(ee[He],te[He],He);U.isUndefined(Zt)&&dt!==xe||(de[He]=Zt)}),de}var dR=ee=>{const te=ll({},ee);let{data:de,withXSRFToken:he,xsrfHeaderName:ge,xsrfCookieName:Ie,headers:we,auth:xe}=te;if(te.headers=we=_n.from(we),te.url=Fr(cR(te.baseURL,te.url,te.allowAbsoluteUrls),ee.params,ee.paramsSerializer),xe&&we.set("Authorization","Basic "+btoa((xe.username||"")+":"+(xe.password?unescape(encodeURIComponent(xe.password)):""))),U.isFormData(de)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)we.setContentType(void 0);else if(U.isFunction(de.getHeaders)){const st=de.getHeaders(),Ve=["content-type","content-length"];Object.entries(st).forEach(([He,dt])=>{Ve.includes(He.toLowerCase())&&we.set(He,dt)})}}if(me.hasStandardBrowserEnv&&(he&&U.isFunction(he)&&(he=he(te)),he||he!==!1&&zH(te.url))){const st=ge&&Ie&&GH.read(Ie);st&&we.set(ge,st)}return te},JH=typeof XMLHttpRequest<"u"&&function(ee){return new Promise(function(de,he){const ge=dR(ee);let Ie=ge.data;const we=_n.from(ge.headers).normalize();let{responseType:xe,onUploadProgress:st,onDownloadProgress:Ve}=ge,He,dt,Zt,Br,je;function mt(){Br&&Br(),je&&je(),ge.cancelToken&&ge.cancelToken.unsubscribe(He),ge.signal&&ge.signal.removeEventListener("abort",He)}let ct=new XMLHttpRequest;ct.open(ge.method.toUpperCase(),ge.url,!0),ct.timeout=ge.timeout;function Qn(){if(!ct)return;const lr=_n.from("getAllResponseHeaders"in ct&&ct.getAllResponseHeaders()),yo={data:!xe||xe==="text"||xe==="json"?ct.responseText:ct.response,status:ct.status,statusText:ct.statusText,headers:lr,config:ee,request:ct};Sd(function(Xi){de(Xi),mt()},function(Xi){he(Xi),mt()},yo),ct=null}"onloadend"in ct?ct.onloadend=Qn:ct.onreadystatechange=function(){!ct||ct.readyState!==4||ct.status===0&&!(ct.responseURL&&ct.responseURL.indexOf("file:")===0)||setTimeout(Qn)},ct.onabort=function(){ct&&(he(new ae("Request aborted",ae.ECONNABORTED,ee,ct)),ct=null)},ct.onerror=function(Ci){const yo=Ci&&Ci.message?Ci.message:"Network Error",cl=new ae(yo,ae.ERR_NETWORK,ee,ct);cl.event=Ci||null,he(cl),ct=null},ct.ontimeout=function(){let Ci=ge.timeout?"timeout of "+ge.timeout+"ms exceeded":"timeout exceeded";const yo=ge.transitional||Yt;ge.timeoutErrorMessage&&(Ci=ge.timeoutErrorMessage),he(new ae(Ci,yo.clarifyTimeoutError?ae.ETIMEDOUT:ae.ECONNABORTED,ee,ct)),ct=null},Ie===void 0&&we.setContentType(null),"setRequestHeader"in ct&&U.forEach(we.toJSON(),function(Ci,yo){ct.setRequestHeader(yo,Ci)}),U.isUndefined(ge.withCredentials)||(ct.withCredentials=!!ge.withCredentials),xe&&xe!=="json"&&(ct.responseType=ge.responseType),Ve&&([Zt,je]=Sp(Ve,!0),ct.addEventListener("progress",Zt)),st&&ct.upload&&([dt,Br]=Sp(st),ct.upload.addEventListener("progress",dt),ct.upload.addEventListener("loadend",Br)),(ge.cancelToken||ge.signal)&&(He=lr=>{ct&&(he(!lr||lr.type?new cn(null,ee,ct):lr),ct.abort(),ct=null)},ge.cancelToken&&ge.cancelToken.subscribe(He),ge.signal&&(ge.signal.aborted?He():ge.signal.addEventListener("abort",He)));const Qi=Cp(ge.url);if(Qi&&me.protocols.indexOf(Qi)===-1){he(new ae("Unsupported protocol "+Qi+":",ae.ERR_BAD_REQUEST,ee));return}ct.send(Ie||null)})},QH=(ee,te)=>{const{length:de}=ee=ee?ee.filter(Boolean):[];if(te||de){let he=new AbortController,ge;const Ie=function(Ve){if(!ge){ge=!0,xe();const He=Ve instanceof Error?Ve:this.reason;he.abort(He instanceof ae?He:new cn(He instanceof Error?He.message:He))}};let we=te&&setTimeout(()=>{we=null,Ie(new ae(`timeout ${te} of ms exceeded`,ae.ETIMEDOUT))},te);const xe=()=>{ee&&(we&&clearTimeout(we),we=null,ee.forEach(Ve=>{Ve.unsubscribe?Ve.unsubscribe(Ie):Ve.removeEventListener("abort",Ie)}),ee=null)};ee.forEach(Ve=>Ve.addEventListener("abort",Ie));const{signal:st}=he;return st.unsubscribe=()=>U.asap(xe),st}};const XH=function*(ee,te){let de=ee.byteLength;if(de<te){yield ee;return}let he=0,ge;for(;he<de;)ge=he+te,yield ee.slice(he,ge),he=ge},YH=async function*(ee,te){for await(const de of ZH(ee))yield*XH(de,te)},ZH=async function*(ee){if(ee[Symbol.asyncIterator]){yield*ee;return}const te=ee.getReader();try{for(;;){const{done:de,value:he}=await te.read();if(de)break;yield he}}finally{await te.cancel()}},hR=(ee,te,de,he)=>{const ge=YH(ee,te);let Ie=0,we,xe=st=>{we||(we=!0,he&&he(st))};return new ReadableStream({async pull(st){try{const{done:Ve,value:He}=await ge.next();if(Ve){xe(),st.close();return}let dt=He.byteLength;if(de){let Zt=Ie+=dt;de(Zt)}st.enqueue(new Uint8Array(He))}catch(Ve){throw xe(Ve),Ve}},cancel(st){return xe(st),ge.return()}},{highWaterMark:2})},fR=64*1024,{isFunction:Tp}=U,eq=(({Request:ee,Response:te})=>({Request:ee,Response:te}))(U.global),{ReadableStream:pR,TextEncoder:gR}=U.global,mR=(ee,...te)=>{try{return!!ee(...te)}catch{return!1}},tq=ee=>{ee=U.merge.call({skipUndefined:!0},eq,ee);const{fetch:te,Request:de,Response:he}=ee,ge=te?Tp(te):typeof fetch=="function",Ie=Tp(de),we=Tp(he);if(!ge)return!1;const xe=ge&&Tp(pR),st=ge&&(typeof gR=="function"?(je=>mt=>je.encode(mt))(new gR):async je=>new Uint8Array(await new de(je).arrayBuffer())),Ve=Ie&&xe&&mR(()=>{let je=!1;const mt=new de(me.origin,{body:new pR,method:"POST",get duplex(){return je=!0,"half"}}).headers.has("Content-Type");return je&&!mt}),He=we&&xe&&mR(()=>U.isReadableStream(new he("").body)),dt={stream:He&&(je=>je.body)};ge&&["text","arrayBuffer","blob","formData","stream"].forEach(je=>{!dt[je]&&(dt[je]=(mt,ct)=>{let Qn=mt&&mt[je];if(Qn)return Qn.call(mt);throw new ae(`Response type '${je}' is not supported`,ae.ERR_NOT_SUPPORT,ct)})});const Zt=async je=>{if(je==null)return 0;if(U.isBlob(je))return je.size;if(U.isSpecCompliantForm(je))return(await new de(me.origin,{method:"POST",body:je}).arrayBuffer()).byteLength;if(U.isArrayBufferView(je)||U.isArrayBuffer(je))return je.byteLength;if(U.isURLSearchParams(je)&&(je=je+""),U.isString(je))return(await st(je)).byteLength},Br=async(je,mt)=>{const ct=U.toFiniteNumber(je.getContentLength());return ct??Zt(mt)};return async je=>{let{url:mt,method:ct,data:Qn,signal:Qi,cancelToken:lr,timeout:Ci,onDownloadProgress:yo,onUploadProgress:cl,responseType:Xi,headers:hC,withCredentials:_p="same-origin",fetchOptions:IR}=dR(je),bR=te||fetch;Xi=Xi?(Xi+"").toLowerCase():"text";let Ap=QH([Qi,lr&&lr.toAbortSignal()],Ci),Td=null;const ul=Ap&&Ap.unsubscribe&&(()=>{Ap.unsubscribe()});let _R;try{if(cl&&Ve&&ct!=="get"&&ct!=="head"&&(_R=await Br(hC,Qn))!==0){let ta=new de(mt,{method:"POST",body:Qn,duplex:"half"}),gc;if(U.isFormData(Qn)&&(gc=ta.headers.get("content-type"))&&hC.setContentType(gc),ta.body){const[fC,Rp]=aR(_R,Sp(lR(cl)));Qn=hR(ta.body,fR,fC,Rp)}}U.isString(_p)||(_p=_p?"include":"omit");const Jo=Ie&&"credentials"in de.prototype,AR={...IR,signal:Ap,method:ct.toUpperCase(),headers:hC.normalize().toJSON(),body:Qn,duplex:"half",credentials:Jo?_p:void 0};Td=Ie&&new de(mt,AR);let ea=await(Ie?bR(Td,IR):bR(mt,AR));const RR=He&&(Xi==="stream"||Xi==="response");if(He&&(yo||RR&&ul)){const ta={};["status","statusText","headers"].forEach(kR=>{ta[kR]=ea[kR]});const gc=U.toFiniteNumber(ea.headers.get("content-length")),[fC,Rp]=yo&&aR(gc,Sp(lR(yo),!0))||[];ea=new he(hR(ea.body,fR,fC,()=>{Rp&&Rp(),ul&&ul()}),ta)}Xi=Xi||"text";let uq=await dt[U.findKey(dt,Xi)||"text"](ea,je);return!RR&&ul&&ul(),await new Promise((ta,gc)=>{Sd(ta,gc,{data:uq,headers:_n.from(ea.headers),status:ea.status,statusText:ea.statusText,config:je,request:Td})})}catch(Jo){throw ul&&ul(),Jo&&Jo.name==="TypeError"&&/Load failed|fetch/i.test(Jo.message)?Object.assign(new ae("Network Error",ae.ERR_NETWORK,je,Td),{cause:Jo.cause||Jo}):ae.from(Jo,Jo&&Jo.code,je,Td)}}},nq=new Map,vR=ee=>{let te=ee&&ee.env||{};const{fetch:de,Request:he,Response:ge}=te,Ie=[he,ge,de];let we=Ie.length,xe=we,st,Ve,He=nq;for(;xe--;)st=Ie[xe],Ve=He.get(st),Ve===void 0&&He.set(st,Ve=xe?new Map:tq(te)),He=Ve;return Ve};vR();const lC={http:ve,xhr:JH,fetch:{get:vR}};U.forEach(lC,(ee,te)=>{if(ee){try{Object.defineProperty(ee,"name",{value:te})}catch{}Object.defineProperty(ee,"adapterName",{value:te})}});const yR=ee=>`- ${ee}`,rq=ee=>U.isFunction(ee)||ee===null||ee===!1;function iq(ee,te){ee=U.isArray(ee)?ee:[ee];const{length:de}=ee;let he,ge;const Ie={};for(let we=0;we<de;we++){he=ee[we];let xe;if(ge=he,!rq(he)&&(ge=lC[(xe=String(he)).toLowerCase()],ge===void 0))throw new ae(`Unknown adapter '${xe}'`);if(ge&&(U.isFunction(ge)||(ge=ge.get(te))))break;Ie[xe||"#"+we]=ge}if(!ge){const we=Object.entries(Ie).map(([st,Ve])=>`adapter ${st} `+(Ve===!1?"is not supported by the environment":"is not available in the build"));let xe=de?we.length>1?`since :
`+we.map(yR).join(`
`):" "+yR(we[0]):"as no adapter specified";throw new ae("There is no suitable adapter to dispatch the request "+xe,"ERR_NOT_SUPPORT")}return ge}var CR={getAdapter:iq,adapters:lC};function cC(ee){if(ee.cancelToken&&ee.cancelToken.throwIfRequested(),ee.signal&&ee.signal.aborted)throw new cn(null,ee)}function SR(ee){return cC(ee),ee.headers=_n.from(ee.headers),ee.data=Wo.call(ee,ee.transformRequest),["post","put","patch"].indexOf(ee.method)!==-1&&ee.headers.setContentType("application/x-www-form-urlencoded",!1),CR.getAdapter(ee.adapter||Er.adapter,ee)(ee).then(function(he){return cC(ee),he.data=Wo.call(ee,ee.transformResponse,he),he.headers=_n.from(he.headers),he},function(he){return pc(he)||(cC(ee),he&&he.response&&(he.response.data=Wo.call(ee,ee.transformResponse,he.response),he.response.headers=_n.from(he.response.headers))),Promise.reject(he)})}const TR="1.13.2",Ep={};["object","boolean","number","function","string","symbol"].forEach((ee,te)=>{Ep[ee]=function(he){return typeof he===ee||"a"+(te<1?"n ":" ")+ee}});const ER={};Ep.transitional=function(te,de,he){function ge(Ie,we){return"[Axios v"+TR+"] Transitional option '"+Ie+"'"+we+(he?". "+he:"")}return(Ie,we,xe)=>{if(te===!1)throw new ae(ge(we," has been removed"+(de?" in "+de:"")),ae.ERR_DEPRECATED);return de&&!ER[we]&&(ER[we]=!0,console.warn(ge(we," has been deprecated since v"+de+" and will be removed in the near future"))),te?te(Ie,we,xe):!0}},Ep.spelling=function(te){return(de,he)=>(console.warn(`${he} is likely a misspelling of ${te}`),!0)};function oq(ee,te,de){if(typeof ee!="object")throw new ae("options must be an object",ae.ERR_BAD_OPTION_VALUE);const he=Object.keys(ee);let ge=he.length;for(;ge-- >0;){const Ie=he[ge],we=te[Ie];if(we){const xe=ee[Ie],st=xe===void 0||we(xe,Ie,ee);if(st!==!0)throw new ae("option "+Ie+" must be "+st,ae.ERR_BAD_OPTION_VALUE);continue}if(de!==!0)throw new ae("Unknown option "+Ie,ae.ERR_BAD_OPTION)}}var wp={assertOptions:oq,validators:Ep};const Ko=wp.validators;class Ip{constructor(te){this.defaults=te||{},this.interceptors={request:new Jt,response:new Jt}}async request(te,de){try{return await this._request(te,de)}catch(he){if(he instanceof Error){let ge={};Error.captureStackTrace?Error.captureStackTrace(ge):ge=new Error;const Ie=ge.stack?ge.stack.replace(/^.+\n/,""):"";try{he.stack?Ie&&!String(he.stack).endsWith(Ie.replace(/^.+\n.+\n/,""))&&(he.stack+=`
`+Ie):he.stack=Ie}catch{}}throw he}}_request(te,de){typeof te=="string"?(de=de||{},de.url=te):de=te||{},de=ll(this.defaults,de);const{transitional:he,paramsSerializer:ge,headers:Ie}=de;he!==void 0&&wp.assertOptions(he,{silentJSONParsing:Ko.transitional(Ko.boolean),forcedJSONParsing:Ko.transitional(Ko.boolean),clarifyTimeoutError:Ko.transitional(Ko.boolean)},!1),ge!=null&&(U.isFunction(ge)?de.paramsSerializer={serialize:ge}:wp.assertOptions(ge,{encode:Ko.function,serialize:Ko.function},!0)),de.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?de.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:de.allowAbsoluteUrls=!0),wp.assertOptions(de,{baseUrl:Ko.spelling("baseURL"),withXsrfToken:Ko.spelling("withXSRFToken")},!0),de.method=(de.method||this.defaults.method||"get").toLowerCase();let we=Ie&&U.merge(Ie.common,Ie[de.method]);Ie&&U.forEach(["delete","get","head","post","put","patch","common"],je=>{delete Ie[je]}),de.headers=_n.concat(we,Ie);const xe=[];let st=!0;this.interceptors.request.forEach(function(mt){typeof mt.runWhen=="function"&&mt.runWhen(de)===!1||(st=st&&mt.synchronous,xe.unshift(mt.fulfilled,mt.rejected))});const Ve=[];this.interceptors.response.forEach(function(mt){Ve.push(mt.fulfilled,mt.rejected)});let He,dt=0,Zt;if(!st){const je=[SR.bind(this),void 0];for(je.unshift(...xe),je.push(...Ve),Zt=je.length,He=Promise.resolve(de);dt<Zt;)He=He.then(je[dt++],je[dt++]);return He}Zt=xe.length;let Br=de;for(;dt<Zt;){const je=xe[dt++],mt=xe[dt++];try{Br=je(Br)}catch(ct){mt.call(this,ct);break}}try{He=SR.call(this,Br)}catch(je){return Promise.reject(je)}for(dt=0,Zt=Ve.length;dt<Zt;)He=He.then(Ve[dt++],Ve[dt++]);return He}getUri(te){te=ll(this.defaults,te);const de=cR(te.baseURL,te.url,te.allowAbsoluteUrls);return Fr(de,te.params,te.paramsSerializer)}}U.forEach(["delete","get","head","options"],function(te){Ip.prototype[te]=function(de,he){return this.request(ll(he||{},{method:te,url:de,data:(he||{}).data}))}}),U.forEach(["post","put","patch"],function(te){function de(he){return function(Ie,we,xe){return this.request(ll(xe||{},{method:te,headers:he?{"Content-Type":"multipart/form-data"}:{},url:Ie,data:we}))}}Ip.prototype[te]=de(),Ip.prototype[te+"Form"]=de(!0)});var bp=Ip;class uC{constructor(te){if(typeof te!="function")throw new TypeError("executor must be a function.");let de;this.promise=new Promise(function(Ie){de=Ie});const he=this;this.promise.then(ge=>{if(!he._listeners)return;let Ie=he._listeners.length;for(;Ie-- >0;)he._listeners[Ie](ge);he._listeners=null}),this.promise.then=ge=>{let Ie;const we=new Promise(xe=>{he.subscribe(xe),Ie=xe}).then(ge);return we.cancel=function(){he.unsubscribe(Ie)},we},te(function(Ie,we,xe){he.reason||(he.reason=new cn(Ie,we,xe),de(he.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(te){if(this.reason){te(this.reason);return}this._listeners?this._listeners.push(te):this._listeners=[te]}unsubscribe(te){if(!this._listeners)return;const de=this._listeners.indexOf(te);de!==-1&&this._listeners.splice(de,1)}toAbortSignal(){const te=new AbortController,de=he=>{te.abort(he)};return this.subscribe(de),te.signal.unsubscribe=()=>this.unsubscribe(de),te.signal}static source(){let te;return{token:new uC(function(ge){te=ge}),cancel:te}}}var sq=uC;function aq(ee){return function(de){return ee.apply(null,de)}}function lq(ee){return U.isObject(ee)&&ee.isAxiosError===!0}const dC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(dC).forEach(([ee,te])=>{dC[te]=ee});var cq=dC;function wR(ee){const te=new bp(ee),de=t(bp.prototype.request,te);return U.extend(de,bp.prototype,te,{allOwnKeys:!0}),U.extend(de,te,null,{allOwnKeys:!0}),de.create=function(ge){return wR(ll(ee,ge))},de}const Un=wR(Er);return Un.Axios=bp,Un.CanceledError=cn,Un.CancelToken=sq,Un.isCancel=pc,Un.VERSION=TR,Un.toFormData=Qe,Un.AxiosError=ae,Un.Cancel=Un.CanceledError,Un.all=function(te){return Promise.all(te)},Un.spread=aq,Un.isAxiosError=lq,Un.mergeConfig=ll,Un.AxiosHeaders=_n,Un.formToJSON=ee=>Bt(U.isHTMLForm(ee)?new FormData(ee):ee),Un.getAdapter=CR.getAdapter,Un.HttpStatusCode=cq,Un.default=Un,u0=Un,u0}var d0={},Gp={exports:{}},Si={},h0,uP;function QV(){if(uP)return h0;uP=1;const t=new Set(["ENOTFOUND","ENETUNREACH","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_CRL","UNABLE_TO_DECRYPT_CERT_SIGNATURE","UNABLE_TO_DECRYPT_CRL_SIGNATURE","UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY","CERT_SIGNATURE_FAILURE","CRL_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CRL_NOT_YET_VALID","CRL_HAS_EXPIRED","ERROR_IN_CERT_NOT_BEFORE_FIELD","ERROR_IN_CERT_NOT_AFTER_FIELD","ERROR_IN_CRL_LAST_UPDATE_FIELD","ERROR_IN_CRL_NEXT_UPDATE_FIELD","OUT_OF_MEM","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","UNABLE_TO_VERIFY_LEAF_SIGNATURE","CERT_CHAIN_TOO_LONG","CERT_REVOKED","INVALID_CA","PATH_LENGTH_EXCEEDED","INVALID_PURPOSE","CERT_UNTRUSTED","CERT_REJECTED","HOSTNAME_MISMATCH"]);return h0=e=>!t.has(e&&e.code),h0}var dP;function XV(){if(dP)return Si;dP=1;var t=yn;Object.defineProperty(Si,"__esModule",{value:!0}),Si.isNetworkError=a,Si.isRetryableError=f,Si.isSafeRequestError=h,Si.isIdempotentRequestError=g,Si.isNetworkOrIdempotentRequestError=E,Si.exponentialDelay=w,Si.default=G,Si.DEFAULT_OPTIONS=Si.namespace=void 0;var e=t(MU()),n=t(Ha()),r=t(DU()),i=t(us()),o=t(QV());function s(oe,J){var X=Object.keys(oe);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(oe);J&&(B=B.filter(function(q){return Object.getOwnPropertyDescriptor(oe,q).enumerable})),X.push.apply(X,B)}return X}function l(oe){for(var J=1;J<arguments.length;J++){var X=arguments[J]!=null?arguments[J]:{};J%2?s(Object(X),!0).forEach(function(B){(0,i.default)(oe,B,X[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(X)):s(Object(X)).forEach(function(B){Object.defineProperty(oe,B,Object.getOwnPropertyDescriptor(X,B))})}return oe}var c="axios-retry";Si.namespace=c;function a(oe){var J=["ERR_CANCELED","ECONNABORTED"];return!oe.response&&!!oe.code&&!J.includes(oe.code)&&(0,o.default)(oe)}var u=["get","head","options"],d=u.concat(["put","delete"]);function f(oe){return oe.code!=="ECONNABORTED"&&(!oe.response||oe.response.status>=500&&oe.response.status<=599)}function h(oe){return oe.config?f(oe)&&u.indexOf(oe.config.method)!==-1:!1}function g(oe){return oe.config?f(oe)&&d.indexOf(oe.config.method)!==-1:!1}function E(oe){return a(oe)||g(oe)}function D(){return 0}function w(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:100,X=Math.pow(2,oe)*J,B=X*.2*Math.random();return X+B}var p={retries:3,retryCondition:E,retryDelay:D,shouldResetTimeout:!1,onRetry:function(){}};Si.DEFAULT_OPTIONS=p;function b(oe,J){return l(l(l({},p),J),oe[c])}function j(oe,J){var X=b(oe,J);return X.retryCount=X.retryCount||0,oe[c]=X,X}function K(oe,J){oe.defaults.agent===J.agent&&delete J.agent,oe.defaults.httpAgent===J.httpAgent&&delete J.httpAgent,oe.defaults.httpsAgent===J.httpsAgent&&delete J.httpsAgent}function M(oe,J){return ne.apply(this,arguments)}function ne(){return ne=(0,r.default)(e.default.mark(function oe(J,X){var B,q,F,x;return e.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(B=J.retries,q=J.retryCondition,F=J.retryCount<B&&q(X),(0,n.default)(F)!=="object"){v.next=13;break}return v.prev=3,v.next=6,F;case 6:return x=v.sent,v.abrupt("return",x!==!1);case 10:return v.prev=10,v.t0=v.catch(3),v.abrupt("return",!1);case 13:return v.abrupt("return",F);case 14:case"end":return v.stop()}},oe,null,[[3,10]])})),ne.apply(this,arguments)}function G(oe,J){var X=oe.interceptors.request.use(function(q){var F=j(q,J);return F.lastRequestTime=Date.now(),q}),B=oe.interceptors.response.use(null,function(){var q=(0,r.default)(e.default.mark(function F(x){var P,v,T,_,N,I,A,S;return e.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(P=x.config,P){L.next=3;break}return L.abrupt("return",Promise.reject(x));case 3:return v=j(P,J),L.next=6,M(v,x);case 6:if(!L.sent){L.next=21;break}if(v.retryCount+=1,T=v.retryDelay,_=v.shouldResetTimeout,N=v.onRetry,I=T(v.retryCount,x),K(oe,P),!(!_&&P.timeout&&v.lastRequestTime)){L.next=17;break}if(A=Date.now()-v.lastRequestTime,S=P.timeout-A-I,!(S<=0)){L.next=16;break}return L.abrupt("return",Promise.reject(x));case 16:P.timeout=S;case 17:return P.transformRequest=[function(C){return C}],L.next=20,N(v.retryCount,x,P);case 20:return L.abrupt("return",new Promise(function(C){return setTimeout(function(){return C(oe(P))},I)}));case 21:return L.abrupt("return",Promise.reject(x));case 22:case"end":return L.stop()}},F)}));return function(F){return q.apply(this,arguments)}}());return{requestInterceptorId:X,responseInterceptorId:B}}return G.isNetworkError=a,G.isSafeRequestError=h,G.isIdempotentRequestError=g,G.isNetworkOrIdempotentRequestError=E,G.exponentialDelay=w,G.isRetryableError=f,Si}var hP;function NU(){if(hP)return Gp.exports;hP=1;const t=XV().default;return Gp.exports=t,Gp.exports.default=t,Gp.exports}var fP;function xU(){return fP||(fP=1,function(t){var e=yn,n=Ha();Object.defineProperty(t,"__esModule",{value:!0}),t.isRetryableError=f,t.axiosRetryHandlerWithNotFound=h,t.default=void 0;var r=s(NU()),i=e(Sf());function o(E){if(typeof WeakMap!="function")return null;var D=new WeakMap,w=new WeakMap;return(o=function(b){return b?w:D})(E)}function s(E,D){if(E&&E.__esModule)return E;if(E===null||n(E)!=="object"&&typeof E!="function")return{default:E};var w=o(D);if(w&&w.has(E))return w.get(E);var p={},b=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var K=b?Object.getOwnPropertyDescriptor(E,j):null;K&&(K.get||K.set)?Object.defineProperty(p,j,K):p[j]=E[j]}return p.default=E,w&&w.set(E,p),p}function l(E,D){var w=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!w){if(Array.isArray(E)||(w=c(E))||D){w&&(E=w);var p=0,b=function(){};return{s:b,n:function(){return p>=E.length?{done:!0}:{done:!1,value:E[p++]}},e:function(G){throw G},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var j=!0,K=!1,M;return{s:function(){w=w.call(E)},n:function(){var G=w.next();return j=G.done,G},e:function(G){K=!0,M=G},f:function(){try{!j&&w.return!=null&&w.return()}finally{if(K)throw M}}}}function c(E,D){if(E){if(typeof E=="string")return a(E,D);var w=Object.prototype.toString.call(E).slice(8,-1);if(w==="Object"&&E.constructor&&(w=E.constructor.name),w==="Map"||w==="Set")return Array.from(E);if(w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return a(E,D)}}function a(E,D){(D==null||D>E.length)&&(D=E.length);for(var w=0,p=new Array(D);w<D;w++)p[w]=E[w];return p}var u=function(D,w){var p,b,j;return((p=D.response)===null||p===void 0?void 0:p.status)===i.default.tooManyRequestsStatusCode&&!w?!1:f(D)||(0,r.isNetworkError)(D)||((b=D.response)===null||b===void 0?void 0:b.status)===0||!((j=D.response)!==null&&j!==void 0&&j.status)},d=function(D,w){(w.retryOn429===void 0||w.retryOn429===null)&&(w.retryOn429=!1),w.shouldRetry||(w.shouldRetry=function(p){return u(p,w.retryOn429)}),(0,r.default)(D,{retries:w.retries,retryCondition:w.shouldRetry,onRetry:function(b,j,K){var M=j.response,ne=w.headerOverwrites;if(ne&&M!==null&&M!==void 0&&M.headers){var G=l(ne),oe;try{for(G.s();!(oe=G.n()).done;){var J=oe.value,X=M==null?void 0:M.headers[J.toLocaleLowerCase()];X&&K.headers&&(K.headers[J]=X)}}catch(B){G.e(B)}finally{G.f()}}},retryDelay:function(b,j){var K,M,ne,G=w.waitTimeInMsBetweenRetries,oe=j==null||(K=j.response)===null||K===void 0||(M=K.headers)===null||M===void 0?void 0:M["retry-after"],J=G;if(oe){var X=parseInt(oe);if(!isNaN(X))J=X*G;else{var B=new Date(oe),q=new Date().getTime();B&&B instanceof Date&&isFinite(B.getTime())&&(J=Math.max(0,B.getTime()-q))}return J}return((ne=j.response)===null||ne===void 0?void 0:ne.status)===i.default.tooManyRequestsStatusCode?5e3:Math.pow(2,b)*G}})};function f(E){return E.code!=="ECONNABORTED"&&(!E.response||E.response.status===429||E.response.status>=500&&E.response.status<=599)}function h(E,D){d(E,{retries:D.retries,waitTimeInMsBetweenRetries:D.waitTimeInMsBetweenRetries,shouldRetry:function(p){var b;return u(p,D.retryOn429)||((b=p.response)===null||b===void 0?void 0:b.status)===i.default.notFoundStatusCode}})}var g=d;t.default=g}(d0)),d0}var dl={},pP;function YV(){if(pP)return dl;pP=1;var t=yn;Object.defineProperty(dl,"__esModule",{value:!0}),dl.BrowserInfo=dl.UNKNOWN_VERSION=void 0;var e=t(Yr()),n=t(po()),r=t(us()),i=zu(),o="([\\d,.]+)",s="U";dl.UNKNOWN_VERSION=s;var l=function(){function c(){(0,e.default)(this,c)}return(0,n.default)(c,null,[{key:"getUserAgent",value:function(){return this.userAgent()}},{key:"userAgentContainsString",value:function(u){return this.getUserAgent().indexOf(u)>-1}},{key:"isChrome",value:function(){return this.userAgentContainsString(i.BrowserVendor.CHROME)&&!this.userAgentContainsString(i.BrowserVendor.EDGE)&&!this.userAgentContainsString(i.BrowserVendor.EDGE_CHROMIUM)}},{key:"isIe",value:function(){return this.userAgentContainsString("Trident")}},{key:"isEdge",value:function(){return this.userAgentContainsString(i.BrowserVendor.EDGE)||this.userAgentContainsString(i.BrowserVendor.EDGE_CHROMIUM)}},{key:"isOpera",value:function(){return this.userAgentContainsString("OPR/")}},{key:"getBrowserName",value:function(){return this.isOpera()?i.BrowserVendor.OPERA:this.isEdge()?i.BrowserVendor.EDGE:this.isChrome()?i.BrowserVendor.CHROME:this.userAgentContainsString(i.BrowserVendor.FIREFOX)?i.BrowserVendor.FIREFOX:this.userAgentContainsString(i.BrowserVendor.SAFARI)?i.BrowserVendor.SAFARI:this.isIe()?i.BrowserVendor.IE:i.BrowserVendor.UNKNOWN}},{key:"getBrowserVersion",value:function(){var u=this,d=function(){var g=u.getUserAgent(),E=g.match(new RegExp(i.BrowserVendor.IE+" "+o));if(E)return E[1];var D=g.match(new RegExp("rv:"+o));if(D)return D[1]},f=function(g){g===i.BrowserVendor.SAFARI&&(g="Version"),g===i.BrowserVendor.OPERA&&(g="OPR"),g===i.BrowserVendor.EDGE&&(g="Edge?");var E=u.getUserAgent().match(new RegExp(g+"/"+o));return E?E[1]:s};return this.isIe()?d():f(this.getBrowserName())}}]),c}();return dl.BrowserInfo=l,(0,r.default)(l,"userAgent",function(){return window.navigator.userAgent}),dl}var Pd={},gP;function ZV(){if(gP)return Pd;gP=1;var t=yn;Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.CustomContextData=void 0;var e=t(Yr()),n=t(po()),r=function(){function i(){(0,e.default)(this,i)}return(0,n.default)(i,null,[{key:"sort",value:function(s){var l=new Array;return Object.keys(s).forEach(function(c){if(s&&s["".concat(c)]){var a={key:c,value:s["".concat(c)]};l.push(a)}}),l.sort(function(c,a){var u=c.key.toUpperCase(),d=a.key.toUpperCase();return u<d?-1:u>d?1:0}),l}}]),i}();return Pd.CustomContextData=r,Pd}var Od={},mP;function ez(){if(mP)return Od;mP=1;var t=yn;Object.defineProperty(Od,"__esModule",{value:!0}),Od.DeviceInfo=void 0;var e=t(Yr()),n=t(po()),r=zu(),i=function(){function o(){(0,e.default)(this,o)}return(0,n.default)(o,null,[{key:"getDeviceType",value:function(){var l=/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i,c=/tablet|ipad/i;return window.navigator.userAgent.match(l)?r.DeviceType.Mobile:window.navigator.userAgent.match(c)?r.DeviceType.Tablet:r.DeviceType.Desktop}}]),o}();return Od.DeviceInfo=i,Od}var f0={exports:{}};function tz(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var p0={exports:{}};const nz={},rz=Object.freeze(Object.defineProperty({__proto__:null,default:nz},Symbol.toStringTag,{value:"Module"})),iz=Hs(rz);var vP;function LU(){return vP||(vP=1,function(t,e){(function(n,r){t.exports=r()})(_e,function(){var n=n||function(r,i){var o;if(typeof window<"u"&&window.crypto&&(o=window.crypto),typeof self<"u"&&self.crypto&&(o=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(o=globalThis.crypto),!o&&typeof window<"u"&&window.msCrypto&&(o=window.msCrypto),!o&&typeof _e<"u"&&_e.crypto&&(o=_e.crypto),!o&&typeof tz=="function")try{o=iz}catch{}var s=function(){if(o){if(typeof o.getRandomValues=="function")try{return o.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof o.randomBytes=="function")try{return o.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||function(){function p(){}return function(b){var j;return p.prototype=b,j=new p,p.prototype=null,j}}(),c={},a=c.lib={},u=a.Base=function(){return{extend:function(p){var b=l(this);return p&&b.mixIn(p),(!b.hasOwnProperty("init")||this.init===b.init)&&(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var p=this.extend();return p.init.apply(p,arguments),p},init:function(){},mixIn:function(p){for(var b in p)p.hasOwnProperty(b)&&(this[b]=p[b]);p.hasOwnProperty("toString")&&(this.toString=p.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=a.WordArray=u.extend({init:function(p,b){p=this.words=p||[],b!=i?this.sigBytes=b:this.sigBytes=p.length*4},toString:function(p){return(p||h).stringify(this)},concat:function(p){var b=this.words,j=p.words,K=this.sigBytes,M=p.sigBytes;if(this.clamp(),K%4)for(var ne=0;ne<M;ne++){var G=j[ne>>>2]>>>24-ne%4*8&255;b[K+ne>>>2]|=G<<24-(K+ne)%4*8}else for(var oe=0;oe<M;oe+=4)b[K+oe>>>2]=j[oe>>>2];return this.sigBytes+=M,this},clamp:function(){var p=this.words,b=this.sigBytes;p[b>>>2]&=4294967295<<32-b%4*8,p.length=r.ceil(b/4)},clone:function(){var p=u.clone.call(this);return p.words=this.words.slice(0),p},random:function(p){for(var b=[],j=0;j<p;j+=4)b.push(s());return new d.init(b,p)}}),f=c.enc={},h=f.Hex={stringify:function(p){for(var b=p.words,j=p.sigBytes,K=[],M=0;M<j;M++){var ne=b[M>>>2]>>>24-M%4*8&255;K.push((ne>>>4).toString(16)),K.push((ne&15).toString(16))}return K.join("")},parse:function(p){for(var b=p.length,j=[],K=0;K<b;K+=2)j[K>>>3]|=parseInt(p.substr(K,2),16)<<24-K%8*4;return new d.init(j,b/2)}},g=f.Latin1={stringify:function(p){for(var b=p.words,j=p.sigBytes,K=[],M=0;M<j;M++){var ne=b[M>>>2]>>>24-M%4*8&255;K.push(String.fromCharCode(ne))}return K.join("")},parse:function(p){for(var b=p.length,j=[],K=0;K<b;K++)j[K>>>2]|=(p.charCodeAt(K)&255)<<24-K%4*8;return new d.init(j,b)}},E=f.Utf8={stringify:function(p){try{return decodeURIComponent(escape(g.stringify(p)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(p){return g.parse(unescape(encodeURIComponent(p)))}},D=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(p){typeof p=="string"&&(p=E.parse(p)),this._data.concat(p),this._nDataBytes+=p.sigBytes},_process:function(p){var b,j=this._data,K=j.words,M=j.sigBytes,ne=this.blockSize,G=ne*4,oe=M/G;p?oe=r.ceil(oe):oe=r.max((oe|0)-this._minBufferSize,0);var J=oe*ne,X=r.min(J*4,M);if(J){for(var B=0;B<J;B+=ne)this._doProcessBlock(K,B);b=K.splice(0,J),j.sigBytes-=X}return new d.init(b,X)},clone:function(){var p=u.clone.call(this);return p._data=this._data.clone(),p},_minBufferSize:0});a.Hasher=D.extend({cfg:u.extend(),init:function(p){this.cfg=this.cfg.extend(p),this.reset()},reset:function(){D.reset.call(this),this._doReset()},update:function(p){return this._append(p),this._process(),this},finalize:function(p){p&&this._append(p);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(p){return function(b,j){return new p.init(j).finalize(b)}},_createHmacHelper:function(p){return function(b,j){return new w.HMAC.init(p,j).finalize(b)}}});var w=c.algo={};return c}(Math);return n})}(p0)),p0.exports}var yP;function oz(){return yP||(yP=1,function(t,e){(function(n,r){t.exports=r(LU())})(_e,function(n){return n.enc.Hex})}(f0)),f0.exports}var g0={},CP;function sz(){return CP||(CP=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(us()),i=function o(){(0,n.default)(this,o)};t.default=i,(0,r.default)(i,"supportedLocales",["ar-sa","bg-bg","ca-es","cs-cz","da-dk","de-de","el-gr","en-us","es-es","et-ee","eu-es","fi-fi","fr-fr","gl-es","he-il","hi-in","hr-hr","hu-hu","id-id","it-it","ja-jp","kk-kz","ko-kr","lt-lt","lv-lv","ms-my","nb-no","nl-nl","pl-pl","pt-br","pt-pt","ro-ro","ru-ru","sk-sk","sl-si","sr-cyrl-cs","sr-latn-cs","sv-se","th-th","tr-tr","uk-ua","vi-vn","zh-cn","zh-hk","zh-tw"])}(g0)),g0}var vc={},SP;function az(){if(SP)return vc;SP=1,Object.defineProperty(vc,"__esModule",{value:!0}),vc.LogLevel=void 0;var t;return vc.LogLevel=t,function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(t||(vc.LogLevel=t={})),vc}var Md={},m0={},TP;function sb(){return TP||(TP=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(us()),i=function o(){(0,n.default)(this,o)};t.default=i,(0,r.default)(i,"authenticatedUserToken","AuthenticatedUserToken"),(0,r.default)(i,"authorization","Authorization"),(0,r.default)(i,"organizationId","OrganizationId"),(0,r.default)(i,"widgetAppId","widgetAppId"),(0,r.default)(i,"requestId","Request-Id"),(0,r.default)(i,"authCodeNonce","AuthCodeNonce"),(0,r.default)(i,"ocSessionId","Oc-Sessionid"),(0,r.default)(i,"ocUserAgent","Ms-Oc-User-Agent"),(0,r.default)(i,"correlationId","x-ms-client-request-id"),(0,r.default)(i,"pageToken","PageToken")}(m0)),m0}var EP;function lz(){if(EP)return Md;EP=1;var t=yn;Object.defineProperty(Md,"__esModule",{value:!0}),Md.LoggingSanitizer=void 0;var e=t(Ha()),n=t(Yr()),r=t(po()),i=t(us()),o=t(Sf()),s=t(sb()),l=function(){function c(){(0,n.default)(this,c)}return(0,r.default)(c,null,[{key:"stripCustomContextDataValues",value:function(u){if(u){var d;(d=Object.keys(u))===null||d===void 0||d.forEach(function(f){var h;(h=u["".concat(f)])!==null&&h!==void 0&&h.value&&(u["".concat(f)].value=o.default.hiddenContentPlaceholder)})}}},{key:"stripPreChatResponse",value:function(u){u&&Object.keys(u).forEach(function(d){u["".concat(d)]&&d!=="Type"&&(u["".concat(d)]=o.default.hiddenContentPlaceholder)})}},{key:"stripGeolocation",value:function(u){u&&(Object.keys(u).includes("longitude")&&(u.longitude=o.default.hiddenContentPlaceholder),Object.keys(u).includes("latitude")&&(u.latitude=o.default.hiddenContentPlaceholder))}},{key:"stripAuthenticationUserToken",value:function(u){u&&(Object.keys(u).includes(s.default.authenticatedUserToken)&&(u[s.default.authenticatedUserToken]=o.default.hiddenContentPlaceholder),Object.keys(u).includes(s.default.authCodeNonce)&&(u[s.default.authCodeNonce]=o.default.hiddenContentPlaceholder),Object.keys(u).includes(s.default.authorization)&&(u[s.default.authorization]=o.default.hiddenContentPlaceholder))}},{key:"stripRequestHeadersSensitiveProperties",value:function(u){c.stripAuthenticationUserToken(u),Object.keys(u).includes(s.default.authorization)&&(u[s.default.authorization]=o.default.hiddenContentPlaceholder)}},{key:"stripRequestPayloadData",value:function(u){if(u!=null&&u.data){var d;if(typeof u.data=="string")try{d=JSON.parse(u.data)}catch{d=void 0}d&&(Object.keys(d).includes("preChatResponse")&&c.stripPreChatResponse(d.preChatResponse),Object.keys(d).includes("customContextData")&&c.stripCustomContextDataValues(d.customContextData),c.stripGeolocation(d),u.data=JSON.stringify(d),u.data=c.stripEmailDataFromError(u.data))}}},{key:"stripEmailDataFromError",value:function(u){return u=u.replace(this.emailRegex,o.default.hiddenContentPlaceholder),u}},{key:"stripAxiosErrorSensitiveProperties",value:function(u){if(u.isAxiosError){var d,f,h,g,E,D;if(u!=null&&(d=u.config)!==null&&d!==void 0&&d.headers){var w;c.stripAuthenticationUserToken(u==null||(w=u.config)===null||w===void 0?void 0:w.headers)}if(u!=null&&(f=u.config)!==null&&f!==void 0&&f.data&&this.stripRequestPayloadData(u==null?void 0:u.config),u!=null&&(h=u.response)!==null&&h!==void 0&&(g=h.config)!==null&&g!==void 0&&g.data){var p;this.stripRequestPayloadData(u==null||(p=u.response)===null||p===void 0?void 0:p.config)}if(u!=null&&(E=u.response)!==null&&E!==void 0&&(D=E.config)!==null&&D!==void 0&&D.headers){var b,j;c.stripAuthenticationUserToken(u==null||(b=u.response)===null||b===void 0||(j=b.config)===null||j===void 0?void 0:j.headers)}}}},{key:"stripErrorSensitiveProperties",value:function(u){var d;u&&(0,e.default)(u)==="object"&&((d=Object.keys(u))===null||d===void 0?void 0:d.length)>0&&this.stripAxiosErrorSensitiveProperties(u)}}]),c}();return Md.LoggingSanitizer=l,(0,i.default)(l,"emailRegex",/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g),Md}var Dd={},wP;function cz(){if(wP)return Dd;wP=1;var t=yn;Object.defineProperty(Dd,"__esModule",{value:!0}),Dd.OSInfo=void 0;var e=t(Yr()),n=t(po()),r=zu(),i=function(){function o(){(0,e.default)(this,o)}return(0,n.default)(o,null,[{key:"getOsType",value:function(){var l=/(windows|win32)/i,c=/ arm;/i,a=/windows\sphone\s\d+\.\d+/i,u=/(macintosh|mac os x)/i,d=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,f=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i,h=/android/i,g=function(){return window.navigator.userAgent};return g().match(a)?r.OperatingSystem.WINDOWS_PHONE:g().match(c)?r.OperatingSystem.WINDOWS_RT:g().match(d)?r.OperatingSystem.IOS:g().match(h)?r.OperatingSystem.ANDROID:g().match(f)?r.OperatingSystem.LINUX:g().match(u)?r.OperatingSystem.MACOSX:g().match(l)?r.OperatingSystem.WINDOWS:r.OperatingSystem.UNKNOWN}}]),o}();return Dd.OSInfo=i,Dd}var v0={},IP;function UU(){return IP||(IP=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(us()),i=function o(){(0,n.default)(this,o)};t.default=i,(0,r.default)(i,"LiveChatConnectorPath","livechatconnector/organization"),(0,r.default)(i,"LiveChatConnectorAuthPath","livechatconnector/auth/organization"),(0,r.default)(i,"LcwFcsDetailsPath","livechatconnector/v2/lcwfcsdetails"),(0,r.default)(i,"LiveChatConfigPath","livechatconnector/config"),(0,r.default)(i,"LiveChatSessionInitPath","livechatconnector/sessioninit"),(0,r.default)(i,"LiveChatAuthSessionInitPath","livechatconnector/auth/sessioninit"),(0,r.default)(i,"LiveChatGetChatTokenPath","livechatconnector/getchattoken"),(0,r.default)(i,"LiveChatv2GetChatTokenPath","livechatconnector/v2/getchattoken"),(0,r.default)(i,"LiveChatv3GetChatTokenPath","livechatconnector/v3/getchattoken"),(0,r.default)(i,"LiveChatv4GetChatTokenPath","livechatconnector/v4/getchattoken"),(0,r.default)(i,"LiveChatv4AuthGetChatTokenPath","livechatconnector/v4/auth/getchattoken"),(0,r.default)(i,"LiveChatAuthGetChatTokenPath","livechatconnector/auth/getchattoken"),(0,r.default)(i,"LiveChatv2AuthGetChatTokenPath","livechatconnector/v2/auth/getchattoken"),(0,r.default)(i,"LiveChatv3AuthGetChatTokenPath","livechatconnector/v3/auth/getchattoken"),(0,r.default)(i,"LiveChatSessionClosePath","livechatconnector/sessionclose"),(0,r.default)(i,"LiveChatAuthSessionClosePath","livechatconnector/auth/sessionclose"),(0,r.default)(i,"LiveChatSubmitPostChatPath","survey/submitpostchat"),(0,r.default)(i,"LiveChatAuthSubmitPostChatPath","survey/auth/submitpostchat"),(0,r.default)(i,"LiveChatGetSurveyInviteLinkPath","livechatconnector/getsurveyinvite"),(0,r.default)(i,"LiveChatAuthGetSurveyInviteLinkPath","livechatconnector/auth/getsurveyinvite"),(0,r.default)(i,"LiveChatGetChatTranscriptPath","livechatconnector/getchattranscripts"),(0,r.default)(i,"LiveChatv2GetChatTranscriptPath","livechatconnector/v2/getchattranscripts"),(0,r.default)(i,"LiveChatAuthGetChatTranscriptPath","livechatconnector/auth/getchattranscripts"),(0,r.default)(i,"LiveChatv2AuthGetChatTranscriptPath","livechatconnector/v2/auth/getchattranscripts"),(0,r.default)(i,"LiveChatTranscriptEmailRequestPath","livechatconnector/createemailrequest"),(0,r.default)(i,"LiveChatAuthTranscriptEmailRequestPath","livechatconnector/auth/createemailrequest"),(0,r.default)(i,"LiveChatFetchDataMaskingInfoPath","livechatconnector/fetchdatamaskinginfo"),(0,r.default)(i,"LiveChatSecondaryChannelEventPath","livechatconnector/secondarychannelevent"),(0,r.default)(i,"LiveChatAuthSecondaryChannelEventPath","livechatconnector/auth/secondarychannelevent"),(0,r.default)(i,"LiveChatLiveWorkItemDetailsPath","livechatconnector/getliveworkitemdetails"),(0,r.default)(i,"LiveChatAuthLiveWorkItemDetailsPath","livechatconnector/auth/getliveworkitemdetails"),(0,r.default)(i,"LiveChatGetReconnectableChatsPath","livechatconnector/auth/reconnectablechats"),(0,r.default)(i,"LiveChatReconnectAvailabilityPath","livechatconnector/reconnect"),(0,r.default)(i,"LiveChatValidateAuthChatMapRecordPath","livechatconnector/auth/validateauthchatmaprecord"),(0,r.default)(i,"GetAgentAvailabilityPath","livechatconnector/auth/getagentavailability"),(0,r.default)(i,"SendTypingIndicatorPath","inbound/typingindicator/livechat/sendtypingindicator"),(0,r.default)(i,"LiveChatAuthGetPersistentChatHistoryPath","livechatconnector/auth/organization")}(v0)),v0}var y0={exports:{}},bP;function uz(){return bP||(bP=1,function(t,e){(function(n,r){t.exports=r(LU())})(_e,function(n){return function(r){var i=n,o=i.lib,s=o.WordArray,l=o.Hasher,c=i.algo,a=[],u=[];(function(){function h(w){for(var p=r.sqrt(w),b=2;b<=p;b++)if(!(w%b))return!1;return!0}function g(w){return(w-(w|0))*4294967296|0}for(var E=2,D=0;D<64;)h(E)&&(D<8&&(a[D]=g(r.pow(E,1/2))),u[D]=g(r.pow(E,1/3)),D++),E++})();var d=[],f=c.SHA256=l.extend({_doReset:function(){this._hash=new s.init(a.slice(0))},_doProcessBlock:function(h,g){for(var E=this._hash.words,D=E[0],w=E[1],p=E[2],b=E[3],j=E[4],K=E[5],M=E[6],ne=E[7],G=0;G<64;G++){if(G<16)d[G]=h[g+G]|0;else{var oe=d[G-15],J=(oe<<25|oe>>>7)^(oe<<14|oe>>>18)^oe>>>3,X=d[G-2],B=(X<<15|X>>>17)^(X<<13|X>>>19)^X>>>10;d[G]=J+d[G-7]+B+d[G-16]}var q=j&K^~j&M,F=D&w^D&p^w&p,x=(D<<30|D>>>2)^(D<<19|D>>>13)^(D<<10|D>>>22),P=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),v=ne+P+q+u[G]+d[G],T=x+F;ne=M,M=K,K=j,j=b+v|0,b=p,p=w,w=D,D=v+T|0}E[0]=E[0]+D|0,E[1]=E[1]+w|0,E[2]=E[2]+p|0,E[3]=E[3]+b|0,E[4]=E[4]+j|0,E[5]=E[5]+K|0,E[6]=E[6]+M|0,E[7]=E[7]+ne|0},_doFinalize:function(){var h=this._data,g=h.words,E=this._nDataBytes*8,D=h.sigBytes*8;return g[D>>>5]|=128<<24-D%32,g[(D+64>>>9<<4)+14]=r.floor(E/4294967296),g[(D+64>>>9<<4)+15]=E,h.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var h=l.clone.call(this);return h._hash=this._hash.clone(),h}});i.SHA256=l._createHelper(f),i.HmacSHA256=l._createHmacHelper(f)}(Math),n.SHA256})}(y0)),y0.exports}var Nd={},_P;function dz(){if(_P)return Nd;_P=1;var t=yn;Object.defineProperty(Nd,"__esModule",{value:!0}),Nd.Timer=void 0;var e=t(Yr()),n=t(po()),r=function(){function i(){(0,e.default)(this,i)}return(0,n.default)(i,null,[{key:"TIMER",value:function(){var s=new Date().getTime();return{get milliSecondsElapsed(){return new Date().getTime()-s}}}}]),i}();return Nd.Timer=r,Nd}var xd={},C0={exports:{}},S0={exports:{}},T0={exports:{}},AP;function FU(){return AP||(AP=1,function(t){function e(n,r){(r==null||r>n.length)&&(r=n.length);for(var i=0,o=Array(r);i<r;i++)o[i]=n[i];return o}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(T0)),T0.exports}var RP;function hz(){return RP||(RP=1,function(t){var e=FU();function n(r){if(Array.isArray(r))return e(r)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(S0)),S0.exports}var E0={exports:{}},kP;function fz(){return kP||(kP=1,function(t){function e(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(E0)),E0.exports}var w0={exports:{}},PP;function pz(){return PP||(PP=1,function(t){var e=FU();function n(r,i){if(r){if(typeof r=="string")return e(r,i);var o={}.toString.call(r).slice(8,-1);return o==="Object"&&r.constructor&&(o=r.constructor.name),o==="Map"||o==="Set"?Array.from(r):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(r,i):void 0}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(w0)),w0.exports}var I0={exports:{}},OP;function gz(){return OP||(OP=1,function(t){function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(I0)),I0.exports}var MP;function mz(){return MP||(MP=1,function(t){var e=hz(),n=fz(),r=pz(),i=gz();function o(s){return e(s)||n(s)||r(s)||i()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}(C0)),C0.exports}const vz="0.5.19",_E={version:vz};var DP;function yz(){if(DP)return xd;DP=1;var t=yn;Object.defineProperty(xd,"__esModule",{value:!0}),xd.addOcUserAgentHeader=void 0;var e=t(mz()),n=t(sb()),r=function(o,s){var l=_E.version,c="ocsdk/".concat(l);s["".concat(n.default.ocUserAgent)]=[].concat((0,e.default)(o),[c]).join(" ")};return xd.addOcUserAgentHeader=r,xd}var Ld={},NP;function Cz(){if(NP)return Ld;NP=1;var t=yn;Object.defineProperty(Ld,"__esModule",{value:!0}),Ld.createGetChatTokenEndpoint=void 0;var e=t(us()),n=zu(),r=t(UU()),i=function(s,l,c){var a,u,d=(a={},(0,e.default)(a,n.LiveChatVersion.V1,r.default.LiveChatGetChatTokenPath),(0,e.default)(a,n.LiveChatVersion.V2,r.default.LiveChatv2GetChatTokenPath),(0,e.default)(a,n.LiveChatVersion.V3,r.default.LiveChatv3GetChatTokenPath),a),f=(u={},(0,e.default)(u,n.LiveChatVersion.V1,r.default.LiveChatAuthGetChatTokenPath),(0,e.default)(u,n.LiveChatVersion.V2,r.default.LiveChatv2AuthGetChatTokenPath),(0,e.default)(u,n.LiveChatVersion.V3,r.default.LiveChatv3AuthGetChatTokenPath),u);return c?l?r.default.LiveChatv4AuthGetChatTokenPath:r.default.LiveChatv4GetChatTokenPath:Object.values(n.LiveChatVersion).includes(s)?l?f[s]:d[s]:l?f[n.LiveChatVersion.V2]:d[n.LiveChatVersion.V2]};return Ld.createGetChatTokenEndpoint=i,Ld}var b0={},xP;function Sz(){return xP||(xP=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(ob()),r=function(s,l){try{if(n.default.isAxiosError(s)&&s.code==l)return!0}catch{return!1}return!1},i=r;t.default=i}(b0)),b0}var _0={},LP;function Tz(){return LP||(LP=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Sf()),r=NU(),i=xU(),o=function(c,a){var u,d,f,h,g,E,D;if(c!=null&&(u=c.response)!==null&&u!==void 0&&u.status)switch(c.response.status){case n.default.tooManyRequestsStatusCode:if(a===!1)return!1;break;case n.default.badRequestStatusCode:if((d=c.response)!==null&&d!==void 0&&(f=d.headers)!==null&&f!==void 0&&f.errorcode&&parseInt(c.response.headers.errorcode)===n.default.outOfOfficeErrorCode)return!1;break;default:return(0,i.isRetryableError)(c)||(0,r.isNetworkError)(c)||((h=c.response)===null||h===void 0?void 0:h.status)==0||!((g=c.response)!==null&&g!==void 0&&g.status)}return(0,i.isRetryableError)(c)||(0,r.isNetworkError)(c)||((E=c.response)===null||E===void 0?void 0:E.status)==0||!((D=c.response)!==null&&D!==void 0&&D.status)},s=o;t.default=s}(_0)),_0}var Ud={},UP;function BU(){if(UP)return Ud;UP=1,Object.defineProperty(Ud,"__esModule",{value:!0}),Ud.uuidv4=void 0;var t=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=Math.random()*16|0,i=n==="x"?r:r&3|8;return i.toString(16)})};return Ud.uuidv4=t,Ud}var Fd={},FP;function Ez(){if(FP)return Fd;FP=1,Object.defineProperty(Fd,"__esModule",{value:!0}),Fd.waitTimeBetweenRetriesConfigs=void 0;var t={getChatConfig:1e3,getLWIDetails:3e3,getChatToken:1e3,sessionInit:1e3,sessionClose:1e3,getReconnectableChats:1e3,getReconnectAvailability:1e3,submitPostChatResponse:1e3,getSurveyInviteLink:1e3,getChatTranscripts:1e3,emailTranscript:1e3,fetchDataMaskingInfo:1e3,makeSecondaryChannelEventRequest:1e3,getAgentAvailability:1e3,sendTypingIndicator:1e3,validateAuthChatRecordTimeout:1e3,getPersistentChatHistory:1e3};return Fd.waitTimeBetweenRetriesConfigs=t,Fd}var BP;function wz(){return BP||(BP=1,function(t){var e=yn,n=Ha();Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=e(MU()),i=e(DU()),o=e(Ha()),s=e(Yr()),l=e(po()),c=e(us()),a=zu(),u=e(ob()),d=P(xU()),f=YV(),h=e(Sf()),g=ZV(),E=ez(),D=e(oz()),w=e(sz()),p=az(),b=lz(),j=cz(),K=e(UU()),M=e(sb()),ne=e(uz()),G=dz(),oe=yz(),J=Cz(),X=e(Sz()),B=e(Tz()),q=BU(),F=Ez();function x(S){if(typeof WeakMap!="function")return null;var H=new WeakMap,L=new WeakMap;return(x=function(y){return y?L:H})(S)}function P(S,H){if(S&&S.__esModule)return S;if(S===null||n(S)!=="object"&&typeof S!="function")return{default:S};var L=x(H);if(L&&L.has(S))return L.get(S);var C={},y=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in S)if(k!=="default"&&Object.prototype.hasOwnProperty.call(S,k)){var Y=y?Object.getOwnPropertyDescriptor(S,k):null;Y&&(Y.get||Y.set)?Object.defineProperty(C,k,Y):C[k]=S[k]}return C.default=S,L&&L.set(S,C),C}function v(S,H){var L=Object.keys(S);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(S);H&&(C=C.filter(function(y){return Object.getOwnPropertyDescriptor(S,y).enumerable})),L.push.apply(L,C)}return L}function T(S){for(var H=1;H<arguments.length;H++){var L=arguments[H]!=null?arguments[H]:{};H%2?v(Object(L),!0).forEach(function(C){(0,c.default)(S,C,L[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(L)):v(Object(L)).forEach(function(C){Object.defineProperty(S,C,Object.getOwnPropertyDescriptor(L,C))})}return S}function _(S,H){var L=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!L){if(Array.isArray(S)||(L=N(S))||H){L&&(S=L);var C=0,y=function(){};return{s:y,n:function(){return C>=S.length?{done:!0}:{done:!1,value:S[C++]}},e:function(W){throw W},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k=!0,Y=!1,V;return{s:function(){L=L.call(S)},n:function(){var W=L.next();return k=W.done,W},e:function(W){Y=!0,V=W},f:function(){try{!k&&L.return!=null&&L.return()}finally{if(Y)throw V}}}}function N(S,H){if(S){if(typeof S=="string")return I(S,H);var L=Object.prototype.toString.call(S).slice(8,-1);if(L==="Object"&&S.constructor&&(L=S.constructor.name),L==="Map"||L==="Set")return Array.from(S);if(L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L))return I(S,H)}}function I(S,H){(H==null||H>S.length)&&(H=S.length);for(var L=0,C=new Array(H);L<H;L++)C[L]=S[L];return C}var A=function(){function S(H){var L=this,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:S.defaultConfiguration,y=arguments.length>2?arguments[2]:void 0;(0,s.default)(this,S),this.omnichannelConfiguration=H,this.configuration=C,this.logger=y,(0,c.default)(this,"liveChatVersion",void 0),(0,c.default)(this,"sessionId",void 0),(0,c.default)(this,"ocUserAgent",void 0),(0,c.default)(this,"HTTPTimeOutErrorMessage","".concat(a.SDKError.ClientHTTPTimeoutErrorName,": ").concat(a.SDKError.ClientHTTPTimeoutErrorMessage)),(0,c.default)(this,"setAuthCodeNonce",function(ie){ie!=null&&ie.authcodenonce&&(L.configuration.authCodeNonce=ie==null?void 0:ie.authcodenonce)}),(0,c.default)(this,"setSessionIdHeader",function(ie,se){ie&&(se[M.default.ocSessionId]=ie)}),(0,c.default)(this,"setRequestIdHeader",function(ie,se){ie&&(se[M.default.requestId]=ie)}),(0,c.default)(this,"setCorrelationIdInHeader",function(ie,se){ie&&(se[M.default.correlationId]=ie)}),(!Object.keys(this.configuration).length||(0,o.default)(C)!=="object")&&(this.configuration=S.defaultConfiguration);for(var k=0,Y=Object.keys(S.defaultConfiguration);k<Y.length;k++){var V=Y[k];this.configuration.hasOwnProperty(V)||(this.configuration["".concat(V)]=S.defaultConfiguration["".concat(V)])}for(var z=0,W=Object.keys(S.defaultConfiguration.requestTimeoutConfig);z<W.length;z++){var le=W[z];this.configuration.requestTimeoutConfig.hasOwnProperty(le)||(this.configuration.requestTimeoutConfig["".concat(le)]=S.defaultConfiguration.requestTimeoutConfig["".concat(le)])}var re=H.channelId;if(!Object.values(a.ChannelId).includes(re))throw new Error("Invalid channelId");var $=Object.keys(H),m=_(h.default.requiredOmnichannelConfigurationParameters),R;try{for(m.s();!(R=m.n()).done;){var Z=R.value;if(!$.includes(Z))throw new Error("Missing '".concat(Z,"' in OmnichannelConfiguration"))}}catch(ie){m.e(ie)}finally{m.f()}this.ocUserAgent=this.configuration.ocUserAgent,this.liveChatVersion=a.LiveChatVersion.V2}return(0,l.default)(S,[{key:"getLcwFcsDetails",value:function(){var H=(0,i.default)(r.default.mark(function C(){var y,k,Y,V,z,W,le,re,$,m,R,Z,ie,se;return r.default.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return y=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETLCWFCSDETAILSSTARTED,"Get LCW FCS details started",""),k="/".concat(K.default.LcwFcsDetailsPath,"/").concat(this.omnichannelConfiguration.orgId),Y="GET",V="".concat(this.omnichannelConfiguration.orgUrl).concat(k),z=u.default.create(),(0,d.default)(z,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatConfig}),W={},(0,oe.addOcUserAgentHeader)(this.ocUserAgent,W),le=G.Timer.TIMER(),Te.prev=10,Te.next=13,z.get(V,{headers:W,timeout:(re=this.configuration.defaultRequestTimeout)!==null&&re!==void 0?re:this.configuration.requestTimeoutConfig.getChatConfig});case 13:return $=Te.sent,m=le.milliSecondsElapsed,R=y.milliSecondsElapsed,Z=$.data,this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETLCWFCSDETAILSSUCCEEDED,"Get LCW FCS details succeeded","",$,R,k,Y,void 0,void 0,W,m),Te.abrupt("return",Z);case 21:throw Te.prev=21,Te.t0=Te.catch(10),ie=le.milliSecondsElapsed,se=y.milliSecondsElapsed,this.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETLCWFCSDETAILSFAILED,"Get LCW FCS details failed","",void 0,se,k,Y,Te.t0,void 0,W,ie),Te.t0;case 27:case"end":return Te.stop()}},C,this,[[10,21]])}));function L(){return H.apply(this,arguments)}return L}()},{key:"getChatConfig",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se=arguments;return r.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return k=Se.length>1&&Se[1]!==void 0?Se[1]:!1,Y=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATCONFIGFSTARTED,"Get Chat config started",y),y||(y=(0,q.uuidv4)()),V="/".concat(K.default.LiveChatConfigPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"?requestId=").concat(y,"&channelId=").concat(this.omnichannelConfiguration.channelId),z="GET",W="".concat(this.omnichannelConfiguration.orgUrl).concat(V),le=u.default.create(),(0,d.default)(le,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatConfig}),re={},this.addDefaultHeaders(y,re),k&&(re=T(T({},h.default.bypassCacheHeaders),re)),$=G.Timer.TIMER(),O.prev=13,O.next=16,le.get(W,{headers:re,timeout:(m=this.configuration.defaultRequestTimeout)!==null&&m!==void 0?m:this.configuration.requestTimeoutConfig.getChatConfig});case 16:return R=O.sent,Z=$.milliSecondsElapsed,ie=Y.milliSecondsElapsed,se=R.data,se.LiveChatVersion&&(this.liveChatVersion=se.LiveChatVersion),se.headers={},R.headers&&R.headers.date&&(se.headers.date=R.headers.date),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATCONFIGSUCCEEDED,"Get Chat config succeeded",y,R,ie,V,z,void 0,void 0,re,Z),O.abrupt("return",se);case 27:return O.prev=27,O.t0=O.catch(13),ue=$.milliSecondsElapsed,Te=Y.milliSecondsElapsed,this.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETCHATCONFIGFAILED,"Get Chat config failed",y,void 0,Te,V,z,O.t0,void 0,re,ue),O.abrupt("return",Promise.reject(O.t0));case 33:case"end":return O.stop()}},C,this,[[13,27]])}));function L(C){return H.apply(this,arguments)}return L}()},{key:"getLWIDetails",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te=arguments;return r.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return V=Te.length>1&&Te[1]!==void 0?Te[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETLWISTATUSSTARTED,"Get LWI Details Started",y),y||(y=(0,q.uuidv4)()),W="/".concat(K.default.LiveChatLiveWorkItemDetailsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),le=u.default.create(),(0,d.axiosRetryHandlerWithNotFound)(le,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getLWIDetails}),re=V.authenticatedUserToken,$=V.reconnectId,m=h.default.defaultHeaders,re&&(W="/".concat(K.default.LiveChatAuthLiveWorkItemDetailsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),m[M.default.authenticatedUserToken]=re,m[M.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(y,m),R=!re&&this.configuration.useUnauthReconnectIdSigQueryParam===!0,$&&(R||(W+="/".concat($))),Z={channelId:this.omnichannelConfiguration.channelId},$&&R&&(Z.sig=$),ie="".concat(this.omnichannelConfiguration.orgUrl).concat(W),se="GET",ue={headers:m,method:se,url:ie,params:Z,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getLWIDetails},Q.abrupt("return",new Promise(function(){var O=(0,i.default)(r.default.mark(function U(ae,ce){var fe,ve,Pe,Me,ke,Ne,Oe,Qe;return r.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return fe=G.Timer.TIMER(),Xe.prev=1,Xe.next=4,le(ue);case 4:ve=Xe.sent,Pe=fe.milliSecondsElapsed,Me=z.milliSecondsElapsed,ke=ve.data,Ne=ve.headers,Y.setAuthCodeNonce(Ne),Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETLWISTATUSSUCCEEDED,"Get LWI Details succeeded",y,ve,Me,W,se,void 0,void 0,m,Pe),ae(ke),Xe.next=20;break;case 13:Xe.prev=13,Xe.t0=Xe.catch(1),Oe=fe.milliSecondsElapsed,Qe=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETLWISTATUSFAILED,"Get LWI Details failed",y,void 0,Qe,W,se,Xe.t0,void 0,m,Oe),(0,X.default)(Xe.t0,h.default.axiosTimeoutErrorCode)&&ce(new Error(Y.HTTPTimeOutErrorMessage)),ce(Xe.t0);case 20:case"end":return Xe.stop()}},U,null,[[1,13]])}));return function(U,ae){return O.apply(this,arguments)}}()));case 19:case"end":return Q.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"getChatToken",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se,Q,O,U,ae,ce=arguments;return r.default.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(V=ce.length>1&&ce[1]!==void 0?ce[1]:{},z=ce.length>2&&ce[2]!==void 0?ce[2]:0,W=G.Timer.TIMER(),le=V.reconnectId,re=V.authenticatedUserToken,$=V.currentLiveChatVersion,m=V.refreshToken,R=V.MsOcBotApplicationId,Z=!!(R&&R.length>0),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATTOKENSTARTED,"Get Chat Token Started",y),!(z<0)){ve.next=8;break}throw new Error("Invalid currentRetryCount");case 8:return y||(y=(0,q.uuidv4)()),ie=h.default.defaultHeaders,this.addDefaultHeaders(y,ie),se=(0,J.createGetChatTokenEndpoint)($||this.liveChatVersion,!!re,Z),re&&(ie[M.default.authenticatedUserToken]=re,ie[M.default.authCodeNonce]=this.configuration.authCodeNonce),ue="/".concat(se,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),Te=!re&&this.configuration.useUnauthReconnectIdSigQueryParam===!0,le&&(Te||(ue+="/".concat(le))),Se={channelId:this.omnichannelConfiguration.channelId},R&&R.length>0&&(Se["Ms-Oc-Bot-Application-Id"]=R),m&&(Se.refreshToken="true"),le&&Te&&(Se.sig=le),Q="".concat(this.omnichannelConfiguration.orgUrl).concat(ue),O="GET",U={headers:ie,method:O,url:Q,params:Se,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getChatToken},ae=u.default.create(),(0,d.default)(ae,{headerOverwrites:[M.default.authCodeNonce],retries:z>this.configuration.maxRequestRetriesOnFailure?z:this.configuration.maxRequestRetriesOnFailure,retryOn429:this.configuration.getChatTokenRetryOn429,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatToken}),ve.abrupt("return",new Promise(function(){var Pe=(0,i.default)(r.default.mark(function Me(ke,Ne){var Oe,Qe,et,Xe,Nt,kt,Fr,ps;return r.default.wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return Oe=G.Timer.TIMER(),Yt.prev=1,Yt.next=4,ae(U);case 4:if(Qe=Yt.sent,et=Oe.milliSecondsElapsed,Xe=W.milliSecondsElapsed,Nt=Qe.data,kt=Qe.headers,Y.setAuthCodeNonce(kt),kt&&kt[M.default.ocSessionId.toLowerCase()]&&(Y.sessionId=kt[M.default.ocSessionId.toLowerCase()]),!Nt){Yt.next=18;break}if(Object.keys(Nt).length!==0){Yt.next=14;break}return Ne(new Error("Empty data received from getChatToken")),Yt.abrupt("return");case 14:return Nt.requestId=y,Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATTOKENSUCCEEDED,"Get Chat Token succeeded",y,Qe,Xe,ue,O,void 0,void 0,ie,et),ke(Nt),Yt.abrupt("return");case 18:if(!(le&&Qe.status===h.default.noContentStatusCode)){Yt.next=21;break}return Ne(Qe),Yt.abrupt("return");case 21:Yt.next=30;break;case 23:Yt.prev=23,Yt.t0=Yt.catch(1),Fr=Oe.milliSecondsElapsed,ps=W.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETCHATTOKENFAILED,"Get Chat Token failed",y,void 0,ps,ue,O,Yt.t0,void 0,ie,Fr),(0,X.default)(Yt.t0,h.default.axiosTimeoutErrorCode)&&Ne(new Error(Y.HTTPTimeOutErrorMessage)),Ne(Yt.t0);case 30:case"end":return Yt.stop()}},Me,null,[[1,23]])}));return function(Me,ke){return Pe.apply(this,arguments)}}()));case 26:case"end":return ve.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"getReconnectableChats",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z;return r.default.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return V=G.Timer.TIMER(),z=y.authenticatedUserToken,this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETRECONNECTABLECHATSSTARTED,"Get Reconnectable chat Started"),W=y==null?void 0:y.requestId,le="/".concat(K.default.LiveChatGetReconnectableChatsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(W,"?channelId=").concat(this.omnichannelConfiguration.channelId),re=h.default.defaultHeaders,re[M.default.authenticatedUserToken]=z,re[M.default.authCodeNonce]=this.configuration.authCodeNonce,this.addDefaultHeaders(W,re),$="".concat(this.omnichannelConfiguration.orgUrl).concat(le),m="GET",R={headers:re,method:m,url:$,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getReconnectableChats},Z=u.default.create(),se.abrupt("return",new Promise(function(){var ue=(0,i.default)(r.default.mark(function Te(Se,Q){var O,U,ae,ce,fe,ve,Pe,Me;return r.default.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return O=G.Timer.TIMER(),Ne.prev=1,Ne.next=4,Z(R);case 4:if(U=Ne.sent,ae=O.milliSecondsElapsed,ce=V.milliSecondsElapsed,fe=U.data,ve=U.headers,Y.setAuthCodeNonce(ve),!fe){Ne.next=13;break}return Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETRECONNECTABLECHATSSUCCEEDED,"Get Reconnectable Chats Succeeded and old session returned",W,U,ce,le,m,void 0,void 0,re,ae),Se(fe),Ne.abrupt("return");case 13:return Se(),Ne.abrupt("return");case 17:return Ne.prev=17,Ne.t0=Ne.catch(1),Pe=O.milliSecondsElapsed,Me=V.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETRECONNECTABLECHATSFAILED,"Get Reconnectable Chats failed",W,void 0,Me,le,m,Ne.t0,void 0,re,Pe),(0,X.default)(Ne.t0,h.default.axiosTimeoutErrorCode)&&Q(new Error(Y.HTTPTimeOutErrorMessage)),Q(Ne.t0),Ne.abrupt("return");case 25:case"end":return Ne.stop()}},Te,null,[[1,17]])}));return function(Te,Se){return ue.apply(this,arguments)}}()));case 14:case"end":return se.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"getReconnectAvailability",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z=arguments;return r.default.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return V=Z.length>1&&Z[1]!==void 0?Z[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSTARTED,"Get Reconnectable availability Started"),W="/".concat(K.default.LiveChatReconnectAvailabilityPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),le=h.default.defaultHeaders,this.addDefaultHeaders(V==null?void 0:V.requestId,le),re="".concat(this.omnichannelConfiguration.orgUrl).concat(W),$="GET",m={headers:le,method:$,url:re,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getReconnectAvailability},R=u.default.create(),se.abrupt("return",new Promise(function(){var ue=(0,i.default)(r.default.mark(function Te(Se,Q){var O,U,ae,ce,fe,ve,Pe;return r.default.wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return O=G.Timer.TIMER(),ke.prev=1,ke.next=4,R(m);case 4:if(U=ke.sent,ae=O.milliSecondsElapsed,ce=z.milliSecondsElapsed,fe=U.data,!fe){ke.next=12;break}return Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSUCCEEDED,"Get Reconnect availability succeeded",V==null?void 0:V.requestId,U,ce,W,$,void 0,void 0,le,ae),Se(fe),ke.abrupt("return");case 12:return Y.logWithLogger(p.LogLevel.WARN,a.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSUCCEEDED,"Get Reconnect availability didn't send any valid data",V==null?void 0:V.requestId,U,ce,W,$,void 0,void 0,le,ae),Se(),ke.abrupt("return");case 17:return ke.prev=17,ke.t0=ke.catch(1),ve=O.milliSecondsElapsed,Pe=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYFAILED,"Get Reconnect Availability failed",V==null?void 0:V.requestId,void 0,Pe,W,$,ke.t0,void 0,le,ve),(0,X.default)(ke.t0,h.default.axiosTimeoutErrorCode)&&Q(new Error(Y.HTTPTimeOutErrorMessage)),Q(ke.t0),ke.abrupt("return");case 25:case"end":return ke.stop()}},Te,null,[[1,17]])}));return function(Te,Se){return ue.apply(this,arguments)}}()));case 11:case"end":return se.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"getAgentAvailability",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se,Q=arguments;return r.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(V=Q.length>1&&Q[1]!==void 0?Q[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETAGENTAVAILABILITYSTARTED,"Get agent availability Started",y),W="/".concat(K.default.GetAgentAvailabilityPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y,"?channelId=lcw"),le=u.default.create(),(0,d.default)(le,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getAgentAvailability}),re=V.authenticatedUserToken,$=V.initContext,m=V.getContext,R=h.default.defaultHeaders,re&&(R[M.default.authenticatedUserToken]=re,R[M.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(y,R),Z=$||{},ie={orgId:this.omnichannelConfiguration.orgId,widgetId:this.omnichannelConfiguration.widgetId},Z&&Z.customContextData&&(se=g.CustomContextData.sort(Z.customContextData),Object.assign(ie,{customContext:se})),Z.portalcontactid&&Object.assign(ie,{portalcontactid:Z.portalcontactid}),Z.cacheKey=(0,ne.default)(JSON.stringify(ie)).toString(D.default),!(m&&!window.document)){U.next=17;break}return U.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 17:if(m&&(Z.browser=f.BrowserInfo.getBrowserName(),Z.device=E.DeviceInfo.getDeviceType(),Z.originurl=window.location.href,Z.os=j.OSInfo.getOsType()),Z.locale||(Z.locale=h.default.defaultLocale),!(Z.locale&&!w.default.supportedLocales.includes(Z.locale))){U.next=21;break}return U.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(Z.locale,"'"))));case 21:return ue="".concat(this.omnichannelConfiguration.orgUrl).concat(W),Te="POST",Se={data:Z,headers:R,method:Te,url:ue,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getAgentAvailability},U.abrupt("return",new Promise(function(){var ae=(0,i.default)(r.default.mark(function ce(fe,ve){var Pe,Me,ke,Ne,Oe,Qe,et,Xe;return r.default.wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return Pe=G.Timer.TIMER(),kt.prev=1,kt.next=4,le(Se);case 4:Me=kt.sent,ke=Pe.milliSecondsElapsed,Ne=z.milliSecondsElapsed,Oe=Me.data,Qe=Me.headers,Y.setAuthCodeNonce(Qe),Oe&&(Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETAGENTAVAILABILITYSUCCEEDED,"Get agent availability succeeded",y,Me,Ne,W,Te,void 0,void 0,R,ke),fe(Oe)),kt.next=21;break;case 12:if(kt.prev=12,kt.t0=kt.catch(1),et=Pe.milliSecondsElapsed,Xe=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETAGENTAVAILABILITYFAILED,"Get agent availability failed",y,void 0,Xe,W,Te,kt.t0,void 0,R,et),!(0,X.default)(kt.t0,h.default.axiosTimeoutErrorCode)){kt.next=20;break}return ve(new Error(Y.HTTPTimeOutErrorMessage)),kt.abrupt("return");case 20:ve(kt.t0);case 21:case"end":return kt.stop()}},ce,null,[[1,12]])}));return function(ce,fe){return ae.apply(this,arguments)}}()));case 25:case"end":return U.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"sessionInit",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se,Q,O,U,ae,ce=arguments;return r.default.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(V=ce.length>1&&ce[1]!==void 0?ce[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SESSIONINITSTARTED,"Session Init Started",y),W=u.default.create(),le=!0,(0,d.default)(W,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionInit,shouldRetry:function(Me){return(0,B.default)(Me,le)},headerOverwrites:[M.default.authCodeNonce]}),re=V.reconnectId,$=V.authenticatedUserToken,m=V.initContext,R=V.getContext,Z=m||{},ie=T({},h.default.defaultHeaders),se=$?K.default.LiveChatAuthSessionInitPath:K.default.LiveChatSessionInitPath,ue="/".concat(se,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),$&&Object.assign(ie,(Te={},(0,c.default)(Te,M.default.authenticatedUserToken,$),(0,c.default)(Te,M.default.authCodeNonce,this.configuration.authCodeNonce),Te)),this.addDefaultHeaders(y,ie),this.setRequestIdHeader(y,ie),Se=!$&&this.configuration.useUnauthReconnectIdSigQueryParam===!0,re&&(Se||(ue+="/".concat(re))),Q={channelId:this.omnichannelConfiguration.channelId},re&&Se&&(Q.sig=re),!(R&&!window.document)){ve.next=20;break}return ve.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 20:if(R&&(Z.browser=f.BrowserInfo.getBrowserName(),Z.device=E.DeviceInfo.getDeviceType(),Z.originurl=window.location.href,Z.os=j.OSInfo.getOsType()),Z.locale||(Z.locale=h.default.defaultLocale),!(Z.locale&&!w.default.supportedLocales.includes(Z.locale))){ve.next=24;break}return ve.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(Z.locale,"'"))));case 24:return O="".concat(this.omnichannelConfiguration.orgUrl).concat(ue),U="POST",ae={data:Z,headers:ie,method:U,url:O,params:Q,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.sessionInit},ve.abrupt("return",new Promise(function(){var Pe=(0,i.default)(r.default.mark(function Me(ke,Ne){var Oe,Qe,et,Xe,Nt,kt,Fr;return r.default.wrap(function(Jt){for(;;)switch(Jt.prev=Jt.next){case 0:return Oe=G.Timer.TIMER(),Jt.prev=1,Jt.next=4,W(ae);case 4:Qe=Jt.sent,et=Oe.milliSecondsElapsed,Xe=z.milliSecondsElapsed,Nt=Qe.headers,Y.setAuthCodeNonce(Nt),Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SESSIONINITSUCCEEDED,"Session Init Succeeded",y,Qe,Xe,ue,U,void 0,Z,ie,et),ke(),Jt.next=22;break;case 13:if(Jt.prev=13,Jt.t0=Jt.catch(1),kt=Oe.milliSecondsElapsed,Fr=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.SESSIONINITFAILED,"Session Init failed",y,void 0,Fr,ue,U,Jt.t0,Z,ie,kt),!(0,X.default)(Jt.t0,h.default.axiosTimeoutErrorCode)){Jt.next=21;break}return Ne(new Error(Y.HTTPTimeOutErrorMessage)),Jt.abrupt("return");case 21:Ne(Jt.t0);case 22:case"end":return Jt.stop()}},Me,null,[[1,13]])}));return function(Me,ke){return Pe.apply(this,arguments)}}()));case 28:case"end":return ve.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"createConversation",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se,Q,O,U,ae,ce,fe,ve,Pe,Me,ke=arguments;return r.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(Y=ke.length>1&&ke[1]!==void 0?ke[1]:{},V=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.CREATESESSIONSTARTED,"Create conversation call Started",y),z=u.default.create(),W=!0,(0,d.default)(z,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionInit,shouldRetry:function(et){return(0,B.default)(et,W)},headerOverwrites:[M.default.authCodeNonce]}),le=Y.reconnectId,re=Y.authenticatedUserToken,$=Y.initContext,m=Y.getContext,R=$||{},Z=T({},h.default.defaultHeaders),ie=re?K.default.LiveChatConnectorAuthPath:K.default.LiveChatConnectorPath,se="/".concat(ie,"/").concat(this.omnichannelConfiguration.orgId,"/widgetApp/").concat(this.omnichannelConfiguration.widgetId,"/conversation"),re&&Object.assign(Z,(ue={},(0,c.default)(ue,M.default.authenticatedUserToken,re),(0,c.default)(ue,M.default.authCodeNonce,this.configuration.authCodeNonce),ue)),this.addDefaultHeaders(y,Z),this.setRequestIdHeader(y,Z),le&&(R.reconnectId=le),R.channelId=this.omnichannelConfiguration.channelId,!(m&&!window.document)){Oe.next=18;break}return Oe.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 18:if(m&&(R.browser=f.BrowserInfo.getBrowserName(),R.device=E.DeviceInfo.getDeviceType(),R.originurl=window.location.href,R.os=j.OSInfo.getOsType()),R.locale||(R.locale=h.default.defaultLocale),!(R.locale&&!w.default.supportedLocales.includes(R.locale))){Oe.next=22;break}return Oe.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(R.locale,"'"))));case 22:return Te="".concat(this.omnichannelConfiguration.orgUrl).concat(se),Se="POST",Q={data:R,headers:Z,method:Se,url:Te,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.sessionInit},O=G.Timer.TIMER(),Oe.prev=26,Oe.next=29,z(Q);case 29:if(U=Oe.sent,ae=O.milliSecondsElapsed,ce=V.milliSecondsElapsed,fe=U.data,ve=U.headers,this.setAuthCodeNonce(ve),ve&&ve[M.default.ocSessionId.toLowerCase()]&&(this.sessionId=ve[M.default.ocSessionId.toLowerCase()]),Object.keys(fe).length!==0){Oe.next=37;break}throw new Error("Empty data received from getChatToken");case 37:return fe.requestId=y,this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.CREATESESSIONSUCCEEDED,"Create coversation call Succeeded",y,U,ce,se,Se,void 0,void 0,Z,ae),Oe.abrupt("return",fe);case 42:if(Oe.prev=42,Oe.t0=Oe.catch(26),Pe=O.milliSecondsElapsed,Me=V.milliSecondsElapsed,this.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.CREATESESSIONFAILED,"Create conversation call failed",y,void 0,Me,se,Se,Oe.t0,R,Z,Pe),!(0,X.default)(Oe.t0,h.default.axiosTimeoutErrorCode)){Oe.next=49;break}throw new Error(this.HTTPTimeOutErrorMessage);case 49:throw Oe.t0;case 50:case"end":return Oe.stop()}},C,this,[[26,42]])}));function L(C){return H.apply(this,arguments)}return L}()},{key:"sessionClose",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se=arguments;return r.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return V=Se.length>1&&Se[1]!==void 0?Se[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SESSIONCLOSESTARTED,"Session Close Started",y),W="/".concat(K.default.LiveChatSessionClosePath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),le=u.default.create(),(0,d.default)(le,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionClose}),re=V.authenticatedUserToken,$=V.isReconnectChat,m=V.isPersistentChat,R=V.chatId,Z=h.default.defaultHeaders,ie={},ie.chatId=R,re&&(W="/".concat(K.default.LiveChatAuthSessionClosePath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),Z[M.default.authenticatedUserToken]=re,Z[M.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(y,Z),$&&(W+="&isReconnectChat=true"),m&&(W+="&isPersistentChat=true"),se="".concat(this.omnichannelConfiguration.orgUrl).concat(W),ue="POST",Te={data:ie,headers:Z,method:ue,url:se,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.sessionClose},O.abrupt("return",new Promise(function(){var U=(0,i.default)(r.default.mark(function ae(ce,fe){var ve,Pe,Me,ke,Ne,Oe,Qe;return r.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return ve=G.Timer.TIMER(),Xe.prev=1,Xe.next=4,le(Te);case 4:Pe=Xe.sent,Me=ve.milliSecondsElapsed,ke=Pe.headers,Y.setAuthCodeNonce(ke),Ne=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SESSIONCLOSESUCCEEDED,"Session Close succeeded",y,Pe,Ne,W,ue,void 0,void 0,Z,Me),ce(),Xe.next=20;break;case 13:Xe.prev=13,Xe.t0=Xe.catch(1),Oe=ve.milliSecondsElapsed,Qe=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.SESSIONCLOSEFAILED,"Session close failed",y,void 0,Qe,W,ue,Xe.t0,void 0,Z,Oe),Xe.t0.code===h.default.axiosTimeoutErrorCode&&fe(new Error(Y.HTTPTimeOutErrorMessage)),fe(Xe.t0);case 20:case"end":return Xe.stop()}},ae,null,[[1,13]])}));return function(ae,ce){return U.apply(this,arguments)}}()));case 18:case"end":return O.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"validateAuthChatRecord",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k){var Y,V=this,z,W,le,re,$,m,R,Z,ie;return r.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDSTARTED,"Validate Auth Chat Record Started",y),W=k.authenticatedUserToken,le=k.chatId,re="/".concat(K.default.LiveChatValidateAuthChatMapRecordPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(le,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),$=u.default.create(),(0,d.default)($,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.validateAuthChatRecord}),m=h.default.defaultHeaders,W&&(m[M.default.authenticatedUserToken]=W,m[M.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(y,m),R="".concat(this.omnichannelConfiguration.orgUrl).concat(re),Z="GET",ie={headers:m,method:Z,url:R,timeout:(Y=this.configuration.defaultRequestTimeout)!==null&&Y!==void 0?Y:this.configuration.requestTimeoutConfig.validateAuthChatRecordTimeout},ue.abrupt("return",new Promise(function(){var Te=(0,i.default)(r.default.mark(function Se(Q,O){var U,ae,ce,fe,ve,Pe,Me,ke;return r.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return U=G.Timer.TIMER(),Oe.prev=1,Oe.next=4,$(ie);case 4:ce=Oe.sent,fe=U.milliSecondsElapsed,ve=ce.headers,V.setAuthCodeNonce(ve),Pe=z.milliSecondsElapsed,((ae=ce.data)===null||ae===void 0?void 0:ae.authChatExist)===!0?(V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDSUCCEEDED,"Validate Auth Chat Record succeeded",y,ce,Pe,re,Z,void 0,void 0,m,fe),Q(ce.data)):(V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDFAILED,"Validate Auth Chat Record Failed. Record is not found or request is not authorized",y,ce,Pe,re,Z,void 0,void 0,m,fe),O(new Error("Validate Auth Chat Record Failed. Record is not found or request is not authorized"))),Oe.next=19;break;case 12:Oe.prev=12,Oe.t0=Oe.catch(1),Me=U.milliSecondsElapsed,ke=z.milliSecondsElapsed,V.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDFAILED,"Validate Auth Chat Record failed",y,void 0,ke,re,Z,Oe.t0,void 0,m,Me),(0,X.default)(Oe.t0,h.default.axiosTimeoutErrorCode)&&O(new Error(V.HTTPTimeOutErrorMessage)),Oe.t0.toString()==="Error: Request failed with status code 404"?Q({}):O(Oe.t0);case 19:case"end":return Oe.stop()}},Se,null,[[1,12]])}));return function(Se,Q){return Te.apply(this,arguments)}}()));case 13:case"end":return ue.stop()}},C,this)}));function L(C,y){return H.apply(this,arguments)}return L}()},{key:"submitPostChatResponse",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k){var Y,V=this,z,W,le,re,$,m,R,Z,ie,se=arguments;return r.default.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return z=se.length>2&&se[2]!==void 0?se[2]:{},W=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SUBMITPOSTCHATSTARTED,"Submit Post Chat Started",y),le="/".concat(K.default.LiveChatSubmitPostChatPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),re=u.default.create(),(0,d.default)(re,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.submitPostChatResponse}),$=z.authenticatedUserToken,m=h.default.defaultHeaders,this.addDefaultHeaders(y,m),$&&(le="/".concat(K.default.LiveChatAuthSubmitPostChatPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),m[M.default.authenticatedUserToken]=$,m[M.default.authCodeNonce]=this.configuration.authCodeNonce),R="".concat(this.omnichannelConfiguration.orgUrl).concat(le),Z="POST",ie={data:JSON.stringify(k),headers:m,method:Z,url:R,timeout:(Y=this.configuration.defaultRequestTimeout)!==null&&Y!==void 0?Y:this.configuration.requestTimeoutConfig.submitPostChatResponse},Te.abrupt("return",new Promise(function(){var Se=(0,i.default)(r.default.mark(function Q(O,U){var ae,ce,fe,ve,Pe,Me,ke;return r.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return ae=G.Timer.TIMER(),Oe.prev=1,Oe.next=4,re(ie);case 4:ce=Oe.sent,fe=ae.milliSecondsElapsed,ve=ce.headers,V.setAuthCodeNonce(ve),Pe=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SUBMITPOSTCHATSUCCEEDED,"Submit Post Chat succeeded",y,ce,Pe,le,Z,void 0,void 0,m,fe),O(),Oe.next=20;break;case 13:Oe.prev=13,Oe.t0=Oe.catch(1),Me=ae.milliSecondsElapsed,ke=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.SUBMITPOSTCHATFAILED,"Submit Post Chat Failed",y,void 0,ke,le,Z,Oe.t0,void 0,m,Me),(0,X.default)(Oe.t0,h.default.axiosTimeoutErrorCode)&&U(new Error(V.HTTPTimeOutErrorMessage)),U(Oe.t0);case 20:case"end":return Oe.stop()}},Q,null,[[1,13]])}));return function(Q,O){return Se.apply(this,arguments)}}()));case 14:case"end":return Te.stop()}},C,this)}));function L(C,y){return H.apply(this,arguments)}return L}()},{key:"getSurveyInviteLink",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k){var Y,V=this,z,W,le,re,$,m,R,Z,ie,se,ue=arguments;return r.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return z=ue.length>2&&ue[2]!==void 0?ue[2]:{},W=G.Timer.TIMER(),this.logger&&this.logger.log(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETSURVEYINVITELINKSTARTED,{SurveyOwnerId:y},"Get Survey Invite Link Started"),le="/".concat(K.default.LiveChatGetSurveyInviteLinkPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(y),re=u.default.create(),(0,d.default)(re,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getSurveyInviteLink}),$=z.authenticatedUserToken,m=z.requestId,R=h.default.defaultHeaders,$&&(le="/".concat(K.default.LiveChatAuthGetSurveyInviteLinkPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(y),R[M.default.authenticatedUserToken]=$,R[M.default.authCodeNonce]=this.configuration.authCodeNonce,R[M.default.widgetAppId]=this.omnichannelConfiguration.widgetId),this.addDefaultHeaders(m,R),m&&(R[M.default.requestId]=m),Z="".concat(this.omnichannelConfiguration.orgUrl).concat(le),ie="POST",se={data:JSON.stringify(k),headers:R,method:ie,url:Z,timeout:(Y=this.configuration.defaultRequestTimeout)!==null&&Y!==void 0?Y:this.configuration.requestTimeoutConfig.getSurveyInviteLink},Se.abrupt("return",new Promise(function(){var Q=(0,i.default)(r.default.mark(function O(U,ae){var ce,fe,ve,Pe,Me,ke,Ne,Oe;return r.default.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return ce=G.Timer.TIMER(),et.prev=1,et.next=4,re(se);case 4:fe=et.sent,ve=ce.milliSecondsElapsed,Pe=fe.data,Me=fe.headers,V.setAuthCodeNonce(Me),ke=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETSURVEYINVITELINKSUCCEEDED,"Get Survey Invite Link Succeeded",m,fe,ke,le,ie,void 0,void 0,R,ve),U(Pe),et.next=20;break;case 13:et.prev=13,et.t0=et.catch(1),Ne=ce.milliSecondsElapsed,Oe=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETSURVEYINVITELINKFAILED,"Get Survey Invite Link failed",m,void 0,Oe,le,ie,et.t0,void 0,R,Ne),(0,X.default)(et.t0,h.default.axiosTimeoutErrorCode)&&ae(new Error(V.HTTPTimeOutErrorMessage)),ae(et.t0);case 20:case"end":return et.stop()}},O,null,[[1,13]])}));return function(O,U){return Q.apply(this,arguments)}}()));case 15:case"end":return Se.stop()}},C,this)}));function L(C,y){return H.apply(this,arguments)}return L}()},{key:"getChatTranscripts",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k,Y){var V,z=this,W,le,re,$,m,R,Z,ie,se,ue,Te=arguments;return r.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return W=Te.length>3&&Te[3]!==void 0?Te[3]:{},le=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATTRANSCRIPTSTARTED,"Get Chat Transcript Started",y),re="/".concat(K.default.LiveChatGetChatTranscriptPath,"/").concat(k,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),$=u.default.create(),(0,d.default)($,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatTranscripts}),m=W.authenticatedUserToken,R=W.currentLiveChatVersion,Z=h.default.defaultHeaders,Z[M.default.organizationId]=this.omnichannelConfiguration.orgId,Z[M.default.widgetAppId]=this.omnichannelConfiguration.widgetId,Z[M.default.authorization]=Y,this.liveChatVersion===a.LiveChatVersion.V2||R&&R===a.LiveChatVersion.V2?(re="/".concat(K.default.LiveChatv2GetChatTranscriptPath,"/").concat(k,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),m&&(Z[M.default.authenticatedUserToken]=m,Z[M.default.authCodeNonce]=this.configuration.authCodeNonce,re="/".concat(K.default.LiveChatv2AuthGetChatTranscriptPath,"/").concat(k,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId))):m&&(Z[M.default.authenticatedUserToken]=m,Z[M.default.authCodeNonce]=this.configuration.authCodeNonce,re="/".concat(K.default.LiveChatAuthGetChatTranscriptPath,"/").concat(k,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId)),this.addDefaultHeaders(y,Z),ie="".concat(this.omnichannelConfiguration.orgUrl).concat(re),se="GET",ue={headers:Z,method:se,url:ie,timeout:(V=this.configuration.defaultRequestTimeout)!==null&&V!==void 0?V:this.configuration.requestTimeoutConfig.getChatTranscripts},Q.abrupt("return",new Promise(function(){var O=(0,i.default)(r.default.mark(function U(ae,ce){var fe,ve,Pe,Me,ke,Ne,Oe,Qe;return r.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return fe=G.Timer.TIMER(),Xe.prev=1,Xe.next=4,$(ue);case 4:ve=Xe.sent,Pe=fe.milliSecondsElapsed,Me=le.milliSecondsElapsed,ke=ve.data,Ne=ve.headers,z.setAuthCodeNonce(Ne),z.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETCHATTRANSCRIPTSUCCEEDED,"Get Chat Transcript succeeded",y,ve,Me,re,se,void 0,void 0,Z,Pe),ae(ke),Xe.next=20;break;case 13:Xe.prev=13,Xe.t0=Xe.catch(1),Oe=fe.milliSecondsElapsed,Qe=le.milliSecondsElapsed,z.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETCHATTRANSCRIPTFAILED,"Get Chat Transcript failed",y,void 0,Qe,re,se,Xe.t0,void 0,Z,Oe),(0,X.default)(Xe.t0,h.default.axiosTimeoutErrorCode)&&ce(new Error(z.HTTPTimeOutErrorMessage)),ce(Xe.t0);case 20:case"end":return Xe.stop()}},U,null,[[1,13]])}));return function(U,ae){return O.apply(this,arguments)}}()));case 17:case"end":return Q.stop()}},C,this)}));function L(C,y,k){return H.apply(this,arguments)}return L}()},{key:"getPersistentChatHistory",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m,R,Z,ie,se,ue,Te,Se=arguments;return r.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(V=Se.length>1&&Se[1]!==void 0?Se[1]:{},z=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYSTARTED,"Get Persistent Chat History Started",y),y||(y=(0,q.uuidv4)()),W=V.authenticatedUserToken,le=V.pageSize,re=V.pageToken,W){O.next=9;break}return $="Authenticated user token is required for persistent chat history",this.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYFAILED,"Get Persistent Chat History failed - Missing authenticated user token",y),O.abrupt("return",Promise.reject(new Error($)));case 9:return m="/".concat(K.default.LiveChatAuthGetPersistentChatHistoryPath,"/").concat(this.omnichannelConfiguration.orgId,"/widgetapp/").concat(this.omnichannelConfiguration.widgetId,"/conversation/history"),R=u.default.create(),(0,d.default)(R,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getPersistentChatHistory}),Z=h.default.defaultHeaders,Z[M.default.authenticatedUserToken]=W,Z[M.default.authCodeNonce]=this.configuration.authCodeNonce,re&&(Z[M.default.pageToken]=re),this.addDefaultHeaders(y,Z),ie={},le&&(ie.pageSize=le.toString()),se="".concat(this.omnichannelConfiguration.orgUrl).concat(m),ue="GET",Te={headers:Z,method:ue,url:se,params:ie,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.getPersistentChatHistory},O.abrupt("return",new Promise(function(){var U=(0,i.default)(r.default.mark(function ae(ce,fe){var ve,Pe,Me,ke,Ne,Oe,Qe,et;return r.default.wrap(function(Nt){for(;;)switch(Nt.prev=Nt.next){case 0:return ve=G.Timer.TIMER(),Nt.prev=1,Nt.next=4,R(Te);case 4:Pe=Nt.sent,Me=ve.milliSecondsElapsed,ke=z.milliSecondsElapsed,Ne=Pe.data,Oe=Pe.headers,Y.setAuthCodeNonce(Oe),Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYSUCCEEDED,"Get Persistent Chat History succeeded",y,Pe,ke,m,ue,void 0,void 0,Z,Me),ce(Ne),Nt.next=22;break;case 13:if(Nt.prev=13,Nt.t0=Nt.catch(1),Qe=ve.milliSecondsElapsed,et=z.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYFAILED,"Get Persistent Chat History failed",y,void 0,et,m,ue,Nt.t0,void 0,Z,Qe),!(0,X.default)(Nt.t0,h.default.axiosTimeoutErrorCode)){Nt.next=21;break}return fe(new Error(Y.HTTPTimeOutErrorMessage)),Nt.abrupt("return");case 21:fe(Nt.t0);case 22:case"end":return Nt.stop()}},ae,null,[[1,13]])}));return function(ae,ce){return U.apply(this,arguments)}}()));case 23:case"end":return O.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"emailTranscript",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k,Y){var V,z=this,W,le,re,$,m,R,Z,ie,se,ue=arguments;return r.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return W=ue.length>3&&ue[3]!==void 0?ue[3]:{},le=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.EMAILTRANSCRIPTSTARTED,"Email Transcript Started",y),re="/".concat(K.default.LiveChatTranscriptEmailRequestPath,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId),$=u.default.create(),(0,d.default)($,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.emailTranscript}),m=W.authenticatedUserToken,R=h.default.defaultHeaders,R[M.default.organizationId]=this.omnichannelConfiguration.orgId,R[M.default.widgetAppId]=this.omnichannelConfiguration.widgetId,R[M.default.authorization]=k,m&&(R[M.default.authenticatedUserToken]=m,R[M.default.authCodeNonce]=this.configuration.authCodeNonce,re="/".concat(K.default.LiveChatAuthTranscriptEmailRequestPath,"/").concat(y,"?channelId=").concat(this.omnichannelConfiguration.channelId)),this.addDefaultHeaders(y,R),Z="".concat(this.omnichannelConfiguration.orgUrl).concat(re),ie="POST",se={data:JSON.stringify(Y),headers:R,method:ie,url:Z,timeout:(V=this.configuration.defaultRequestTimeout)!==null&&V!==void 0?V:this.configuration.requestTimeoutConfig.emailTranscript},Se.abrupt("return",new Promise(function(){var Q=(0,i.default)(r.default.mark(function O(U,ae){var ce,fe,ve,Pe,Me,ke,Ne;return r.default.wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return ce=G.Timer.TIMER(),Qe.prev=1,Qe.next=4,$(se);case 4:fe=Qe.sent,ve=ce.milliSecondsElapsed,Pe=fe.headers,z.setAuthCodeNonce(Pe),Me=le.milliSecondsElapsed,z.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.EMAILTRANSCRIPTSUCCEEDED,"Email Transcript succeeded",y,fe,Me,re,ie,void 0,void 0,R,ve),U(),Qe.next=20;break;case 13:Qe.prev=13,Qe.t0=Qe.catch(1),ke=ce.milliSecondsElapsed,Ne=le.milliSecondsElapsed,z.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.EMAILTRANSCRIPTFAILED,"Email Transcript Failed",y,void 0,Ne,re,ie,Qe.t0,void 0,R,ke),(0,X.default)(Qe.t0,h.default.axiosTimeoutErrorCode)&&ae(new Error(z.HTTPTimeOutErrorMessage)),ae(Qe.t0);case 20:case"end":return Qe.stop()}},O,null,[[1,13]])}));return function(O,U){return Q.apply(this,arguments)}}()));case 17:case"end":return Se.stop()}},C,this)}));function L(C,y,k){return H.apply(this,arguments)}return L}()},{key:"fetchDataMaskingInfo",value:function(){var H=(0,i.default)(r.default.mark(function C(y){var k,Y=this,V,z,W,le,re,$,m;return r.default.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return V=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.FETCHDATAMASKINGSTARTED,"Fetch Data Masking Started",y),y||(y=(0,q.uuidv4)()),z="/".concat(K.default.LiveChatFetchDataMaskingInfoPath,"/").concat(this.omnichannelConfiguration.orgId),W=u.default.create(),(0,d.default)(W,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.fetchDataMaskingInfo}),le=h.default.defaultHeaders,le[M.default.organizationId]=this.omnichannelConfiguration.orgId,le[M.default.requestId]=y,this.addDefaultHeaders(y,le),re="".concat(this.omnichannelConfiguration.orgUrl).concat(z),$="GET",m={headers:le,method:$,url:re,timeout:(k=this.configuration.defaultRequestTimeout)!==null&&k!==void 0?k:this.configuration.requestTimeoutConfig.fetchDataMaskingInfo},Z.abrupt("return",new Promise(function(){var ie=(0,i.default)(r.default.mark(function se(ue,Te){var Se,Q,O,U,ae,ce,fe;return r.default.wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:return Se=G.Timer.TIMER(),Pe.prev=1,Pe.next=4,W(m);case 4:Q=Pe.sent,O=Se.milliSecondsElapsed,U=V.milliSecondsElapsed,ae=Q.data,Y.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.FETCHDATAMASKINGSUCCEEDED,"Fetch Data Masking succeeded",y,Q,U,z,$,void 0,void 0,le,O),ue(ae),Pe.next=19;break;case 12:Pe.prev=12,Pe.t0=Pe.catch(1),ce=Se.milliSecondsElapsed,fe=V.milliSecondsElapsed,Y.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.FETCHDATAMASKINGFAILED,"Fetch Data Masking Failed",y,void 0,fe,z,$,Pe.t0,void 0,le,ce),(0,X.default)(Pe.t0,h.default.axiosTimeoutErrorCode)&&Te(new Error(Y.HTTPTimeOutErrorMessage)),Te(Pe.t0);case 19:case"end":return Pe.stop()}},se,null,[[1,12]])}));return function(se,ue){return ie.apply(this,arguments)}}()));case 14:case"end":return Z.stop()}},C,this)}));function L(C){return H.apply(this,arguments)}return L}()},{key:"makeSecondaryChannelEventRequest",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k){var Y,V=this,z,W,le,re,$,m,R,Z,ie,se=arguments;return r.default.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return z=se.length>2&&se[2]!==void 0?se[2]:{},W=G.Timer.TIMER(),this.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTSTARTED,"Secondary Channel Event Request Started",y),le="/".concat(K.default.LiveChatSecondaryChannelEventPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y),re=u.default.create(),(0,d.default)(re,{headerOverwrites:[M.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.makeSecondaryChannelEventRequest}),$=z.authenticatedUserToken,m=h.default.defaultHeaders,m[M.default.organizationId]=this.omnichannelConfiguration.orgId,$&&(m[M.default.authenticatedUserToken]=$,m[M.default.authCodeNonce]=this.configuration.authCodeNonce,le="/".concat(K.default.LiveChatAuthSecondaryChannelEventPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(y)),this.addDefaultHeaders(y,m),le+="?channelId="+h.default.defaultChannelId,R="".concat(this.omnichannelConfiguration.orgUrl).concat(le),Z="POST",ie={data:JSON.stringify(k),headers:m,method:Z,url:R,timeout:(Y=this.configuration.defaultRequestTimeout)!==null&&Y!==void 0?Y:this.configuration.requestTimeoutConfig.makeSecondaryChannelEventRequest},Te.abrupt("return",new Promise(function(){var Se=(0,i.default)(r.default.mark(function Q(O,U){var ae,ce,fe,ve,Pe,Me,ke;return r.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return ae=G.Timer.TIMER(),Oe.prev=1,Oe.next=4,re(ie);case 4:ce=Oe.sent,fe=ae.milliSecondsElapsed,ve=ce.headers,V.setAuthCodeNonce(ve),Pe=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTSUCCEEDED,"Secondary Channel Event Request Succeeded",y,ce,Pe,le,Z,void 0,void 0,m,fe),O(),Oe.next=20;break;case 13:Oe.prev=13,Oe.t0=Oe.catch(1),Me=ae.milliSecondsElapsed,ke=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTFAILED,"Secondary Channel Event Request Failed",y,void 0,ke,le,Z,Oe.t0,void 0,m,Me),(0,X.default)(Oe.t0,h.default.axiosTimeoutErrorCode)&&U(new Error(V.HTTPTimeOutErrorMessage)),U(Oe.t0);case 20:case"end":return Oe.stop()}},Q,null,[[1,13]])}));return function(Q,O){return Se.apply(this,arguments)}}()));case 16:case"end":return Te.stop()}},C,this)}));function L(C,y){return H.apply(this,arguments)}return L}()},{key:"sendTypingIndicator",value:function(){var H=(0,i.default)(r.default.mark(function C(y,k){var Y,V=this,z,W,le,re,$,m,R,Z,ie,se=arguments;return r.default.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(z=se.length>2&&se[2]!==void 0?se[2]:{},!(!k||k!==a.LiveChatVersion.V2)){Te.next=3;break}return Te.abrupt("return",Promise.resolve());case 3:if(W=G.Timer.TIMER(),le=z.customerDisplayName,!(!k||k!==a.LiveChatVersion.V2)){Te.next=7;break}throw new Error("Typing indicator is only supported on v2");case 7:return re="/".concat(K.default.SendTypingIndicatorPath,"/").concat(y),$=u.default.create(),m=h.default.defaultHeaders,m[M.default.organizationId]=this.omnichannelConfiguration.orgId,le&&(m[h.default.customerDisplayName]=le),this.addDefaultHeaders(y,m),R="".concat(this.omnichannelConfiguration.orgUrl).concat(re),Z="POST",ie={headers:m,method:Z,url:R,timeout:(Y=this.configuration.defaultRequestTimeout)!==null&&Y!==void 0?Y:this.configuration.requestTimeoutConfig.sendTypingIndicator},Te.abrupt("return",new Promise(function(){var Se=(0,i.default)(r.default.mark(function Q(O,U){var ae,ce,fe,ve,Pe,Me;return r.default.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return ae=G.Timer.TIMER(),Ne.prev=1,Ne.next=4,$(ie);case 4:ce=Ne.sent,fe=ae.milliSecondsElapsed,ve=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.INFO,a.OCSDKTelemetryEvent.SENDTYPINGINDICATORSUCCEEDED,"Send Typing Indicator Succeeded",y,ce,ve,re,Z,void 0,void 0,m,fe),O(),Ne.next=18;break;case 11:Ne.prev=11,Ne.t0=Ne.catch(1),Pe=ae.milliSecondsElapsed,Me=W.milliSecondsElapsed,V.logWithLogger(p.LogLevel.ERROR,a.OCSDKTelemetryEvent.SENDTYPINGINDICATORFAILED,"Send Typing Indicator Failed",y,void 0,Me,re,Z,Ne.t0,void 0,m,Pe),(0,X.default)(Ne.t0,h.default.axiosTimeoutErrorCode)&&U(new Error(V.HTTPTimeOutErrorMessage)),U(Ne.t0);case 18:case"end":return Ne.stop()}},Q,null,[[1,11]])}));return function(Q,O){return Se.apply(this,arguments)}}()));case 17:case"end":return Te.stop()}},C,this)}));function L(C,y){return H.apply(this,arguments)}return L}()},{key:"logWithLogger",value:function(L,C,y,k,Y,V,z,W,le,re,$,m){var R,Z,ie,se;if(this.logger){le&&b.LoggingSanitizer.stripErrorSensitiveProperties(le);var ue=void 0;re&&(ue=T({},re),ue.customContextData&&b.LoggingSanitizer.stripCustomContextDataValues(ue.customContextData),ue.preChatResponse&&b.LoggingSanitizer.stripPreChatResponse(ue.preChatResponse),b.LoggingSanitizer.stripGeolocation(ue));var Te=void 0,Se=void 0;if($&&(Te=T({},$),b.LoggingSanitizer.stripRequestHeadersSensitiveProperties(Te),$[M.default.authenticatedUserToken]&&window.document&&window.atob))try{var Q=$[M.default.authenticatedUserToken],O=Q.split(".")[1],U=window.atob(O),ae=JSON.parse(U),ce=ae.lwicontexts;if(Se={sub:ae.sub,exp:ae.exp},ce){var fe=JSON.parse(ce);b.LoggingSanitizer.stripCustomContextDataValues(fe),Se.lwiContexts=fe}}catch{}var ve={RequestId:k,Region:Y==null?void 0:Y.data.Region,ElapsedTimeInMilliseconds:V,HttpRequestResponseTime:m,TransactionId:Y==null?void 0:Y.headers[h.default.transactionid],RequestPath:z,RequestMethod:W,ResponseStatusCode:Y?Y.status:le?(R=le.response)===null||R===void 0?void 0:R.status:void 0,ExceptionDetails:le?((Z=le.response)===null||Z===void 0?void 0:Z.data)||le:void 0,RequestPayload:ue,RequestHeaders:Te,ResponseErrorcode:le?(ie=le.response)===null||ie===void 0||(se=ie.headers)===null||se===void 0?void 0:se.errorcode:void 0,AuthTokenDetails:Se};this.logger.log(L,C,ve,y)}}},{key:"addDefaultHeaders",value:function(L,C){this.setSessionIdHeader(this.sessionId,C),(0,oe.addOcUserAgentHeader)(this.ocUserAgent,C),this.setCorrelationIdInHeader(L,C)}}]),S}();t.default=A,(0,c.default)(A,"defaultRequestTimeoutConfig",{getChatConfig:12e4,getLWIDetails:15e3,getChatToken:15e3,sessionInit:15e3,sessionClose:15e3,getReconnectableChats:15e3,getReconnectAvailability:15e3,submitPostChatResponse:15e3,getSurveyInviteLink:15e3,getChatTranscripts:3e4,emailTranscript:5e3,fetchDataMaskingInfo:5e3,makeSecondaryChannelEventRequest:15e3,getAgentAvailability:15e3,sendTypingIndicator:5e3,validateAuthChatRecordTimeout:15e3,getPersistentChatHistory:15e3}),(0,c.default)(A,"defaultConfiguration",{authCodeNonce:(0,q.uuidv4)().substring(0,8),getChatTokenRetryCount:10,getChatTokenTimeBetweenRetriesOnFailure:1e4,getChatTokenRetryOn429:!0,maxRequestRetriesOnFailure:5,defaultRequestTimeout:void 0,requestTimeoutConfig:A.defaultRequestTimeoutConfig,useUnauthReconnectIdSigQueryParam:!1,waitTimeBetweenRetriesConfig:F.waitTimeBetweenRetriesConfigs,ocUserAgent:[]})}(YC)),YC}var $P;function Iz(){return $P||($P=1,function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=e(Yr()),r=e(po()),i=e(Sf()),o=e(zV()),s=e(wz()),l=function(){function c(){(0,n.default)(this,c)}return(0,r.default)(c,null,[{key:"getSDK",value:function(u,d,f){var h=new o.default(f);return new s.default({channelId:u.channelId||i.default.defaultChannelId,orgId:u.orgId,orgUrl:u.orgUrl,widgetId:u.widgetId},d||{},h)}}]),c}();t.default=l}(WC)),WC}(function(t){var e=yn;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"SDKProvider",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"uuidv4",{enumerable:!0,get:function(){return o.uuidv4}});var n=e(qV()),r=e(jV()),i=e(Iz()),o=BU();(function(){if(_e.window===void 0&&(_e.window=_e),!window)throw new Error("window object not found");"Microsoft"in window||(window.Microsoft={}),"CRM"in window.Microsoft||(window.Microsoft.CRM={}),"Omnichannel"in window.Microsoft.CRM||(window.Microsoft.CRM.Omnichannel={}),"SDK"in window.Microsoft.CRM.Omnichannel||(window.Microsoft.CRM.Omnichannel.SDK={SDKProvider:i.default,Util:{uuidv4:o.uuidv4}}),window.document&&n.default.raiseCustomEvent(r.default.OCSDKLOAD)})()})(Kv);var ab={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLocaleString=t.defaultLocaleId=t.getLocaleIdFromString=t.getLocaleStringFromId=void 0;var e={1025:"ar-sa",1026:"bg-bg",1027:"ca-es",1029:"cs-cz",1030:"da-dk",1031:"de-de",1032:"el-gr",1033:"en-us",3082:"es-es",1061:"et-ee",1069:"eu-es",1035:"fi-fi",1036:"fr-fr",1110:"gl-es",1037:"he-il",1081:"hi-in",1050:"hr-hr",1038:"hu-hu",1057:"id-id",1040:"it-it",1041:"ja-jp",1087:"kk-kz",1042:"ko-kr",1063:"lt-lt",1062:"lv-lv",1086:"ms-my",1044:"nb-no",1043:"nl-nl",1045:"pl-pl",1046:"pt-br",2070:"pt-pt",1048:"ro-ro",1049:"ru-ru",1051:"sk-sk",1060:"sl-si",3098:"sr-cyrl-cs",2074:"sr-latn-cs",1053:"sv-se",1054:"th-th",1055:"tr-tr",1058:"uk-ua",1066:"vi-vn",2052:"zh-cn",3076:"zh-hk",1028:"zh-tw"},n=function(i){var o=Object.keys(e).find(function(s){return s===i});return o?e[o]:t.defaultLocaleString};t.getLocaleStringFromId=n;var r=function(i){var o=Object.keys(e).find(function(s){return e[s]===i});return o??t.defaultLocaleId};t.getLocaleIdFromString=r,t.defaultLocaleId="1033",t.defaultLocaleString="en-us"})(ab);var tl={},Gu={};Object.defineProperty(Gu,"__esModule",{value:!0});var AE;(function(t){t.Customer="Customer",t.Agent="__agent__",t.System="__system__"})(AE||(AE={}));Gu.default=AE;var Wu={};Object.defineProperty(Wu,"__esModule",{value:!0});var bz=function(){function t(){}return t.UserMessage="UserMessage",t.SwiftCard="SwiftCard",t.Typing="Control/Typing",t.ClearTyping="Control/ClearTyping",t.LiveState="Control/LiveState",t}();Wu.default=bz;var hr={};Object.defineProperty(hr,"__esModule",{value:!0});hr.ResourceType=hr.FileSharingProtocolType=hr.Role=hr.PersonType=hr.MessageType=hr.DeliveryMode=hr.MessageContentType=void 0;var _z=function(){function t(){}return t.RichText="RichText",t.Text="Text",t}();hr.MessageContentType=_z;var Az=function(){function t(){}return t.Bridged="bridged",t.Unbridged="unbridged",t}();hr.DeliveryMode=Az;var Rz=function(){function t(){}return t.UserMessage="UserMessage",t.SwiftCard="SwiftCard",t.Typing="Control/Typing",t.ClearTyping="Control/ClearTyping",t.LiveState="Control/LiveState",t}();hr.MessageType=Rz;var HP;(function(t){t[t.Unknown=0]="Unknown",t[t.User=1]="User",t[t.Bot=2]="Bot"})(HP||(hr.PersonType=HP={}));var qP;(function(t){t.Bot="bot",t.Agent="agent",t.System="system",t.User="user",t.Unknown="unknown"})(qP||(hr.Role=qP={}));var jP;(function(t){t[t.AmsBasedFileSharing=0]="AmsBasedFileSharing"})(jP||(hr.FileSharingProtocolType=jP={}));var kz=function(){function t(){}return t.NewMessage="NewMessage",t.MessageUpdate="MessageUpdate",t.UserPresence="UserPresence",t.ConversationUpdate="ConversationUpdate",t.ThreadUpdate="ThreadUpdate",t}();hr.ResourceType=kz;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.messageContentMetadata=t.isJsonObject=t.getRuntimeId=t.isNotEmpty=t.isClientIdNotFoundErrorMessage=t.getMessageRole=t.isCustomerMessage=t.isSystemMessage=void 0;var e=Gu,n=Wu,r=Kv,i=hr,o=function(h){var g=h.messageType,E=h.properties,D=g===n.default.UserMessage&&E&&E.tags&&E.tags.includes("system"),w=h.tags&&h.tags.includes("system");return D||w||!1};t.isSystemMessage=o;var s=function(h){var g=h.sender,E=g&&g.id&&g.id.includes("contacts/8:"),D=g&&g.displayName&&g.displayName===e.default.Customer;return E||D||!1};t.isCustomerMessage=s;var l=function(h){var g,E=h.messageType,D=h.properties,w=h.tags,p=E===n.default.UserMessage&&(!D.tags||Object.keys(D.tags).length===0)&&w&&w.length===0,b=E===n.default.UserMessage&&((g=D==null?void 0:D.tags)===null||g===void 0?void 0:g.includes("public"))||w&&w.includes("public");return p?i.Role.Bot:b?i.Role.Agent:(0,t.isSystemMessage)(h)?i.Role.System:(0,t.isCustomerMessage)(h)?i.Role.User:i.Role.Unknown};t.getMessageRole=l;var c=function(h){var g,E,D;return((g=h==null?void 0:h.response)===null||g===void 0?void 0:g.status)===401&&((D=(E=h==null?void 0:h.response)===null||E===void 0?void 0:E.headers)===null||D===void 0?void 0:D.message)==="UserId not found"};t.isClientIdNotFoundErrorMessage=c;var a=function(h){return h!=null&&h.trim()!==""};t.isNotEmpty=a;var u=function(h){return h!==null&&(0,t.isNotEmpty)(h)?h:(0,r.uuidv4)()};t.getRuntimeId=u;var d=function(h){try{return JSON.parse(h),!0}catch{return!1}};t.isJsonObject=d;var f=function(h){if(!h||h.length===0)return"0";var g=h==null?void 0:h.charAt(0),E=h==null?void 0:h.charAt((h==null?void 0:h.length)-1),D=h==null?void 0:h.length;return"".concat(g).concat(D).concat(E)};t.messageContentMetadata=f})(tl);var Ku={};Object.defineProperty(Ku,"__esModule",{value:!0});var Pz=function(){function t(){}return t.Bridged="bridged",t.Unbridged="unbridged",t}();Ku.default=Pz;var Tf={},lb={},cb={},ub={},db={},Yl={};Object.defineProperty(Yl,"__esModule",{value:!0});var Oz=function(){function t(){}return t.IFrame=0,t.Page=1,t}();Yl.default=Oz;var Ef={};Object.defineProperty(Ef,"__esModule",{value:!0});Ef.uuidv4=void 0;var Mz=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})};Ef.uuidv4=Mz;var VP=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},zP=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(db,"__esModule",{value:!0});var Dz=Yl,Nz=Ef,xz=function(){function t(e){this.hostType=Dz.default.Page,this.id=(0,Nz.uuidv4)(),this.protocolType=e,this.newConversationMessageListeners={},this.threadUpdateListeners={},this.debug=!1}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.joinConversation=function(e,n){var r=this;return this.onJoinConversation(e,n).then(function(i){var o={disconnect:r.disconnectFromConversation.bind(r,i),downloadFile:r.downloadFile.bind(r,i),getFileStatus:r.getFileStatus.bind(r,i),getMembers:r.getMembers.bind(r,i),getMessages:r.getMessages.bind(r,i),id:i.id,indicateTypingStatus:r.indicateTypingStatus.bind(r,i),registerOnNewMessage:r.registerOnNewMessage.bind(r,i),registerOnThreadUpdate:r.registerOnThreadUpdate.bind(r,i),sendFileMessage:r.sendFileMessage.bind(r,i),sendMessage:r.sendMessage.bind(r,i),sendMessageToBot:r.sendMessageToBot.bind(r,i),uploadFile:r.uploadFile.bind(r,i),sendFileData:r.sendFileData.bind(r,i)};return o})},t.prototype.registerOnNewMessage=function(e,n){return VP(this,void 0,void 0,function(){return zP(this,function(r){return[2,Promise.resolve()]})})},t.prototype.registerOnThreadUpdate=function(e,n){return VP(this,void 0,void 0,function(){return zP(this,function(r){return[2,Promise.resolve()]})})},t.prototype.uploadFile=function(e,n,r){return Promise.resolve()},t.prototype.downloadFile=function(e,n){return this.debug&&console.debug("IC3Core/ClientBridge/downloadFile"),this.downloadFileData(e,n).then(function(r){var i=r;if(i&&i.size)return i;var o=new Blob([new Uint8Array(r)]);return!o||o.size===0&&o.type===""?r:o})},t}();db.default=xz;var hb={},go={};Object.defineProperty(go,"__esModule",{value:!0});var Lz=function(){function t(){}return t.NewMessageEvent="NewMessage",t.MessageUpdateEvent="MessageUpdate",t.ThreadUpdateEvent="ThreadUpdate",t.ConversationUpdateEvent="ConversationUpdate",t.HttpLongPoll="HttpLongPoll",t.ContentTypeJson="application/json",t.ContentTypeTextPlain="text/plain;charset=UTF-8",t.ContentTypeForm="application/x-www-form-urlencoded",t.RedirectAs404="redirectAs404",t.NoCache="no-cache",t.User="user",t.Web="web",t.ClientInfoValue="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country=IN; clientName=swc; clientVer=912/0.106.0.34//swc",t.TextPlainMimeType="text/plain",t.SwcName="SWC",t.Image="image",t.ClientVersion="937/0.123.0.9",t.DelayForAms=50,t.Reset_Flag="reset_ic3_needed",t.Malware="malware",t.Ready="ready",t.InProgress="in progress",t.Failed="failed",t.Expired="expired",t.ImageView="imgpsh_fullsize_anim",t.FileView="original",t.DocumentTypeImage="pish/image",t.DocumentTypeFile="sharing/file",t.ImageContent="imgpsh",t.FileContent="original",t.AMSAcceptHeaderValue="image/webp,image/ *,*/*;q=0.8",t.AMSAcceptEncodingHeaderValue="gzip, deflate, sdch, br",t.AMSAuthorizationSkypeTokenValue="skype_token ",t.stabilizePollMaxRetryCount=50,t.timeBetweenStabilizingPoll=1e3,t.retryCount=2,t.retry404Count=3,t.retryOtherCount=3,t.liveStateRetryCount=3,t.timeBetweenOperationRetry=1e3,t.heartBeatDuration=3e4,t.endpointRequestLog="Endpoint request",t.subscriptionRequestLog="Subscription request",t.setPropertiesRequestLog="Set message properties request",t.unsubscribeRequestLog="Unsubscribe from endpoint request",t.pollRequestLog="Polling",t.oldInitializer="Old initializer",t.newInitializer="New Initializer",t.skypeTokenAuthURL="/v1/skypetokenauth",t.skypeTokenConstantForData="skypetoken=",t}();go.default=Lz;var ds={};Object.defineProperty(ds,"__esModule",{value:!0});var Uz=function(){function t(){}return t.LocationHeader="location",t.SetRegistrationTokenHeader="set-registrationtoken",t.RegistrationTokenHeader="RegistrationToken",t.RegistrationTokenHeaderValue="registrationToken=",t.ContentTypeHeader="content-type",t.AuthenticationHeader="authentication",t.BehaviorOverrideHeader="behavioroverride",t.SkypeTokenHeaderValue="skypetoken=",t.SetEndpointProperty="supportsMessageProperties",t}();ds.default=Uz;var Zl={};Object.defineProperty(Zl,"__esModule",{value:!0});var RE;(function(t){t.GET="get",t.POST="post",t.PUT="put",t.DELETE="delete"})(RE||(RE={}));Zl.default=RE;var fb={},pb={},nl={},js={};Object.defineProperty(js,"__esModule",{value:!0});var Fz=ds,Bz=function(){function t(){}return t.isNullOrEmptyString=function(e){return t.isNullOrUndefined(e)||e===""},t.isNullOrUndefinedOrEmptyArray=function(e){return t.isNullOrUndefined(e)||e.length===0},t.isNullOrUndefined=function(e){return e==null},t.isPrimitiveString=function(e){return typeof e=="string"},t.convertStringToBoolean=function(e){return!t.isNullOrUndefined(e)&&e.toLowerCase()==="true"},t.sanitizeUrlWithBackSlash=function(e){return e.endsWith("/")?e:e+"/"},t.getRegistrationTokenValue=function(e){var n=e.match(/registrationToken=(.+); expires=(\d+)/);return n&&n.length>=2?Fz.default.RegistrationTokenHeaderValue+n[1]:""},t.addQueryParametersToPath=function(e,n){var r=e;if(!t.isNullOrUndefined(n)){r.indexOf("?")>=0||(r+="?");for(var i in n)if(n.hasOwnProperty(i)){var o=i+"="+n[i];r[r.length-1]!=="?"&&(o="&"+o),r+=o}}return r},t.getResponseHeader=function(e,n){var r;return t.isNullOrUndefined(e)||(r=e.headers[n]),r},t.timer=function(){var e=new Date().getTime();return{get milliSecondsElapsed(){var n=new Date().getTime()-e;return n}}},t.concatArrays=function(e,n){!t.isNullOrUndefined(e)&&!t.isNullOrUndefined(n)&&n.forEach(function(r){e.push(r)})},t}();js.default=Bz;var Ju={};Object.defineProperty(Ju,"__esModule",{value:!0});var kE;(function(t){t.JoinConversation="JoinConversation",t.RegisterOnNewMessage="RegisterOnNewMessage",t.RegisterOnThreadUpdate="RegisterOnThreadUpdate",t.OnNewMessageFailure="OnNewMessageFailure",t.OnThreadUpdateFailure="OnThreadUpdateFailure",t.SendLiveStateFailure="SendLiveStateFailure",t.JoinConversationV1GetThreadRequestFailed="JoinConversationV1GetThreadRequestFailed",t.UpdateToken="UpdateToken",t.SyncingPollData="SyncingPollData",t.IC3InitializationBegins="IC3InitializationBegins",t.IC3StartedPolling="IC3StartedPolling",t.IC3StoppedPolling="IC3StoppedPolling",t.IC3EndpointCreationSuccess="IC3EndpointCreationSuccess",t.RedirectOnRequestCreationFailure="RedirectOnRequestCreationFailure",t.ResetOnRequestCreationFailure="ResetOnRequestCreationFailure",t.MaxRetryCountReachedForRedirect="MaxRetryCountReachedForRedirect",t.OnRequestCreationFailureRedirect="OnRequestCreationFailureRedirect",t.OnRequestCreationSuccessRedirect="OnRequestCreationSuccessRedirect",t.ErrorDuringPolling="ErrorDuringPolling",t.HTTPRequestFailed="HTTPRequestFailed",t.HTTPRequestUnusualResponse="HTTPRequestUnusualResponse"})(kE||(kE={}));Ju.default=kE;var Qu={};Object.defineProperty(Qu,"__esModule",{value:!0});var PE;(function(t){t.INFO="INFO",t.DEBUG="DEBUG",t.WARN="WARN",t.ERROR="ERROR"})(PE||(PE={}));Qu.default=PE;var wf={};Object.defineProperty(wf,"__esModule",{value:!0});var $z=function(){function t(){}return t.OK=200,t.Created=201,t.Accepted=202,t.NoContent=204,t.Unauthorized=401,t.Forbidden=403,t.Redirect=404,t.TooManyRequests=429,t.InternalServerError=500,t.ServiceUnavailable=503,t.NotFound=729,t}();wf.default=$z;Object.defineProperty(nl,"__esModule",{value:!0});nl.HttpClient=void 0;var Wp=js,Hz=go,GP=Ju,WP=Qu,A0=ds,Bd=wf,qz=ob(),jz=function(){function t(){}return t.MakeRequest=function(e){var n=new Promise(function(r,i){function o(d,f){if(f.status>=400){var h={ResponseText:f.statusText,Status:status};t.logWarning("Requesting "+e.url,f.status,h)}e.callbackOnSuccess&&e.callbackOnSuccess(f),r(d)}function s(d){var f,h,g,E,D,w,p,b,j,K,M={ErrorThrown:d.message,ResponseText:(f=d.response)===null||f===void 0?void 0:f.statusText,Status:(h=d.response)===null||h===void 0?void 0:h.status},ne=function(){var B,q;t.logError("Request to "+e.url+" failed.",((B=d.response)===null||B===void 0?void 0:B.status)||0,M),i(new Error(((q=d.response)===null||q===void 0?void 0:q.statusText)||""))},G=function(){var B;t.logError("Request to "+e.url+" failed. Resetting endpoint.",((B=d.response)===null||B===void 0?void 0:B.status)||0,M),e.callbackOnFailure&&e.callbackOnFailure(d),i(new Error(Hz.default.Reset_Flag))},oe=function(){var B;l++;var q=e.timeBetweenRetry||0;(e.enableExponentialBackoff||((B=d.response)===null||B===void 0?void 0:B.status)===Bd.default.TooManyRequests)&&(q=q*Math.exp(l)),setTimeout(function(){u()},q)},J=(g=d.response)===null||g===void 0?void 0:g.headers[A0.default.LocationHeader],X=(E=d.response)===null||E===void 0?void 0:E.headers[A0.default.SetRegistrationTokenHeader];((D=d.response)===null||D===void 0?void 0:D.status)===Bd.default.Redirect&&!Wp.default.isNullOrEmptyString(J)?e.shouldRedirectOn404?G():l<=c?(e.url=J,oe()):ne():(((w=d.response)===null||w===void 0?void 0:w.status)===Bd.default.Unauthorized||((p=d.response)===null||p===void 0?void 0:p.status)===Bd.default.Forbidden)&&!Wp.default.isNullOrEmptyString(X)?l<=c&&e.shouldRetryOnFailure&&e.shouldRetryOnFailure(((b=d.response)===null||b===void 0?void 0:b.status)||0)?(e.headers&&(e.headers[A0.default.RegistrationTokenHeader]=Wp.default.getRegistrationTokenValue(X)),oe()):e.shouldResetOnFailure?G():ne():l<=c&&e.shouldRetryOnFailure&&e.shouldRetryOnFailure(((j=d.response)===null||j===void 0?void 0:j.status)||0)||((K=d.response)===null||K===void 0?void 0:K.status)===Bd.default.TooManyRequests?oe():e.shouldResetOnFailure?G():ne()}var l=0,c=e.retryCount||1,a={url:e.url,method:e.type,data:e.data,timeout:e.timeout,headers:e.headers,withCredentials:e.useXHRWithCredentials||!1},u=function(){qz.default.request(a).then(function(d){o(d.data,d)}).catch(function(d){s(d)})};u()});return n},t.isClientError=function(e){if(!e)return!1;var n=e.message,r=!1;return Wp.default.isNullOrEmptyString(n)||(r=n.search(/Status- 40\d/)>=-1),r},t.setLogger=function(e){t.logger=e},t.logError=function(e,n,r){t.logger&&t.logger.log(WP.default.ERROR,GP.default.HTTPRequestFailed,{Description:e,ErrorCode:n.toString(),ExceptionDetails:r})},t.logWarning=function(e,n,r){t.logger&&t.logger.log(WP.default.INFO,GP.default.HTTPRequestUnusualResponse,{Description:e,ErrorCode:n.toString(),ExceptionDetails:r})},t}();nl.HttpClient=jz;var rl={};Object.defineProperty(rl,"__esModule",{value:!0});var yc=go,Vz=ds,Kp=js,zz=function(){function t(){}return t.getV2EndpointUrl=function(e,n){return n.chatService+"/v2/users/ME/endpoints/"+e},t.getThreadUrl=function(e,n){return n.chatService+"/v1/threads/"+e+"?view=msnp24Equivalent"},t.getMessagesUrl=function(e,n){return n.chatService+"/v1/users/ME/conversations/"+e+"/messages"},t.getBotMessagesUrl=function(e,n){return n.chatService+"/v1/agents/"+e+"/invoke"},t.getAmsObjectsUrl=function(e){return Kp.default.sanitizeUrlWithBackSlash(e.ams)+"v1/objects"},t.getAmsObjectContentUrl=function(e,n,r){r===void 0&&(r=!1);var i=r?yc.default.ImageContent:yc.default.FileContent;return Kp.default.sanitizeUrlWithBackSlash(n.ams)+"v1/objects/"+e+"/content/"+i},t.getAmsObjectViewUrl=function(e,n,r){r===void 0&&(r=!1);var i=r?yc.default.ImageView:yc.default.FileView;return Kp.default.sanitizeUrlWithBackSlash(n.ams)+"v1/objects/"+e+"/views/"+i},t.getAmsStatusUrl=function(e,n,r){r===void 0&&(r=!1);var i=r?yc.default.ImageView:yc.default.FileView,o=Kp.default.sanitizeUrlWithBackSlash(n.ams)+"v1/objects/"+e+"/views/"+i+"/status";return o},t.getV1EndpointUrl=function(e){return e.chatService+"/v1/users/ME/endpoints"},t.getV1DeleteEndpointUrl=function(e,n){return e.chatService+"/v1/users/ME/endpoints/"+n},t.getV1SubscriptionUrl=function(e){return e.chatService+"/v1/users/ME/endpoints/SELF/subscriptions"},t.getV1PollUrl=function(e,n){return e.chatService+"/v1/users/ME/endpoints/SELF/subscriptions/"+n+"/poll"},t.getV1SetPropertiesUrl=function(e){return e.chatService+"/v1/users/ME/endpoints/SELF/properties?name="+Vz.default.SetEndpointProperty},t}();rl.default=zz;var ec={};Object.defineProperty(ec,"__esModule",{value:!0});var ri=go,Gz=Ef,Wz=function(){function t(){}return t.getDefaultIC3Headers=function(){return{Accept:ri.default.ContentTypeJson,BehaviorOverride:ri.default.RedirectAs404,ClientInfo:ri.default.ClientInfoValue,ContextId:"tcid="+(0,Gz.uuidv4)(),Expires:0,Pragma:ri.default.NoCache,"x-ms-client-type":ri.default.Web,"x-ms-user-type":ri.default.User}},t.getDefaultBaseIC3Headers=function(){return{Accept:ri.default.ContentTypeJson,BehaviorOverride:ri.default.RedirectAs404,"content-type":ri.default.ContentTypeJson}},t.getDefaultGetMessagesQueryParameters=function(){return{pageSize:20,startTime:0,view:"msnp24Equivalent|supportsMessageProperties"}},t.getDefaultAMSHeaders=function(e){return{Authorization:ri.default.AMSAuthorizationSkypeTokenValue+e,"X-MS-Client-Version":ri.default.ClientInfoValue}},t.getDefaultAMSViewHeaders=function(e){return{Accept:ri.default.AMSAcceptHeaderValue,"Accept-Encoding":ri.default.AMSAcceptEncodingHeaderValue,Authorization:ri.default.AMSAuthorizationSkypeTokenValue+e,"X-MS-Client-Version":ri.default.ClientInfoValue}},t}();ec.default=Wz;var gb={};Object.defineProperty(gb,"__esModule",{value:!0});var Kz=function(){function t(){}return t.read="read",t}();gb.default=Kz;var Jv={};Object.defineProperty(Jv,"__esModule",{value:!0});var OE;(function(t){t[t.Unknown=0]="Unknown",t[t.InProgress=1]="InProgress",t[t.Success=2]="Success",t[t.Error=3]="Error"})(OE||(OE={}));Jv.default=OE;var tc={},If={};Object.defineProperty(If,"__esModule",{value:!0});var ME;(function(t){t[t.AmsBasedFileSharing=0]="AmsBasedFileSharing"})(ME||(ME={}));If.default=ME;var Xu={};Object.defineProperty(Xu,"__esModule",{value:!0});var Jz=function(){function t(){}return t.RichText="RichText",t.Text="Text",t}();Xu.default=Jz;var Qv={};Object.defineProperty(Qv,"__esModule",{value:!0});var Qz=function(){function t(){}return t.Text="Text",t.RichText="RichText",t.RichTextHtml="RichText/Html",t.ControlTyping="Control/Typing",t.ControlClearTyping="Control/ClearTyping",t.LiveState="Control/LiveState",t}();Qv.default=Qz;var bf={};Object.defineProperty(bf,"__esModule",{value:!0});var DE;(function(t){t[t.Unknown=0]="Unknown",t[t.User=1]="User",t[t.Bot=2]="Bot"})(DE||(DE={}));bf.default=DE;var mb={};Object.defineProperty(mb,"__esModule",{value:!0});var NE;(function(t){t[t.Typing=0]="Typing",t[t.ClearTyping=1]="ClearTyping"})(NE||(NE={}));mb.default=NE;var rv=_e&&_e.__assign||function(){return rv=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},rv.apply(this,arguments)};Object.defineProperty(tc,"__esModule",{value:!0});var KP=go,R0=Ku,Xz=If,JP=wf,Cc=Xu,Sc=Qv,$d=Wu,k0=bf,Jp=rl,QP=mb,Xo=js,Yz=function(){function t(){}return t.createMessageData=function(e){var n=e.contentType===Cc.default.Text?Sc.default.Text:Sc.default.RichTextHtml,r=e.content,i=t.createBaseMessageData(n,e.contentType.toString(),r);return i.properties=this.getMessageProperties(e),Xo.default.isNullOrUndefined(e.sender.displayName)||(i.imdisplayname=e.sender.displayName),i},t.createBaseMessageData=function(e,n,r){var i={"Has-Mentions":"false",clientmessageid:Date.now().toString(),composetime:new Date().toISOString(),content:r,contenttype:n,messagetype:e};return i},t.getMessageProperties=function(e){var n={};if(n.deliveryMode=e.deliveryMode.toString(),e.tags){var r=[];e.tags.forEach(function(i){r.push(i)}),n.tags=r.join()}return n},t.createTypingStatusThreadMessageData=function(e,n){var r="";switch(e){case QP.default.Typing:r=Sc.default.ControlTyping;break;case QP.default.ClearTyping:r=Sc.default.ControlClearTyping;break}var i=t.createBaseMessageData(r,Cc.default.Text,"");return Xo.default.isNullOrUndefined(n)||(i=rv(rv({},n),i)),i},t.createBotMessageData=function(e,n){var r={conversation:{id:e},value:n};return JSON.stringify(r)},t.createFileMessage=function(e,n,r){var i=Sc.default.Text,o=Cc.default.Text.toString().toLowerCase(),s=t.createBaseMessageData(i,o.toString(),"");return s.amsreferences=JSON.stringify([e.id]),s.properties=JSON.stringify(this.createFileMessageProperties(e,n,r)),Xo.default.isNullOrUndefined(r.sender.displayName)||(s.imdisplayname=r.sender.displayName),s},t.createFileMessageProperties=function(e,n,r){var i={};if(i.deliveryMode=r.deliveryMode.toString(),i.files=JSON.stringify([this.createFileProperty(e,n)]),i.importance="",i.subject="",r.tags){var o=[];r.tags.forEach(function(s){o.push(s)}),i.tags=o.join()}return i},t.createFileProperty=function(e,n){var r=!!t.isDocumentTypeImage(e.type);return{"@type":"http://schema.skype.com/File",type:e.type,itemid:"",baseUrl:"",providerData:"",version:2,id:e.id,title:e.name,state:"active",objectUrl:Jp.default.getAmsObjectViewUrl(e.id,n.RegionGtms,r),fileName:e.name,fileType:t.getNameAndExtension(e.name).extension,botFileProperties:{url:Jp.default.getAmsObjectViewUrl(e.id,n.RegionGtms,r)},fileInfo:{fileUrl:Jp.default.getAmsObjectContentUrl(e.id,n.RegionGtms,r),siteUrl:"",serverRelativeUrl:""},filePreview:{previewUrl:""}}},t.getNameAndExtension=function(e){var n=(e||"").split("."),r="",i="";return n.length>1?(i=n.pop().toLowerCase(),r=n.join(".")):(i="",r=n[0]),{name:r,extension:i}},t.createIRawMessage=function(e,n,r){var i={clientmessageid:e.clientmessageid,content:e.content,contentType:t.getMessageContentType(e),deliveryMode:!Xo.default.isNullOrUndefined(e.properties)&&e.properties.deliveryMode===R0.default.Bridged?R0.default.Bridged:R0.default.Unbridged,messageType:t.getMessageType(e),properties:e.properties,sender:{displayName:e.imdisplayname,id:e.from,type:t.getPersonType(e.from)},timestamp:new Date(Date.parse(e.originalarrivaltime))};if(r&&(i.resourceType=r),!Xo.default.isNullOrUndefined(e.properties)&&!Xo.default.isNullOrEmptyString(e.properties.tags)){var o=[];o=e.properties.tags.split(","),i.tags=o}if(!Xo.default.isNullOrUndefined(e.properties)&&!Xo.default.isNullOrEmptyString(e.properties.files)){var s=[];if(s=JSON.parse(e.properties.files),s.length>0){var l=s[0].id;Xo.default.isNullOrUndefined(l)&&e.amsreferences&&(l=e.amsreferences[0]);var c=t.getFileUrl(s[0],l,n),a={fileSharingProtocolType:Xz.default.AmsBasedFileSharing,id:l,name:s[0].fileName,size:s[0].version,type:s[0].fileType,url:c};i.fileMetadata=a}}return i},t.createIRawThread=function(e){var n={id:e.id,members:e.members,messages:e.messages,properties:e.properties,rosterVersion:e.rosterVersion,type:e.type,version:e.version};return n},t.getConversationIdFromUrl=function(e){var n=e&&e.match(/\/(\d+:[^\/]*)[\/]?/);return n&&n[1]?n[1]:void 0},t.isSystemMessage=function(e){var n=!1;return Xo.default.isNullOrEmptyString(e.messagetype)||(n=t.getSystemMessageTypes().reduce(function(r,i){return r||e.messagetype.toLowerCase().indexOf(i.toLowerCase())===0},n)),n},t.getPersonType=function(e){var n=k0.default.Unknown,r=e.split("/").pop();return r.indexOf("28:")===0?n=k0.default.Bot:r.indexOf("19:")===0&&(n=k0.default.User),n},t.isImageType=function(e){switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"bmp":case"tiff":case"jfif":return!0;default:return!1}},t.getMessageType=function(e){var n;switch(e.messagetype){case $d.default.Typing:n=$d.default.Typing;break;case $d.default.ClearTyping:n=$d.default.ClearTyping;break;default:n=$d.default.UserMessage}return n},t.getMessageContentType=function(e){var n,r=e.contenttype?e.contenttype:e.messagetype;return r===Sc.default.Text.toLowerCase()||r.indexOf(KP.default.TextPlainMimeType)>=0?n=Cc.default.Text:n=Cc.default.RichText,n},t.getSystemMessageTypes=function(){return["ThreadActivity"]},t.getFileUrl=function(e,n,r){var i=e.fileInfo,o;if(i&&i.fileUrl)o=i.fileUrl;else if(n){var s=t.isImageType(e.fileType);o=Jp.default.getAmsObjectContentUrl(n,r.RegionGtms,s)}return o},t.isDocumentTypeImage=function(e){return e.indexOf(KP.default.Image)!==-1},t.getDomainRegexp=function(){return new RegExp(/^(https?:.+?\.microsoft\.com)/i)},t.parseDomain=function(e){var n=e.match(t.getDomainRegexp());return n?n[1]:null},t.parseChatServiceHostUrl=function(e){return t.parseDomain(e)},t.shouldRetryOnFailure=function(e){return e!==JP.default.Accepted&&e!==JP.default.Created},t}();tc.default=Yz;var XP=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},YP=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(pb,"__esModule",{value:!0});var ii=go,Zz=ds,Qp=Zl,P0=nl,Xp=rl,O0=ec,ZP=gb,Hd=Jv,Yp=tc,eG=function(){function t(){}return t.getDocumentTypeFromContentType=function(e){return Yp.default.isDocumentTypeImage(e)?ii.default.DocumentTypeImage:ii.default.DocumentTypeFile},t.createNewDocument=function(e,n,r){return XP(this,void 0,void 0,function(){var i,o,s,l,c,a;return YP(this,function(u){return i=(a={},a[e]=[ZP.default[ZP.default.read]],a),o={filename:n.name,permissions:i,type:t.getDocumentTypeFromContentType(n.type)},s=Xp.default.getAmsObjectsUrl(r.RegionGtms),l=O0.default.getDefaultAMSHeaders(r.SkypeToken),l[Zz.default.ContentTypeHeader]=ii.default.ContentTypeJson,c={data:JSON.stringify(o),headers:l,type:Qp.default.POST,url:s},[2,P0.HttpClient.MakeRequest(c)]})})},t.uploadDocument=function(e,n,r){return XP(this,void 0,void 0,function(){var i,o,s,l;return YP(this,function(c){return console.log("AmsHelper.ts uploadDocument(): "+e+", "+n+", "+r),i=Yp.default.isDocumentTypeImage(n.type),o=Xp.default.getAmsObjectContentUrl(e,r.RegionGtms,i),s=O0.default.getDefaultAMSHeaders(r.SkypeToken),l={data:n.data,headers:s,processData:!1,type:Qp.default.PUT,url:o},[2,P0.HttpClient.MakeRequest(l)]})})},t.getFileStatus=function(e,n){var r=Yp.default.isImageType(e.type),i=Xp.default.getAmsStatusUrl(e.id,n.RegionGtms,r);return this.getViewStatus(i,n).then(function(o){var s=o.scan&&o.scan.status===ii.default.Malware;if(s)return Hd.default.Error;if(o.view_state===ii.default.Ready)return Hd.default.Success;var l=o.scan&&o.scan.status===ii.default.InProgress;return l||o.view_state&&o.view_state!==ii.default.Failed?Hd.default.InProgress:Hd.default.Error}).catch(function(){return Promise.reject({})})},t.downloadDocument=function(e,n){var r=this,i=Yp.default.isImageType(e.type),o=Xp.default.getAmsStatusUrl(e.id,n.RegionGtms,i);return new Promise(function(s){r.getViewUri(o,n).then(function(l){var c=new Headers;c.append("Authorization","skype_token "+n.SkypeToken),c.append("X-MS-Client-Version",ii.default.ClientVersion),i&&(c.append("accept",ii.default.AMSAcceptHeaderValue),c.append("Accept-Encoding",ii.default.AMSAcceptEncodingHeaderValue));var a={headers:c,method:Qp.default.GET};return fetch(l,a).then(function(u){s(u.blob())}).catch(function(){return Promise.reject({})})})})},t.getViewUri=function(e,n){var r=this;return this.getViewStatus(e,n).then(function(i){var o=i.scan&&i.scan.status===ii.default.Malware;return!i.view_location||i.view_state===ii.default.Failed||o?Promise.reject({}):i.view_state&&i.view_state!==ii.default.Ready?r.getViewUri(e,n):i.content_state===ii.default.Expired?Promise.reject({}):Promise.resolve(i.view_location)}).catch(function(){return Promise.reject("")})},t.getViewStatus=function(e,n){var r=this;return console.log("AmsHelper.ts getViewStatus(): "+e+", "+n),new Promise(function(i){setTimeout(i,ii.default.DelayForAms)}).then(function(){var i=O0.default.getDefaultAMSViewHeaders(n.SkypeToken),o={headers:i,type:Qp.default.GET,url:e};return P0.HttpClient.MakeRequest(o).then(function(s){return s.status_location&&!s.view_state?r.getViewStatus(s.status_location,n):Promise.resolve(s)}).catch(function(s){return s.status===401||s.status===403?Promise.reject("unauthorized"):Promise.reject({})})})},t}();pb.default=eG;var vb={};Object.defineProperty(vb,"__esModule",{value:!0});var tG=function(){function t(){}return t.TEXT="text",t}();vb.default=tG;var _f={};Object.defineProperty(_f,"__esModule",{value:!0});var nG=function(){function t(){}return t.IC3V1SDK=0,t.IC3V2SDK=1,t.MockIC3SDK=2,t}();_f.default=nG;Object.defineProperty(fb,"__esModule",{value:!0});var Zp=pb,cr=go,qd=If,rG=Jv,iG=Yl,jd=nl,oG=vb,ra=ds,eg=Zl,Tc=Ju,Ec=Qu,sG=Xu,aG=Qv,lG=_f,Vd=ec,tg=rl,ur=tc,Ti=js,cG=function(){function t(e){this.hostType=iG.default.Page,this.protocolType=lG.default.IC3V1SDK,this.id=e,this.conversations=[],this.newConversationMessageListeners={},this.threadUpdateListeners={},this.internalConversationsData={},this.liveStateFailureCount=0,this.debug=!1}return t.prototype.startPolling=function(){this.ic3Initializer&&this.ic3Initializer.startPolling()},t.prototype.stopPolling=function(){this.ic3Initializer&&this.ic3Initializer.stopPolling()},t.prototype.setup=function(e){return this.logger=e.logger,jd.HttpClient.setLogger(this.logger),Promise.resolve()},t.prototype.initialize=function(e){return this.setupSession(e),Promise.resolve()},t.prototype.update=function(e){return Promise.resolve()},t.prototype.dispose=function(){return this.conversations=[],this.newConversationMessageListeners={},this.threadUpdateListeners={},this.internalConversationsData={},Promise.resolve()},t.prototype.joinConversation=function(e,n){var r;n===void 0&&(n=!0);var i=Ti.default.timer(),o={id:e},s=this.conversations.findIndex(function(l){return l.id===o.id});return s===-1&&(this.conversations.push(o),this.newConversationMessageListeners[o.id]=this.newConversationMessageListeners[o.id]||[],this.threadUpdateListeners[o.id]=this.threadUpdateListeners[o.id]||[]),(r=this.logger)===null||r===void 0||r.log(Ec.default.INFO,Tc.default.JoinConversation,{ElapsedTimeInMilliseconds:i.milliSecondsElapsed,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),!Ti.default.isNullOrUndefined(n)&&n===!0&&this.sendHeartBeat(o.id),Promise.resolve(o)},t.prototype.sendLiveState=function(e){var n=this;this.debug&&console.debug("IC3Core/sendLiveState");var r=aG.default.LiveState,i=sG.default.Text,o=ur.default.createBaseMessageData(r,i,"");return this.sendMessageToIC3(e,o).then(function(){return n.liveStateFailureCount=0,Promise.resolve()}).catch(function(s){var l;n.liveStateFailureCount++,n.liveStateFailureCount>=cr.default.liveStateRetryCount&&((l=n.logger)===null||l===void 0||l.log(Ec.default.ERROR,Tc.default.SendLiveStateFailure,{ExceptionDetails:s,EndpointUrl:n.EndpointUrl,EndpointId:n.EndpointId}),n.stopHeartBeat(),n.liveStateFailureCount=0)})},t.prototype.sendHeartBeat=function(e){this.heartBeatTimer||(this.debug&&console.debug("IC3Core/sendHeartBeat"),this.sendLiveState(e),this.heartBeatTimer=window.setInterval(this.sendLiveState.bind(this,e),cr.default.heartBeatDuration))},t.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatTimer)},t.prototype.sendMessage=function(e,n){var r=ur.default.createMessageData(n);return this.sendMessageToIC3(e.id,r)},t.prototype.getMessages=function(e){var n=this,r=Vd.default.getDefaultGetMessagesQueryParameters(),i=Ti.default.addQueryParametersToPath(tg.default.getMessagesUrl(e.id,this.ic3Info.RegionGtms),r),o=Vd.default.getDefaultIC3Headers();o[ra.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,o[ra.default.ContentTypeHeader]=cr.default.ContentTypeJson;var s={enableExponentialBackoff:!0,headers:o,redirect404RetryCount:cr.default.retryCount,retryCount:cr.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:ur.default.shouldRetryOnFailure,timeBetweenRetry:cr.default.timeBetweenOperationRetry,type:eg.default.GET,url:i};return jd.HttpClient.MakeRequest(s).then(function(l){for(var c=[],a=0,u=l.messages;a<u.length;a++){var d=u[a];ur.default.isSystemMessage(d)||c.push(ur.default.createIRawMessage(d,n.ic3Info))}return n.getAllMessagesFromBackwardLinkUrl(l._metadata.backwardLink,r.startTime,c)})},t.prototype.registerOnNewMessage=function(e,n){var r;return this.newConversationMessageListeners[e.id].push(n),(r=this.logger)===null||r===void 0||r.log(Ec.default.INFO,Tc.default.RegisterOnNewMessage,{EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),Promise.resolve()},t.prototype.registerOnThreadUpdate=function(e,n){var r;return this.threadUpdateListeners[e.id].push(n),(r=this.logger)===null||r===void 0||r.log(Ec.default.INFO,Tc.default.RegisterOnThreadUpdate,{EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),Promise.resolve()},t.prototype.disconnectFromConversation=function(e){return this.conversations.findIndex(function(n){return n.id===e.id}),delete this.internalConversationsData[e.id],this.ic3Info.visitor&&(this.stopHeartBeat(),this.stopPolling()),Promise.resolve()},t.prototype.sendFileData=function(e,n,r){var i=this;if(Ti.default.isNullOrUndefined(r)&&(r=qd.default.AmsBasedFileSharing),n.size<=0)throw new Error("File size is lesser or equal to zero.");var o={fileSharingProtocolType:r,id:"",name:n.name,size:n.size,type:n.type,url:""};return new Promise(function(s,l){Zp.default.createNewDocument(e.id,n,i.ic3Info).then(function(c){o.id=c.id;var a=ur.default.isDocumentTypeImage(n.type);o.url=tg.default.getAmsObjectContentUrl(c.id,i.ic3Info.RegionGtms,a),Zp.default.uploadDocument(c.id,n,i.ic3Info).then(function(){s(o)}).catch(function(u){l(u)})}).catch(function(c){l(c)})})},t.prototype.sendFileMessage=function(e,n,r){return this.sendMessageToIC3(e.id,ur.default.createFileMessage(n,this.ic3Info,r))},t.prototype.downloadFileData=function(e,n){var r=this;return this.debug&&console.debug("IC3Core/IC3ClientAdapter/downloadFileData"),new Promise(function(i,o){var s=n.fileSharingProtocolType;Ti.default.isNullOrUndefined(s)&&(s=qd.default.AmsBasedFileSharing),s===qd.default.AmsBasedFileSharing?Zp.default.downloadDocument(n,r.ic3Info).then(function(l){i(l)}).catch(function(l){o(l)}):o("This Protocol is not implemented")})},t.prototype.getFileStatus=function(e,n){var r=this;return new Promise(function(i,o){var s=n.fileSharingProtocolType;Ti.default.isNullOrUndefined(s)&&(s=qd.default.AmsBasedFileSharing),s===qd.default.AmsBasedFileSharing?Zp.default.getFileStatus(n,r.ic3Info).then(function(l){i(l)}).catch(function(l){o(rG.default.Error+" e")}):o("This Protocol is not implemented")})},t.prototype.indicateTypingStatus=function(e,n,r){var i=ur.default.createTypingStatusThreadMessageData(n,r);return this.sendMessageToIC3(e.id,i)},t.prototype.sendMessageToBot=function(e,n,r){var i=ur.default.createBotMessageData(e.id,r),o=tg.default.getBotMessagesUrl(n,this.ic3Info.RegionGtms),s=Vd.default.getDefaultIC3Headers();s[ra.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,s[ra.default.ContentTypeHeader]=cr.default.ContentTypeTextPlain;var l={data:i,dataType:oG.default.TEXT,enableExponentialBackoff:!0,headers:s,redirect404RetryCount:cr.default.retryCount,retryCount:cr.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:ur.default.shouldRetryOnFailure,timeBetweenRetry:cr.default.timeBetweenOperationRetry,type:eg.default.POST,url:o};return jd.HttpClient.MakeRequest(l)},t.prototype.getMembers=function(e){var n=this.internalConversationsData[e.id].members,r=[];return Ti.default.isNullOrUndefinedOrEmptyArray(n)||n.forEach(function(i){var o={displayName:i.friendlyName,id:i.id,type:ur.default.getPersonType(i.id)};r.push(o)}),Promise.resolve(r)},t.prototype.sendMessageToIC3=function(e,n){var r=tg.default.getMessagesUrl(e,this.ic3Info.RegionGtms),i=Vd.default.getDefaultIC3Headers();i[ra.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,i[ra.default.ContentTypeHeader]=cr.default.ContentTypeJson;var o={data:JSON.stringify(n),enableExponentialBackoff:!0,headers:i,redirect404RetryCount:cr.default.retryCount,retryCount:cr.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:ur.default.shouldRetryOnFailure,timeBetweenRetry:cr.default.timeBetweenOperationRetry,type:eg.default.POST,url:r};return jd.HttpClient.MakeRequest(o)},t.prototype.onNewMessage=function(e,n,r){var i=this,o,s=Ti.default.timer();try{e&&(Ti.default.isNullOrUndefined(this.newConversationMessageListeners[e.id])||ur.default.isSystemMessage(n)||this.newConversationMessageListeners[e.id].forEach(function(c){var a=ur.default.createIRawMessage(n,i.ic3Info,r);c(a)}))}catch(c){var l=s.milliSecondsElapsed;(o=this.logger)===null||o===void 0||o.log(Ec.default.ERROR,Tc.default.OnNewMessageFailure,{ExceptionDetails:c,ElapsedTimeInMilliseconds:l,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId});return}},t.prototype.onThreadUpdate=function(e,n){var r,i=Ti.default.timer();try{e&&(Ti.default.isNullOrUndefined(this.threadUpdateListeners[e.id])||this.threadUpdateListeners[e.id].forEach(function(s){var l=ur.default.createIRawThread(n);s(l)}))}catch(s){var o=i.milliSecondsElapsed;(r=this.logger)===null||r===void 0||r.log(Ec.default.ERROR,Tc.default.OnThreadUpdateFailure,{ExceptionDetails:s,ElapsedTimeInMilliseconds:o,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId});return}},t.prototype.getAllMessagesFromBackwardLinkUrl=function(e,n,r){var i=this;return Ti.default.isNullOrEmptyString(e)?Promise.resolve(r):this.getMessagesFromBackwardLinkUrl(e,n).then(function(o){for(var s=0,l=o.messages;s<l.length;s++){var c=l[s];ur.default.isSystemMessage(c)||r.push(ur.default.createIRawMessage(c,i.ic3Info))}return i.getAllMessagesFromBackwardLinkUrl(o._metadata.backwardLink,n,r)})},t.prototype.getMessagesFromBackwardLinkUrl=function(e,n){var r={startTime:n},i=Ti.default.addQueryParametersToPath(e,r),o=Vd.default.getDefaultIC3Headers();o[ra.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,o[ra.default.ContentTypeHeader]=cr.default.ContentTypeJson;var s={enableExponentialBackoff:!0,headers:o,redirect404RetryCount:cr.default.retryCount,retryCount:cr.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:ur.default.shouldRetryOnFailure,timeBetweenRetry:cr.default.timeBetweenOperationRetry,type:eg.default.GET,url:i};return jd.HttpClient.MakeRequest(s)},t.prototype.setupSession=function(e){this.ic3Info={SkypeToken:e.token,RegionGtms:e.regionGtms,visitor:e.visitor},Ti.default.isNullOrUndefined(this.ic3Info)||(this.EndpointId=this.ic3Info.endpointId,this.EndpointUrl=this.ic3Info.RegionGtms?this.ic3Info.RegionGtms.chatService:"")},t.prototype.setDebug=function(e){e===void 0&&(e=!1),this.debug=e},t}();fb.default=cG;var yb={},Cb={};Object.defineProperty(Cb,"__esModule",{value:!0});var uG=function(){function t(){}return t.ConversationProperties="/v1/users/ME/conversations/ALL/properties",t.ConversationMessages="/v1/users/ME/conversations/ALL/messages",t.Threads="/v1/threads/ALL",t.Contacts="/v1/users/ME/contacts/ALL",t}();Cb.default=uG;var Sb={};Object.defineProperty(Sb,"__esModule",{value:!0});var dG=function(){function t(){}return t.Agent="Agent",t.MessageProperties="MessageProperties",t.InviteFree="InviteFree",t}();Sb.default=dG;var Tb={},Eb={};Object.defineProperty(Eb,"__esModule",{value:!0});var ng=go,hG=nl,eO=ds,fG=Zl,pG=ec,gG=tc,mG=function(){function t(){}return t.poll=function(e,n,r){var i=pG.default.getDefaultIC3Headers();i[eO.default.RegistrationTokenHeader]=n,i[eO.default.ContentTypeHeader]=ng.default.ContentTypeJson;var o=JSON.stringify({}),s={callbackOnFailure:r,data:o,enableExponentialBackoff:!0,headers:i,redirect404RetryCount:ng.default.retryCount,retryCount:ng.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:gG.default.shouldRetryOnFailure,timeBetweenRetry:ng.default.timeBetweenOperationRetry,type:fG.default.POST,url:e};return hG.HttpClient.MakeRequest(s)},t}();Eb.default=mG;Object.defineProperty(Tb,"__esModule",{value:!0});var vG=rl,yG=Eb,CG=go,SG=function(){function t(e,n,r,i){this.isPolling=!1,this._ic3Info=e,this._onNewData=n,this._onError=r,this.callbackOnFailure=i}return t.prototype.start=function(){return this.isPolling||(this.isPolling=!0,this.startPolling()),Promise.resolve()},t.prototype.stop=function(){return this.isPolling=!1,Promise.resolve()},Object.defineProperty(t.prototype,"onNewData",{get:function(){return this._onNewData},set:function(e){this._onNewData=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"setCallbackOnFailure",{set:function(e){this.setCallbackOnFailure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ic3Info",{get:function(){return this._ic3Info},set:function(e){this._ic3Info=e},enumerable:!1,configurable:!0}),t.prototype.startPolling=function(){var e=this;this.isPolling&&this.poll().then(function(n){e.isPolling&&e._onNewData&&e._onNewData(n)}).catch(function(n){e._onError&&e._onError(n)}).then(function(){e.startPolling()})},t.prototype.poll=function(){var e=vG.default.getV1PollUrl(this._ic3Info.RegionGtms,this._ic3Info.subscriptionId);return yG.default.poll(e,this._ic3Info.RegistrationToken,this.callbackOnEachRequestCompleted.bind(this))},t.prototype.callbackOnEachRequestCompleted=function(e){this.callbackOnFailure(e,CG.default.pollRequestLog)},t}();Tb.default=SG;var tO=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},nO=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(yb,"__esModule",{value:!0});var en=go,Xn=ds,rg=Cb,M0=Sb,ig=ec,og=rl,So=js,rO=Tb,Yo=Qu,Zo=Ju,D0=wf,ms=tc,sg=nl,ag=Zl,TG=function(){function t(){this.debug=!1,this.current404RetryCount=0,this.currentOtherRetryCount=0,this.skipUnsubscribe=!1,this.telemetryMessage="",this.errorCode="",this.pollDataHandler=function(e){},this.resetRetryCount()}return t.prototype.setup=function(e){return tO(this,void 0,void 0,function(){return nO(this,function(n){return this.logger=e,[2]})})},t.prototype.getPoller=function(){var e=this.pollDataHandler.bind(this);return this.poller||(this.poller=new rO.default(this.ic3Info,e,this.redirectErrorHandler.bind(this),this.onRequestCreationFailure.bind(this))),this.poller},t.prototype.setIc3Info=function(e){return tO(this,void 0,void 0,function(){var n;return nO(this,function(r){return n={RegionGtms:JSON.parse(JSON.stringify(e.RegionGtms)),SkypeToken:e.SkypeToken,visitor:e.visitor},this.ic3Info=n,[2]})})},t.prototype.initializeIC3=function(e){var n=this,r;e&&(this.pollDataHandler=e),(r=this.logger)===null||r===void 0||r.log(Yo.default.INFO,Zo.default.IC3InitializationBegins,{Description:"Endpoint to poll is "+JSON.stringify(this.ic3Info.RegionGtms.chatService),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId});var i=this.createEndpoint().then(function(){return n.createSubscription()}).then(function(){return n.setEndpointProperty()}).then(function(){return n.startPolling(e)}).then(function(){return n.resetRetryCount()}).then(function(){return Promise.resolve(n.ic3Info)}).catch(function(o){return n.redirectErrorHandler(o)});return i},t.prototype.startPolling=function(e){var n,r=!e&&this.pollDataHandler?this.pollDataHandler.bind(this):this.pollDataHandler;this.poller||(this.poller=new rO.default(this.ic3Info,r,this.redirectErrorHandler.bind(this),this.onRequestCreationFailure.bind(this))),this.poller.ic3Info=this.ic3Info,(n=this.logger)===null||n===void 0||n.log(Yo.default.INFO,Zo.default.IC3StartedPolling,{EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.poller.start()},t.prototype.stopPolling=function(e){var n,r=e?en.default.oldInitializer:en.default.newInitializer;(n=this.logger)===null||n===void 0||n.log(Yo.default.INFO,Zo.default.IC3StoppedPolling,{Description:r+" stopped polling.",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.poller&&this.poller.stop()},t.prototype.reset=function(e){return this.stopPolling(e),this.unsubscribeFromEndpoint()},t.prototype.resetRetryCount=function(){this.current404RetryCount=0,this.currentOtherRetryCount=0},t.prototype.onEndpointCreationFailure=function(e){this.onRequestCreationFailure(e,en.default.endpointRequestLog)},t.prototype.onEndpointCreationSuccess=function(e){var n,r,i=So.default.getResponseHeader(e,Xn.default.SetRegistrationTokenHeader);So.default.isNullOrUndefined(i)||(this.ic3Info.RegistrationToken=So.default.getRegistrationTokenValue(i));var o=So.default.getResponseHeader(e,Xn.default.LocationHeader);if(!So.default.isNullOrUndefined(o)){var s=o.match(/endpoints\/(%7B[\da-z\-]+%7D)/);this.ic3Info.endpointId=s&&s[1],(n=this.logger)===null||n===void 0||n.log(Yo.default.INFO,Zo.default.IC3EndpointCreationSuccess,{Description:"IC3 endpoint Id is "+this.ic3Info.endpointId,EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),e.status===D0.default.Created&&ms.default.parseChatServiceHostUrl(o)!==this.ic3Info.RegionGtms.chatService&&(this.ic3Info.RegionGtms.chatService=ms.default.parseChatServiceHostUrl(o),(r=this.logger)===null||r===void 0||r.log(Yo.default.WARN,Zo.default.OnRequestCreationSuccessRedirect,{Description:"Endpoint changed",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}))}},t.prototype.createEndpointRequest=function(){var e=og.default.getV1EndpointUrl(this.ic3Info.RegionGtms),n=ig.default.getDefaultIC3Headers();n[Xn.default.AuthenticationHeader]=Xn.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,n[Xn.default.ContentTypeHeader]=en.default.ContentTypeJson;var r=[M0.default.Agent,M0.default.InviteFree,M0.default.MessageProperties],i={endpointFeatures:r.join(",")},o={callbackOnFailure:this.onEndpointCreationFailure.bind(this),callbackOnSuccess:this.onEndpointCreationSuccess.bind(this),data:JSON.stringify(i),enableExponentialBackoff:!0,headers:n,redirect404RetryCount:en.default.retryCount,retryCount:en.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:ms.default.shouldRetryOnFailure,timeBetweenRetry:en.default.timeBetweenOperationRetry,type:ag.default.POST,url:e};return sg.HttpClient.MakeRequest(o)},t.prototype.createEndpoint=function(){var e=this;return this.createEndpointRequest().then(function(n){return n.subscriptions&&n.subscriptions.length>0&&(e.ic3Info.subscriptionId=n.subscriptions[0].id),n})},t.prototype.onSubscriptionCreationFailure=function(e){this.onRequestCreationFailure(e,en.default.subscriptionRequestLog)},t.prototype.onSubscriptionCreationSuccess=function(e){var n,r=So.default.getResponseHeader(e,Xn.default.LocationHeader)||"";e.status===D0.default.Created&&!So.default.isNullOrUndefined(r)&&ms.default.parseChatServiceHostUrl(r)!==this.ic3Info.RegionGtms.chatService&&(this.ic3Info.RegionGtms.chatService=ms.default.parseChatServiceHostUrl(r),(n=this.logger)===null||n===void 0||n.log(Yo.default.WARN,Zo.default.OnRequestCreationSuccessRedirect,{Description:"Endpoint changed",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}));var i=r.match(/\/(\d+)$/);i&&(this.ic3Info.subscriptionId=i[1])},t.prototype.createSubscriptionRequest=function(){var e=og.default.getV1SubscriptionUrl(this.ic3Info.RegionGtms),n=ig.default.getDefaultIC3Headers();n[Xn.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,n[Xn.default.ContentTypeHeader]=en.default.ContentTypeJson;var r={channelType:en.default.HttpLongPoll,interestedResources:[rg.default.ConversationMessages,rg.default.ConversationProperties,rg.default.Threads,rg.default.Contacts]},i={callbackOnFailure:this.onSubscriptionCreationFailure.bind(this),callbackOnSuccess:this.onSubscriptionCreationSuccess.bind(this),data:JSON.stringify(r),enableExponentialBackoff:!0,headers:n,redirect404RetryCount:en.default.retryCount,retryCount:en.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:ms.default.shouldRetryOnFailure,timeBetweenRetry:en.default.timeBetweenOperationRetry,type:ag.default.POST,url:e};return sg.HttpClient.MakeRequest(i)},t.prototype.createSubscription=function(){return this.createSubscriptionRequest()},t.prototype.onSetEndpointPropertyCreationFailure=function(e){this.onRequestCreationFailure(e,en.default.setPropertiesRequestLog)},t.prototype.setEndpointProperty=function(){if(this.ic3Info.visitor)return Promise.resolve();var e=og.default.getV1SetPropertiesUrl(this.ic3Info.RegionGtms),n={},r=Xn.default.SetEndpointProperty;n[r]=!0;var i=ig.default.getDefaultIC3Headers();i[Xn.default.AuthenticationHeader]=Xn.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,i[Xn.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,i[Xn.default.ContentTypeHeader]=en.default.ContentTypeJson;var o={callbackOnFailure:this.onSetEndpointPropertyCreationFailure.bind(this),data:JSON.stringify(n),enableExponentialBackoff:!0,headers:i,redirect404RetryCount:en.default.retryCount,retryCount:en.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:ms.default.shouldRetryOnFailure,timeBetweenRetry:en.default.timeBetweenOperationRetry,type:ag.default.PUT,url:e};return sg.HttpClient.MakeRequest(o)},t.prototype.onUnsubscribeCreationFailure=function(e){this.onRequestCreationFailure(e,en.default.unsubscribeRequestLog)},t.prototype.unsubscribeFromEndpoint=function(){if(this.ic3Info.visitor||So.default.isNullOrUndefined(this.ic3Info.endpointId)||this.skipUnsubscribe)return this.skipUnsubscribe=!0,Promise.resolve();var e=og.default.getV1DeleteEndpointUrl(this.ic3Info.RegionGtms,this.ic3Info.endpointId),n=ig.default.getDefaultIC3Headers();n[Xn.default.AuthenticationHeader]=Xn.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,n[Xn.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,n[Xn.default.ContentTypeHeader]=en.default.ContentTypeJson;var r={callbackOnFailure:this.onUnsubscribeCreationFailure.bind(this),enableExponentialBackoff:!0,headers:n,redirect404RetryCount:en.default.retryCount,retryCount:en.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:ms.default.shouldRetryOnFailure,timeBetweenRetry:en.default.timeBetweenOperationRetry,type:ag.default.DELETE,url:e};return sg.HttpClient.MakeRequest(r)},t.prototype.onRequestCreationFailure=function(e,n){var r,i,o=So.default.getResponseHeader(e,Xn.default.LocationHeader);this.telemetryMessage=n+" failed. Error Code: "+e.status+".",this.errorCode=e.status.toString(),this.skipUnsubscribe=!0,e.status===D0.default.Redirect&&!So.default.isNullOrEmptyString(o)?((r=this.logger)===null||r===void 0||r.log(Yo.default.WARN,Zo.default.RedirectOnRequestCreationFailure,{Description:this.telemetryMessage+" Trying to redirect.",ErrorCode:e.status.toString(),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.onRequestCreationFailureRedirect(e)):((i=this.logger)===null||i===void 0||i.log(Yo.default.WARN,Zo.default.ResetOnRequestCreationFailure,{Description:this.telemetryMessage+" Trying to reset.",ErrorCode:e.status.toString(),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.current404RetryCount=0,this.currentOtherRetryCount++)},t.prototype.redirectErrorHandler=function(e){var n=this,r;return e.message===en.default.Reset_Flag&&this.current404RetryCount<=en.default.retry404Count&&this.currentOtherRetryCount<=en.default.retryCount?this.reset().then(function(){return n.initializeIC3()}):((r=this.logger)===null||r===void 0||r.log(Yo.default.ERROR,Zo.default.MaxRetryCountReachedForRedirect,{Description:"Fatal Error. Initialization failed. Maximum retry count reached. Exiting. "+this.telemetryMessage,ErrorCode:this.errorCode,ExceptionDetails:e,EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.reset().then(function(){return Promise.reject(e.message)}))},t.prototype.onRequestCreationFailureRedirect=function(e){var n;this.current404RetryCount++,this.currentOtherRetryCount=0,this.ic3Info.RegionGtms.chatService=ms.default.parseChatServiceHostUrl(So.default.getResponseHeader(e,Xn.default.LocationHeader)),(n=this.logger)===null||n===void 0||n.log(Yo.default.WARN,Zo.default.OnRequestCreationFailureRedirect,{Description:"Endpoint changed.",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId})},t}();yb.default=TG;var wb={};Object.defineProperty(wb,"__esModule",{value:!0});var EG=function(){function t(){}return t.NewMessage="NewMessage",t.MessageUpdate="MessageUpdate",t.UserPresence="UserPresence",t.ConversationUpdate="ConversationUpdate",t.ThreadUpdate="ThreadUpdate",t}();wb.default=EG;var wG=_e&&_e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),iO=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},oO=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(hb,"__esModule",{value:!0});var To=go,sO=ds,aO=Zl,IG=fb,lO=yb,N0=Ju,cO=nl,x0=Qu,bG=_f,uO=ec,wc=wb,_G=rl,Ic=tc,L0=js,AG=function(t){wG(e,t);function e(n,r){var i=t.call(this,n)||this;return i.debug&&console.debug("IC3Core/Constructor"),i.protocolType=bG.default.IC3V1SDK,i.hostType=r,i.ic3Initializer=new lO.default,i}return e.prototype.startPolling=function(){t.prototype.startPolling.call(this)},e.prototype.stopPolling=function(){t.prototype.stopPolling.call(this)},e.prototype.setup=function(n){return t.prototype.setup.call(this,n)},e.prototype.initialize=function(n){var r=this;return t.prototype.initialize.call(this,n).then(function(){var i=function(){var o;return(o=r.ic3Initializer)===null||o===void 0?void 0:o.setup(r.logger).then(function(){return r.setSkypeTokenCookie()}).then(function(){var s;return(s=r.ic3Initializer)===null||s===void 0?void 0:s.setIc3Info(r.ic3Info)}).then(function(){var s;return(s=r.ic3Initializer)===null||s===void 0?void 0:s.initializeIC3(r.handlePollData.bind(r))}).then(function(s){r.ic3Info=s})};return i()})},e.prototype.update=function(n){var r=this;return t.prototype.update.call(this,n).then(function(){var i=function(){var o={RegionGtms:n.regionGtms,SkypeToken:n.token,visitor:n.visitor};return r.updateToken(o)};return i()})},e.prototype.dispose=function(){var n;return iO(this,void 0,void 0,function(){return oO(this,function(r){return(n=this.ic3Initializer)===null||n===void 0||n.stopPolling(),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),Promise.resolve(),[2]})})},e.prototype.joinConversation=function(n,r){var i=this,o=L0.default.timer();return t.prototype.joinConversation.call(this,n,r).then(function(s){return i.getThreadRequest(s.id).then(function(l){return i.internalConversationsData[s.id]={id:n,members:l.members},s}).catch(function(l){var c=o.milliSecondsElapsed;return i.logger&&i.logger.log(x0.default.WARN,N0.default.JoinConversationV1GetThreadRequestFailed,{Description:"Unable to retrieve thread: "+l,ElapsedTimeInMilliseconds:c,EndpointUrl:i.EndpointUrl,EndpointId:i.ic3Info.endpointId}),i.internalConversationsData[s.id]={id:n,members:[]},s})})},e.prototype.sendMessage=function(n,r){return t.prototype.sendMessage.call(this,n,r)},e.prototype.sendFileMessage=function(n,r,i){return t.prototype.sendFileMessage.call(this,n,r,i)},e.prototype.getMessages=function(n){return t.prototype.getMessages.call(this,n)},e.prototype.registerOnNewMessage=function(n,r){return t.prototype.registerOnNewMessage.call(this,n,r)},e.prototype.registerOnThreadUpdate=function(n,r){return t.prototype.registerOnThreadUpdate.call(this,n,r)},e.prototype.disconnectFromConversation=function(n){return t.prototype.disconnectFromConversation.call(this,n)},e.prototype.setSkypeTokenCookie=function(){var n=this.ic3Info.RegionGtms.ams.concat(To.default.skypeTokenAuthURL),r=uO.default.getDefaultBaseIC3Headers();r[sO.default.ContentTypeHeader]=To.default.ContentTypeForm;var i=To.default.skypeTokenConstantForData+this.ic3Info.SkypeToken,o={data:i,enableExponentialBackoff:!0,useXHRWithCredentials:!0,headers:r,redirect404RetryCount:To.default.retryCount,retryCount:To.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:Ic.default.shouldRetryOnFailure,timeBetweenRetry:To.default.timeBetweenOperationRetry,type:aO.default.POST,url:n};return cO.HttpClient.MakeRequest(o)},e.prototype.getThreadRequest=function(n){var r=_G.default.getThreadUrl(n,this.ic3Info.RegionGtms),i=uO.default.getDefaultBaseIC3Headers();i[sO.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken;var o={enableExponentialBackoff:!0,headers:i,redirect404RetryCount:To.default.retryCount,retryCount:To.default.retryCount,shouldRedirectOn404:!0,shouldRetryOnFailure:Ic.default.shouldRetryOnFailure,timeBetweenRetry:To.default.timeBetweenOperationRetry,type:aO.default.GET,url:r};return cO.HttpClient.MakeRequest(o)},e.prototype.newMessageReceived=function(n,r,i){t.prototype.onNewMessage.call(this,n,r,i)},e.prototype.newThreadUpdate=function(n,r){t.prototype.onThreadUpdate.call(this,n,r)},e.prototype.handleNewMessageEvent=function(n){var r;n.resource&&n.resource.conversationid?r=n.resource.conversationid:n.resource.conversationLink?r=Ic.default.getConversationIdFromUrl(n.resource.conversationLink):r=Ic.default.getConversationIdFromUrl(n.resourceLink);var i=this.conversations.findIndex(function(s){return s.id===r}),o=this.conversations[i];this.newMessageReceived(o,n.resource,n.resourceType)},e.prototype.handleConversationUpdateEvent=function(n){n.resourceType,wc.default.ConversationUpdate},e.prototype.handleThreadUpdate=function(n){if(n.resourceType===wc.default.ThreadUpdate){var r;n.resource&&n.resource.id?r=n.resource.id:n.resource.messages?r=Ic.default.getConversationIdFromUrl(n.resource.messages):r=Ic.default.getConversationIdFromUrl(n.resourceLink);var i=this.conversations.findIndex(function(s){return s.id===r}),o=this.conversations[i];this.newThreadUpdate(o,n.resource)}},e.prototype.handlePollData=function(n){if(!(!n||!n.eventMessages))for(var r=0,i=n.eventMessages;r<i.length;r++){var o=i[r];this.handlePollEventMessage(o)}},e.prototype.handlePollEventMessage=function(n){n.resourceType===wc.default.NewMessage||n.resourceType===wc.default.MessageUpdate?this.handleNewMessageEvent(n):n.resourceType===wc.default.ThreadUpdate?this.handleThreadUpdate(n):n.resourceType===wc.default.ConversationUpdate&&this.handleConversationUpdateEvent(n)},e.prototype.updateToken=function(n){return iO(this,void 0,void 0,function(){var r,i,o,s,l,c,a,u,d,f,h,g=this;return oO(this,function(E){switch(E.label){case 0:return this.logger&&this.logger.log(x0.default.INFO,N0.default.UpdateToken,{EndpointUrl:this.EndpointUrl,EndpointId:this.ic3Info.endpointId}),r=[],i=function(D){D&&D.eventMessages&&L0.default.concatArrays(r,D.eventMessages)},o=[],s=function(D){D&&D.eventMessages&&L0.default.concatArrays(o,D.eventMessages)},l=this.ic3Initializer,c=new lO.default,a=this.updateTokenClearTimeoutHandle,u=this.ic3Info,l.getPoller().onNewData=i,this.logger?[4,c.setup(this.logger)]:[3,2];case 1:E.sent(),E.label=2;case 2:return h=c.setIc3Info(n).then(function(){return c.initializeIC3(s)}).then(function(D){d=D}).then(function(){return g.getMatchingIC3EventIndex(r,o)}).then(function(D){f=D}).then(function(){return l.reset(!0)}).then(function(){return g.syncPollingData(r,o,f)}).then(function(){g.ic3Info=d,g.ic3Initializer=c,g.ic3Initializer.getPoller().onNewData=g.handlePollData.bind(g)}).catch(function(D){throw g.updateTokenClearTimeoutHandle!==a&&(clearTimeout(g.updateTokenClearTimeoutHandle),g.updateTokenClearTimeoutHandle=a),g.ic3Info=u,g.ic3Initializer.getPoller().onNewData=g.handlePollData.bind(g),g.ic3Initializer.getPoller().start(),new Error("Update token failed: "+(D&&D.message))}),[2,h]}})})},e.prototype.getMatchingIC3EventIndex=function(n,r,i){var o=this;return new Promise(function(s,l){if(i=i||0,i===To.default.stabilizePollMaxRetryCount)s({newPollIndex:-1,previousPollIndex:-1});else{for(var c=0,a=0;c<n.length&&a<r.length;){var u=n[c],d=r[a];if(u.time===d.time){s({newPollIndex:a,previousPollIndex:c});return}else new Date(u.time)<new Date(u.time)?c++:a++}setTimeout(function(){o.getMatchingIC3EventIndex(n,r,i+1).then(function(f){s(f)}).catch(function(f){l(f)})},To.default.timeBetweenStabilizingPoll)}})},e.prototype.syncPollingData=function(n,r,i){this.logger&&this.logger.log(x0.default.INFO,N0.default.SyncingPollData,{EndpointUrl:this.EndpointUrl,EndpointId:this.ic3Info.endpointId});var o=i.previousPollIndex,s=i.newPollIndex+1;i.previousPollIndex===-1&&i.newPollIndex===-1&&(o=n.length-1,s=0);for(var l=0;l<=o;l++)this.handlePollEventMessage(n[l]);for(var l=s;l<r.length;l++)this.handlePollEventMessage(r[l])},e}(IG.default);hb.default=AG;var RG=_e&&_e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),dO=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},hO=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(ub,"__esModule",{value:!0});var kG=db,PG=Yl,OG=hb,MG=function(t){RG(e,t);function e(n){var r=t.call(this,n)||this;return r.hostType=PG.default.Page,r.protocolAdapter=new OG.default("",r.hostType),r}return e.prototype.setup=function(n){return Promise.resolve()},e.prototype.update=function(n){return Promise.resolve()},e.prototype.onRegisterOnNewMessage=function(n){return Promise.resolve()},e.prototype.onRegisterOnThreadUpdate=function(n){return Promise.resolve()},e.prototype.initialize=function(n){return this.protocolAdapter.initialize(n)},e.prototype.dispose=function(){return this.protocolAdapter.dispose()},e.prototype.sendMessage=function(n,r){return this.protocolAdapter.sendMessage(n,r)},e.prototype.sendFileMessage=function(n,r,i){return this.protocolAdapter.sendFileMessage(n,r,i)},e.prototype.getMessages=function(n){return this.protocolAdapter.getMessages(n)},e.prototype.disconnectFromConversation=function(n){return this.protocolAdapter.disconnectFromConversation(n)},e.prototype.onJoinConversation=function(n,r){return this.protocolAdapter.joinConversation(n,r)},e.prototype.sendFileData=function(n,r,i){return this.protocolAdapter.sendFileData(n,r,i)},e.prototype.downloadFileData=function(n,r){return this.protocolAdapter.downloadFileData(n,r)},e.prototype.getFileStatus=function(n,r){return this.protocolAdapter.getFileStatus(n,r)},e.prototype.indicateTypingStatus=function(n,r,i){return this.protocolAdapter.indicateTypingStatus(n,r,i)},e.prototype.sendMessageToBot=function(n,r,i){return this.protocolAdapter.sendMessageToBot(n,r,i)},e.prototype.getMembers=function(n){return this.protocolAdapter.getMembers(n)},e.prototype.registerOnNewMessage=function(n,r){return dO(this,void 0,void 0,function(){return hO(this,function(i){return this.protocolAdapter.registerOnNewMessage(n,r),[2,Promise.resolve()]})})},e.prototype.registerOnThreadUpdate=function(n,r){return dO(this,void 0,void 0,function(){return hO(this,function(i){return this.protocolAdapter.registerOnThreadUpdate(n,r),[2,Promise.resolve()]})})},e.prototype.setDebug=function(n){n===void 0&&(n=!1),this.protocolAdapter.setDebug(n)},e}(kG.default);ub.default=MG;Object.defineProperty(cb,"__esModule",{value:!0});var DG=ub,fO=Yl,NG=function(){function t(){}return t.getClientBridge=function(e){switch(e.hostType){case fO.default.IFrame:throw new Error("Framed bridge not implemented for "+e.hostType+" in IC3Core");case fO.default.Page:return new DG.default(e.protocolType);default:throw new Error("Client bridge not implemented for "+e.hostType+" in IC3Core")}},t}();cb.default=NG;var Ib={},bb={};Object.defineProperty(bb,"__esModule",{value:!0});var xG=function(){function t(){}return t.getTelemetryEventData=function(e,n,r){var i={Description:r.Description,ElapsedTimeInMilliseconds:r.ElapsedTimeInMilliseconds,EndpointUrl:r.EndpointUrl,EndpointId:r.EndpointId,ErrorCode:r.ErrorCode,Event:n,ExceptionDetails:r.ExceptionDetails,ShouldBubbleToHost:r.ShouldBubbleToHost,SubscriptionId:e.id};return i},t}();bb.default=xG;Object.defineProperty(Ib,"__esModule",{value:!0});var LG=js,UG=bb,FG=function(){function t(e,n){this.sdk=e,this.logger=n}return t.prototype.log=function(e,n,r){if(this.isLoggingEnabled()){var i=UG.default.getTelemetryEventData(this.sdk,n,r);this.logEvent(e,i)}},t.prototype.logEvent=function(e,n){this.isLoggingEnabled()&&setTimeout(this.logger.logClientSdkTelemetryEvent.bind(this.logger),0,e,n)},t.prototype.isLoggingEnabled=function(){return!LG.default.isNullOrUndefined(this.logger)},t}();Ib.default=FG;Object.defineProperty(lb,"__esModule",{value:!0});var BG=cb,$G=Ib,HG=function(){function t(){}return t.getSDK=function(e){return new Promise(function(n){var r={hostType:e.hostType,protocolType:e.protocolType},i=BG.default.getClientBridge(r),o={logger:new $G.default(i,e.logger)};return i.setup(o).then(function(){var s={dispose:i.dispose.bind(i),id:i.id,initialize:i.initialize.bind(i),joinConversation:i.joinConversation.bind(i),update:i.update.bind(i),setDebug:i.setDebug.bind(i)};return n(s)})})},t}();lb.default=HG;Object.defineProperty(Tf,"__esModule",{value:!0});Tf.SDKProvider=void 0;var qG=lb;Tf.SDKProvider=qG.default;var _b={},tn={},Ab={};(function(t){var e=_e&&_e.__spreadArray||function(f,h,g){if(g||arguments.length===2)for(var E=0,D=h.length,w;E<D;E++)(w||!(E in h))&&(w||(w=Array.prototype.slice.call(h,0,E)),w[E]=h[E]);return f.concat(w||Array.prototype.slice.call(h))};Object.defineProperty(t,"__esModule",{value:!0}),t.setChatId=t.setDebugDetailed=t.setDebug=t.setRequestId=t.setRuntimeId=t.useTelemetry=t._exceptionDetailPIIKeys=t._basePIIKeys=void 0,t.redactPII=d;var n=tl;t._basePIIKeys=["senderDisplayName","message","content","fileName"].map(function(f){return f.toLowerCase()}),t._exceptionDetailPIIKeys=e(e([],t._basePIIKeys,!0),["authorization"],!1);var r=[],i=function(f,h,g,E,D,w,p){p===void 0&&(p=null),h.useTelemetry(f),g.useTelemetry(f),E.useTelemetry(f),D.useTelemetry(f),w.useTelemetry(f),p==null||p.useTelemetry(f)};t.useTelemetry=i;var o=function(f,h,g,E,D,w,p){p===void 0&&(p=null),h.setRuntimeId(f),g.setRuntimeId(f),E.setRuntimeId(f),D.setRuntimeId(f),w.setRuntimeId(f),p==null||p.setRuntimeId(f)};t.setRuntimeId=o;var s=function(f,h,g,E,D,w,p){p===void 0&&(p=null),h==null||h.setRequestId(f),g==null||g.setRequestId(f),E==null||E.setRequestId(f),D==null||D.setRequestId(f),w==null||w.setRequestId(f),p==null||p.setRequestId(f)};t.setRequestId=s;var l=function(f,h,g,E,D,w,p){p===void 0&&(p=null),h==null||h.setDebug(f),g==null||g.setDebug(f),E==null||E.setDebug(f),D==null||D.setDebug(f),w==null||w.setDebug(f),p==null||p.setDebug(f)};t.setDebug=l;var c=function(f,h,g,E,D,w,p,b){E==null||E.setDebug(f),p==null||p.setDebug(f),D==null||D.setDebug(h),w==null||w.setDebug(h),b==null||b.setDebug(g)};t.setDebugDetailed=c;var a=function(f,h,g,E,D,w,p){p===void 0&&(p=null),h==null||h.setChatId(f),g==null||g.setChatId(f),E==null||E.setChatId(f),D==null||D.setChatId(f),w==null||w.setChatId(f),p==null||p.setChatId(f)};t.setChatId=a;function u(f){for(var h=0,g=r;h<g.length;h++){var E=g[h];if(f.toLowerCase().includes(E.toLowerCase()))return E}}function d(f,h,g,E){if(h===void 0&&(h=!1),g===void 0&&(g=!0),E===void 0&&(E=t._basePIIKeys),f==null)return f;if(typeof f=="boolean")return{result:f};if(typeof f=="string")if((0,n.isJsonObject)(f))f=JSON.parse(f);else{var D=u(f);D&&f.length>1&&(f="".concat(D,":").concat(f.slice(0,1),"**").concat(f.length-1," hidden**"))}if(f&&typeof f=="object")try{var w=void 0;g?w=JSON.parse(JSON.stringify(f)):w=f;for(var p=0,b=Object.entries(w);p<b.length;p++){var j=b[p],K=j[0],M=j[1],ne=K.toLowerCase();if(h||E.includes(ne))typeof M=="string"?(0,n.isJsonObject)(M)?w[K]=d(JSON.parse(M),!0,!1,E):M.length>1&&(w[K]=M.slice(0,1)+"**".concat(M.length-1," hidden**")):typeof M=="object"&&d(M,!0,!1,E);else if(typeof M=="object")d(M,h,!1,E);else if(typeof M=="string")if((0,n.isJsonObject)(M))w[K]=d(JSON.parse(M),h,!1,E);else{var D=u(M);D&&M.length>1&&(w[K]="".concat(K,":").concat(D,":")+M.slice(0,1)+"**".concat(M.length-1," hidden**"))}}return w}catch(G){return{error:G,keys:Object.keys(f)}}return f}t.default={useTelemetry:t.useTelemetry,setRuntimeId:t.setRuntimeId,setRequestId:t.setRequestId,setDebug:t.setDebug,setDebugDetailed:t.setDebugDetailed,setChatId:t.setChatId,redactPII:d}})(Ab);var Af={};Object.defineProperty(Af,"__esModule",{value:!0});var xE;(function(t){t.INFO="INFO",t.DEBUG="DEBUG",t.WARN="WARN",t.ERROR="ERROR",t.LOG="LOG"})(xE||(xE={}));Af.default=xE;var Xv={},Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});Pa.failEvent=Pa.completeEvent=Pa.startEvent=void 0;var jG=function(t){return"".concat(t,"Started")};Pa.startEvent=jG;var VG=function(t){return"".concat(t,"Completed")};Pa.completeEvent=VG;var zG=function(t){return"".concat(t,"Failed")};Pa.failEvent=zG;var Rf={};Object.defineProperty(Rf,"__esModule",{value:!0});var LE;(function(t){t.EVENTS="occhatsdk_events",t.IC3CLIENT="occhatsdk_ic3clientevents",t.OCSDK="occhatsdk_ocsdkevents",t.ACSCLIENT="occhatsdk_acsclientevents",t.ACSADAPTER="occhatsdk_acsadapterevents",t.CALLINGSDK="occhatsdk_callingsdkevents",t.AMSCLIENT="occhatsdk_amsclientevents",t.UNDEFINED="undefined"})(LE||(LE={}));Rf.default=LE;var Rb={};Object.defineProperty(Rb,"__esModule",{value:!0});var GG=function(){function t(){}return t.prototype.start=function(){this.timeStart=new Date().getTime()},t.prototype.stop=function(){return new Date().getTime()-this.timeStart},t}();Rb.default=GG;var Yc=_e&&_e.__assign||function(){return Yc=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Yc.apply(this,arguments)};Object.defineProperty(Xv,"__esModule",{value:!0});var U0=Pa,WG=Rf,KG=Rb,JG=function(){function t(e){this.omnichannelConfig=e,this.runtimeId="",this.telemetry=null,this.debug=!1,this.telemetryEvents=new Map,this.scenarioType=WG.default.EVENTS}return t.prototype.setDebug=function(e){var n;this.debug=e,(n=this.telemetry)===null||n===void 0||n.setDebug(e)},t.prototype.setScenarioType=function(e){this.scenarioType=e},t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.useTelemetry=function(e){this.debug&&console.log("[ScenarioMarker][useTelemetry]"),this.telemetry=e},t.prototype.startScenario=function(e,n){var r;if(n===void 0&&(n={}),this.debug&&console.log("[ScenarioMarker][startScenario]"),!this.telemetryEvents.has(e)){var i=new KG.default;i.start(),this.telemetryEvents.set(e,i)}var o=Yc({ChatSDKRuntimeId:this.runtimeId,Event:(0,U0.startEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId},n);(r=this.telemetry)===null||r===void 0||r.info(o,this.scenarioType)},t.prototype.singleRecord=function(e,n){var r,i=Yc({ChatSDKRuntimeId:this.runtimeId,Event:e,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId},n);(r=this.telemetry)===null||r===void 0||r.info(i,this.scenarioType)},t.prototype.failScenario=function(e,n){var r;if(n===void 0&&(n={}),this.debug&&console.log("[ScenarioMarker][failScenario]"),!this.telemetryEvents.has(e)){console.warn("'".concat(e,"' event has not started."));return}var i=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var o=Yc({ChatSDKRuntimeId:this.runtimeId,Event:(0,U0.failEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,ElapsedTimeInMilliseconds:i.stop()},n);(r=this.telemetry)===null||r===void 0||r.error(o,this.scenarioType)},t.prototype.completeScenario=function(e,n){var r;if(n===void 0&&(n={}),this.debug&&console.log("[ScenarioMarker][completeScenario]"),!this.telemetryEvents.has(e)){console.warn("'".concat(e,"' event has not started."));return}var i=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var o=Yc({ChatSDKRuntimeId:this.runtimeId,Event:(0,U0.completeEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,ElapsedTimeInMilliseconds:i.stop()},n);(r=this.telemetry)===null||r===void 0||r.info(o,this.scenarioType)},t}();Xv.default=JG;var Je=_e&&_e.__assign||function(){return Je=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Je.apply(this,arguments)};Object.defineProperty(tn,"__esModule",{value:!0});tn.createAMSClientLogger=tn.createCallingSDKLogger=tn.createACSAdapterLogger=tn.createACSClientLogger=tn.createOCSDKLogger=tn.createIC3ClientLogger=tn.AMSClientLogger=tn.CallingSDKLogger=tn.ACSAdapterLogger=tn.ACSClientLogger=tn.OCSDKLogger=tn.IC3ClientLogger=void 0;var ia=Ab,dn=Af,$U=Xv,rn=Rf,HU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){this.debug&&console.log("[IC3ClientLogger][useTelemetry]"),this.telemetry=e},t.prototype.logClientSdkTelemetryEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[IC3ClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},c=Je(Je({},n),{ExceptionDetails:n.ExceptionDetails?JSON.stringify(n.ExceptionDetails):""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.IC3CLIENT);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.IC3CLIENT);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.IC3CLIENT);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.IC3CLIENT);break}},t}();tn.IC3ClientLogger=HU;var qU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){this.debug&&console.log("[OCSDKLogger][useTelemetry]"),this.telemetry=e},t.prototype.logClientSdkTelemetryEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[OCSDKLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},c=Je(Je({},n),{RequestHeaders:n.RequestHeaders?JSON.stringify(n.RequestHeaders):"",RequestPayload:n.RequestPayload?JSON.stringify(n.RequestPayload):"",ExceptionDetails:n.ExceptionDetails?JSON.stringify(n.ExceptionDetails):""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.OCSDK);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.OCSDK);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.OCSDK);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.OCSDK);break}},t}();tn.OCSDKLogger=qU;var jU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.scenarioMarker=null,this.debug=!1,this.scenarioMarker=new $U.default(e),this.scenarioMarker.setScenarioType(rn.default.ACSCLIENT)}return t.prototype.setDebug=function(e){var n;this.debug=e,(n=this.scenarioMarker)===null||n===void 0||n.setDebug(e)},t.prototype.setRuntimeId=function(e){var n;this.runtimeId=e,(n=this.scenarioMarker)===null||n===void 0||n.setRuntimeId(e)},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){var n;this.debug&&console.log("[ACSClientLogger][useTelemetry]"),this.telemetry=e,(n=this.scenarioMarker)===null||n===void 0||n.useTelemetry(this.telemetry)},t.prototype.logClientSdkTelemetryEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[ACSClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},c=Je(Je({},n),{ExceptionDetails:n.ExceptionDetails?JSON.stringify(n.ExceptionDetails):""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.ACSCLIENT);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.ACSCLIENT);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.ACSCLIENT);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.ACSCLIENT);break}},t.prototype.startScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};(r=this.scenarioMarker)===null||r===void 0||r.startScenario(e,Je(Je({},i),n))},t.prototype.failScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};(r=this.scenarioMarker)===null||r===void 0||r.failScenario(e,Je(Je({},i),n))},t.prototype.completeScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};(r=this.scenarioMarker)===null||r===void 0||r.completeScenario(e,Je(Je({},i),n))},t.prototype.recordIndividualEvent=function(e,n,r){var i,o={RequestId:this.requestId,ChatId:this.chatId,CustomProperties:JSON.stringify(r),Source:n};(i=this.scenarioMarker)===null||i===void 0||i.singleRecord(e,Je({},o))},t}();tn.ACSClientLogger=jU;var VU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.scenarioMarker=null,this.debug=!1,this.scenarioMarker=new $U.default(e),this.scenarioMarker.setScenarioType(rn.default.ACSADAPTER)}return t.prototype.setDebug=function(e){var n;this.debug=e,(n=this.scenarioMarker)===null||n===void 0||n.setDebug(e)},t.prototype.setRuntimeId=function(e){var n;this.runtimeId=e,(n=this.scenarioMarker)===null||n===void 0||n.setRuntimeId(this.runtimeId)},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){var n;this.debug&&console.log("[ACSAdapterLogger][useTelemetry]"),this.telemetry=e,(n=this.scenarioMarker)===null||n===void 0||n.useTelemetry(this.telemetry)},t.prototype.logEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[ACSAdapterLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId};n.CustomProperties&&(n.CustomProperties=JSON.stringify((0,ia.redactPII)(n.CustomProperties,!1))),n.ExceptionDetails&&(n.ExceptionDetails=JSON.stringify((0,ia.redactPII)(n.ExceptionDetails,!1,!0,ia._exceptionDetailPIIKeys))),n.Description&&(n.Description=JSON.stringify((0,ia.redactPII)(n.Description,!1,!0)));var c=Je(Je({},n),{ExceptionDetails:n.ExceptionDetails||""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.ACSADAPTER);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.ACSADAPTER);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.ACSADAPTER);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.ACSADAPTER);break}},t.prototype.startScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};(r=this.scenarioMarker)===null||r===void 0||r.startScenario(e,Je(Je({},i),n))},t.prototype.failScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};if(n.CustomProperties&&(n.CustomProperties=JSON.stringify((0,ia.redactPII)(n.CustomProperties,!1))),n.ExceptionDetails){var o=n.ExceptionDetails;o instanceof Error&&(o=Je(Je({},o),{name:o.name,message:o.message})),n.ExceptionDetails=JSON.stringify((0,ia.redactPII)(o,!1,!0,ia._exceptionDetailPIIKeys))}n.Description&&(n.Description=JSON.stringify((0,ia.redactPII)(n.Description,!1,!0))),(r=this.scenarioMarker)===null||r===void 0||r.failScenario(e,Je(Je({},i),n))},t.prototype.completeScenario=function(e,n){var r;n===void 0&&(n={});var i={RequestId:this.requestId,ChatId:this.chatId};(r=this.scenarioMarker)===null||r===void 0||r.completeScenario(e,Je(Je({},i),n))},t}();tn.ACSAdapterLogger=VU;var zU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){this.debug&&console.log("[CallingSDKLogger][useTelemetry]"),this.telemetry=e},t.prototype.logScenarioOperation=function(e,n,r,i,o,s){},t.prototype.logCallingSdkTelemetryEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[CallingSDKLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},c=Je(Je({},n),{ExceptionDetails:n.ExceptionDetails?JSON.stringify(n.ExceptionDetails):""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.CALLINGSDK);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.CALLINGSDK);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.CALLINGSDK);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.CALLINGSDK);break}},t}();tn.CallingSDKLogger=zU;var GU=function(){function t(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.setRequestId=function(e){this.requestId=e},t.prototype.setChatId=function(e){this.chatId=e},t.prototype.useTelemetry=function(e){this.debug&&console.log("[AMSClientLogger][useTelemetry]"),this.telemetry=e},t.prototype.logClientSdkTelemetryEvent=function(e,n){var r,i,o,s;this.debug&&console.log("[AMSClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(n);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},c=Je(Je({},n),{ExceptionDetails:n.ExceptionDetails?JSON.stringify(n.ExceptionDetails):""});switch(e){case dn.default.DEBUG:(r=this.telemetry)===null||r===void 0||r.debug(Je(Je({},l),c),rn.default.AMSCLIENT);break;case dn.default.WARN:(i=this.telemetry)===null||i===void 0||i.warn(Je(Je({},l),c),rn.default.AMSCLIENT);break;case dn.default.ERROR:(o=this.telemetry)===null||o===void 0||o.error(Je(Je({},l),c),rn.default.AMSCLIENT);break;case dn.default.INFO:default:(s=this.telemetry)===null||s===void 0||s.info(Je(Je({},l),c),rn.default.AMSCLIENT);break}},t}();tn.AMSClientLogger=GU;var QG=function(t,e){e===void 0&&(e=!1);var n=new HU(t);return n.setDebug(e),n};tn.createIC3ClientLogger=QG;var XG=function(t,e){e===void 0&&(e=!1);var n=new qU(t);return n.setDebug(e),n};tn.createOCSDKLogger=XG;var YG=function(t,e){e===void 0&&(e=!1);var n=new jU(t);return n.setDebug(e),n};tn.createACSClientLogger=YG;var ZG=function(t,e){e===void 0&&(e=!1);var n=new VU(t);return n.setDebug(e),n};tn.createACSAdapterLogger=ZG;var eW=function(t,e){e===void 0&&(e=!1);var n=new zU(t);return n.setDebug(e),n};tn.createCallingSDKLogger=eW;var tW=function(t,e){e===void 0&&(e=!1);var n=new GU(t);return n.setDebug(e),n};tn.createAMSClientLogger=tW;var kf={};class gh extends Error{}gh.prototype.name="InvalidTokenError";function nW(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function rW(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return nW(e)}catch{return atob(e)}}function iW(t,e){if(typeof t!="string")throw new gh("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new gh(`Invalid token specified: missing part #${n+1}`);let i;try{i=rW(r)}catch(o){throw new gh(`Invalid token specified: invalid base64 for part #${n+1} (${o.message})`)}try{return JSON.parse(i)}catch(o){throw new gh(`Invalid token specified: invalid json for part #${n+1} (${o.message})`)}}const UE=t=>{const{exp:e}=iW(t);return{token:t,expiresOnTimestamp:e*1e3}},pO={token:"",expiresOnTimestamp:-10},oW=t=>t*1e3*60,sW=oW(10),aW=.5;class lW{constructor(e){this.expiringSoonIntervalInMs=sW,this.refreshAfterLifetimePercentage=aW,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:n,token:r,refreshProactively:i}=e;this.refresh=n,this.currentToken=r?UE(r):pO,this.refreshProactively=i??!1,this.refreshProactively&&this.scheduleRefresh()}async getToken(e){return this.isTokenExpiringSoon(this.currentToken)?(this.isTokenValid(this.currentToken)||await this.updateTokenAndReschedule(e==null?void 0:e.abortSignal),this.currentToken):this.currentToken}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=pO,this.activeTimeout&&clearTimeout(this.activeTimeout)}async updateTokenAndReschedule(e){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{await this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}async refreshTokenAndReschedule(e){const n=await this.refreshToken(e);if(!this.isTokenValid(n))throw new Error("The token returned from the tokenRefresher is expired.");this.currentToken=n,this.refreshProactively&&this.scheduleRefresh()}async refreshToken(e){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),UE(await this.activeTokenFetching)}finally{this.activeTokenFetching=null}}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now();let n=null;this.isTokenExpiringSoon(this.currentToken)?n=e*this.refreshAfterLifetimePercentage:n=e-this.expiringSoonIntervalInMs,this.activeTimeout=setTimeout(()=>this.updateTokenAndReschedule(),n)}isTokenValid(e){return e&&Date.now()<e.expiresOnTimestamp}isTokenExpiringSoon(e){return!e||Date.now()>=e.expiresOnTimestamp-this.expiringSoonIntervalInMs}}class cW{constructor(e){this.token=e}async getToken(){return this.token}dispose(){}}class WU{constructor(e){this.disposed=!1,typeof e=="string"?this.tokenCredential=new cW(UE(e)):this.tokenCredential=new lW(e)}async getToken(e){this.throwIfDisposed();const n=await this.tokenCredential.getToken(e);return this.throwIfDisposed(),n}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}const KU=t=>new TextEncoder().encode(t);function uW(t){if(typeof atob!="function")throw new Error("Your browser environment is missing the global `atob` function");const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}function JU(t){if(typeof btoa!="function")throw new Error("Your browser environment is missing the global `btoa` function");const e=new Uint8Array(t);let n="";for(const r of e)n+=String.fromCharCode(r);return btoa(n)}var F0;const QU=(F0=globalThis==null?void 0:globalThis.crypto)===null||F0===void 0?void 0:F0.subtle,dW=async t=>{const e=KU(t),n=await QU.digest("SHA-256",e);return JU(n)},hW=async(t,e)=>{const n={name:"HMAC",hash:{name:"SHA-256"}},r=KU(e),i=uW(t),o=QU,s=await o.importKey("raw",i,n,!1,["sign"]),l=await o.sign(n,s,r);return JU(l)};function XU(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function YU(t,e){const n=e.retryDelayInMs*Math.pow(2,t),r=Math.min(e.maxRetryDelayInMs,n);return{retryAfterInMs:r/2+XU(0,r/2)}}function kb(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}function Pb(t){if(kb(t)){const e=typeof t.name=="string",n=typeof t.message=="string";return e&&n}return!1}function Ob(t,e){switch(e){case"utf-8":return pW(t);case"base64":return ZU(t);case"base64url":return fW(t);case"hex":return gW(t)}}function Ro(t,e){switch(e){case"utf-8":return mW(t);case"base64":return e2(t);case"base64url":return vW(t);case"hex":return yW(t)}}function ZU(t){return btoa([...t].map(e=>String.fromCharCode(e)).join(""))}function fW(t){return ZU(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function pW(t){return new TextDecoder().decode(t)}function gW(t){return[...t].map(e=>e.toString(16).padStart(2,"0")).join("")}function mW(t){return new TextEncoder().encode(t)}function e2(t){return new Uint8Array([...atob(t)].map(e=>e.charCodeAt(0)))}function vW(t){const e=t.replace(/-/g,"+").replace(/_/g,"/");return e2(e)}const gO=new Set("0123456789abcdefABCDEF");function yW(t){const e=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;++n){const r=t[2*n],i=t[2*n+1];if(!gO.has(r)||!gO.has(i))return e.slice(0,n);e[n]=parseInt(`${r}${i}`,16)}return e}let lg;function t2(){if(lg)return lg;if(!self.crypto||!self.crypto.subtle)throw new Error("Your browser environment does not support cryptography functions.");return lg=self.crypto.subtle,lg}async function CW(t,e,n){const r=t2(),i=Ro(t,"base64"),o=Ro(e,"utf-8"),s=await r.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),l=await r.sign({name:"HMAC",hash:{name:"SHA-256"}},s,o);return Ob(new Uint8Array(l),n)}async function SW(t,e){const n=Ro(t,"utf-8"),r=await t2().digest({name:"SHA-256"},n);return Ob(new Uint8Array(r),e)}function TW(){let t="";for(let e=0;e<32;e++){const n=Math.floor(Math.random()*16);e===12?t+="4":e===16?t+=n&3|8:t+=n.toString(16),(e===7||e===11||e===15||e===19)&&(t+="-")}return t}var ax;const EW=typeof((ax=globalThis==null?void 0:globalThis.crypto)==null?void 0:ax.randomUUID)=="function"?globalThis.crypto.randomUUID.bind(globalThis.crypto):TW;function Mb(){return EW()}const wW=typeof window<"u"&&typeof window.document<"u";var lx,cx,ux;const IW=typeof self=="object"&&typeof(self==null?void 0:self.importScripts)=="function"&&(((lx=self.constructor)==null?void 0:lx.name)==="DedicatedWorkerGlobalScope"||((cx=self.constructor)==null?void 0:cx.name)==="ServiceWorkerGlobalScope"||((ux=self.constructor)==null?void 0:ux.name)==="SharedWorkerGlobalScope"),n2=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u",r2=typeof Bun<"u"&&typeof Bun.version<"u";var dx;const Yv=typeof globalThis.process<"u"&&!!globalThis.process.version&&!!((dx=globalThis.process.versions)!=null&&dx.node),bW=Yv&&!r2&&!n2,_W=typeof navigator<"u"&&(navigator==null?void 0:navigator.product)==="ReactNative",B0="REDACTED",AW=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],RW=["api-version"];class Db{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:n=[]}={}){Ye(this,"allowedHeaderNames");Ye(this,"allowedQueryParameters");e=AW.concat(e),n=RW.concat(n),this.allowedHeaderNames=new Set(e.map(r=>r.toLowerCase())),this.allowedQueryParameters=new Set(n.map(r=>r.toLowerCase()))}sanitize(e){const n=new Set;return JSON.stringify(e,(r,i)=>{if(i instanceof Error)return{...i,name:i.name,message:i.message};if(r==="headers")return this.sanitizeHeaders(i);if(r==="url")return this.sanitizeUrl(i);if(r==="query")return this.sanitizeQuery(i);if(r==="body")return;if(r==="response")return;if(r==="operationSpec")return;if(Array.isArray(i)||kb(i)){if(n.has(i))return"[Circular]";n.add(i)}return i},2)}sanitizeUrl(e){if(typeof e!="string"||e===null||e==="")return e;const n=new URL(e);if(!n.search)return e;for(const[r]of n.searchParams)this.allowedQueryParameters.has(r.toLowerCase())||n.searchParams.set(r,B0);return n.toString()}sanitizeHeaders(e){const n={};for(const r of Object.keys(e))this.allowedHeaderNames.has(r.toLowerCase())?n[r]=e[r]:n[r]=B0;return n}sanitizeQuery(e){if(typeof e!="object"||e===null)return e;const n={};for(const r of Object.keys(e))this.allowedQueryParameters.has(r.toLowerCase())?n[r]=e[r]:n[r]=B0;return n}}async function kW(t,e){var i,o;const n=new AbortController;function r(){n.abort()}(i=e==null?void 0:e.abortSignal)==null||i.addEventListener("abort",r);try{return await Promise.race(t.map(s=>s({abortSignal:n.signal})))}finally{n.abort(),(o=e==null?void 0:e.abortSignal)==null||o.removeEventListener("abort",r)}}let Nb=class extends Error{constructor(e){super(e),this.name="AbortError"}};function i2(t,e){const{cleanupBeforeAbort:n,abortSignal:r,abortErrorMsg:i}=e??{};return new Promise((o,s)=>{function l(){s(new Nb(i??"The operation was aborted."))}function c(){r==null||r.removeEventListener("abort",a)}function a(){n==null||n(),c(),l()}if(r!=null&&r.aborted)return l();try{t(u=>{c(),o(u)},u=>{c(),s(u)})}catch(u){s(u)}r==null||r.addEventListener("abort",a)})}const PW="The delay was aborted.";function o2(t,e){let n;const{abortSignal:r,abortErrorMsg:i}=e??{};return i2(o=>{n=setTimeout(o,t)},{cleanupBeforeAbort:()=>clearTimeout(n),abortSignal:r,abortErrorMsg:i??PW})}function Pf(t){if(Pb(t))return t.message;{let e;try{typeof t=="object"&&t?e=JSON.stringify(t):e=String(t)}catch{e="[unable to stringify input]"}return`Unknown error ${e}`}}function xb(t){return typeof t<"u"&&t!==null}function OW(t,e){if(!xb(t)||typeof t!="object")return!1;for(const n of e)if(!s2(t,n))return!1;return!0}function s2(t,e){return xb(t)&&typeof t=="object"&&e in t}function MW(t,e){return YU(t,e)}function DW(t,e){return SW(t,e)}function NW(t,e,n){return CW(t,e,n)}function xW(t,e){return XU(t,e)}function a2(t){return Pb(t)}function LW(t){return kb(t)}function l2(){return Mb()}const UW=wW,FW=r2,BW=n2,c2=Yv,iv=Yv,$W=bW,HW=_W,qW=IW;function jW(t,e){return Ob(t,e)}function VW(t,e){return Ro(t,e)}const zW=Object.freeze(Object.defineProperty({__proto__:null,calculateRetryDelay:MW,cancelablePromiseRace:kW,computeSha256Hash:DW,computeSha256Hmac:NW,createAbortablePromise:i2,delay:o2,getErrorMessage:Pf,getRandomIntegerInclusive:xW,isBrowser:UW,isBun:FW,isDefined:xb,isDeno:BW,isError:a2,isNode:c2,isNodeLike:iv,isNodeRuntime:$W,isObject:LW,isObjectWithProperties:OW,isReactNative:HW,isWebWorker:qW,objectHasProperty:s2,randomUUID:l2,stringToUint8Array:VW,uint8ArrayToString:jW},Symbol.toStringTag,{value:"Module"})),GW="CommunicationAccessKeyCredentialPolicy";function u2(t){return{name:GW,async sendRequest(e,n){var r;const i=e.method.toUpperCase(),o=new Date().toUTCString(),s=await dW(((r=e.body)===null||r===void 0?void 0:r.toString())||""),l="x-ms-date",c=`${l};host;x-ms-content-sha256`,a=new URL(e.url),u=a.searchParams.toString(),d=u?`${a.pathname}?${u}`:a.pathname,f=a.port,h=f?`${a.host}:${f}`:a.host,g=`${i}
${d}
${o};${h};${s}`,E=await hW(t.key,g);return c2&&e.headers.set("Host",h||""),e.headers.set(l,o),e.headers.set("x-ms-content-sha256",s),e.headers.set("Authorization",`HMAC-SHA256 SignedHeaders=${c}&Signature=${E}`),n(e)}}}class Lb extends Error{constructor(e){super(e),this.name="AbortError"}}function WW(...t){if(t.length>0){const e=String(t[0]);e.includes(":error")?console.error(...t):e.includes(":warning")?console.warn(...t):e.includes(":info")?console.info(...t):e.includes(":verbose")?console.debug(...t):console.debug(...t)}}var mO={};const vO=typeof process<"u"&&mO&&mO.DEBUG||void 0;let d2,FE=[],BE=[];const ov=[];vO&&Ub(vO);const Fc=Object.assign(t=>h2(t),{enable:Ub,enabled:Fb,disable:KW,log:WW});function Ub(t){d2=t,FE=[],BE=[];const e=t.split(",").map(n=>n.trim());for(const n of e)n.startsWith("-")?BE.push(n.substring(1)):FE.push(n);for(const n of ov)n.enabled=Fb(n.namespace)}function Fb(t){if(t.endsWith("*"))return!0;for(const e of BE)if(yO(t,e))return!1;for(const e of FE)if(yO(t,e))return!0;return!1}function yO(t,e){if(e.indexOf("*")===-1)return t===e;let n=e;if(e.indexOf("**")!==-1){const f=[];let h="";for(const g of e)g==="*"&&h==="*"||(h=g,f.push(g));n=f.join("")}let r=0,i=0;const o=n.length,s=t.length;let l=-1,c=-1;for(;r<s&&i<o;)if(n[i]==="*"){if(l=i,i++,i===o)return!0;for(;t[r]!==n[i];)if(r++,r===s)return!1;c=r,r++,i++;continue}else if(n[i]===t[r])i++,r++;else if(l>=0){if(i=l+1,r=c+1,r===s)return!1;for(;t[r]!==n[i];)if(r++,r===s)return!1;c=r,r++,i++;continue}else return!1;const a=r===t.length,u=i===n.length,d=i===n.length-1&&n[i]==="*";return a&&(u||d)}function KW(){const t=d2||"";return Ub(""),t}function h2(t){const e=Object.assign(n,{enabled:Fb(t),destroy:JW,log:Fc.log,namespace:t,extend:QW});function n(...r){e.enabled&&(r.length>0&&(r[0]=`${t} ${r[0]}`),e.log(...r))}return ov.push(e),e}function JW(){const t=ov.indexOf(this);return t>=0?(ov.splice(t,1),!0):!1}function QW(t){const e=h2(`${this.namespace}:${t}`);return e.log=this.log,e}var CO={};const $E=["verbose","info","warning","error"],SO={verbose:400,info:300,warning:200,error:100};function TO(t,e){e.log=(...n)=>{t.log(...n)}}function EO(t){return $E.includes(t)}function f2(t){const e=new Set,n=typeof process<"u"&&CO&&CO[t.logLevelEnvVarName]||void 0;let r;const i=Fc(t.namespace);i.log=(...u)=>{Fc.log(...u)};function o(u){if(u&&!EO(u))throw new Error(`Unknown log level '${u}'. Acceptable values: ${$E.join(",")}`);r=u;const d=[];for(const f of e)s(f)&&d.push(f.namespace);Fc.enable(d.join(","))}n&&(EO(n)?o(n):console.error(`${t.logLevelEnvVarName} set to unknown log level '${n}'; logging is not enabled. Acceptable values: ${$E.join(", ")}.`));function s(u){return!!(r&&SO[u.level]<=SO[r])}function l(u,d){const f=Object.assign(u.extend(d),{level:d});if(TO(u,f),s(f)){const h=Fc.disable();Fc.enable(h+","+f.namespace)}return e.add(f),f}function c(){return r}function a(u){const d=i.extend(u);return TO(i,d),{error:l(d,"error"),warning:l(d,"warning"),info:l(d,"info"),verbose:l(d,"verbose")}}return{setLogLevel:o,getLogLevel:c,createClientLogger:a,logger:i}}const XW=f2({logLevelEnvVarName:"TYPESPEC_RUNTIME_LOG_LEVEL",namespace:"typeSpecRuntime"});function p2(t){return XW.createClientLogger(t)}function cg(t){return t.toLowerCase()}function*YW(t){for(const e of t.values())yield[e.name,e.value]}class ZW{constructor(e){Ye(this,"_headersMap");if(this._headersMap=new Map,e)for(const n of Object.keys(e))this.set(n,e[n])}set(e,n){this._headersMap.set(cg(e),{name:e,value:String(n).trim()})}get(e){var n;return(n=this._headersMap.get(cg(e)))==null?void 0:n.value}has(e){return this._headersMap.has(cg(e))}delete(e){this._headersMap.delete(cg(e))}toJSON(e={}){const n={};if(e.preserveCase)for(const r of this._headersMap.values())n[r.name]=r.value;else for(const[r,i]of this._headersMap)n[r]=i.value;return n}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return YW(this._headersMap)}}function sf(t){return new ZW(t)}class e5{constructor(e){Ye(this,"url");Ye(this,"method");Ye(this,"headers");Ye(this,"timeout");Ye(this,"withCredentials");Ye(this,"body");Ye(this,"multipartBody");Ye(this,"formData");Ye(this,"streamResponseStatusCodes");Ye(this,"enableBrowserStreams");Ye(this,"proxySettings");Ye(this,"disableKeepAlive");Ye(this,"abortSignal");Ye(this,"requestId");Ye(this,"allowInsecureConnection");Ye(this,"onUploadProgress");Ye(this,"onDownloadProgress");Ye(this,"requestOverrides");Ye(this,"authSchemes");this.url=e.url,this.body=e.body,this.headers=e.headers??sf(),this.method=e.method??"GET",this.timeout=e.timeout??0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=e.disableKeepAlive??!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=e.withCredentials??!1,this.abortSignal=e.abortSignal,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||Mb(),this.allowInsecureConnection=e.allowInsecureConnection??!1,this.enableBrowserStreams=e.enableBrowserStreams??!1,this.requestOverrides=e.requestOverrides,this.authSchemes=e.authSchemes}}function t5(t){return new e5(t)}const wO=new Set(["Deserialize","Serialize","Retry","Sign"]);class sv{constructor(e){Ye(this,"_policies",[]);Ye(this,"_orderedPolicies");this._policies=(e==null?void 0:e.slice(0))??[],this._orderedPolicies=void 0}addPolicy(e,n={}){if(n.phase&&n.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(n.phase&&!wO.has(n.phase))throw new Error(`Invalid phase name: ${n.phase}`);if(n.afterPhase&&!wO.has(n.afterPhase))throw new Error(`Invalid afterPhase name: ${n.afterPhase}`);this._policies.push({policy:e,options:n}),this._orderedPolicies=void 0}removePolicy(e){const n=[];return this._policies=this._policies.filter(r=>e.name&&r.policy.name===e.name||e.phase&&r.options.phase===e.phase?(n.push(r.policy),!1):!0),this._orderedPolicies=void 0,n}sendRequest(e,n){return this.getOrderedPolicies().reduceRight((o,s)=>l=>s.sendRequest(l,o),o=>e.sendRequest(o))(n)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new sv(this._policies)}static create(){return new sv}orderPolicies(){const e=[],n=new Map;function r(g){return{name:g,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}const i=r("Serialize"),o=r("None"),s=r("Deserialize"),l=r("Retry"),c=r("Sign"),a=[i,o,s,l,c];function u(g){return g==="Retry"?l:g==="Serialize"?i:g==="Deserialize"?s:g==="Sign"?c:o}for(const g of this._policies){const E=g.policy,D=g.options,w=E.name;if(n.has(w))throw new Error("Duplicate policy names not allowed in pipeline");const p={policy:E,dependsOn:new Set,dependants:new Set};D.afterPhase&&(p.afterPhase=u(D.afterPhase),p.afterPhase.hasAfterPolicies=!0),n.set(w,p),u(D.phase).policies.add(p)}for(const g of this._policies){const{policy:E,options:D}=g,w=E.name,p=n.get(w);if(!p)throw new Error(`Missing node for policy ${w}`);if(D.afterPolicies)for(const b of D.afterPolicies){const j=n.get(b);j&&(p.dependsOn.add(j),j.dependants.add(p))}if(D.beforePolicies)for(const b of D.beforePolicies){const j=n.get(b);j&&(j.dependsOn.add(p),p.dependants.add(j))}}function d(g){g.hasRun=!0;for(const E of g.policies)if(!(E.afterPhase&&(!E.afterPhase.hasRun||E.afterPhase.policies.size))&&E.dependsOn.size===0){e.push(E.policy);for(const D of E.dependants)D.dependsOn.delete(E);n.delete(E.policy.name),g.policies.delete(E)}}function f(){for(const g of a){if(d(g),g.policies.size>0&&g!==o){o.hasRun||d(o);return}g.hasAfterPolicies&&d(o)}}let h=0;for(;n.size>0;){h++;const g=e.length;if(f(),e.length<=g&&h>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function n5(){return sv.create()}const r5=Symbol(),i5=new Db;var va;let av=(va=class extends Error{constructor(n,r={}){var o;super(n);Ye(this,"code");Ye(this,"statusCode");Ye(this,"request");Ye(this,"response");Ye(this,"details");this.name="RestError",this.code=r.code,this.statusCode=r.statusCode,Object.defineProperty(this,"request",{value:r.request,enumerable:!1}),Object.defineProperty(this,"response",{value:r.response,enumerable:!1});const i=(o=this.request)!=null&&o.agent?{maxFreeSockets:this.request.agent.maxFreeSockets,maxSockets:this.request.agent.maxSockets}:void 0;Object.defineProperty(this,r5,{value:()=>`RestError: ${this.message} 
 ${i5.sanitize({...this,request:{...this.request,agent:i},response:this.response})}`,enumerable:!1}),Object.setPrototypeOf(this,va.prototype)}},Ye(va,"REQUEST_SEND_ERROR","REQUEST_SEND_ERROR"),Ye(va,"PARSE_ERROR","PARSE_ERROR"),va);function o5(t){return t instanceof av?!0:Pb(t)&&t.name==="RestError"}function s5(t){return!!(t&&typeof t.pipe=="function")}function Bb(t){return!!(t&&typeof t.getReader=="function"&&typeof t.tee=="function")}function a5(t){return typeof t.stream=="function"}function l5(t){if(t.buffer instanceof ArrayBuffer&&t.byteOffset===0&&t.byteLength===t.buffer.byteLength)return t.buffer;const e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return n.set(r),n.buffer}function c5(t){return(typeof Blob=="function"||typeof Blob=="object")&&t instanceof Blob}class u5{async sendRequest(e){if(new URL(e.url).protocol!=="https:"&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await d5(e)}catch(i){throw p5(i,e)}}}async function d5(t){const{abortController:e,abortControllerCleanup:n}=f5(t);try{const r=g5(t.headers),{streaming:i,body:o}=v5(t),s={body:o,method:t.method,headers:r,signal:e.signal,..."credentials"in Request.prototype?{credentials:t.withCredentials?"include":"same-origin"}:{},..."cache"in Request.prototype?{cache:"no-store"}:{}};i&&(s.duplex="half");const l=await fetch(t.url,{...s,...t.requestOverrides});return c5(t.body)&&t.onUploadProgress&&t.onUploadProgress({loadedBytes:t.body.size}),h5(l,t,n)}catch(r){throw n==null||n(),r}}async function h5(t,e,n){var s,l;const r=m5(t),i={request:e,headers:r,status:t.status},o=Bb(t.body)?g2(t.body,{onProgress:e.onDownloadProgress,onEnd:n}):t.body;if((s=e.streamResponseStatusCodes)!=null&&s.has(Number.POSITIVE_INFINITY)||(l=e.streamResponseStatusCodes)!=null&&l.has(i.status))if(e.enableBrowserStreams)i.browserStreamBody=o??void 0;else{const c=new Response(o);i.blobBody=c.blob(),n==null||n()}else{const c=new Response(o);i.bodyAsText=await c.text(),n==null||n()}return i}function f5(t){const e=new AbortController;let n,r;if(t.abortSignal){if(t.abortSignal.aborted)throw new Lb("The operation was aborted. Request has already been canceled.");r=i=>{i.type==="abort"&&e.abort()},t.abortSignal.addEventListener("abort",r),n=()=>{var i;r&&((i=t.abortSignal)==null||i.removeEventListener("abort",r))}}return t.timeout>0&&setTimeout(()=>{e.abort()},t.timeout),{abortController:e,abortControllerCleanup:n}}function p5(t,e){return t&&(t==null?void 0:t.name)==="AbortError"?t:new av(`Error sending request: ${t.message}`,{code:(t==null?void 0:t.code)??av.REQUEST_SEND_ERROR,request:e})}function g5(t){const e=new Headers;for(const[n,r]of t)e.append(n,r);return e}function m5(t){const e=sf();for(const[n,r]of t.headers)e.set(n,r);return e}function v5(t){const e=typeof t.body=="function"?t.body():t.body;if(s5(e))throw new Error("Node streams are not supported in browser environment.");return Bb(e)?{streaming:!0,body:g2(e,{onProgress:t.onUploadProgress})}:typeof e=="object"&&e&&"buffer"in e?{streaming:!1,body:l5(e)}:e===void 0?{streaming:!1}:{streaming:!1,body:e}}function g2(t,e={}){let n=0;const{onProgress:r,onEnd:i}=e;if(C5(t))return t.pipeThrough(new TransformStream({transform(o,s){if(o===null){s.terminate();return}s.enqueue(o),n+=o.length,r&&r({loadedBytes:n})},flush(){i==null||i()}}));{const o=t.getReader();return new ReadableStream({async pull(s){const{done:l,value:c}=await o.read();if(l||!c){i==null||i(),s.close(),o.releaseLock();return}n+=(c==null?void 0:c.length)??0,s.enqueue(c),r&&r({loadedBytes:n})},cancel(s){return i==null||i(),o.cancel(s)}})}}function y5(){return new u5}function C5(t){return t.pipeThrough!==void 0&&self.TransformStream!==void 0}function S5(){return y5()}const T5=p2("ts-http-runtime"),m2="logPolicy";function E5(t={}){const e=t.logger??T5.info,n=new Db({additionalAllowedHeaderNames:t.additionalAllowedHeaderNames,additionalAllowedQueryParameters:t.additionalAllowedQueryParameters});return{name:m2,async sendRequest(r,i){if(!e.enabled)return i(r);e(`Request: ${n.sanitize(r)}`);const o=await i(r);return e(`Response status code: ${o.status}`),e(`Headers: ${n.sanitize(o.headers)}`),o}}}const v2="redirectPolicy",IO=["GET","HEAD"];function w5(t={}){const{maxRetries:e=20}=t;return{name:v2,async sendRequest(n,r){const i=await r(n);return y2(r,i,e)}}}async function y2(t,e,n,r=0){const{request:i,status:o,headers:s}=e,l=s.get("location");if(l&&(o===300||o===301&&IO.includes(i.method)||o===302&&IO.includes(i.method)||o===303&&i.method==="POST"||o===307)&&r<n){const c=new URL(l,i.url);i.url=c.toString(),o===303&&(i.method="GET",i.headers.delete("Content-Length"),delete i.body),i.headers.delete("Authorization");const a=await t(i);return y2(t,a,n,r+1)}return e}const bu=3,I5="decompressResponsePolicy";function b5(){throw new Error("decompressResponsePolicy is not supported in browser environment")}const _5="The operation was aborted.";function A5(t,e,n){return new Promise((r,i)=>{let o,s;const l=()=>i(new Lb(n!=null&&n.abortErrorMsg?n==null?void 0:n.abortErrorMsg:_5)),c=()=>{n!=null&&n.abortSignal&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(o&&clearTimeout(o),c(),l()),n!=null&&n.abortSignal&&n.abortSignal.aborted)return l();o=setTimeout(()=>{c(),r(e)},t),n!=null&&n.abortSignal&&n.abortSignal.addEventListener("abort",s)})}function R5(t,e){const n=t.headers.get(e);if(!n)return;const r=Number(n);if(!Number.isNaN(r))return r}const HE="Retry-After",k5=["retry-after-ms","x-ms-retry-after-ms",HE];function C2(t){if(t&&[429,503].includes(t.status))try{for(const i of k5){const o=R5(t,i);if(o===0||o)return o*(i===HE?1e3:1)}const e=t.headers.get(HE);if(!e)return;const r=Date.parse(e)-Date.now();return Number.isFinite(r)?Math.max(0,r):void 0}catch{return}}function P5(t){return Number.isFinite(C2(t))}function S2(){return{name:"throttlingRetryStrategy",retry({response:t}){const e=C2(t);return Number.isFinite(e)?{retryAfterInMs:e}:{skipStrategy:!0}}}}const O5=1e3,M5=1e3*64;function $b(t={}){const e=t.retryDelayInMs??O5,n=t.maxRetryDelayInMs??M5;return{name:"exponentialRetryStrategy",retry({retryCount:r,response:i,responseError:o}){const s=N5(o),l=s&&t.ignoreSystemErrors,c=D5(i),a=c&&t.ignoreHttpStatusCodes;return i&&(P5(i)||!c)||a||l?{skipStrategy:!0}:o&&!s&&!c?{errorToThrow:o}:YU(r,{retryDelayInMs:e,maxRetryDelayInMs:n})}}}function D5(t){return!!(t&&t.status!==void 0&&(t.status>=500||t.status===408)&&t.status!==501&&t.status!==505)}function N5(t){return t?t.code==="ETIMEDOUT"||t.code==="ESOCKETTIMEDOUT"||t.code==="ECONNREFUSED"||t.code==="ECONNRESET"||t.code==="ENOENT"||t.code==="ENOTFOUND":!1}const x5=p2("ts-http-runtime retryPolicy"),L5="retryPolicy";function Of(t,e={maxRetries:bu}){const n=e.logger||x5;return{name:L5,async sendRequest(r,i){var c;let o,s,l=-1;e:for(;;){l+=1,o=void 0,s=void 0;try{n.info(`Retry ${l}: Attempting to send request`,r.requestId),o=await i(r),n.info(`Retry ${l}: Received a response from request`,r.requestId)}catch(a){if(n.error(`Retry ${l}: Received an error from request`,r.requestId),s=a,!a||s.name!=="RestError")throw a;o=s.response}if((c=r.abortSignal)!=null&&c.aborted)throw n.error(`Retry ${l}: Request aborted.`),new Lb;if(l>=(e.maxRetries??bu)){if(n.info(`Retry ${l}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),s)throw s;if(o)return o;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${l}: Processing ${t.length} retry strategies.`);t:for(const a of t){const u=a.logger||n;u.info(`Retry ${l}: Processing retry strategy ${a.name}.`);const d=a.retry({retryCount:l,response:o,responseError:s});if(d.skipStrategy){u.info(`Retry ${l}: Skipped.`);continue t}const{errorToThrow:f,retryAfterInMs:h,redirectTo:g}=d;if(f)throw u.error(`Retry ${l}: Retry strategy ${a.name} throws error:`,f),f;if(h||h===0){u.info(`Retry ${l}: Retry strategy ${a.name} retries after ${h}`),await A5(h,void 0,{abortSignal:r.abortSignal});continue e}if(g){u.info(`Retry ${l}: Retry strategy ${a.name} redirects to ${g}`),r.url=g;continue e}}if(s)throw n.info("None of the retry strategies could work with the received error. Throwing it."),s;if(o)return n.info("None of the retry strategies could work with the received response. Returning it."),o}}}}const U5="defaultRetryPolicy";function F5(t={}){return{name:U5,sendRequest:Of([S2(),$b(t)],{maxRetries:t.maxRetries??bu}).sendRequest}}const T2="formDataPolicy";function B5(t){const e={};for(const[n,r]of t.entries())e[n]??(e[n]=[]),e[n].push(r);return e}function $5(){return{name:T2,async sendRequest(t,e){if(Yv&&typeof FormData<"u"&&t.body instanceof FormData&&(t.formData=B5(t.body),t.body=void 0),t.formData){const n=t.headers.get("Content-Type");n&&n.indexOf("application/x-www-form-urlencoded")!==-1?t.body=H5(t.formData):await q5(t.formData,t),t.formData=void 0}return e(t)}}}function H5(t){const e=new URLSearchParams;for(const[n,r]of Object.entries(t))if(Array.isArray(r))for(const i of r)e.append(n,i.toString());else e.append(n,r.toString());return e.toString()}async function q5(t,e){const n=e.headers.get("Content-Type");if(n&&!n.startsWith("multipart/form-data"))return;e.headers.set("Content-Type",n??"multipart/form-data");const r=[];for(const[i,o]of Object.entries(t))for(const s of Array.isArray(o)?o:[o])if(typeof s=="string")r.push({headers:sf({"Content-Disposition":`form-data; name="${i}"`}),body:Ro(s,"utf-8")});else{if(s==null||typeof s!="object")throw new Error(`Unexpected value for key ${i}: ${s}. Value should be serialized to string first.`);{const l=s.name||"blob",c=sf();c.set("Content-Disposition",`form-data; name="${i}"; filename="${l}"`),c.set("Content-Type",s.type||"application/octet-stream"),r.push({headers:c,body:s})}}e.multipartBody={parts:r}}const j5="proxyPolicy",E2="proxyPolicy is not supported in browser environment";function V5(){throw new Error(E2)}function z5(){throw new Error(E2)}const w2="agentPolicy";function G5(t){return{name:w2,sendRequest:async(e,n)=>(e.agent||(e.agent=t),n(e))}}const I2="tlsPolicy";function W5(t){return{name:I2,sendRequest:async(e,n)=>(e.tlsSettings||(e.tlsSettings=t),n(e))}}function K5(t){return new Response(t).blob()}async function J5(t){if(t instanceof Blob||t instanceof Uint8Array)return t;if(Bb(t))return K5(t);throw new Error("Unsupported source type. Only Blob, Uint8Array, and ReadableStream are supported in browser.")}function Q5(t){return"resize"in t.buffer?t:t.map(e=>e)}async function X5(t){const e=[];for(const n of t){const r=await J5(typeof n=="function"?n():n);r instanceof Blob?e.push(r):e.push(new Blob([Q5(r)]))}return new Blob(e)}function Y5(){return`----AzSDKFormBoundary${Mb()}`}function Z5(t){let e="";for(const[n,r]of t)e+=`${n}: ${r}\r
`;return e}function e6(t){return t instanceof Uint8Array?t.byteLength:a5(t)?t.size===-1?void 0:t.size:void 0}function t6(t){let e=0;for(const n of t){const r=e6(n);if(r===void 0)return;e+=r}return e}async function n6(t,e,n){const r=[Ro(`--${n}`,"utf-8"),...e.flatMap(o=>[Ro(`\r
`,"utf-8"),Ro(Z5(o.headers),"utf-8"),Ro(`\r
`,"utf-8"),o.body,Ro(`\r
--${n}`,"utf-8")]),Ro(`--\r
\r
`,"utf-8")],i=t6(r);i&&t.headers.set("Content-Length",i),t.body=await X5(r)}const b2="multipartPolicy",r6=70,i6=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function o6(t){if(t.length>r6)throw new Error(`Multipart boundary "${t}" exceeds maximum length of 70 characters`);if(Array.from(t).some(e=>!i6.has(e)))throw new Error(`Multipart boundary "${t}" contains invalid characters`)}function s6(){return{name:b2,async sendRequest(t,e){if(!t.multipartBody)return e(t);if(t.body)throw new Error("multipartBody and regular body cannot be set at the same time");let n=t.multipartBody.boundary;const r=t.headers.get("Content-Type")??"multipart/mixed",i=r.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!i)throw new Error(`Got multipart request body, but content-type header was not multipart: ${r}`);const[,o,s]=i;if(s&&n&&s!==n)throw new Error(`Multipart boundary was specified as ${s} in the header, but got ${n} in the request body`);return n??(n=s),n?o6(n):n=Y5(),t.headers.set("Content-Type",`${o}; boundary=${n}`),await n6(t,t.multipartBody.parts,n),t.multipartBody=void 0,e(t)}}}function _2(){return n5()}const a6=f2({logLevelEnvVarName:"AZURE_LOG_LEVEL",namespace:"azure"});function Mf(t){return a6.createClientLogger(t)}const nc=Mf("core-rest-pipeline"),l6="exponentialRetryPolicy";function c6(t={}){return Of([$b({...t,ignoreSystemErrors:!0})],{maxRetries:t.maxRetries??bu})}const A2="systemErrorRetryPolicy";function u6(t={}){return{name:A2,sendRequest:Of([$b({...t,ignoreHttpStatusCodes:!0})],{maxRetries:t.maxRetries??bu}).sendRequest}}const R2="throttlingRetryPolicy";function d6(t={}){return{name:R2,sendRequest:Of([S2()],{maxRetries:t.maxRetries??bu}).sendRequest}}const h6=m2;function k2(t={}){return E5({logger:nc.info,...t})}const f6=v2;function P2(t={}){return w5(t)}function p6(){return"x-ms-useragent"}function g6(t){const e=[{name:"Firefox",regex:/Firefox\/([\d.]+)/},{name:"Safari",regex:/Version\/([\d.]+).*Safari/}];for(const n of e){const r=t.match(n.regex);if(r)return{brand:n.name,version:r[1]}}}function m6(t){const e=["Google Chrome","Microsoft Edge","Opera","Brave","Chromium"];for(const n of e){const r=t.find(i=>i.brand===n);if(r)return r}}async function v6(t){const e=globalThis.navigator;let n="unknown";if(e!=null&&e.userAgentData){const r=await e.userAgentData.getHighEntropyValues(["architecture","platformVersion"]);n=`${r.platform} ${r.platformVersion}; ${r.architecture}`;const i=m6(e.userAgentData.brands);i&&t.set(i.brand,`${i.version} (${n})`)}else if(e!=null&&e.platform){n=e.platform;const r=g6(e.userAgent);r&&t.set(r.brand,`${r.version} (${n})`)}else typeof globalThis.EdgeRuntime=="string"&&t.set("EdgeRuntime",`${globalThis.EdgeRuntime} (${n})`)}const O2="1.22.2",y6=3;function C6(t){const e=[];for(const[n,r]of t){const i=r?`${n}/${r}`:n;e.push(i)}return e.join(" ")}function S6(){return p6()}async function M2(t){const e=new Map;e.set("core-rest-pipeline",O2),await v6(e);const n=C6(e);return t?`${t} ${n}`:n}const bO=S6(),D2="userAgentPolicy";function N2(t={}){const e=M2(t.userAgentPrefix);return{name:D2,async sendRequest(n,r){return n.headers.has(bO)||n.headers.set(bO,await e),r(n)}}}function T6(t){return!!(t&&typeof t.pipe=="function")}const x2={arrayBuffer:()=>{throw new Error("Not implemented")},bytes:()=>{throw new Error("Not implemented")},slice:()=>{throw new Error("Not implemented")},text:()=>{throw new Error("Not implemented")}},Zv=Symbol("rawContent");function L2(t){return typeof t[Zv]=="function"}function E6(t){return L2(t)?t[Zv]():t}function w6(t,e,n={}){return{...x2,type:n.type??"",lastModified:n.lastModified??new Date().getTime(),webkitRelativePath:n.webkitRelativePath??"",size:n.size??-1,name:e,stream:()=>{const r=t();if(T6(r))throw new Error("Not supported: a Node stream was provided as input to createFileFromStream.");return r},[Zv]:t}}function I6(t,e,n={}){return iv?{...x2,type:n.type??"",lastModified:n.lastModified??new Date().getTime(),webkitRelativePath:n.webkitRelativePath??"",size:t.byteLength,name:e,arrayBuffer:async()=>t.buffer,stream:()=>new Blob([_O(t)]).stream(),[Zv]:()=>t}:new File([_O(t)],e,n)}function _O(t){return"resize"in t.buffer?t:t.map(e=>e)}const Hb=b2;function U2(){const t=s6();return{name:Hb,sendRequest:async(e,n)=>{if(e.multipartBody)for(const r of e.multipartBody.parts)L2(r.body)&&(r.body=E6(r.body));return t.sendRequest(e,n)}}}const b6=I5;function F2(){return b5()}function B2(t={}){return F5(t)}const _6=T2;function $2(){return $5()}const A6=j5;function R6(t){return V5()}function H2(t,e){return z5()}const q2="setClientRequestIdPolicy";function j2(t="x-ms-client-request-id"){return{name:q2,async sendRequest(e,n){return e.headers.has(t)||e.headers.set(t,e.requestId),n(e)}}}const k6=w2;function V2(t){return G5(t)}const P6=I2;function z2(t){return W5(t)}const Oh={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function O6(t={}){let e=new Mh(t.parentContext);return t.span&&(e=e.setValue(Oh.span,t.span)),t.namespace&&(e=e.setValue(Oh.namespace,t.namespace)),e}class Mh{constructor(e){Ye(this,"_contextMap");this._contextMap=e instanceof Mh?new Map(e._contextMap):new Map}setValue(e,n){const r=new Mh(this);return r._contextMap.set(e,n),r}getValue(e){return this._contextMap.get(e)}deleteValue(e){const n=new Mh(this);return n._contextMap.delete(e),n}}const $0={instrumenterImplementation:void 0};function M6(){return{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{},addEvent:()=>{}}}function D6(){return{createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(t,e)=>({span:M6(),tracingContext:O6({parentContext:e.tracingContext})}),withContext(t,e,...n){return e(...n)}}}function ug(){return $0.instrumenterImplementation||($0.instrumenterImplementation=D6()),$0.instrumenterImplementation}function qb(t){const{namespace:e,packageName:n,packageVersion:r}=t;function i(a,u,d){var D;const f=ug().startSpan(a,{...d,packageName:n,packageVersion:r,tracingContext:(D=u==null?void 0:u.tracingOptions)==null?void 0:D.tracingContext});let h=f.tracingContext;const g=f.span;h.getValue(Oh.namespace)||(h=h.setValue(Oh.namespace,e)),g.setAttribute("az.namespace",h.getValue(Oh.namespace));const E=Object.assign({},u,{tracingOptions:{...u==null?void 0:u.tracingOptions,tracingContext:h}});return{span:g,updatedOptions:E}}async function o(a,u,d,f){const{span:h,updatedOptions:g}=i(a,u,f);try{const E=await s(g.tracingOptions.tracingContext,()=>Promise.resolve(d(g,h)));return h.setStatus({status:"success"}),E}catch(E){throw h.setStatus({status:"error",error:E}),E}finally{h.end()}}function s(a,u,...d){return ug().withContext(a,u,...d)}function l(a){return ug().parseTraceparentHeader(a)}function c(a){return ug().createRequestHeaders(a)}return{startSpan:i,withSpan:o,withContext:s,parseTraceparentHeader:l,createRequestHeaders:c}}const Hl=av;function jb(t){return o5(t)}const G2="tracingPolicy";function W2(t={}){const e=M2(t.userAgentPrefix),n=new Db({additionalAllowedQueryParameters:t.additionalAllowedQueryParameters}),r=N6();return{name:G2,async sendRequest(i,o){if(!r)return o(i);const s=await e,l={"http.url":n.sanitizeUrl(i.url),"http.method":i.method,"http.user_agent":s,requestId:i.requestId};s&&(l["http.user_agent"]=s);const{span:c,tracingContext:a}=x6(r,i,l)??{};if(!c||!a)return o(i);try{const u=await r.withContext(a,o,i);return U6(c,u),u}catch(u){throw L6(c,u),u}}}}function N6(){try{return qb({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:O2})}catch(t){nc.warning(`Error when creating the TracingClient: ${Pf(t)}`);return}}function x6(t,e,n){try{const{span:r,updatedOptions:i}=t.startSpan(`HTTP ${e.method}`,{tracingOptions:e.tracingOptions},{spanKind:"client",spanAttributes:n});if(!r.isRecording()){r.end();return}const o=t.createRequestHeaders(i.tracingOptions.tracingContext);for(const[s,l]of Object.entries(o))e.headers.set(s,l);return{span:r,tracingContext:i.tracingOptions.tracingContext}}catch(r){nc.warning(`Skipping creating a tracing span due to an error: ${Pf(r)}`);return}}function L6(t,e){try{t.setStatus({status:"error",error:a2(e)?e:void 0}),jb(e)&&e.statusCode&&t.setAttribute("http.status_code",e.statusCode),t.end()}catch(n){nc.warning(`Skipping tracing span processing due to an error: ${Pf(n)}`)}}function U6(t,e){try{t.setAttribute("http.status_code",e.status);const n=e.headers.get("x-ms-request-id");n&&t.setAttribute("serviceRequestId",n),e.status>=400&&t.setStatus({status:"error"}),t.end()}catch(n){nc.warning(`Skipping tracing span processing due to an error: ${Pf(n)}`)}}function K2(t){if(t instanceof AbortSignal)return{abortSignal:t};if(t.aborted)return{abortSignal:AbortSignal.abort(t.reason)};const e=new AbortController;let n=!0;function r(){n&&(t.removeEventListener("abort",i),n=!1)}function i(){e.abort(t.reason),r()}return t.addEventListener("abort",i),{abortSignal:e.signal,cleanup:r}}const F6="wrapAbortSignalLikePolicy";function B6(){return{name:F6,sendRequest:async(t,e)=>{if(!t.abortSignal)return e(t);const{abortSignal:n,cleanup:r}=K2(t.abortSignal);t.abortSignal=n;try{return await e(t)}finally{r==null||r()}}}}function J2(t){var n;const e=_2();return iv&&(t.agent&&e.addPolicy(V2(t.agent)),t.tlsOptions&&e.addPolicy(z2(t.tlsOptions)),e.addPolicy(H2(t.proxyOptions)),e.addPolicy(F2())),e.addPolicy(B6()),e.addPolicy($2(),{beforePolicies:[Hb]}),e.addPolicy(N2(t.userAgentOptions)),e.addPolicy(j2((n=t.telemetryOptions)==null?void 0:n.clientRequestIdHeaderName)),e.addPolicy(U2(),{afterPhase:"Deserialize"}),e.addPolicy(B2(t.retryOptions),{phase:"Retry"}),e.addPolicy(W2({...t.userAgentOptions,...t.loggingOptions}),{afterPhase:"Retry"}),iv&&e.addPolicy(P2(t.redirectOptions),{afterPhase:"Retry"}),e.addPolicy(k2(t.loggingOptions),{afterPhase:"Sign"}),e}function Q2(){const t=S5();return{async sendRequest(e){const{abortSignal:n,cleanup:r}=e.abortSignal?K2(e.abortSignal):{};try{return e.abortSignal=n,await t.sendRequest(e)}finally{r==null||r()}}}}function X2(t){return sf(t)}function Y2(t){return t5(t)}const $6=l6;function H6(t={}){return c6(t)}const q6=A2;function j6(t={}){return u6(t)}const V6=R2;function z6(t={}){return d6(t)}const G6=Mf("core-rest-pipeline retryPolicy");function W6(t,e={maxRetries:y6}){return Of(t,{logger:G6,...e})}const K6={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:1e3*60*2};async function J6(t,e,n){async function r(){if(Date.now()<n)try{return await t()}catch{return null}else{const o=await t();if(o===null)throw new Error("Failed to refresh access token.");return o}}let i=await r();for(;i===null;)await o2(e),i=await r();return i}function Z2(t,e){let n=null,r=null,i;const o={...K6,...e},s={get isRefreshing(){return n!==null},get shouldRefresh(){return s.isRefreshing?!1:r!=null&&r.refreshAfterTimestamp&&r.refreshAfterTimestamp<Date.now()?!0:((r==null?void 0:r.expiresOnTimestamp)??0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return r===null||r.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function l(c,a){return s.isRefreshing||(n=J6(()=>t.getToken(c,a),o.retryIntervalInMs,(r==null?void 0:r.expiresOnTimestamp)??Date.now()).then(d=>(n=null,r=d,i=a.tenantId,r)).catch(d=>{throw n=null,r=null,i=void 0,d})),n}return async(c,a)=>{const u=!!a.claims,d=i!==a.tenantId;return u&&(r=null),d||u||s.mustRefresh?l(c,a):(s.shouldRefresh&&l(c,a),r)}}const eF="bearerTokenAuthenticationPolicy";async function dg(t,e){try{return[await e(t),void 0]}catch(n){if(jb(n)&&n.response)return[n.response,n];throw n}}async function Q6(t){const{scopes:e,getAccessToken:n,request:r}=t,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions,enableCae:!0},o=await n(e,i);o&&t.request.headers.set("Authorization",`Bearer ${o.token}`)}function AO(t){return t.status===401&&t.headers.has("WWW-Authenticate")}async function RO(t,e){const{scopes:n}=t,r=await t.getAccessToken(n,{enableCae:!0,claims:e});return r?(t.request.headers.set("Authorization",`${r.tokenType??"Bearer"} ${r.token}`),!0):!1}function Df(t){var l,c;const{credential:e,scopes:n,challengeCallbacks:r}=t,i=t.logger||nc,o={authorizeRequest:((l=r==null?void 0:r.authorizeRequest)==null?void 0:l.bind(r))??Q6,authorizeRequestOnChallenge:(c=r==null?void 0:r.authorizeRequestOnChallenge)==null?void 0:c.bind(r)},s=e?Z2(e):()=>Promise.resolve(null);return{name:eF,async sendRequest(a,u){if(!a.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");await o.authorizeRequest({scopes:Array.isArray(n)?n:[n],request:a,getAccessToken:s,logger:i});let d,f,h;if([d,f]=await dg(a,u),AO(d)){let g=kO(d.headers.get("WWW-Authenticate"));if(g){let E;try{E=atob(g)}catch{return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${g}`),d}h=await RO({scopes:Array.isArray(n)?n:[n],response:d,request:a,getAccessToken:s,logger:i},E),h&&([d,f]=await dg(a,u))}else if(o.authorizeRequestOnChallenge&&(h=await o.authorizeRequestOnChallenge({scopes:Array.isArray(n)?n:[n],request:a,response:d,getAccessToken:s,logger:i}),h&&([d,f]=await dg(a,u)),AO(d)&&(g=kO(d.headers.get("WWW-Authenticate")),g))){let E;try{E=atob(g)}catch{return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${g}`),d}h=await RO({scopes:Array.isArray(n)?n:[n],response:d,request:a,getAccessToken:s,logger:i},E),h&&([d,f]=await dg(a,u))}}if(f)throw f;return d}}}function X6(t){const e=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,n=/(\w+)="([^"]*)"/g,r=[];let i;for(;(i=e.exec(t))!==null;){const o=i[1],s=i[2],l={};let c;for(;(c=n.exec(s))!==null;)l[c[1]]=c[2];r.push({scheme:o,params:l})}return r}function kO(t){var n;return t?(n=X6(t).find(r=>r.scheme==="Bearer"&&r.params.claims&&r.params.error==="insufficient_claims"))==null?void 0:n.params.claims:void 0}const tF="ndJsonPolicy";function Y6(){return{name:tF,async sendRequest(t,e){if(typeof t.body=="string"&&t.body.startsWith("[")){const n=JSON.parse(t.body);Array.isArray(n)&&(t.body=n.map(r=>JSON.stringify(r)+`
`).join(""))}return e(t)}}}const qE="auxiliaryAuthenticationHeaderPolicy",PO="x-ms-authorization-auxiliary";async function Z6(t){var o;const{scopes:e,getAccessToken:n,request:r}=t,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions};return((o=await n(e,i))==null?void 0:o.token)??""}function e8(t){const{credentials:e,scopes:n}=t,r=t.logger||nc,i=new WeakMap;return{name:qE,async sendRequest(o,s){if(!o.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication for auxiliary header is not permitted for non-TLS protected (non-https) URLs.");if(!e||e.length===0)return r.info(`${qE} header will not be set due to empty credentials.`),s(o);const l=[];for(const a of e){let u=i.get(a);u||(u=Z2(a),i.set(a,u)),l.push(Z6({scopes:Array.isArray(n)?n:[n],request:o,getAccessToken:u}))}const c=(await Promise.all(l)).filter(a=>!!a);return c.length===0?(r.warning(`None of the auxiliary tokens are valid. ${PO} header will not be set.`),s(o)):(o.headers.set(PO,c.map(a=>`Bearer ${a}`).join(", ")),s(o))}}}const t8=Object.freeze(Object.defineProperty({__proto__:null,RestError:Hl,agentPolicy:V2,agentPolicyName:k6,auxiliaryAuthenticationHeaderPolicy:e8,auxiliaryAuthenticationHeaderPolicyName:qE,bearerTokenAuthenticationPolicy:Df,bearerTokenAuthenticationPolicyName:eF,createDefaultHttpClient:Q2,createEmptyPipeline:_2,createFile:I6,createFileFromStream:w6,createHttpHeaders:X2,createPipelineFromOptions:J2,createPipelineRequest:Y2,decompressResponsePolicy:F2,decompressResponsePolicyName:b6,defaultRetryPolicy:B2,exponentialRetryPolicy:H6,exponentialRetryPolicyName:$6,formDataPolicy:$2,formDataPolicyName:_6,getDefaultProxySettings:R6,isRestError:jb,logPolicy:k2,logPolicyName:h6,multipartPolicy:U2,multipartPolicyName:Hb,ndJsonPolicy:Y6,ndJsonPolicyName:tF,proxyPolicy:H2,proxyPolicyName:A6,redirectPolicy:P2,redirectPolicyName:f6,retryPolicy:W6,setClientRequestIdPolicy:j2,setClientRequestIdPolicyName:q2,systemErrorRetryPolicy:j6,systemErrorRetryPolicyName:q6,throttlingRetryPolicy:z6,throttlingRetryPolicyName:V6,tlsPolicy:z2,tlsPolicyName:P6,tracingPolicy:W2,tracingPolicyName:G2,userAgentPolicy:N2,userAgentPolicyName:D2},Symbol.toStringTag,{value:"Module"}));class n8{constructor(e){Ye(this,"_key");if(!e)throw new Error("key must be a non-empty string");this._key=e}get key(){return this._key}update(e){this._key=e}}function nF(t){const e=t;return e&&typeof e.getToken=="function"&&(e.signRequest===void 0||e.getToken.length>0)}function r8(t){return nF(t)?Df({credential:t,scopes:["https://communication.azure.com//.default"]}):u2(t)}const i8=/endpoint=(.*);accesskey=(.*)/i,o8=t=>{const e=t.match(i8);if(e!=null&&e[1]&&e[2])return{endpoint:e[1],credential:new n8(e[2])}},rF=t=>{const e=o8(t);if(e)return e;throw new Error(`Invalid connection string ${t}`)},s8=t=>{var e;const n=new URL(t);return!!(!((e=n.protocol)===null||e===void 0)&&e.match(/^http[s]?/))&&n.host!==void 0&&n.host!==""&&(n.pathname===void 0||n.pathname===""||n.pathname==="/")},OO=t=>{if(!s8(t))throw new Error(`Invalid endpoint url ${t}`)},iF=t=>{const e=t;return e&&typeof e.key=="string"&&e.getToken===void 0},a8=(t,e)=>{if(iF(e)||nF(e))return OO(t),{url:t,credential:e};{const{endpoint:n,credential:r}=rF(t);return OO(n),{url:n,credential:r}}},oF=t=>typeof t.communicationUserId=="string",sF=t=>typeof t.phoneNumber=="string",aF=t=>typeof t.microsoftTeamsUserId=="string",lF=t=>typeof t.teamsAppId=="string",l8=t=>typeof t.id=="string",ey=t=>oF(t)?Object.assign(Object.assign({},t),{kind:"communicationUser"}):sF(t)?Object.assign(Object.assign({},t),{kind:"phoneNumber"}):aF(t)?Object.assign(Object.assign({},t),{kind:"microsoftTeamsUser"}):lF(t)?Object.assign(Object.assign({},t),{kind:"microsoftTeamsApp"}):Object.assign(Object.assign({},t),{kind:"unknown"}),mh=t=>{const e=ey(t);switch(e.kind){case"communicationUser":return e.communicationUserId;case"microsoftTeamsUser":{const{microsoftTeamsUserId:n,rawId:r,cloud:i,isAnonymous:o}=e;if(r)return r;if(o)return`8:teamsvisitor:${n}`;switch(i){case"dod":return`8:dod:${n}`;case"gcch":return`8:gcch:${n}`;case"public":return`8:orgid:${n}`}return`8:orgid:${n}`}case"microsoftTeamsApp":{const{teamsAppId:n,rawId:r,cloud:i}=e;if(r)return r;switch(i){case"dod":return`28:dod:${n}`;case"gcch":return`28:gcch:${n}`}return`28:orgid:${n}`}case"phoneNumber":{const{phoneNumber:n,rawId:r}=e;return r||`4:${n}`}case"unknown":return e.id}},H0=(t,e)=>({kind:"microsoftTeamsApp",teamsAppId:t,cloud:e}),q0=(t,e,n)=>({kind:"microsoftTeamsUser",microsoftTeamsUserId:t,isAnonymous:n,cloud:e}),c8=t=>{if(t.startsWith("4:"))return{kind:"phoneNumber",phoneNumber:`${t.substring(2)}`};const e=t.split(":");if(e.length!==3)return{kind:"unknown",id:t};const n=`${e[0]}:${e[1]}:`,r=e[2];switch(n){case"8:teamsvisitor:":return{kind:"microsoftTeamsUser",microsoftTeamsUserId:r,isAnonymous:!0};case"8:orgid:":return q0(r,"public",!1);case"8:dod:":return q0(r,"dod",!1);case"8:gcch:":return q0(r,"gcch",!1);case"8:acs:":case"8:spool:":case"8:dod-acs:":case"8:gcch-acs:":return{kind:"communicationUser",communicationUserId:t};case"28:orgid:":return H0(r,"public");case"28:gcch:":return H0(r,"gcch");case"28:dod:":return H0(r,"dod")}return{kind:"unknown",id:t}},Eo=(t,e)=>{const n=Object.keys(t)[0],r=t[n];if(e in r)return r[e];throw new Error(`Property ${e} is required for identifier of type ${n}.`)},u8=t=>{const e=[];if(t.communicationUser!==void 0&&e.push("communicationUser"),t.microsoftTeamsUser!==void 0&&e.push("microsoftTeamsUser"),t.microsoftTeamsApp!==void 0&&e.push("microsoftTeamsApp"),t.phoneNumber!==void 0&&e.push("phoneNumber"),e.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(e)} should be present.`)},Nf=t=>{var e,n,r,i,o,s;const l=ey(t);switch(l.kind){case"communicationUser":return{rawId:mh(l),communicationUser:{id:l.communicationUserId}};case"phoneNumber":return{rawId:(e=l.rawId)!==null&&e!==void 0?e:mh(l),phoneNumber:{value:l.phoneNumber}};case"microsoftTeamsUser":return{rawId:(n=l.rawId)!==null&&n!==void 0?n:mh(l),microsoftTeamsUser:{userId:l.microsoftTeamsUserId,isAnonymous:(r=l.isAnonymous)!==null&&r!==void 0?r:!1,cloud:(i=l.cloud)!==null&&i!==void 0?i:"public"}};case"microsoftTeamsApp":return{rawId:(o=l.rawId)!==null&&o!==void 0?o:mh(l),microsoftTeamsApp:{appId:l.teamsAppId,cloud:(s=l.cloud)!==null&&s!==void 0?s:"public"}};case"unknown":return{rawId:l.id};default:throw new Error(`Can't serialize an identifier with kind ${l.kind}`)}},d8=t=>t.communicationUser?"communicationUser":t.phoneNumber?"phoneNumber":t.microsoftTeamsUser?"microsoftTeamsUser":t.microsoftTeamsApp?"microsoftTeamsApp":"unknown",Vo=t=>{var e;u8(t);const{communicationUser:n,microsoftTeamsUser:r,microsoftTeamsApp:i,phoneNumber:o}=t,s=(e=t.kind)!==null&&e!==void 0?e:d8(t);return s==="communicationUser"&&n?{kind:"communicationUser",communicationUserId:Eo({communicationUser:n},"id")}:s==="phoneNumber"&&o?{kind:"phoneNumber",phoneNumber:Eo({phoneNumber:o},"value"),rawId:Eo({phoneNumber:t},"rawId")}:s==="microsoftTeamsUser"&&r?{kind:"microsoftTeamsUser",microsoftTeamsUserId:Eo({microsoftTeamsUser:r},"userId"),isAnonymous:Eo({microsoftTeamsUser:r},"isAnonymous"),cloud:Eo({microsoftTeamsUser:r},"cloud"),rawId:Eo({microsoftTeamsUser:t},"rawId")}:s==="microsoftTeamsApp"&&i?{kind:"microsoftTeamsApp",teamsAppId:Eo({microsoftTeamsApp:i},"appId"),cloud:Eo({microsoftTeamsApp:i},"cloud"),rawId:Eo({microsoftTeamsApp:t},"rawId")}:{kind:"unknown",id:Eo({unknown:t},"rawId")}},h8=Object.freeze(Object.defineProperty({__proto__:null,AzureCommunicationTokenCredential:WU,createCommunicationAccessKeyCredentialPolicy:u2,createCommunicationAuthPolicy:r8,createIdentifierFromRawId:c8,deserializeCommunicationIdentifier:Vo,getIdentifierKind:ey,getIdentifierRawId:mh,isCommunicationUserIdentifier:oF,isKeyCredential:iF,isMicrosoftTeamsAppIdentifier:lF,isMicrosoftTeamsUserIdentifier:aF,isPhoneNumberIdentifier:sF,isUnknownIdentifier:l8,parseClientArguments:a8,parseConnectionString:rF,serializeCommunicationIdentifier:Nf},Symbol.toStringTag,{value:"Module"})),f8=Hs(h8);function Cn(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function We(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})}function MO(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function at(t){return this instanceof at?(this.v=t,this):new at(t)}function Ar(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(h){return function(g){return Promise.resolve(g).then(h,d)}}function l(h,g){r[h]&&(i[h]=function(E){return new Promise(function(D,w){o.push([h,E,D,w])>1||c(h,E)})},g&&(i[h]=g(i[h])))}function c(h,g){try{a(r[h](g))}catch(E){f(o[0][3],E)}}function a(h){h.value instanceof at?Promise.resolve(h.value.v).then(u,d):f(o[0][2],h)}function u(h){c("next",h)}function d(h){c("throw",h)}function f(h,g){h(g),o.shift(),o.length&&c(o[0][0],o[0][1])}}function Oa(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,o){e[i]=t[i]?function(s){return(n=!n)?{value:at(t[i](s)),done:!1}:o?o(s):s}:o}}function Rr(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof MO=="function"?MO(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(s){return new Promise(function(l,c){s=t[o](s),i(l,c,s.done,s.value)})}}function i(o,s,l,c){Promise.resolve(c).then(function(a){o({value:a,done:l})},s)}}var cF={exports:{}},hg,p8=new Uint8Array(16);function uF(){if(!hg&&(hg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!hg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return hg(p8)}const g8=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ty(t){return typeof t=="string"&&g8.test(t)}var wr=[];for(var j0=0;j0<256;++j0)wr.push((j0+256).toString(16).substr(1));function ny(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(wr[t[e+0]]+wr[t[e+1]]+wr[t[e+2]]+wr[t[e+3]]+"-"+wr[t[e+4]]+wr[t[e+5]]+"-"+wr[t[e+6]]+wr[t[e+7]]+"-"+wr[t[e+8]]+wr[t[e+9]]+"-"+wr[t[e+10]]+wr[t[e+11]]+wr[t[e+12]]+wr[t[e+13]]+wr[t[e+14]]+wr[t[e+15]]).toLowerCase();if(!ty(n))throw TypeError("Stringified UUID is invalid");return n}var DO,V0,z0=0,G0=0;function m8(t,e,n){var r=e&&n||0,i=e||new Array(16);t=t||{};var o=t.node||DO,s=t.clockseq!==void 0?t.clockseq:V0;if(o==null||s==null){var l=t.random||(t.rng||uF)();o==null&&(o=DO=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),s==null&&(s=V0=(l[6]<<8|l[7])&16383)}var c=t.msecs!==void 0?t.msecs:Date.now(),a=t.nsecs!==void 0?t.nsecs:G0+1,u=c-z0+(a-G0)/1e4;if(u<0&&t.clockseq===void 0&&(s=s+1&16383),(u<0||c>z0)&&t.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");z0=c,G0=a,V0=s,c+=122192928e5;var d=((c&268435455)*1e4+a)%4294967296;i[r++]=d>>>24&255,i[r++]=d>>>16&255,i[r++]=d>>>8&255,i[r++]=d&255;var f=c/4294967296*1e4&268435455;i[r++]=f>>>8&255,i[r++]=f&255,i[r++]=f>>>24&15|16,i[r++]=f>>>16&255,i[r++]=s>>>8|128,i[r++]=s&255;for(var h=0;h<6;++h)i[r+h]=o[h];return e||ny(i)}function dF(t){if(!ty(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}function v8(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}var y8="6ba7b810-9dad-11d1-80b4-00c04fd430c8",C8="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function hF(t,e,n){function r(i,o,s,l){if(typeof i=="string"&&(i=v8(i)),typeof o=="string"&&(o=dF(o)),o.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(o),c.set(i,o.length),c=n(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){l=l||0;for(var a=0;a<16;++a)s[l+a]=c[a];return s}return ny(c)}try{r.name=t}catch{}return r.DNS=y8,r.URL=C8,r}function S8(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return T8(E8(w8(t),t.length*8))}function T8(t){for(var e=[],n=t.length*32,r="0123456789abcdef",i=0;i<n;i+=8){var o=t[i>>5]>>>i%32&255,s=parseInt(r.charAt(o>>>4&15)+r.charAt(o&15),16);e.push(s)}return e}function fF(t){return(t+64>>>9<<4)+14+1}function E8(t,e){t[e>>5]|=128<<e%32,t[fF(e)-1]=e;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<t.length;s+=16){var l=n,c=r,a=i,u=o;n=qr(n,r,i,o,t[s],7,-680876936),o=qr(o,n,r,i,t[s+1],12,-389564586),i=qr(i,o,n,r,t[s+2],17,606105819),r=qr(r,i,o,n,t[s+3],22,-1044525330),n=qr(n,r,i,o,t[s+4],7,-176418897),o=qr(o,n,r,i,t[s+5],12,1200080426),i=qr(i,o,n,r,t[s+6],17,-1473231341),r=qr(r,i,o,n,t[s+7],22,-45705983),n=qr(n,r,i,o,t[s+8],7,1770035416),o=qr(o,n,r,i,t[s+9],12,-1958414417),i=qr(i,o,n,r,t[s+10],17,-42063),r=qr(r,i,o,n,t[s+11],22,-1990404162),n=qr(n,r,i,o,t[s+12],7,1804603682),o=qr(o,n,r,i,t[s+13],12,-40341101),i=qr(i,o,n,r,t[s+14],17,-1502002290),r=qr(r,i,o,n,t[s+15],22,1236535329),n=jr(n,r,i,o,t[s+1],5,-165796510),o=jr(o,n,r,i,t[s+6],9,-1069501632),i=jr(i,o,n,r,t[s+11],14,643717713),r=jr(r,i,o,n,t[s],20,-373897302),n=jr(n,r,i,o,t[s+5],5,-701558691),o=jr(o,n,r,i,t[s+10],9,38016083),i=jr(i,o,n,r,t[s+15],14,-660478335),r=jr(r,i,o,n,t[s+4],20,-405537848),n=jr(n,r,i,o,t[s+9],5,568446438),o=jr(o,n,r,i,t[s+14],9,-1019803690),i=jr(i,o,n,r,t[s+3],14,-187363961),r=jr(r,i,o,n,t[s+8],20,1163531501),n=jr(n,r,i,o,t[s+13],5,-1444681467),o=jr(o,n,r,i,t[s+2],9,-51403784),i=jr(i,o,n,r,t[s+7],14,1735328473),r=jr(r,i,o,n,t[s+12],20,-1926607734),n=Vr(n,r,i,o,t[s+5],4,-378558),o=Vr(o,n,r,i,t[s+8],11,-2022574463),i=Vr(i,o,n,r,t[s+11],16,1839030562),r=Vr(r,i,o,n,t[s+14],23,-35309556),n=Vr(n,r,i,o,t[s+1],4,-1530992060),o=Vr(o,n,r,i,t[s+4],11,1272893353),i=Vr(i,o,n,r,t[s+7],16,-155497632),r=Vr(r,i,o,n,t[s+10],23,-1094730640),n=Vr(n,r,i,o,t[s+13],4,681279174),o=Vr(o,n,r,i,t[s],11,-358537222),i=Vr(i,o,n,r,t[s+3],16,-722521979),r=Vr(r,i,o,n,t[s+6],23,76029189),n=Vr(n,r,i,o,t[s+9],4,-640364487),o=Vr(o,n,r,i,t[s+12],11,-421815835),i=Vr(i,o,n,r,t[s+15],16,530742520),r=Vr(r,i,o,n,t[s+2],23,-995338651),n=zr(n,r,i,o,t[s],6,-198630844),o=zr(o,n,r,i,t[s+7],10,1126891415),i=zr(i,o,n,r,t[s+14],15,-1416354905),r=zr(r,i,o,n,t[s+5],21,-57434055),n=zr(n,r,i,o,t[s+12],6,1700485571),o=zr(o,n,r,i,t[s+3],10,-1894986606),i=zr(i,o,n,r,t[s+10],15,-1051523),r=zr(r,i,o,n,t[s+1],21,-2054922799),n=zr(n,r,i,o,t[s+8],6,1873313359),o=zr(o,n,r,i,t[s+15],10,-30611744),i=zr(i,o,n,r,t[s+6],15,-1560198380),r=zr(r,i,o,n,t[s+13],21,1309151649),n=zr(n,r,i,o,t[s+4],6,-145523070),o=zr(o,n,r,i,t[s+11],10,-1120210379),i=zr(i,o,n,r,t[s+2],15,718787259),r=zr(r,i,o,n,t[s+9],21,-343485551),n=Sa(n,l),r=Sa(r,c),i=Sa(i,a),o=Sa(o,u)}return[n,r,i,o]}function w8(t){if(t.length===0)return[];for(var e=t.length*8,n=new Uint32Array(fF(e)),r=0;r<e;r+=8)n[r>>5]|=(t[r/8]&255)<<r%32;return n}function Sa(t,e){var n=(t&65535)+(e&65535),r=(t>>16)+(e>>16)+(n>>16);return r<<16|n&65535}function I8(t,e){return t<<e|t>>>32-e}function ry(t,e,n,r,i,o){return Sa(I8(Sa(Sa(e,t),Sa(r,o)),i),n)}function qr(t,e,n,r,i,o,s){return ry(e&n|~e&r,t,e,i,o,s)}function jr(t,e,n,r,i,o,s){return ry(e&r|n&~r,t,e,i,o,s)}function Vr(t,e,n,r,i,o,s){return ry(e^n^r,t,e,i,o,s)}function zr(t,e,n,r,i,o,s){return ry(n^(e|~r),t,e,i,o,s)}var b8=hF("v3",48,S8);function pF(t,e,n){t=t||{};var r=t.random||(t.rng||uF)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return ny(r)}function _8(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function W0(t,e){return t<<e|t>>>32-e}function A8(t){var e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var r=unescape(encodeURIComponent(t));t=[];for(var i=0;i<r.length;++i)t.push(r.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,s=Math.ceil(o/16),l=new Array(s),c=0;c<s;++c){for(var a=new Uint32Array(16),u=0;u<16;++u)a[u]=t[c*64+u*4]<<24|t[c*64+u*4+1]<<16|t[c*64+u*4+2]<<8|t[c*64+u*4+3];l[c]=a}l[s-1][14]=(t.length-1)*8/Math.pow(2,32),l[s-1][14]=Math.floor(l[s-1][14]),l[s-1][15]=(t.length-1)*8&4294967295;for(var d=0;d<s;++d){for(var f=new Uint32Array(80),h=0;h<16;++h)f[h]=l[d][h];for(var g=16;g<80;++g)f[g]=W0(f[g-3]^f[g-8]^f[g-14]^f[g-16],1);for(var E=n[0],D=n[1],w=n[2],p=n[3],b=n[4],j=0;j<80;++j){var K=Math.floor(j/20),M=W0(E,5)+_8(K,D,w,p)+b+e[K]+f[j]>>>0;b=p,p=w,w=W0(D,30)>>>0,D=E,E=M}n[0]=n[0]+E>>>0,n[1]=n[1]+D>>>0,n[2]=n[2]+w>>>0,n[3]=n[3]+p>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var R8=hF("v5",80,A8);const k8="00000000-0000-0000-0000-000000000000";function P8(t){if(!ty(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}const O8=Object.freeze(Object.defineProperty({__proto__:null,NIL:k8,parse:dF,stringify:ny,v1:m8,v3:b8,v4:pF,v5:R8,validate:ty,version:P8},Symbol.toStringTag,{value:"Module"})),gF=Hs(O8),mF=Hs(zW);function vF(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function yF(t){const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}function M8(t){return atob(t)}const pr="$",_u="_";function D8(t,e){return e!=="Composite"&&e!=="Dictionary"&&(typeof t=="string"||typeof t=="number"||typeof t=="boolean"||(e==null?void 0:e.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))!==null||t===void 0||t===null)}const N8=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function x8(t){return N8.test(t)}const L8=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function U8(t){return L8.test(t)}function F8(t){const e={...t.headers,...t.body};return t.hasNullableType&&Object.getOwnPropertyNames(e).length===0?t.shouldWrapBody?{body:null}:null:t.shouldWrapBody?{...t.headers,body:t.body}:e}function NO(t,e){var c;const n=t.parsedHeaders;if(t.request.method==="HEAD")return{...n,body:t.parsedBody};const r=e&&e.bodyMapper,i=!!(r!=null&&r.nullable),o=r==null?void 0:r.type.name;if(o==="Stream")return{...n,blobBody:t.blobBody,readableStreamBody:t.readableStreamBody};const s=o==="Composite"&&r.type.modelProperties||{},l=Object.keys(s).some(a=>s[a].serializedName==="");if(o==="Sequence"||l){const a=t.parsedBody??[];for(const u of Object.keys(s))s[u].serializedName&&(a[u]=(c=t.parsedBody)==null?void 0:c[u]);if(n)for(const u of Object.keys(n))a[u]=n[u];return i&&!t.parsedBody&&!n&&Object.getOwnPropertyNames(s).length===0?null:a}return F8({body:t.parsedBody,headers:n,hasNullableType:i,shouldWrapBody:D8(t.parsedBody,o)})}class B8{constructor(e={},n=!1){Ye(this,"modelMappers");Ye(this,"isXML");this.modelMappers=e,this.isXML=n}validateConstraints(e,n,r){const i=(o,s)=>{throw new Error(`"${r}" with value "${n}" should satisfy the constraint "${o}": ${s}.`)};if(e.constraints&&n!==void 0&&n!==null){const{ExclusiveMaximum:o,ExclusiveMinimum:s,InclusiveMaximum:l,InclusiveMinimum:c,MaxItems:a,MaxLength:u,MinItems:d,MinLength:f,MultipleOf:h,Pattern:g,UniqueItems:E}=e.constraints;if(o!==void 0&&n>=o&&i("ExclusiveMaximum",o),s!==void 0&&n<=s&&i("ExclusiveMinimum",s),l!==void 0&&n>l&&i("InclusiveMaximum",l),c!==void 0&&n<c&&i("InclusiveMinimum",c),a!==void 0&&n.length>a&&i("MaxItems",a),u!==void 0&&n.length>u&&i("MaxLength",u),d!==void 0&&n.length<d&&i("MinItems",d),f!==void 0&&n.length<f&&i("MinLength",f),h!==void 0&&n%h!==0&&i("MultipleOf",h),g){const D=typeof g=="string"?new RegExp(g):g;(typeof n!="string"||n.match(D)===null)&&i("Pattern",g)}E&&n.some((D,w,p)=>p.indexOf(D)!==w)&&i("UniqueItems",E)}}serialize(e,n,r,i={xml:{}}){const o={xml:{rootName:i.xml.rootName??"",includeRoot:i.xml.includeRoot??!1,xmlCharKey:i.xml.xmlCharKey??_u}};let s={};const l=e.type.name;r||(r=e.serializedName),l.match(/^Sequence$/i)!==null&&(s=[]),e.isConstant&&(n=e.defaultValue);const{required:c,nullable:a}=e;if(c&&a&&n===void 0)throw new Error(`${r} cannot be undefined.`);if(c&&!a&&n==null)throw new Error(`${r} cannot be null or undefined.`);if(!c&&a===!1&&n===null)throw new Error(`${r} cannot be null.`);return n==null||l.match(/^any$/i)!==null?s=n:l.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)!==null?s=z8(l,r,n):l.match(/^Enum$/i)!==null?s=G8(r,e.type.allowedValues,n):l.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)!==null?s=J8(l,n,r):l.match(/^ByteArray$/i)!==null?s=W8(r,n):l.match(/^Base64Url$/i)!==null?s=K8(r,n):l.match(/^Sequence$/i)!==null?s=Q8(this,e,n,r,!!this.isXML,o):l.match(/^Dictionary$/i)!==null?s=X8(this,e,n,r,!!this.isXML,o):l.match(/^Composite$/i)!==null&&(s=Z8(this,e,n,r,!!this.isXML,o)),s}deserialize(e,n,r,i={xml:{}}){const o={xml:{rootName:i.xml.rootName??"",includeRoot:i.xml.includeRoot??!1,xmlCharKey:i.xml.xmlCharKey??_u},ignoreUnknownProperties:i.ignoreUnknownProperties??!1};if(n==null)return this.isXML&&e.type.name==="Sequence"&&!e.xmlIsWrapped&&(n=[]),e.defaultValue!==void 0&&(n=e.defaultValue),n;let s;const l=e.type.name;if(r||(r=e.serializedName),l.match(/^Composite$/i)!==null)s=tK(this,e,n,r,o);else{if(this.isXML){const c=o.xml.xmlCharKey;n[pr]!==void 0&&n[c]!==void 0&&(n=n[c])}l.match(/^Number$/i)!==null?(s=parseFloat(n),isNaN(s)&&(s=n)):l.match(/^Boolean$/i)!==null?n==="true"?s=!0:n==="false"?s=!1:s=n:l.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)!==null?s=n:l.match(/^(Date|DateTime|DateTimeRfc1123)$/i)!==null?s=new Date(n):l.match(/^UnixTime$/i)!==null?s=V8(n):l.match(/^ByteArray$/i)!==null?s=yF(n):l.match(/^Base64Url$/i)!==null?s=q8(n):l.match(/^Sequence$/i)!==null?s=rK(this,e,n,r,o):l.match(/^Dictionary$/i)!==null&&(s=nK(this,e,n,r,o))}return e.isConstant&&(s=e.defaultValue),s}}function xf(t={},e=!1){return new B8(t,e)}function $8(t,e){let n=t.length;for(;n-1>=0&&t[n-1]===e;)--n;return t.substr(0,n)}function H8(t){if(!t)return;if(!(t instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");const e=vF(t);return $8(e,"=").replace(/\+/g,"-").replace(/\//g,"_")}function q8(t){if(t){if(t&&typeof t.valueOf()!="string")throw new Error("Please provide an input of type string for converting to Uint8Array");return t=t.replace(/-/g,"+").replace(/_/g,"/"),yF(t)}}function jE(t){const e=[];let n="";if(t){const r=t.split(".");for(const i of r)i.charAt(i.length-1)==="\\"?n+=i.substr(0,i.length-1)+".":(n+=i,e.push(n),n="")}return e}function j8(t){if(t)return typeof t.valueOf()=="string"&&(t=new Date(t)),Math.floor(t.getTime()/1e3)}function V8(t){if(t)return new Date(t*1e3)}function z8(t,e,n){if(n!=null){if(t.match(/^Number$/i)!==null){if(typeof n!="number")throw new Error(`${e} with value ${n} must be of type number.`)}else if(t.match(/^String$/i)!==null){if(typeof n.valueOf()!="string")throw new Error(`${e} with value "${n}" must be of type string.`)}else if(t.match(/^Uuid$/i)!==null){if(!(typeof n.valueOf()=="string"&&U8(n)))throw new Error(`${e} with value "${n}" must be of type string and a valid uuid.`)}else if(t.match(/^Boolean$/i)!==null){if(typeof n!="boolean")throw new Error(`${e} with value ${n} must be of type boolean.`)}else if(t.match(/^Stream$/i)!==null){const r=typeof n;if(r!=="string"&&typeof n.pipe!="function"&&typeof n.tee!="function"&&!(n instanceof ArrayBuffer)&&!ArrayBuffer.isView(n)&&!((typeof Blob=="function"||typeof Blob=="object")&&n instanceof Blob)&&r!=="function")throw new Error(`${e} must be a string, Blob, ArrayBuffer, ArrayBufferView, ReadableStream, or () => ReadableStream.`)}}return n}function G8(t,e,n){if(!e)throw new Error(`Please provide a set of allowedValues to validate ${t} as an Enum Type.`);if(!e.some(i=>typeof i.valueOf()=="string"?i.toLowerCase()===n.toLowerCase():i===n))throw new Error(`${n} is not a valid value for ${t}. The valid values are: ${JSON.stringify(e)}.`);return n}function W8(t,e){if(e!=null){if(!(e instanceof Uint8Array))throw new Error(`${t} must be of type Uint8Array.`);e=vF(e)}return e}function K8(t,e){if(e!=null){if(!(e instanceof Uint8Array))throw new Error(`${t} must be of type Uint8Array.`);e=H8(e)}return e}function J8(t,e,n){if(e!=null){if(t.match(/^Date$/i)!==null){if(!(e instanceof Date||typeof e.valueOf()=="string"&&!isNaN(Date.parse(e))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);e=e instanceof Date?e.toISOString().substring(0,10):new Date(e).toISOString().substring(0,10)}else if(t.match(/^DateTime$/i)!==null){if(!(e instanceof Date||typeof e.valueOf()=="string"&&!isNaN(Date.parse(e))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);e=e instanceof Date?e.toISOString():new Date(e).toISOString()}else if(t.match(/^DateTimeRfc1123$/i)!==null){if(!(e instanceof Date||typeof e.valueOf()=="string"&&!isNaN(Date.parse(e))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);e=e instanceof Date?e.toUTCString():new Date(e).toUTCString()}else if(t.match(/^UnixTime$/i)!==null){if(!(e instanceof Date||typeof e.valueOf()=="string"&&!isNaN(Date.parse(e))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);e=j8(e)}else if(t.match(/^TimeSpan$/i)!==null&&!x8(e))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${e}".`)}return e}function Q8(t,e,n,r,i,o){if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);let s=e.type.element;if(!s||typeof s!="object")throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);s.type.name==="Composite"&&s.type.className&&(s=t.modelMappers[s.type.className]??s);const l=[];for(let c=0;c<n.length;c++){const a=t.serialize(s,n[c],r,o);if(i&&s.xmlNamespace){const u=s.xmlNamespacePrefix?`xmlns:${s.xmlNamespacePrefix}`:"xmlns";s.type.name==="Composite"?(l[c]={...a},l[c][pr]={[u]:s.xmlNamespace}):(l[c]={},l[c][o.xml.xmlCharKey]=a,l[c][pr]={[u]:s.xmlNamespace})}else l[c]=a}return l}function X8(t,e,n,r,i,o){if(typeof n!="object")throw new Error(`${r} must be of type object.`);const s=e.type.value;if(!s||typeof s!="object")throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const l={};for(const c of Object.keys(n)){const a=t.serialize(s,n[c],r,o);l[c]=TF(s,a,i,o)}if(i&&e.xmlNamespace){const c=e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns",a=l;return a[pr]={[c]:e.xmlNamespace},a}return l}function Y8(t,e,n){const r=e.type.additionalProperties;if(!r&&e.type.className){const i=CF(t,e,n);return i==null?void 0:i.type.additionalProperties}return r}function CF(t,e,n){const r=e.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(e,void 0,2)}".`);return t.modelMappers[r]}function SF(t,e,n){let r=e.type.modelProperties;if(!r){const i=CF(t,e,n);if(!i)throw new Error(`mapper() cannot be null or undefined for model "${e.type.className}".`);if(r=i==null?void 0:i.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(i)}" of type "${e.type.className}" for object "${n}".`)}return r}function Z8(t,e,n,r,i,o){if(lv(t,e)&&(e=EF(t,e,n,"clientName")),n!=null){const s={},l=SF(t,e,r);for(const a of Object.keys(l)){const u=l[a];if(u.readOnly)continue;let d,f=s;if(t.isXML)u.xmlIsWrapped?d=u.xmlName:d=u.xmlElementName||u.xmlName;else{const h=jE(u.serializedName);d=h.pop();for(const g of h){const E=f[g];E==null&&(n[a]!==void 0&&n[a]!==null||u.defaultValue!==void 0)&&(f[g]={}),f=f[g]}}if(f!=null){if(i&&e.xmlNamespace){const w=e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns";f[pr]={...f[pr],[w]:e.xmlNamespace}}const h=u.serializedName!==""?r+"."+u.serializedName:r;let g=n[a];const E=lv(t,e);E&&E.clientName===a&&g==null&&(g=e.serializedName);const D=t.serialize(u,g,h,o);if(D!==void 0&&d!==void 0&&d!==null){const w=TF(u,D,i,o);i&&u.xmlIsAttribute?(f[pr]=f[pr]||{},f[pr][d]=D):i&&u.xmlIsWrapped?f[d]={[u.xmlElementName]:w}:f[d]=w}}}const c=Y8(t,e,r);if(c){const a=Object.keys(l);for(const u in n)a.every(f=>f!==u)&&(s[u]=t.serialize(c,n[u],r+'["'+u+'"]',o))}return s}return n}function TF(t,e,n,r){if(!n||!t.xmlNamespace)return e;const o={[t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns"]:t.xmlNamespace};if(["Composite"].includes(t.type.name)){if(e[pr])return e;{const l={...e};return l[pr]=o,l}}const s={};return s[r.xml.xmlCharKey]=e,s[pr]=o,s}function eK(t,e){return[pr,e.xml.xmlCharKey].includes(t)}function tK(t,e,n,r,i){const o=i.xml.xmlCharKey??_u;lv(t,e)&&(e=EF(t,e,n,"serializedName"));const s=SF(t,e,r);let l={};const c=[];for(const u of Object.keys(s)){const d=s[u],f=jE(s[u].serializedName);c.push(f[0]);const{serializedName:h,xmlName:g,xmlElementName:E}=d;let D=r;h!==""&&h!==void 0&&(D=r+"."+h);const w=d.headerCollectionPrefix;if(w){const p={};for(const b of Object.keys(n))b.startsWith(w)&&(p[b.substring(w.length)]=t.deserialize(d.type.value,n[b],D,i)),c.push(b);l[u]=p}else if(t.isXML)if(d.xmlIsAttribute&&n[pr])l[u]=t.deserialize(d,n[pr][g],D,i);else if(d.xmlIsMsText)n[o]!==void 0?l[u]=n[o]:typeof n=="string"&&(l[u]=n);else{const p=E||g||h;if(d.xmlIsWrapped){const b=n[g],j=(b==null?void 0:b[E])??[];l[u]=t.deserialize(d,j,D,i),c.push(g)}else{const b=n[p];l[u]=t.deserialize(d,b,D,i),c.push(p)}}else{let p,b=n,j=0;for(const ne of f){if(!b)break;j++,b=b[ne]}b===null&&j<f.length&&(b=void 0),p=b;const K=e.type.polymorphicDiscriminator;K&&u===K.clientName&&p==null&&(p=e.serializedName);let M;if(Array.isArray(n[u])&&s[u].serializedName===""){p=n[u];const ne=t.deserialize(d,p,D,i);for(const[G,oe]of Object.entries(l))Object.prototype.hasOwnProperty.call(ne,G)||(ne[G]=oe);l=ne}else(p!==void 0||d.defaultValue!==void 0)&&(M=t.deserialize(d,p,D,i),l[u]=M)}}const a=e.type.additionalProperties;if(a){const u=d=>{for(const f in s)if(jE(s[f].serializedName)[0]===d)return!1;return!0};for(const d in n)u(d)&&(l[d]=t.deserialize(a,n[d],r+'["'+d+'"]',i))}else if(n&&!i.ignoreUnknownProperties)for(const u of Object.keys(n))l[u]===void 0&&!c.includes(u)&&!eK(u,i)&&(l[u]=n[u]);return l}function nK(t,e,n,r,i){const o=e.type.value;if(!o||typeof o!="object")throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const s={};for(const l of Object.keys(n))s[l]=t.deserialize(o,n[l],r,i);return s}return n}function rK(t,e,n,r,i){let o=e.type.element;if(!o||typeof o!="object")throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]),o.type.name==="Composite"&&o.type.className&&(o=t.modelMappers[o.type.className]??o);const s=[];for(let l=0;l<n.length;l++)s[l]=t.deserialize(o,n[l],`${r}[${l}]`,i);return s}return n}function iK(t,e,n){const r=[n];for(;r.length;){const i=r.shift(),o=e===i?e:i+"."+e;if(Object.prototype.hasOwnProperty.call(t,o))return t[o];for(const[s,l]of Object.entries(t))s.startsWith(i+".")&&l.type.uberParent===i&&l.type.className&&r.push(l.type.className)}}function EF(t,e,n,r){const i=lv(t,e);if(i){let o=i[r];if(o){r==="serializedName"&&(o=o.replace(/\\/gi,""));const s=n[o],l=e.type.uberParent??e.type.className;if(typeof s=="string"&&l){const c=iK(t.modelMappers.discriminators,s,l);c&&(e=c)}}}return e}function lv(t,e){return e.type.polymorphicDiscriminator||xO(t,e.type.uberParent)||xO(t,e.type.className)}function xO(t,e){return e&&t.modelMappers[e]&&t.modelMappers[e].type.polymorphicDiscriminator}const Rl={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"},LO={operationRequestMap:new WeakMap};function Au(t,e,n){let r=e.parameterPath;const i=e.mapper;let o;if(typeof r=="string"&&(r=[r]),Array.isArray(r)){if(r.length>0)if(i.isConstant)o=i.defaultValue;else{let s=UO(t,r);!s.propertyFound&&n&&(s=UO(n,r));let l=!1;s.propertyFound||(l=i.required||r[0]==="options"&&r.length===2),o=l?i.defaultValue:s.propertyValue}}else{i.required&&(o={});for(const s in r){const l=i.type.modelProperties[s],c=r[s],a=Au(t,{parameterPath:c,mapper:l},n);a!==void 0&&(o||(o={}),o[s]=a)}}return o}function UO(t,e){const n={propertyFound:!1};let r=0;for(;r<e.length;++r){const i=e[r];if(t&&i in t)t=t[i];else break}return r===e.length&&(n.propertyValue=t,n.propertyFound=!0),n}const wF=Symbol.for("@azure/core-client original request");function oK(t){return wF in t}function Yu(t){if(oK(t))return Yu(t[wF]);let e=LO.operationRequestMap.get(t);return e||(e={},LO.operationRequestMap.set(t,e)),e}const sK=["application/json","text/json"],aK=["application/xml","application/atom+xml"],IF="deserializationPolicy";function bF(t={}){var s,l;const e=((s=t.expectedContentTypes)==null?void 0:s.json)??sK,n=((l=t.expectedContentTypes)==null?void 0:l.xml)??aK,r=t.parseXML,i=t.serializerOptions,o={xml:{rootName:(i==null?void 0:i.xml.rootName)??"",includeRoot:(i==null?void 0:i.xml.includeRoot)??!1,xmlCharKey:(i==null?void 0:i.xml.xmlCharKey)??_u}};return{name:IF,async sendRequest(c,a){const u=await a(c);return uK(e,n,u,o,r)}}}function lK(t){let e;const n=t.request,r=Yu(n),i=r==null?void 0:r.operationSpec;return i&&(r!=null&&r.operationResponseGetter?e=r==null?void 0:r.operationResponseGetter(i,t):e=i.responses[t.status]),e}function cK(t){const e=t.request,n=Yu(e),r=n==null?void 0:n.shouldDeserialize;let i;return r===void 0?i=!0:typeof r=="boolean"?i=r:i=r(t),i}async function uK(t,e,n,r,i){const o=await fK(t,e,n,r,i);if(!cK(o))return o;const s=Yu(o.request),l=s==null?void 0:s.operationSpec;if(!l||!l.responses)return o;const c=lK(o),{error:a,shouldReturnResponse:u}=hK(o,l,c,r);if(a)throw a;if(u)return o;if(c){if(c.bodyMapper){let d=o.parsedBody;l.isXML&&c.bodyMapper.type.name===Rl.Sequence&&(d=typeof d=="object"?d[c.bodyMapper.xmlElementName]:[]);try{o.parsedBody=l.serializer.deserialize(c.bodyMapper,d,"operationRes.parsedBody",r)}catch(f){throw new Hl(`Error ${f} occurred in deserializing the responseBody - ${o.bodyAsText}`,{statusCode:o.status,request:o.request,response:o})}}else l.httpMethod==="HEAD"&&(o.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(o.parsedHeaders=l.serializer.deserialize(c.headersMapper,o.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return o}function dK(t){const e=Object.keys(t.responses);return e.length===0||e.length===1&&e[0]==="default"}function hK(t,e,n,r){var d,f,h,g,E;const i=200<=t.status&&t.status<300;if(dK(e)?i:!!n)if(n){if(!n.isError)return{error:null,shouldReturnResponse:!1}}else return{error:null,shouldReturnResponse:!1};const s=n??e.responses.default,l=(d=t.request.streamResponseStatusCodes)!=null&&d.has(t.status)?`Unexpected status code: ${t.status}`:t.bodyAsText,c=new Hl(l,{statusCode:t.status,request:t.request,response:t});if(!s&&!((h=(f=t.parsedBody)==null?void 0:f.error)!=null&&h.code&&((E=(g=t.parsedBody)==null?void 0:g.error)!=null&&E.message)))throw c;const a=s==null?void 0:s.bodyMapper,u=s==null?void 0:s.headersMapper;try{if(t.parsedBody){const D=t.parsedBody;let w;if(a){let b=D;if(e.isXML&&a.type.name===Rl.Sequence){b=[];const j=a.xmlElementName;typeof D=="object"&&j&&(b=D[j])}w=e.serializer.deserialize(a,b,"error.response.parsedBody",r)}const p=D.error||w||D;c.code=p.code,p.message&&(c.message=p.message),a&&(c.response.parsedBody=w)}t.headers&&u&&(c.response.parsedHeaders=e.serializer.deserialize(u,t.headers.toJSON(),"operationRes.parsedHeaders"))}catch(D){c.message=`Error "${D.message}" occurred in deserializing the responseBody - "${t.bodyAsText}" for the default response.`}return{error:c,shouldReturnResponse:!1}}async function fK(t,e,n,r,i){var o;if(!((o=n.request.streamResponseStatusCodes)!=null&&o.has(n.status))&&n.bodyAsText){const s=n.bodyAsText,l=n.headers.get("Content-Type")||"",c=l?l.split(";").map(a=>a.toLowerCase()):[];try{if(c.length===0||c.some(a=>t.indexOf(a)!==-1))return n.parsedBody=JSON.parse(s),n;if(c.some(a=>e.indexOf(a)!==-1)){if(!i)throw new Error("Parsing XML not supported.");const a=await i(s,r.xml);return n.parsedBody=a,n}}catch(a){const u=`Error "${a}" occurred while parsing the response body - ${n.bodyAsText}.`,d=a.code||Hl.PARSE_ERROR;throw new Hl(u,{code:d,statusCode:n.status,request:n.request,response:n})}}return n}function pK(t){const e=new Set;for(const n in t.responses){const r=t.responses[n];r.bodyMapper&&r.bodyMapper.type.name===Rl.Stream&&e.add(Number(n))}return e}function Ma(t){const{parameterPath:e,mapper:n}=t;let r;return typeof e=="string"?r=e:Array.isArray(e)?r=e.join("."):r=n.serializedName,r}const _F="serializationPolicy";function AF(t={}){const e=t.stringifyXML;return{name:_F,async sendRequest(n,r){const i=Yu(n),o=i==null?void 0:i.operationSpec,s=i==null?void 0:i.operationArguments;return o&&s&&(gK(n,s,o),mK(n,s,o,e)),r(n)}}}function gK(t,e,n){var i,o;if(n.headerParameters)for(const s of n.headerParameters){let l=Au(e,s);if(l!=null||s.mapper.required){l=n.serializer.serialize(s.mapper,l,Ma(s));const c=s.mapper.headerCollectionPrefix;if(c)for(const a of Object.keys(l))t.headers.set(c+a,l[a]);else t.headers.set(s.mapper.serializedName||Ma(s),l)}}const r=(o=(i=e.options)==null?void 0:i.requestOptions)==null?void 0:o.customHeaders;if(r)for(const s of Object.keys(r))t.headers.set(s,r[s])}function mK(t,e,n,r=function(){throw new Error("XML serialization unsupported!")}){var l,c;const i=(l=e.options)==null?void 0:l.serializerOptions,o={xml:{rootName:(i==null?void 0:i.xml.rootName)??"",includeRoot:(i==null?void 0:i.xml.includeRoot)??!1,xmlCharKey:(i==null?void 0:i.xml.xmlCharKey)??_u}},s=o.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){t.body=Au(e,n.requestBody);const a=n.requestBody.mapper,{required:u,serializedName:d,xmlName:f,xmlElementName:h,xmlNamespace:g,xmlNamespacePrefix:E,nullable:D}=a,w=a.type.name;try{if(t.body!==void 0&&t.body!==null||D&&t.body===null||u){const p=Ma(n.requestBody);t.body=n.serializer.serialize(a,t.body,p,o);const b=w===Rl.Stream;if(n.isXML){const j=E?`xmlns:${E}`:"xmlns",K=vK(g,j,w,t.body,o);w===Rl.Sequence?t.body=r(yK(K,h||f||d,j,g),{rootName:f||d,xmlCharKey:s}):b||(t.body=r(K,{rootName:f||d,xmlCharKey:s}))}else{if(w===Rl.String&&((c=n.contentType)!=null&&c.match("text/plain")||n.mediaType==="text"))return;b||(t.body=JSON.stringify(t.body))}}}catch(p){throw new Error(`Error "${p.message}" occurred in serializing the payload - ${JSON.stringify(d,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){t.formData={};for(const a of n.formDataParameters){const u=Au(e,a);if(u!=null){const d=a.mapper.serializedName||Ma(a);t.formData[d]=n.serializer.serialize(a.mapper,u,Ma(a),o)}}}}function vK(t,e,n,r,i){if(t&&!["Composite","Sequence","Dictionary"].includes(n)){const o={};return o[i.xml.xmlCharKey]=r,o[pr]={[e]:t},o}return r}function yK(t,e,n,r){if(Array.isArray(t)||(t=[t]),!n||!r)return{[e]:t};const i={[e]:t};return i[pr]={[n]:r},i}function RF(t={}){const e=J2(t??{});return t.credentialOptions&&e.addPolicy(Df({credential:t.credentialOptions.credential,scopes:t.credentialOptions.credentialScopes})),e.addPolicy(AF(t.serializationOptions),{phase:"Serialize"}),e.addPolicy(bF(t.deserializationOptions),{phase:"Deserialize"}),e}let K0;function CK(){return K0||(K0=Q2()),K0}const SK={CSV:",",SSV:" ",Multi:"Multi",TSV:"	",Pipes:"|"};function TK(t,e,n,r){const i=EK(e,n,r);let o=!1,s=FO(t,i);if(e.path){let a=FO(e.path,i);e.path==="/{nextLink}"&&a.startsWith("/")&&(a=a.substring(1)),wK(a)?(s=a,o=!0):s=IK(s,a)}const{queryParams:l,sequenceParams:c}=bK(e,n,r);return s=AK(s,l,c,o),s}function FO(t,e){let n=t;for(const[r,i]of e)n=n.split(r).join(i);return n}function EK(t,e,n){var i;const r=new Map;if((i=t.urlParameters)!=null&&i.length)for(const o of t.urlParameters){let s=Au(e,o,n);const l=Ma(o);s=t.serializer.serialize(o.mapper,s,l),o.skipEncoding||(s=encodeURIComponent(s)),r.set(`{${o.mapper.serializedName||l}}`,s)}return r}function wK(t){return t.includes("://")}function IK(t,e){if(!e)return t;const n=new URL(t);let r=n.pathname;r.endsWith("/")||(r=`${r}/`),e.startsWith("/")&&(e=e.substring(1));const i=e.indexOf("?");if(i!==-1){const o=e.substring(0,i),s=e.substring(i+1);r=r+o,s&&(n.search=n.search?`${n.search}&${s}`:s)}else r=r+e;return n.pathname=r,n.toString()}function bK(t,e,n){var o;const r=new Map,i=new Set;if((o=t.queryParameters)!=null&&o.length)for(const s of t.queryParameters){s.mapper.type.name==="Sequence"&&s.mapper.serializedName&&i.add(s.mapper.serializedName);let l=Au(e,s,n);if(l!=null||s.mapper.required){l=t.serializer.serialize(s.mapper,l,Ma(s));const c=s.collectionFormat?SK[s.collectionFormat]:"";if(Array.isArray(l)&&(l=l.map(a=>a??"")),s.collectionFormat==="Multi"&&l.length===0)continue;Array.isArray(l)&&(s.collectionFormat==="SSV"||s.collectionFormat==="TSV")&&(l=l.join(c)),s.skipEncoding||(Array.isArray(l)?l=l.map(a=>encodeURIComponent(a)):l=encodeURIComponent(l)),Array.isArray(l)&&(s.collectionFormat==="CSV"||s.collectionFormat==="Pipes")&&(l=l.join(c)),r.set(s.mapper.serializedName||Ma(s),l)}}return{queryParams:r,sequenceParams:i}}function _K(t){const e=new Map;if(!t||t[0]!=="?")return e;t=t.slice(1);const n=t.split("&");for(const r of n){const[i,o]=r.split("=",2),s=e.get(i);s?Array.isArray(s)?s.push(o):e.set(i,[s,o]):e.set(i,o)}return e}function AK(t,e,n,r=!1){if(e.size===0)return t;const i=new URL(t),o=_K(i.search);for(const[l,c]of e){const a=o.get(l);if(Array.isArray(a))if(Array.isArray(c)){a.push(...c);const u=new Set(a);o.set(l,Array.from(u))}else a.push(c);else a?(Array.isArray(c)?c.unshift(a):n.has(l)&&o.set(l,[a,c]),r||o.set(l,c)):o.set(l,c)}const s=[];for(const[l,c]of o)if(typeof c=="string")s.push(`${l}=${c}`);else if(Array.isArray(c))for(const a of c)s.push(`${l}=${a}`);else s.push(`${l}=${c}`);return i.search=s.length?`?${s.join("&")}`:"",i.toString()}const kF=Mf("core-client");class Vb{constructor(e={}){Ye(this,"_endpoint");Ye(this,"_requestContentType");Ye(this,"_allowInsecureConnection");Ye(this,"_httpClient");Ye(this,"pipeline");var n;if(this._requestContentType=e.requestContentType,this._endpoint=e.endpoint??e.baseUri,e.baseUri&&kF.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||CK(),this.pipeline=e.pipeline||RK(e),(n=e.additionalPolicies)!=null&&n.length)for(const{policy:r,position:i}of e.additionalPolicies){const o=i==="perRetry"?"Sign":void 0;this.pipeline.addPolicy(r,{afterPhase:o})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,n){const r=n.baseUrl||this._endpoint;if(!r)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");const i=TK(r,n,e,this),o=Y2({url:i});o.method=n.httpMethod;const s=Yu(o);s.operationSpec=n,s.operationArguments=e;const l=n.contentType||this._requestContentType;l&&n.requestBody&&o.headers.set("Content-Type",l);const c=e.options;if(c){const a=c.requestOptions;a&&(a.timeout&&(o.timeout=a.timeout),a.onUploadProgress&&(o.onUploadProgress=a.onUploadProgress),a.onDownloadProgress&&(o.onDownloadProgress=a.onDownloadProgress),a.shouldDeserialize!==void 0&&(s.shouldDeserialize=a.shouldDeserialize),a.allowInsecureConnection&&(o.allowInsecureConnection=!0)),c.abortSignal&&(o.abortSignal=c.abortSignal),c.tracingOptions&&(o.tracingOptions=c.tracingOptions)}this._allowInsecureConnection&&(o.allowInsecureConnection=!0),o.streamResponseStatusCodes===void 0&&(o.streamResponseStatusCodes=pK(n));try{const a=await this.sendRequest(o),u=NO(a,n.responses[a.status]);return c!=null&&c.onResponse&&c.onResponse(a,u),u}catch(a){if(typeof a=="object"&&(a!=null&&a.response)){const u=a.response,d=NO(u,n.responses[a.statusCode]||n.responses.default);a.details=d,c!=null&&c.onResponse&&c.onResponse(u,d,a)}throw a}}}function RK(t){const e=kK(t),n=t.credential&&e?{credentialScopes:e,credential:t.credential}:void 0;return RF({...t,credentialOptions:n})}function kK(t){if(t.credentialScopes)return t.credentialScopes;if(t.endpoint)return`${t.endpoint}/.default`;if(t.baseUri)return`${t.baseUri}/.default`;if(t.credential&&!t.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}function PK(t){return`, ${t.trim()}`.split(", Bearer ").filter(n=>n).map(n=>`${n.trim()}, `.split('", ').filter(o=>o).map(o=>(([s,l])=>({[s]:l}))(o.trim().split('="'))).reduce((o,s)=>({...o,...s}),{}))}async function OK(t){const{scopes:e,response:n}=t,r=t.logger||kF,i=n.headers.get("WWW-Authenticate");if(!i)return r.info("The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow."),!1;const s=(PK(i)||[]).find(c=>c.claims);if(!s)return r.info('The WWW-Authenticate header was missing the necessary "claims" to perform the Continuous Access Evaluation authentication flow.'),!1;const l=await t.getAccessToken(s.scope?[s.scope]:e,{claims:M8(s.claims)});return l?(t.request.headers.set("Authorization",`${l.tokenType??"Bearer"} ${l.token}`),!0):!1}const PF={DefaultScope:"/.default",HeaderConstants:{AUTHORIZATION:"authorization"}};function MK(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(t)}const DK=async t=>{const e=FK(t.request),n=LK(t.response);if(n){const r=UK(n),i=xK(t,r),o=NK(r);if(!o)return!1;const s=await t.getAccessToken(i,{...e,tenantId:o});return s?(t.request.headers.set(PF.HeaderConstants.AUTHORIZATION,`${s.tokenType??"Bearer"} ${s.token}`),!0):!1}return!1};function NK(t){const r=new URL(t.authorization_uri).pathname.split("/")[1];if(r&&MK(r))return r}function xK(t,e){if(!e.resource_id)return t.scopes;const n=new URL(e.resource_id);n.pathname=PF.DefaultScope;let r=n.toString();return r==="https://disk.azure.com/.default"&&(r="https://disk.azure.com//.default"),[r]}function LK(t){const e=t.headers.get("WWW-Authenticate");if(t.status===401&&e)return e}function UK(t){return`${t.slice(7).trim()} `.split(" ").filter(i=>i).map(i=>(([o,s])=>({[o]:s}))(i.trim().split("="))).reduce((i,o)=>({...i,...o}),{})}function FK(t){return{abortSignal:t.abortSignal,requestOptions:{timeout:t.timeout},tracingOptions:t.tracingOptions}}const BK=Object.freeze(Object.defineProperty({__proto__:null,MapperTypeNames:Rl,ServiceClient:Vb,XML_ATTRKEY:pr,XML_CHARKEY:_u,authorizeRequestOnClaimChallenge:OK,authorizeRequestOnTenantChallenge:DK,createClientPipeline:RF,createSerializer:xf,deserializationPolicy:bF,deserializationPolicyName:IF,serializationPolicy:AF,serializationPolicyName:_F},Symbol.toStringTag,{value:"Module"})),OF=Hs(BK),MF=Hs(t8);(function(t){function e(p){return p&&typeof p=="object"&&"default"in p?p.default:p}var n=e(gF),r=e(mF),i=e(OF),o=e(MF),s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _e<"u"?_e:typeof self<"u"?self:{};function l(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}function c(p,b){return b={exports:{}},p(b,b.exports),b.exports}var a=c(function(p,b){(function(j,K){p.exports=K()})(s,function(){return function(j){function K(ne){if(M[ne])return M[ne].exports;var G=M[ne]={i:ne,l:!1,exports:{}};return j[ne].call(G.exports,G,G.exports,K),G.l=!0,G.exports}var M={};return K.m=j,K.c=M,K.i=function(ne){return ne},K.d=function(ne,G,oe){K.o(ne,G)||Object.defineProperty(ne,G,{configurable:!1,enumerable:!0,get:oe})},K.n=function(ne){var G=ne&&ne.__esModule?function(){return ne.default}:function(){return ne};return K.d(G,"a",G),G},K.o=function(ne,G){return Object.prototype.hasOwnProperty.call(ne,G)},K.p="",K(K.s=1)}([function(j,K,M){function ne(J,X){var B,q=new Promise(function(x,P){fetch(J).then(function(v){B!==void 0&&clearTimeout(B),x(v)}).catch(function(v){B!==void 0&&clearTimeout(B),P(v)})});if(X!==0){var F=new Promise(function(x,P){B=setTimeout(P,X,new Error("Fetch for '".concat(J.url,"' timed out")))});return Promise.race([q,F])}return q}function G(J){try{return JSON.stringify(J)}catch{return"Unable to serialize object of type ".concat(typeof J)}}Object.defineProperty(K,"__esModule",{value:!0}),K.Timespan=K.toJson=K.fetchWithTimeout=void 0,K.fetchWithTimeout=ne,K.toJson=G;var oe=function(){function J(){this.start=Date.now()}return Object.defineProperty(J.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),J.prototype.reset=function(){this.start=Date.now()},J}();K.Timespan=oe},function(j,K,M){function ne(v,T,_){return new P(v,T,_)}var G=this&&this.__extends||function(){var v=function(T,_){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,I){N.__proto__=I}||function(N,I){for(var A in I)Object.prototype.hasOwnProperty.call(I,A)&&(N[A]=I[A])})(T,_)};return function(T,_){function N(){this.constructor=T}if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");v(T,_),T.prototype=_===null?Object.create(_):(N.prototype=_.prototype,new N)}}(),oe=this&&this.__assign||function(){return oe=Object.assign||function(v){for(var T,_=1,N=arguments.length;_<N;_++){T=arguments[_];for(var I in T)Object.prototype.hasOwnProperty.call(T,I)&&(v[I]=T[I])}return v},oe.apply(this,arguments)},J=this&&this.__awaiter||function(v,T,_,N){function I(A){return A instanceof _?A:new _(function(S){S(A)})}return new(_||(_=Promise))(function(A,S){function H(y){try{C(N.next(y))}catch(k){S(k)}}function L(y){try{C(N.throw(y))}catch(k){S(k)}}function C(y){y.done?A(y.value):I(y.value).then(H,L)}C((N=N.apply(v,T||[])).next())})},X=this&&this.__generator||function(v,T){function _(C){return function(y){return N([C,y])}}function N(C){if(I)throw new TypeError("Generator is already executing.");for(;H&&(H=0,C[0]&&(L=0)),L;)try{if(I=1,A&&(S=2&C[0]?A.return:C[0]?A.throw||((S=A.return)&&S.call(A),0):A.next)&&!(S=S.call(A,C[1])).done)return S;switch(A=0,S&&(C=[2&C[0],S.value]),C[0]){case 0:case 1:S=C;break;case 4:return L.label++,{value:C[1],done:!1};case 5:L.label++,A=C[1],C=[0];continue;case 7:C=L.ops.pop(),L.trys.pop();continue;default:if(S=L.trys,!(S=S.length>0&&S[S.length-1])&&(C[0]===6||C[0]===2)){L=0;continue}if(C[0]===3&&(!S||C[1]>S[0]&&C[1]<S[3])){L.label=C[1];break}if(C[0]===6&&L.label<S[1]){L.label=S[1],S=C;break}if(S&&L.label<S[2]){L.label=S[2],L.ops.push(C);break}S[2]&&L.ops.pop(),L.trys.pop();continue}C=T.call(v,L)}catch(y){C=[6,y],A=0}finally{I=S=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}var I,A,S,H,L={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return H={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H};Object.defineProperty(K,"__esModule",{value:!0}),K.createRegistrarClient=K.RegistrarClient=void 0;var B=M(0),q=["skype","aad","cae"],F=function(v){function T(_){var N=v.call(this,_)||this;return N.name="CancelationError",N}return G(T,v),T}(Error),x=function(){function v(T,_,N){this.logger=T,this.maxBackoffInMs=_,this.initialDelay=N,this.backoffCount=0,this.id=++v.idCounter}return v.prototype.delay=function(T){var _=this;if(this.timerHandle!==void 0)throw new Error("Retry sequence logical failure");if(this.backoffCount===-1)return new Promise(function(I,A){A(new F("Cancelled"))});var N=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off ".concat(T," for ").concat(N," milliseconds with ID ").concat(this.id)),new Promise(function(I,A){_.cancelFunc=A,_.timerHandle=setTimeout(function(){_.logger.info("[RegistrarClient] Back off for ".concat(T," with ID ").concat(_.id," complete")),_.timerHandle=void 0,I()},N)})},v.prototype.cancel=function(){this.timerHandle!==void 0&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.cancelFunc!==void 0&&this.cancelFunc(new F("Cancelled"))),this.backoffCount=-1},v.prototype.calculateNextBackoffMs=function(){var T=1+.4*(Math.random()-.5),_=this.initialDelay*Math.pow(2,this.backoffCount)*T;return _=Math.round(_),Math.min(this.maxBackoffInMs,_)},v.idCounter=0,v}(),P=function(){function v(T,_,N){var I;this.logger=T,this.tokenProvider=_,this.options=N,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=N.maxRetriesForGetToken===void 0||N.maxRetriesForGetToken===null?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:N.maxRetriesForGetToken,this.proxyUrlRewrite=(I=N.proxyUrlRewrite)!==null&&I!==void 0?I:function(A){return A}}return v.prototype.setTelemetryLogger=function(T){this.eventLogger=T},v.prototype.register=function(T,_){return J(this,void 0,void 0,function(){return X(this,function(N){switch(N.label){case 0:return[4,this.performRegistration(T,_,"pr_set_registration")];case 1:return N.sent(),this.cachedRegistrationParams=[T,_],[2]}})})},v.prototype.unregister=function(){return J(this,void 0,void 0,function(){var T;return X(this,function(_){switch(_.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),T=new Request(this.proxyUrlRewrite("".concat(this.options.registrarUrl,"/").concat(this.options.registrationId)),{method:"DELETE",mode:"cors",headers:new Headers(oe(oe({},this.options.extraRegistrationHeaders),{accept:"application/json, text/javascript"}))}),[4,this.callRegistrar(T,"pr_delete_registration")];case 1:return _.sent(),[2]}})})},v.prototype.cancelPendingRequests=function(){var T=this;Object.keys(this.backoffs).forEach(function(_){T.backoffs[_].cancel()}),this.backoffs={}},v.prototype.resendRegistration=function(){return J(this,void 0,void 0,function(){return X(this,function(T){switch(T.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return T.sent(),[2]}})})},v.prototype.performRegistration=function(T,_,N){return J(this,void 0,void 0,function(){var I,A;return X(this,function(S){switch(S.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),I={clientDescription:T,registrationId:this.options.registrationId,nodeId:"",transports:_},A=new Request(this.proxyUrlRewrite(this.options.registrarUrl),{method:"POST",mode:"cors",headers:new Headers(oe(oe({},this.options.extraRegistrationHeaders),{"content-type":"application/json",accept:"application/json, text/javascript"})),body:(0,B.toJson)(I)}),[4,this.callRegistrar(A,N)];case 1:return S.sent(),[2]}})})},v.prototype.startBackoff=function(){var T=new x(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[T.id]=T,T},v.prototype.stopBackoff=function(T){T.cancel(),delete this.backoffs[T.id]},v.prototype.getToken=function(T){return J(this,void 0,void 0,function(){var _,N,I,A,S,H,L;return X(this,function(C){switch(C.label){case 0:_=this.startBackoff(),N=0,C.label=1;case 1:return C.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new token"),[4,this.tokenProvider({needFresh:!0,supportedTokenTypes:q,wwwAuthenticateHeader:T,purpose:"registrar"})];case 2:return I=C.sent(),this.stopBackoff(_),[2,I];case 3:A=C.sent(),C.label=4;case 4:return C.trys.push([4,6,,7]),N++,S=JSON.stringify(A),N>this.maxRetriesForGetToken?(H="[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ".concat(S),this.logger.error(H),this.stopBackoff(_),[2,Promise.reject(H)]):(this.logger.warn("[RegistrarClient] Retrying for a new token. Retry Count: ".concat(N," Error: ").concat(S)),[4,_.delay("Fetching a new token")]);case 5:return C.sent(),[3,8];case 6:throw L=C.sent(),this.stopBackoff(_),L;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})},v.prototype.callRegistrar=function(T,_){var N,I,A;return J(this,void 0,void 0,function(){var S,H,L,C,y,k,Y,V,z,W,le,re,$,m,R,Z;return X(this,function(ie){switch(ie.label){case 0:return S=this.startBackoff(),[4,this.tokenProvider({needFresh:!1,supportedTokenTypes:q,wwwAuthenticateHeader:void 0,purpose:"registrar"})];case 1:H=ie.sent(),this.setTokenHeader(T,H),L=new B.Timespan,C=0,ie.label=2;case 2:y=void 0,ie.label=3;case 3:return ie.trys.push([3,10,15,16]),k=T.clone(),[4,(0,B.fetchWithTimeout)(k,this.options.requestTimeoutMs)];case 4:return y=ie.sent(),y.status!==401?[3,8]:++C>this.maxRetriesForGetToken?(Y="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '".concat(T.url,"' failed with ").concat(y.status," ").concat(y.statusText),this.logger.error(Y),this.stopBackoff(S),[2,Promise.reject(Y)]):(this.logger.warn("[RegistrarClient] Retry Count ".concat(C,". Request '").concat(T.url,"' failed with ").concat(y.status," ").concat(y.statusText)),V=(I=(N=y.headers)===null||N===void 0?void 0:N.get("www-authenticate"))!==null&&I!==void 0?I:void 0,z=this.setTokenHeader,W=[T],[4,this.getToken(V)]);case 5:return z.apply(this,W.concat([ie.sent()])),C>1?[4,S.delay("Registrar call retry after 401")]:[3,7];case 6:ie.sent(),ie.label=7;case 7:return[3,22];case 8:if(y.status>=500&&y.status<600)throw new Error("Fetch for '".concat(T.url,"' failed with ").concat(y.status," ").concat(y.statusText));ie.label=9;case 9:return[3,16];case 10:le=ie.sent(),this.logger.error("[RegistrarClient] Request failed with ".concat(le)),ie.label=11;case 11:return ie.trys.push([11,13,,14]),[4,S.delay("Registrar call retry")];case 12:return ie.sent(),[3,22];case 13:throw re=ie.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(S),re;case 14:return[3,16];case 15:return this.sendTelemetryEvent(_,T,y,L),[7];case 16:return this.stopBackoff(S),y.ok?[2,y]:[3,17];case 17:$=void 0,ie.label=18;case 18:return ie.trys.push([18,20,,21]),R=(m=JSON).stringify,[4,y.json()];case 19:return $=R.apply(m,[ie.sent()]),[3,21];case 20:return ie.sent(),$="no details",[3,21];case 21:throw Z="Fetch for '".concat(T.url,"' failed with ").concat(y.status," ").concat(y.statusText," (").concat($,", MS-CV: ").concat((A=y.headers)===null||A===void 0?void 0:A.get("MS-CV"),")"),this.logger.error("[RegistrarClient] ".concat(Z)),new Error(Z);case 22:return[3,2];case 23:return[2]}})})},v.prototype.setTokenHeader=function(T,_){switch(T.headers.delete("X-Skypetoken"),T.headers.delete("Authorization"),T.headers.delete("X-MS-Migration"),_.tokenType.toLowerCase()){case"skype":T.headers.set("X-Skypetoken",_.token);break;case"aad":case"cae":T.headers.set("Authorization","Bearer ".concat(_.token));break;default:throw new Error("unsupported token type: ".concat(_.tokenType))}this.options.usingLegacyTokenApi===!1&&T.headers.set("X-MS-Migration","True")},v.prototype.sendTelemetryEvent=function(T,_,N,I){if(this.eventLogger!==void 0){var A={name:T,properties:{url:{value:_.url},result_code:{value:N!==void 0?N.status:0},begin_timestamp:{value:I.startTime},elapsed:{value:I.duration}}};this.eventLogger.logEvent(A)}},v}();K.RegistrarClient=P,K.createRegistrarClient=ne}])})});l(a);var u=c(function(p,b){(function(j,K){p.exports=K(a)})(s,function(j){return function(K){function M(G){if(ne[G])return ne[G].exports;var oe=ne[G]={i:G,l:!1,exports:{}};return K[G].call(oe.exports,oe,oe.exports,M),oe.l=!0,oe.exports}var ne={};return M.m=K,M.c=ne,M.i=function(G){return G},M.d=function(G,oe,J){M.o(G,oe)||Object.defineProperty(G,oe,{configurable:!1,enumerable:!0,get:J})},M.n=function(G){var oe=G&&G.__esModule?function(){return G.default}:function(){return G};return M.d(oe,"a",oe),oe},M.o=function(G,oe){return Object.prototype.hasOwnProperty.call(G,oe)},M.p="",M(M.s=20)}([function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.Logger=void 0;var G=function(){function oe(J,X){this.name=J,this.logger=X}return oe.prototype.debug=function(J){this.logger.debug("[".concat(this.name,"] ").concat(J))},oe.prototype.info=function(J){this.logger.info("[".concat(this.name,"] ").concat(J))},oe.prototype.warn=function(J){this.logger.warn("[".concat(this.name,"] ").concat(J))},oe.prototype.error=function(J){this.logger.error("[".concat(this.name,"] ").concat(J))},oe}();M.Logger=G},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.USER_AUTHENTICATE_EVENT_NAME=M.SUPPORTED_TOKEN_TYPES=M.FAILED_MESSAGE_ACK=M.UNHANDLED_MESSAGE_ACK=M.HANDLED_MESSAGE_ACK=M.CLIENT_VERSION=M.constants=void 0,M.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},M.CLIENT_VERSION="2024.14.01.55",M.HANDLED_MESSAGE_ACK=200,M.UNHANDLED_MESSAGE_ACK=404,M.FAILED_MESSAGE_ACK=500,M.SUPPORTED_TOKEN_TYPES=["skype","aad","cae"],M.USER_AUTHENTICATE_EVENT_NAME="user.authenticate"},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterState=M.UserActivityState=void 0;var G;(function(J){J[J.Unknown=0]="Unknown",J[J.Active=1]="Active",J[J.Inactive=2]="Inactive"})(G||(M.UserActivityState=G={}));var oe;(function(J){J[J.Unknown=0]="Unknown",J[J.Connected=2]="Connected",J[J.Disconnected=3]="Disconnected",J[J.Switching=9]="Switching"})(oe||(M.TrouterState=oe={}))},function(K,M,ne){function G(P){try{return JSON.stringify(P)}catch{return"Unable to serialize object of type ".concat(typeof P)}}function oe(P){var v=Math.round(new Date().getTime()/1e3);return P!==void 0&&P>v?P-v:0}function J(P){return Math.round(new Date().getTime()/1e3)+P}function X(P,v){return B(this,void 0,void 0,function(){var T,_,N;return q(this,function(I){return _=new Promise(function(A,S){fetch(P).then(function(H){clearTimeout(T),A(H)}).catch(function(H){clearTimeout(T),S(H)})}),v!==0?(N=new Promise(function(A,S){var H=new URL(P.url),L=new Error("".concat(P.method," ").concat(H.origin).concat(H.pathname," timed out"));T=setTimeout(S,v,L)}),[2,Promise.race([_,N])]):[2,_]})})}var B=this&&this.__awaiter||function(P,v,T,_){function N(I){return I instanceof T?I:new T(function(A){A(I)})}return new(T||(T=Promise))(function(I,A){function S(C){try{L(_.next(C))}catch(y){A(y)}}function H(C){try{L(_.throw(C))}catch(y){A(y)}}function L(C){C.done?I(C.value):N(C.value).then(S,H)}L((_=_.apply(P,v||[])).next())})},q=this&&this.__generator||function(P,v){function T(L){return function(C){return _([L,C])}}function _(L){if(N)throw new TypeError("Generator is already executing.");for(;S&&(S=0,L[0]&&(H=0)),H;)try{if(N=1,I&&(A=2&L[0]?I.return:L[0]?I.throw||((A=I.return)&&A.call(I),0):I.next)&&!(A=A.call(I,L[1])).done)return A;switch(I=0,A&&(L=[2&L[0],A.value]),L[0]){case 0:case 1:A=L;break;case 4:return H.label++,{value:L[1],done:!1};case 5:H.label++,I=L[1],L=[0];continue;case 7:L=H.ops.pop(),H.trys.pop();continue;default:if(A=H.trys,!(A=A.length>0&&A[A.length-1])&&(L[0]===6||L[0]===2)){H=0;continue}if(L[0]===3&&(!A||L[1]>A[0]&&L[1]<A[3])){H.label=L[1];break}if(L[0]===6&&H.label<A[1]){H.label=A[1],A=L;break}if(A&&H.label<A[2]){H.label=A[2],H.ops.push(L);break}A[2]&&H.ops.pop(),H.trys.pop();continue}L=v.call(P,H)}catch(C){L=[6,C],I=0}finally{N=A=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}var N,I,A,S,H={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return S={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S};Object.defineProperty(M,"__esModule",{value:!0}),M.Timespan=M.CorrelationVector=M.fetchWithTimeout=M.calculateExpireTsInSec=M.calculateTtlInSec=M.toJson=void 0,M.toJson=G,M.calculateTtlInSec=oe,M.calculateExpireTsInSec=J,M.fetchWithTimeout=X;var F=function(){function P(v){this.base=v!==void 0?v:this.createCorrelationVectorBase(),this.extension=0}return P.extend=function(v){return new P(v)},P.prototype.increase=function(){this.extension++},P.prototype.value=function(){return"".concat(this.base,".").concat(this.extension)},P.prototype.createCorrelationVectorBase=function(){for(var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",T="AQgw",_="",N=0;N<21;N++)_+=v.charAt(Math.floor(Math.random()*v.length));return _+=T.charAt(Math.floor(Math.random()*T.length))},P}();M.CorrelationVector=F;var x=function(){function P(){this.start=Date.now()}return Object.defineProperty(P.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),P.prototype.reset=function(){this.start=Date.now()},P}();M.Timespan=x},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterManagerState=M.UserActivityEventReason=M.ServerState=void 0;var G=ne(3),oe=function(){function B(q,F,x,P,v,T,_){this.connectionId=q,this.connectedClientId=F,this.domId=x,this.unsecureUrl=P,this.url=v,this.c2cUrlBase=T,this.expirationTsSec=_}return B.prototype.getRemainingTtlInSec=function(){return(0,G.calculateTtlInSec)(this.expirationTsSec)},B}();M.ServerState=oe;var J;(function(B){B[B.Unknown=0]="Unknown",B[B.Modified=1]="Modified",B[B.Snapshot=2]="Snapshot",B[B.Connected=3]="Connected"})(J||(M.UserActivityEventReason=J={}));var X;(function(B){B[B.Unknown=0]="Unknown",B[B.Connected=2]="Connected",B[B.Disconnected=3]="Disconnected",B[B.Switching=9]="Switching",B[B.TerminalError=10]="TerminalError"})(X||(M.TrouterManagerState=X={}))},function(K,M,ne){function G(v,T){return v==="skype"&&oe(T==null?void 0:T.scae)!=="1"?"v4a":"v4c"}function oe(v){return typeof v=="string"?v:typeof v=="number"?v.toString():void 0}function J(v,T){return(T==null?void 0:T.kind)==="v4c-websocket-failure"?"v4a":v}function X(v){return Object.prototype.hasOwnProperty.call(v,"connectparams")}function B(v,T){return T==="v4a"?v.replace(/\/v4\/c\b/,"/v4/a").replace("wss://","https://").replace("ws://","http://"):v.replace(/\/v4\/a\b/,"/v4/c").replace("https://","wss://").replace("http://","ws://")}function q(v){if(v!==void 0)return P(P({},v),{reconnectUrl:void 0,serviceUrl:void 0})}function F(v){return typeof v=="string"?parseInt(v,10):v}function x(v){if((v==null?void 0:v.kind)==="redirect"&&v.host!==void 0){var T=v.host;return T.endsWith("/")&&(T=T.substring(0,T.length-1)),T.endsWith("/v4/c")||T.endsWith("/v4/a")||(T+="/v4/c"),T}}var P=this&&this.__assign||function(){return P=Object.assign||function(v){for(var T,_=1,N=arguments.length;_<N;_++){T=arguments[_];for(var I in T)Object.prototype.hasOwnProperty.call(T,I)&&(v[I]=T[I])}return v},P.apply(this,arguments)};Object.defineProperty(M,"__esModule",{value:!0}),M.redirectUrlIfPresent=M.ensureNumber=M.reconnectParamsWithoutUrls=M.adaptUrl=M.isV4ConnectEvent=M.usedProtocolAfterFallback=M.usedProtocol=void 0,M.usedProtocol=G,M.usedProtocolAfterFallback=J,M.isV4ConnectEvent=X,M.adaptUrl=B,M.reconnectParamsWithoutUrls=q,M.ensureNumber=F,M.redirectUrlIfPresent=x},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterFsm=M.State=void 0;var G,oe=ne(4),J=ne(0),X=ne(5);(function(F){F[F.Initial=0]="Initial",F[F.RetrievingToken=1]="RetrievingToken",F[F.Allocating=2]="Allocating",F[F.Handshaking=3]="Handshaking",F[F.Connecting=4]="Connecting",F[F.AnonymousConnecting=5]="AnonymousConnecting",F[F.WebsocketAuthenticating=6]="WebsocketAuthenticating",F[F.Connected=7]="Connected",F[F.Unregistering=8]="Unregistering",F[F.TerminalError=9]="TerminalError"})(G||(M.State=G={}));var B;(function(F){F[F.Initial=0]="Initial",F[F.Registering=1]="Registering",F[F.RegisteringButResendPending=2]="RegisteringButResendPending",F[F.Retrying=3]="Retrying",F[F.Registered=4]="Registered",F[F.RegistrationDisabled=5]="RegistrationDisabled"})(B||(B={}));var q=function(){function F(x,P,v,T){this.worker=P,this.incallModeEnabled=v,this.protocolSelector=T,this.state=G.Initial,this.autoReconnect=!0,this.logger=new J.Logger("ConnectionFsm",x),this.registrationState=B.Initial}return F.prototype.getState=function(){return this.state},F.prototype.isActive=function(){return this.state===G.Allocating||this.state===G.Connected||this.state===G.Handshaking||this.state===G.Connecting||this.state===G.RetrievingToken||this.state===G.AnonymousConnecting||this.state===G.WebsocketAuthenticating},F.prototype.isConnecting=function(){return this.state===G.Allocating||this.state===G.Handshaking||this.state===G.Connecting||this.state===G.AnonymousConnecting},F.prototype.start=function(){return this.state===G.Initial?(this.setState(G.RetrievingToken),this.worker.getToken(!0,!1,void 0),!0):(this.showIgnored("start"),!1)},F.prototype.stop=function(x,P){x&&(this.registrationState=B.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.state===G.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped"),this.registrationState!==B.Registered&&this.registrationState!==B.Registering&&this.registrationState!==B.RegisteringButResendPending||this.state===G.Unregistering?P?(this.setState(G.TerminalError),this.worker.dispatchTerminalError()):(this.setState(G.Initial),this.worker.dispatchDisconnected()):(this.registrationState=B.Initial,this.setState(G.Unregistering),this.worker.sendUnregisterRequest())},F.prototype.onTokenReceived=function(x,P,v){this.state===G.RetrievingToken?(0,X.usedProtocolAfterFallback)(this.protocolSelector(x.tokenType,v),P)==="v4c"?(this.setState(G.AnonymousConnecting),this.worker.startConnectionTimer(),this.worker.connectV4c(x,P)):(this.setState(G.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(x)):this.showIgnored("onTokenReceived")},F.prototype.checkConnection=function(x){x&&this.onPingInterval()},F.prototype.onAllocationSucceed=function(x){return this.state===G.Allocating&&this.registrationState===B.Registered&&this.worker.dispatchUnregistered(),this.state===G.Allocating?(this.setState(G.Handshaking),this.registrationState=B.Initial,this.worker.startSocketIo(x),!0):(this.showIgnored("onAllocationSucceed"),!1)},F.prototype.onAllocationFailed=function(x,P){this.state===G.Allocating?this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!x,claimsChallenge:P}):this.showIgnored("onAllocationFailed")},F.prototype.onV4cException=function(){this.state!==G.AnonymousConnecting&&this.state!==G.WebsocketAuthenticating||(this.logger.error("v4c exception, falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}}))},F.prototype.onConnectingTimeout=function(){this.state===G.Allocating||this.state===G.Connecting||this.state===G.Handshaking||this.state===G.AnonymousConnecting||this.state===G.WebsocketAuthenticating?this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0}):this.showIgnored("onConnectingTimeout")},F.prototype.onConnecting=function(){this.state===G.Handshaking?this.setState(G.Connecting):this.showIgnored("onConnecting")},F.prototype.onSocketConnect=function(x){this.state===G.AnonymousConnecting?(this.setState(G.WebsocketAuthenticating),this.worker.sendV4cAuthenticationEvent(x)):this.showIgnored("onSocketConnect")},F.prototype.onConnectingFailed=function(){this.state===G.Connecting?this.onConnectingTimeout():this.state===G.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.state===G.AnonymousConnecting||this.state===G.WebsocketAuthenticating?(this.logger.info("/v4/c falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}})):this.showIgnored("onConnectingFailed")},F.prototype.onSocketDisconnect=function(x){this.state===G.Handshaking||this.state===G.Connected||this.state===G.WebsocketAuthenticating?(this.state===G.Connected&&this.worker.sendDisconnectTelemetryEvent(x==null?void 0:x.toTelemetryString()),this.state===G.WebsocketAuthenticating&&this.worker.countDisconnectBeforeConnectionEstablishment(),(x==null?void 0:x.reason)==="skypetoken-deprecated"?(this.logger.error("Skypetoken deprecated response, not retrying any further"),this.onTerminalError()):this.cleanUpAndInitiateReconnect({backoff:this.state!==G.Connected&&(x==null?void 0:x.reason)!=="dup",allowCachedToken:(x==null?void 0:x.reason)!=="unauthorized",claimsChallenge:x==null?void 0:x.claims})):this.showIgnored("onSocketDisconnect")},F.prototype.onTrouterConnected=function(){this.state===G.Connecting||this.state===G.WebsocketAuthenticating?(this.setState(G.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(oe.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.registrationState=B.RegistrationDisabled,this.worker.dispatchRegistered()):(this.registrationState=B.Registering,this.worker.sendRegisterRequest())):this.showIgnored("onTrouterConnected")},F.prototype.onReconnectRequired=function(x,P,v){this.state===G.AnonymousConnecting||this.state===G.WebsocketAuthenticating?v===void 0||v.target!=="host"||v.url===void 0||v.url===""?(this.logger.error("unexpected reconnect arguments: ".concat(v==null?void 0:v.target," ").concat(v==null?void 0:v.url,", reconnecting without cache")),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect-no-host"}})):this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect",host:v.url}}):this.worker.dispatchReconnectIsRequired(x,P)},F.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},F.prototype.onDownstreamRequest=function(x){this.state===G.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(x)):this.showIgnored("onDownstreamRequest")},F.prototype.onTrouterMessageLost=function(x){this.state===G.Connected?this.worker.dispatchTrouterMessageLost(x):this.showIgnored("onTrouterMessageLost")},F.prototype.onPingInterval=function(){this.state===G.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},F.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},F.prototype.onPingResponse=function(){this.state===G.Connected||this.showIgnored("onPingResponse")},F.prototype.onRegistrationFailed=function(){this.state===G.Connected&&this.registrationState===B.Registering?(this.worker.dispatchUnregistered(),this.registrationState=B.Retrying,this.worker.startRegistrationRetryTimer()):this.state===G.Connected&&this.registrationState===B.RegisteringButResendPending?(this.registrationState=B.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationFailed")},F.prototype.onRetryRegistration=function(){this.state===G.Connected&&this.registrationState===B.Retrying?(this.registrationState=B.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRetryRegistration")},F.prototype.onRegistrationSucceeded=function(){this.state===G.Connected&&this.registrationState===B.Registering?(this.registrationState=B.Registered,this.worker.dispatchRegistered(),this.worker.startRegistrationTimer()):this.state===G.Connected&&this.registrationState===B.RegisteringButResendPending?(this.registrationState=B.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationSucceeded")},F.prototype.onRegistrationNearExpiry=function(){this.state===G.Connected&&this.registrationState===B.Registered?(this.registrationState=B.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationNearExpiry")},F.prototype.onUnregistrationDone=function(){this.state===G.Unregistering?(this.setState(G.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationDone")},F.prototype.onResendRegistration=function(){this.worker.dispatchUnregistered(),this.state===G.Connected&&this.registrationState===B.Registered?(this.registrationState=B.Registering,this.worker.stopRegistrationTimer(),this.worker.sendRegisterRequest()):this.state===G.Connected&&this.registrationState===B.Registering&&(this.registrationState=B.RegisteringButResendPending)},F.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===G.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},F.prototype.onSetNewUserActivityState=function(){this.worker.sendUserActivityState(oe.UserActivityEventReason.Modified,this.state===G.Connected)},F.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},F.prototype.forceReconnect=function(x){this.state===G.Connected&&this.worker.sendDisconnectTelemetryEvent(x),this.worker.resetTokenBackoff(),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})},F.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '".concat(G[this.state],"' to ").concat(G[G.TerminalError])),this.stop(!0,!0),this.setState(G.TerminalError)},F.prototype.onMissedResponse=function(x){this.state===G.Connected?(this.worker.sendDisconnectTelemetryEvent(x),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})):this.showIgnored(x)},F.prototype.showIgnored=function(x){this.logger.debug("Ignoring event '".concat(x,"' in state '").concat(G[this.state],"'"))},F.prototype.setState=function(x){if(this.logger.info("Switching from state '".concat(G[this.state],"' to state '").concat(G[x],"'")),this.state===x)return void this.logger.error("Attempt to switch to the current state '".concat(G[x],"'"));this.state=x},F.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},F.prototype.cleanUpAndInitiateReconnect=function(x){if(!this.autoReconnect)return this.logger.info("Automatic reconnect is disabled, stopping this connection"),void this.stop(!0);this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.setState(G.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(x.allowCachedToken,x.backoff,x.claimsChallenge,x.fallbackReason)},F}();M.TrouterFsm=q},function(K,M,ne){function G($,m){var R=m?void 0:{"X-MS-Migration":"True"};switch($.tokenType.toLowerCase()){case"skype":return B({"X-Skypetoken":$.token},R);case"aad":case"cae":return B({Authorization:"Bearer ".concat($.token)},R);default:throw new Error("unsupported token type: ".concat($.tokenType))}}function oe($){return $!=null&&typeof $.toString=="function"?$.toString():"[".concat(typeof $,"]")}function J($){return typeof $=="object"&&$!==null&&$.stack!==void 0?(0,v.toJson)($.stack):'"(no error.stack)"'}function X($){return typeof $=="object"&&$!==null&&typeof $.message=="string"?$.message:"(no error.message)"}var B=this&&this.__assign||function(){return B=Object.assign||function($){for(var m,R=1,Z=arguments.length;R<Z;R++){m=arguments[R];for(var ie in m)Object.prototype.hasOwnProperty.call(m,ie)&&($[ie]=m[ie])}return $},B.apply(this,arguments)},q=this&&this.__awaiter||function($,m,R,Z){function ie(se){return se instanceof R?se:new R(function(ue){ue(se)})}return new(R||(R=Promise))(function(se,ue){function Te(O){try{Q(Z.next(O))}catch(U){ue(U)}}function Se(O){try{Q(Z.throw(O))}catch(U){ue(U)}}function Q(O){O.done?se(O.value):ie(O.value).then(Te,Se)}Q((Z=Z.apply($,m||[])).next())})},F=this&&this.__generator||function($,m){function R(Q){return function(O){return Z([Q,O])}}function Z(Q){if(ie)throw new TypeError("Generator is already executing.");for(;Te&&(Te=0,Q[0]&&(Se=0)),Se;)try{if(ie=1,se&&(ue=2&Q[0]?se.return:Q[0]?se.throw||((ue=se.return)&&ue.call(se),0):se.next)&&!(ue=ue.call(se,Q[1])).done)return ue;switch(se=0,ue&&(Q=[2&Q[0],ue.value]),Q[0]){case 0:case 1:ue=Q;break;case 4:return Se.label++,{value:Q[1],done:!1};case 5:Se.label++,se=Q[1],Q=[0];continue;case 7:Q=Se.ops.pop(),Se.trys.pop();continue;default:if(ue=Se.trys,!(ue=ue.length>0&&ue[ue.length-1])&&(Q[0]===6||Q[0]===2)){Se=0;continue}if(Q[0]===3&&(!ue||Q[1]>ue[0]&&Q[1]<ue[3])){Se.label=Q[1];break}if(Q[0]===6&&Se.label<ue[1]){Se.label=ue[1],ue=Q;break}if(ue&&Se.label<ue[2]){Se.label=ue[2],Se.ops.push(Q);break}ue[2]&&Se.ops.pop(),Se.trys.pop();continue}Q=m.call($,Se)}catch(O){Q=[6,O],se=0}finally{ie=ue=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}var ie,se,ue,Te,Se={label:0,sent:function(){if(1&ue[0])throw ue[1];return ue[1]},trys:[],ops:[]};return Te={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(Te[Symbol.iterator]=function(){return this}),Te};Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterConnection=M.ReconnectReason=void 0;var x,P=ne(21),v=ne(3),T=ne(15),_=ne(1),N=ne(16),I=ne(17),A=ne(2),S=ne(4),H=ne(0),L=ne(5),C=ne(6),y=ne(12),k=function(){function $(){this.cv=_.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}return $}(),Y=function(){function $(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return $.prototype.rewriteUrlForProxy=function(m){return m},$}(),V="MS-CV",z=function(){function $(m,R){this.logger=R,this.cvCounter=0;var Z=JSON.parse(m);this.startTS=this.safeJsonNumber(Z,"startTS",0),this.url=this.safeJsonString(Z,"url",""),this.shortUrl=this.safeJsonString(Z,"shortUrl",""),this.body=this.safeJsonString(Z,"body",""),this.headers=this.safeJsonRecord(Z,"headers",{}),this.id=this.safeJsonNumber(Z,"id",-1),this.method=this.safeJsonString(Z,"method",""),this.replied=!1,this.timedout=!1,this.receivedCv=this.headers[V],this.updateCvHeader()}return Object.defineProperty($.prototype,"correlationVector",{get:function(){return this.receivedCv?"".concat(this.receivedCv,".").concat(this.cvCounter):""},enumerable:!1,configurable:!0}),$.prototype.on=function(m,R){m==="data"?this.dataCallback=R:m==="end"&&(typeof this.dataCallback=="function"&&this.dataCallback(this.body),R())},$.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},$.prototype.updateCvHeader=function(){var m=this.correlationVector;m&&(this.headers[V]=m)},$.prototype.safeJsonNumber=function(m,R,Z){var ie;if(m!=null&&Object.prototype.hasOwnProperty.call(m,R)){var se=m;if(typeof se[R]=="number")return se[R];if(typeof se[R]=="string")return parseFloat(se[R]);(ie=this.logger)===null||ie===void 0||ie.warn("unexpected type of '".concat(R,"': ").concat(typeof se[R]))}return Z},$.prototype.safeJsonString=function(m,R,Z){var ie;if(m!=null&&Object.prototype.hasOwnProperty.call(m,R)){var se=m;if(typeof se[R]=="string")return se[R];(ie=this.logger)===null||ie===void 0||ie.warn("unexpected type of '".concat(R,"': ").concat(typeof se[R]))}return Z},$.prototype.safeJsonRecord=function(m,R,Z){var ie;if(m!=null&&Object.prototype.hasOwnProperty.call(m,R)){var se=m;if(typeof se[R]=="object")return se[R];(ie=this.logger)===null||ie===void 0||ie.warn("unexpected type of '".concat(R,"': ").concat(typeof se[R]))}return Z},$}(),W=function(){function $(m,R,Z){this.request=m,this.responseData=R,this.sendResponse=Z}return $.prototype.writeHead=function(m,R){this.responseData.status=m,this.responseData.headers=R},$.prototype.write=function(m){this.responseData.body+=m},$.prototype.end=function(m){return m&&(this.responseData.body+=m),this.sendResponse(this.request,this.responseData)},$}(),le=function(){function $(m){this.name=m,this.args={},this.timeoutTimerId=0}return $}();(function($){$[$.Configuration=0]="Configuration",$[$.ServerInitiated=1]="ServerInitiated"})(x||(M.ReconnectReason=x={}));var re=function(){function $(m,R,Z,ie,se,ue,Te,Se){var Q,O=this;this.options=R,this.manager=Z,this.tokenProvider=ie,this.usingLegacyTokenApi=se,this.protocolSelector=Te,this.audienceSubscriptionState=Se,this.WEBSOCKET_TRANSPORT_NAME="websocket",this.XHR_POLLING_TRANSPORT_NAME="xhr-polling",this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR="Error",this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED="Unsubscribed",this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT="Timeout",this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST="BadRequest",this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX=/&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.connectingErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingSentEventTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.connectingErrorsThreshold=3,this.pendingAudienceSubscription=void 0,this.logger=new H.Logger("Connection",m),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new I.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),typeof window<"u"&&window.location&&(this.domId=window.location.hostname);var U=new k;U.cv=_.CLIENT_VERSION,U.ua="",!((Q=this.options)===null||Q===void 0)&&Q.clientInfo&&(U.ua=this.safeString(this.options.clientInfo.ua),U.v=this.safeString(this.options.clientInfo.v)),this.clientInfo=U,this.connectionTracker=new T.ConnectionTracker(m,this.clientID,this.clientInfo,function(){return O.getServerState()},this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(R);var ae=this.options.incallModeTimeoutMs>0;if(this.fsm=new C.TrouterFsm(m,this,ae,this.protocolSelector),R.registration){var ce={registrarUrl:R.registration.registrarUrl,proxyUrlRewrite:R.rewriteUrlForProxy,registrationId:R.registration.registrationId,requestTimeoutMs:R.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:R.timeoutOptions.maxBackoffMs,usingLegacyTokenApi:this.usingLegacyTokenApi,maxRetriesForGetToken:R.retryLimitOnTokenFetch,extraRegistrationHeaders:R.extraConnectionHeaders};this.registrarClient=(0,P.createRegistrarClient)(m,this.tokenProvider,ce)}this.userActivityState=ue}return $.prototype.start=function(m){this.logger.info("Starting"),this.reconnectParams=m,typeof window<"u"&&window.navigator&&window.addEventListener?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: ".concat(this.isNavigatorOnline))):this.isNavigatorOnline=!0,this.fsm.start()},$.prototype.stop=function(m){this.logger.info("Stopping"),typeof window<"u"&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(m),this.connectionTracker.close()},$.prototype.configure=function(m){var R=this.options.trouterUrl!==m.trouterUrl;this.options=m,this.applyConnectionTrackerOptions(m),R&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,x.Configuration))},$.prototype.checkConnection=function(m){this.logger.info("checkConnection called with ".concat(m)),this.fsm.checkConnection(m),m&&this.connectionTracker.sendTelemetry(T.ClientEventName.CheckConnection,{disconnectDetected:m},[])},$.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegistrationTimer(),this.cancelPendingRegistrationRequests(),this.fsm.disableAutoReconnect()},$.prototype.getServerState=function(){return new S.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},$.prototype.getState=function(){return this.fsm.getState()},$.prototype.getToken=function(m,R,Z,ie,se){var ue=this;se===void 0&&(se=0),this.logger.info("Getting token ".concat(R?"with backoff":"without backoff"));var Te=function(){ue.connectionTracker.trackStart("token");var Se={needFresh:!m,wwwAuthenticateHeader:Z,supportedTokenTypes:_.SUPPORTED_TOKEN_TYPES,purpose:"trouter"};ue.logger.info("Requesting token: needFresh=".concat(Se.needFresh," ")+"types=[".concat(_.SUPPORTED_TOKEN_TYPES,"], ")+"wwwAuthenticateHeader is ".concat(Se.wwwAuthenticateHeader?"non empty":"empty")),ue.tokenProvider(Se).then(function(Q){ue.logger.debug("".concat(Q.tokenType," token is received")),ue.connectionTracker.trackEnd("token"),ue.fsm.onTokenReceived(Q,ie,ue.reconnectParams)}).catch(function(Q){var O=(0,v.toJson)(Q.stack);if(ue.logger.error("Getting token failed, will retry after timeout. Error: ".concat(O)),ue.connectionTracker.trackError("token",O),!ue.canRetryTokenFetchRequest(se+ue.unauthorizedErrorCount))return ue.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),ue.resetTokenBackoff(),void ue.fsm.onTerminalError();ue.getToken(m,!0,Z,ie,se+1)})};R?this.tokenBackoff.backoff("getting token",Te):(this.resetTokenBackoff(),Te())},$.prototype.startConnectionTimer=function(){var m=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for ".concat(this.timeoutOptions.connectionTimeoutMs," ms")),this.connectionTimeoutId=setTimeout(function(){m.logger.info("Connection timeout is fired"),m.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},$.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},$.prototype.startPingTimer=function(){var m=this;this.transportTypeName==="websocket"?(this.logger.debug("Starting ping timeout for ".concat(this.timeoutOptions.pingTimeoutMs," ms")),this.pingTimerId=setInterval(function(){m.logger.info("Ping interval fired"),m.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport ".concat(this.transportTypeName))},$.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},$.prototype.shouldSkipRegistration=function(){return this.options.registration===void 0},$.prototype.hasCustomRegistrationTtl=function(){var m,R;return((m=this.options.registration)===null||m===void 0?void 0:m.registrarTtlSec)!==void 0&&((R=this.options.registration)===null||R===void 0?void 0:R.registrarTtlSec)!==0},$.prototype.startRegistrationTimer=function(){var m=this;this.stopRegistrationTimer();var R=this.getRegistrationTtl(),Z=R[0],ie=R[1];if(Z<=30||!ie)return this.logger.debug("Starting registration expiration timer (TTL ".concat(Z," sec)")),void(this.registrationTimerId=setTimeout(function(){m.registrationTimerId=void 0,m.logger.warn("Registration expired but the connection is still alive. Should never happen"),m.dispatchUnregistered()},1e3*Z));var se=Z-30;this.logger.debug("Starting registration extension timer for ".concat(se," sec")),this.registrationTimerId=setTimeout(function(){m.logger.info("Registration extension timer fired"),m.registrationTimerId=setTimeout(function(){m.registrationTimerId=void 0,m.logger.debug("Registration extension did not happen in time"),m.dispatchUnregistered()},3e4),m.fsm.onRegistrationNearExpiry()},1e3*se)},$.prototype.startRegistrationRetryTimer=function(){var m=this;this.stopRegistrationTimer(),this.registrationTimerId=setTimeout(function(){m.registrationTimerId=void 0,m.fsm.onRetryRegistration()},123e3)},$.prototype.stopRegistrationTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},$.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.fsm.onResendRegistration(),Promise.resolve()},$.prototype.buildSocketIoUrlParams=function(m,R){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var Z={},ie=this.allocateResult.connectparams,se=0,ue=Object.keys(ie);se<ue.length;se++){var Te=ue[se];if(ie[Te]!==void 0){var Se=ie[Te];typeof Se=="string"||typeof Se=="number"?Z[Te]=Se:this.logger.error("signatureData[".concat(Te,"] has unsupported type ").concat(typeof Se))}}return Z.v="v4",Z.tc=encodeURI((0,v.toJson)(this.clientInfo)),Z.timeout=this.timeoutOptions.pingTimeoutMs/1e3,Z.auth="true",this.options.endpointId&&(Z.epid=this.options.endpointId),m&&(Z.userActivity=encodeURI((0,v.toJson)(m))),R&&(Z.audienceSubscriptionState=encodeURIComponent((0,v.toJson)(R))),this.appendConnectedClientIds(this.buildQuery(Z),!0)},$.prototype.startSocketIo=function(m){var R,Z;if(this.logger.debug("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var ie=this.options.ioOptions?B({},this.options.ioOptions):new Y,se=this.userActivityState.state!==A.UserActivityState.Unknown?this.userActivityState.increaseCvAndGetEventObject():void 0,ue=(R=this.audienceSubscriptionState)===null||R===void 0?void 0:R.increaseCvAndGetEventObject();if(ie["force new connection"]=!0,ie.reconnect=!1,ie.rewriteUrlForProxy=this.options.rewriteUrlForProxy,ie.requestHeaders=B(B({},this.options.extraConnectionHeaders),G(m,this.usingLegacyTokenApi)),ie.query=this.buildSocketIoUrlParams(se,ue),this.logger.info("connecting to ".concat(this.allocateResult.socketio,"?").concat(ie.query)),this.stopSocketIo(),this.socket=((Z=this.options.io)!==null&&Z!==void 0?Z:y).connect(this.allocateResult.socketio,ie),this.socket===void 0)throw new Error("Can't create Socket.io object");this.attachSocketIoHandlers(this.socket,m,se,ue)},$.prototype.stopSocketIo=function(){if(this.socket){this.logger.debug("clearing socket.io");try{for(var m=0,R=["connecting","connect","connect_failed","close_during_connecting","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];m<R.length;m++){var Z=R[m];this.socket.removeAllListeners(Z)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(ie){this.logger.error("exception in disconnecting previous socket. Error: ".concat(J(ie)))}}},$.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},$.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},$.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},$.prototype.dispatchDownstreamRequest=function(m){var R=this;this.logger.debug("dispatching downstream request");try{var Z=new W(m,new T.ResponseData(m.id),function(ie,se){return R.logger.debug("sending response to downstream"),R.sendResponse(ie,se)});this.manager.onDownstreamRequest(this,m,Z)}catch(ie){this.logger.error("exception in socket.on message. Error : ".concat(J(ie)))}},$.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},$.prototype.dispatchReconnectIsRequired=function(m,R){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,m,R)},$.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},$.prototype.dispatchTerminalError=function(){this.logger.info("dispatching terminal error"),this.manager.onTerminalError(this)},$.prototype.dispatchTrouterMessageLost=function(m){this.logger.info("dispatching trouter message lost"),this.manager.onTrouterMessageLost(m)},$.prototype.countDisconnectBeforeConnectionEstablishment=function(){this.logger.warn("counting disconnect before connection was fully established as a connection failure"),++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold()},$.prototype.sendProcessedDroppedIndicators=function(m){var R=this;try{this.logger.debug("emitting processed flow tags to the server");var Z=new le("trouter.processed_message_loss");Z.args={droppedIndicators:m},this.sendDownstreamEvent(Z,function(){R.logger.info("emitted processed flow tags to the server")})}catch(se){var ie=J(se);this.logger.error("unable to send processed message loss event. Error: ".concat(ie)),this.connectionTracker.trackError("trouter.processed_message_loss",ie,!1)}},$.prototype.sendAllocateRequest=function(m){var R=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var Z,ie=this.options.trouterUrl,se=this.reconnectParams,ue=typeof(se==null?void 0:se.se)=="string"?parseInt(se.se,10):typeof(se==null?void 0:se.se)=="number"?se.se:void 0;ue&&ue<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: ".concat(new Date(ue))),this.reconnectParams=se=void 0),se&&se.serviceUrl!==ie&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(se.serviceUrl,", now ").concat(ie,")")),this.reconnectParams=se=void 0),se!=null&&se.reconnectUrl&&(ie=se.reconnectUrl),Z=se?B(B({},se),{serviceUrl:void 0,reconnectUrl:void 0}):null,ie=(0,L.adaptUrl)(ie,"v4a"),ie=this.appendCorrelationIds(ie,!1),ie=this.appendEndpointId(ie,!1),Z&&(ie+="&".concat(this.buildQuery(Z)),Z.v||(ie+="&v=".concat("v4"))),ie=this.options.rewriteUrlForProxy(ie);var Te=new Request(ie,{method:"POST",mode:"cors",headers:new Headers(B(B({"Content-Type":"text/plain"},this.options.extraConnectionHeaders),G(m,this.usingLegacyTokenApi)))});this.logger.info("sendAllocateRequest: POST ".concat(ie)),this.connectionTracker.trackStart("allocation");var Se,Q=Date.now(),O=-1,U=!1;(0,v.fetchWithTimeout)(Te,this.timeoutOptions.fetchTimeoutMs).then(function(ae){var ce;if(O=ae.status,!ae.ok)throw Se=(ce=ae.headers.get("www-authenticate"))!==null&&ce!==void 0?ce:void 0,U=ae.headers.get("x-trouter-skypetoken-deprecated")==="1",R.logger.warn("Allocation request got response status ".concat(ae.status,", www-authenticate header was ").concat(Se?"not empty":"empty")),new Error(ae.statusText);var fe=ae.headers.get("content-type");if(!fe||fe!=="application/json"&&!fe.startsWith("application/json;"))throw new Error("Content-type '".concat(fe,"' is unexpected"));return R.connectionTracker.trackEnd("allocation"),ae.json()}).then(function(ae){R.unauthorizedErrorCount=0,R.onAllocationResponse(ae,m)}).catch(function(ae){R.connectingErrorsInRow++;var ce="".concat(ae).concat(O>=0?", status code ".concat(O):"");if(R.logger.error("".concat(R.connectingErrorsInRow," failed connecting attempt(s) in a row. ").concat(ce)),R.connectionTracker.trackError("allocation",ce),U){var fe="Skypetoken deprecated response, not retrying any further";return R.logger.error(fe),R.connectionTracker.trackError("allocation",fe),void R.fsm.onTerminalError()}if(O===401&&R.unauthorizedErrorCount++,!R.canRetryTokenFetchRequest(R.unauthorizedErrorCount)){var fe="getToken retry limit hit, reached terminal error state";return R.connectionTracker.trackError("allocation",fe),void R.fsm.onTerminalError()}if(O!==-1||R.isNavigatorOnline){if(R.reconnectParams&&R.connectingErrorsInRow>=R.connectingErrorsThreshold){if(O>=400&&O<=599)R.resetReconnectParamsOnErrorThreshold();else if(R.reconnectParams.reconnectUrl&&R.connectingErrorsInRow%3==0){R.logger.warn("".concat(R.connectingErrorsInRow," connection attempts, testing nominal service URL"));var ve=Math.min(R.timeoutOptions.connectionTimeoutMs-(Date.now()-Q)-500,R.timeoutOptions.fetchTimeoutMs);return void R.testNominalUrlConnectivity(ve).then(function(Pe){R.connectionTracker.trackProgress("nomcheck",Pe?"ok":"failed"),Pe?(R.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),R.reconnectParams&&delete R.reconnectParams.reconnectUrl):R.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),R.fsm.onAllocationFailed(!1,void 0)},function(){R.fsm.onAllocationFailed(!1,void 0)})}}}else R.logger.info("Expected failure, the browser says it is not online at the moment");R.fsm.onAllocationFailed(O===401,Se)})},$.prototype.testNominalUrlConnectivity=function(m){var R=this;if(m<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check (".concat(m," ms), falling back to assuming that the connectivity is fine")),Promise.resolve(!0);var Z;try{var ie=new URL(this.options.trouterUrl);ie.pathname="/",ie.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent((0,v.toJson)(this.clientInfo))}),Z=new Request(this.options.rewriteUrlForProxy(ie.toString()),{method:"GET",headers:{Accept:"text/plain"}})}catch(se){return this.logger.warn("Nominal service URL connectivity test request could not be created (".concat(se,"), falling back to assuming that the connectivity is fine")),Promise.resolve(!0)}return(0,v.fetchWithTimeout)(Z,m).then(function(se){if(se.status!==200)throw new Error("Not 200 OK: ".concat(se.status," ").concat(se.statusText));return se.text()}).then(function(se){if(se!=="Trouter")throw new Error('Not "Trouter": '.concat(se.substring(0,16)).concat(se.length>16?"...":""));return!0}).catch(function(se){return R.logger.error("Nominal service URL connectivity test failed: ".concat(se)),!1})},$.prototype.sendPingRequest=function(){var m=this;if(this.socket&&this.pingResponseTimerId===void 0)try{this.logger.debug("emitting ping event");var R=!1;this.socket.emit("ping",function(){R!==!0&&m.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){m.logger.error("Ping response timeout is fired"),R=!0,m.clearPingResponseTimer(),m.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(ie){var Z=J(ie);this.logger.error("unable to send ping. Error: ".concat(Z)),this.connectionTracker.trackError("ping",Z,!1)}},$.prototype.connectV4c=function(m,R){var Z,ie,se,ue,Te,Se,Q=this.options.ioOptions?B({},this.options.ioOptions):new Y;Q["force new connection"]=!0,Q.reconnect=!1,!((Z=this.reconnectParams)===null||Z===void 0)&&Z.serviceUrl&&(0,L.adaptUrl)(this.reconnectParams.serviceUrl,"v4c")!==(0,L.adaptUrl)(this.options.trouterUrl,"v4c")&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(this.reconnectParams.serviceUrl,", now ").concat(this.options.trouterUrl,")")),this.reconnectParams=void 0);var O=(ue=(ie=(0,L.redirectUrlIfPresent)(R))!==null&&ie!==void 0?ie:(R==null?void 0:R.kind)!=="redirect-no-host"?(se=this.reconnectParams)===null||se===void 0?void 0:se.reconnectUrl:void 0)!==null&&ue!==void 0?ue:this.options.trouterUrl,U=(0,L.adaptUrl)(O,"v4c");Q["skipped handshake data"]={timeout:70,websocketUrl:U},Q.query=this.buildV4cUrlParams(),Q.rewriteUrlForProxy=this.options.rewriteUrlForProxy;try{if(this.stopSocketIo(),this.transportTypeName="websocket",this.socket=((Te=this.options.io)!==null&&Te!==void 0?Te:y).connect(this.options.trouterUrl,Q),this.socket===void 0)throw new Error("failed to create Socket.io object");var ae=(Se=this.audienceSubscriptionState)===null||Se===void 0?void 0:Se.increaseCvAndGetEventObject();this.attachSocketIoHandlers(this.socket,m,void 0,ae)}catch(ce){this.logger.error("".concat(ce)),this.connectionTracker.trackError("v4c","".concat(ce)),this.fsm.onV4cException()}},$.prototype.sendV4cAuthenticationEvent=function(m){var R,Z={headers:B(B({},this.options.extraConnectionHeaders),G(m,this.usingLegacyTokenApi)),connectparams:(0,L.reconnectParamsWithoutUrls)(this.reconnectParams)};(R=this.socket)===null||R===void 0||R.emit(_.USER_AUTHENTICATE_EVENT_NAME,Z)},$.prototype.setUserActivityState=function(m){var R=m.state!==this.userActivityState.state;this.userActivityState=m,R?(this.logger.info("Changing user activity state to '".concat(m.toEventJSON(),"'")),this.fsm.onSetNewUserActivityState()):(this.logger.debug("Not changing the same user activity state '".concat(m.toEventJSON(),"'")),this.manager.onUserActivityStateAccepted(m.correlationVector.value()))},$.prototype.sendUserActivityState=function(m,R){this.userActivityState.state!==A.UserActivityState.Unknown&&(this.transportTypeName==="websocket"&&R?m===S.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):this.transportTypeName==="xhr-polling"&&m===S.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},$.prototype.setAudienceSubscriptionsAsync=function(m,R){var Z=this.audienceSubscriptionState;if(this.audienceSubscriptionState=m,this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME)return this.setAudienceSubscriptionsInternalAsync(m.increaseCvAndGetEventObject(),R);if(this.transportTypeName===this.XHR_POLLING_TRANSPORT_NAME){var ie=this.setAudienceSubscriptionsLongpollInternalAsync(m.increaseCvAndGetEventObject(),R,Z);return this.fsm.forceReconnect("set audience subscription force reconnect"),ie}throw new Error("set audience subscription executed on an unknown transport")},$.prototype.setAudienceSubscriptionsUnsafeAsync=function(m){if(m)return this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?this.setAudienceSubscriptionsInternalAsync(m,15e3):void 0},$.prototype.setAudienceSubscriptionsInternalAsync=function(m,R){return q(this,void 0,void 0,function(){var Z,ie,se=this;return F(this,function(ue){switch(ue.label){case 0:return this.logger.info("[WebSocket] Audience subscription set requested."),Z=new le("audience.subscribe"),Z.args=m,[4,new Promise(function(Te){var Se=!1,Q=setTimeout(function(){return Se=!0,Te(se.buildAudienceSubscriptionsTimeoutResponse(m))},R);se.sendDownstreamEvent(Z,function(O,U){Se||(clearTimeout(Q),se.logger.debug("[Websocket] Audience subscription response: ".concat(U)),se.pendingAudienceSubscription&&se.onAudienceSubscriptionResult(U),Te(U))})})];case 1:return ie=ue.sent(),this.manager.onAudiencesSetResolved(ie,m.cv),[2,ie]}})})},$.prototype.setAudienceSubscriptionsLongpollInternalAsync=function(m,R,Z){var ie;return q(this,void 0,void 0,function(){var se,ue,Te,Se,Q,O,U=this;return F(this,function(ae){switch(ae.label){case 0:return this.logger.info("[XHR Polling] Audience subscription set requested."),this.pendingAudienceSubscription&&(this.logger.error("Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons."),clearTimeout(this.pendingAudienceSubscription.timeoutId)),m.audiences.length===0?[2,this.handleAudienceUnsubscribeLongpoll(m.cv,Z)]:[4,new Promise(function(ce){var fe=setTimeout(function(){return U.pendingAudienceSubscription=void 0,ce(U.buildAudienceSubscriptionsTimeoutResponse(m))},R);U.pendingAudienceSubscription={audienceSetResolve:ce,timeoutId:fe}})];case 1:return se=ae.sent(),this.manager.getState()===A.TrouterState.Unknown||this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?[2,se]:(ue=se.responses[0],(ue==null?void 0:ue.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(se,m.cv),[2,se]):(Te=se.responses.find(function(ce){return ce.audienceId===m.audiences[0].id}),(Te==null?void 0:Te.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(se,m.cv),[2,se]):(Se=((ie=Z==null?void 0:Z.audienceSubscriptionModel.audienceSubscriptions[0])===null||ie===void 0?void 0:ie.id)!==(ue==null?void 0:ue.audienceId),Z&&Se&&(Q=this.mapToSyntheticAudienceSubscriptionResponses(Z.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200),(O=se.responses).push.apply(O,Q)),this.manager.onAudiencesSetResolved(se,m.cv),[2,se])))}})})},$.prototype.clearAudienceSubscriptionStateQueryParam=function(){var m,R,Z;!((Z=(R=(m=this.socket)===null||m===void 0?void 0:m.socket)===null||R===void 0?void 0:R.options)===null||Z===void 0)&&Z.query&&(this.socket.socket.options.query=this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX,""))},$.prototype.handleAudienceUnsubscribeLongpoll=function(m,R){var Z;this.audienceSubscriptionState=void 0;var ie={responses:[]};if(R){var se=this.mapToSyntheticAudienceSubscriptionResponses(R.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200);(Z=ie.responses).push.apply(Z,se)}return this.manager.onAudiencesSetResolved(ie,m),ie},$.prototype.buildAudienceSubscriptionsTimeoutResponse=function(m){return this.logger.error("Audience subscription attempt has timed out."),{responses:this.mapToSyntheticAudienceSubscriptionResponses(m.audiences,this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)}},$.prototype.mapToSyntheticAudienceSubscriptionResponses=function(m,R,Z){return m.map(function(ie){return{audienceId:ie.id,result:{audienceSubscriptionState:R,responseStatus:Z}}})},$.prototype.expediteBackoff=function(){this.tokenBackoff.expediteIfPending()},$.prototype.sendRegisterRequest=function(){var m=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var R=new v.Timespan;this.connectionTracker.trackStart("registration");var Z=this.getRegistrationTtl()[0];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:Z}]}).then(function(){m.logger.info("Register request successful"),m.connectionTracker.trackEnd("registration"),m.fsm.onRegistrationSucceeded(),m.connectionTracker.sendTelemetry(T.ClientEventName.Registration,{duration:R.duration},[])}).catch(function(ie){m.logger.error("Register request failed. Error: ".concat(ie)),m.connectionTracker.trackError("registration",X(ie)),m.fsm.onRegistrationFailed(),m.connectionTracker.sendTelemetry(T.ClientEventName.Registration,{duration:R.duration},[])})},$.prototype.sendUnregisterRequest=function(){var m=this;this.logger.info("sending unregister request");var R=new v.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then(function(){m.logger.info("Unregister request successful"),m.connectionTracker.trackEnd("unregistration"),m.fsm.onUnregistrationDone(),m.connectionTracker.sendTelemetry(T.ClientEventName.Unregistration,{duration:R.duration},[])}).catch(function(Z){m.logger.error("Unregister request failed. Error: ".concat(Z)),m.connectionTracker.trackError("unregistration",X(Z)),m.fsm.onUnregistrationDone(),m.connectionTracker.sendTelemetry(T.ClientEventName.Unregistration,{duration:R.duration},[])})},$.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},$.prototype.cancelPendingRegistrationRequests=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},$.prototype.clearSentEventTimers=function(){var m=Object.keys(this.pendingSentEventTimers);if(m.length>0){this.logger.debug("Clearing all pending downstream events related timers");for(var R=0,Z=m;R<Z.length;R++){var ie=Z[R];this.clearSentEventTimer(Number(ie))}}},$.prototype.restartIncallModeTimer=function(){var m=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){m.logger.info("Call mode timer fired"),m.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},$.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},$.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},$.prototype.isIncallMode=function(){return this.inIncallMode},$.prototype.sendDisconnectTelemetryEvent=function(m){var R={reason:m,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(R),this.connectionTracker.clearConnectedInfo()},$.prototype.forceReconnectDueToNoRegistration=function(){this.fsm.forceReconnect("force reconnect due to no registration")},$.prototype.resetReconnectParamsOnErrorThreshold=function(){this.logger.warn("".concat(this.connectingErrorsInRow," connection attempts, server-side failure: erasing cached connection parameters")),this.reconnectParams=void 0},$.prototype.onSocketConnecting=function(m){this.logger.info("onSocketConnecting(".concat(m,")")),this.transportTypeName=m,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},$.prototype.onSocketConnect=function(m){this.logger.info("onSocketConnect"),this.fsm.onSocketConnect(m)},$.prototype.onSocketConnectFailed=function(m){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",m,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},$.prototype.onSocketDisconnect=function(m){var R=this.connectionTracker.getSessionLength()||0,Z=N.DisconnectReason.fromRawReason(m);this.logger.error("onSocketDisconnect, reason: ".concat(Z.reason)),Z.reason==="dup"&&this.lastDisconnectReason==="dup"&&R<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row "+"after ".concat(R," ms which is below the threshold of ")+"".concat(this.options.duplicateDisconnectThresholdMs," ms. Resetting cached ")+"connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=Z.reason,this.fsm.onSocketDisconnect(Z),this.connectionExpireTimestampInSecs=void 0},$.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},$.prototype.onSocketReconnectFailed=function(m){this.logger.error("onSocketReconnectFailed with '".concat(m,"'")),this.fsm.onSocketDisconnect(N.DisconnectReason.fromSocketIoEventData("reconnecterror",m))},$.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},$.prototype.onSocketError=function(m){this.logger.error("onSocketError with '".concat((0,v.toJson)(m),"'")),this.fsm.isConnecting()&&++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold(),this.connectionTracker.trackError("connectSocket",oe(m)),this.fsm.onSocketDisconnect(N.DisconnectReason.fromSocketIoEventData("socketerror",m))},$.prototype.onSocketMessage=function(m){var R,Z=this;this.logger.debug("onSocketMessage");var ie;try{ie=new z(m,this.logger);var se=(R=ie.headers)===null||R===void 0?void 0:R["X-Microsoft-Skype-Chain-ID"],ue=se?" Chain-Id ".concat(se):"";this.logger.info("Received request N ".concat(ie.id).concat(ue," CV ").concat(ie.correlationVector," to '").concat(ie.url,"'")),ie.startTS=Date.now(),ie.url&&this.urlPath&&ie.url.startsWith(this.urlPath)&&(ie.shortUrl=ie.url.substring(this.urlPath.length))}catch(Se){var Te=J(Se);return this.logger.error("unable to parse request. Error: ".concat(Te)),this.connectionTracker.trackRequest(void 0,Te),void this.connectionTracker.sendResponseError("unable to parse request, error: ".concat(Se))}ie.timeoutTimerId=setTimeout(function(){if(!ie.replied){Z.logger.error("Request ".concat(ie.id," timed out"));var Se=new T.ResponseData(ie.id);Se.status=504,Se.headers={"Trouter-Responder":"ClientLib"},Z.sendResponse(ie,Se),ie.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(ie),this.fsm.onDownstreamRequest(ie)}catch(Se){this.logger.error("exception in socket.on message. Error: ".concat(J(Se))),this.connectionTracker.sendResponseError(X(Se),ie,void 0)}},$.prototype.onTrouterConnected=function(m,R,Z){var ie,se,ue,Te,Se=this;if((0,L.isV4ConnectEvent)(m)){var Q=m;this.allocateResult=B(B({},Q),{ttl:m.ttl.toString()}),this.populateAndCacheReconnectParams(Q,Q.reconnectUrl),this.populateConnectionStateFields(Q)}else if(!this.allocateResult)return void this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set");this.connectingErrorsInRow=0,this.logger.info("onTrouterConnected: ".concat(this.allocateResult.url)),this.transportTypeName==="xhr-polling"&&R&&this.manager.onUserActivityStateAccepted(R.cv),!((ue=(se=(ie=this.socket)===null||ie===void 0?void 0:ie.socket)===null||se===void 0?void 0:se.options)===null||ue===void 0)&&ue.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var O=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=(0,v.calculateExpireTsInSec)((0,L.ensureNumber)(m.ttl)),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(O,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),(Te=this.setAudienceSubscriptionsUnsafeAsync(Z))===null||Te===void 0||Te.catch(function(U){return Se.logger.error("Re-subscribe to audiences has failed with ".concat(U))}),this.fsm.onTrouterConnected()},$.prototype.onTrouterReconnect=function(m){var R=m.target;this.logger.info("onTrouterReconnect target: ".concat(R)),R==="self"?this.fsm.onReconnectRequired(!0,x.ServerInitiated):this.fsm.onReconnectRequired(!1,x.ServerInitiated,m)},$.prototype.onTrouterMessageLoss=function(m){this.logger.debug("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(m.droppedIndicators)},$.prototype.onAudienceSubscriptionResult=function(m){this.logger.info("onAudienceSubscriptionResult"),this.pendingAudienceSubscription&&(clearTimeout(this.pendingAudienceSubscription.timeoutId),this.pendingAudienceSubscription.audienceSetResolve(m),this.pendingAudienceSubscription=void 0)},$.prototype.buildV4cUrlParams=function(){var m={};return m.tc=encodeURI((0,v.toJson)(this.clientInfo)),m.timeout=Math.floor(this.timeoutOptions.pingTimeoutMs/1e3),this.options.endpointId&&(m.epid=this.options.endpointId),this.appendConnectedClientIds(this.buildQuery(m),!0)},$.prototype.attachSocketIoHandlers=function(m,R,Z,ie){var se=this;m.on("connecting",function(ue){se.onSocketConnecting(ue)}),m.on("connect",function(){se.onSocketConnect(R)}),m.on("connect_failed",function(ue){se.onSocketConnectFailed(ue)}),m.on("close_during_connecting",function(ue){se.onSocketConnectFailed(ue)}),m.on("disconnect",function(ue){se.onSocketDisconnect(ue)}),m.on("reconnect",function(){se.onSocketReconnect()}),m.on("reconnect_failed",function(ue){se.onSocketReconnectFailed(ue)}),m.on("reconnecting",function(){se.onSocketReconnecting()}),m.on("error",function(ue){se.onSocketError(ue)}),m.on("message",function(ue){se.onSocketMessage(ue)}),m.on("trouter.connected",function(ue){se.onTrouterConnected(ue,Z,ie)}),m.on("trouter.reconnect",function(ue){se.onTrouterReconnect(ue)}),m.on("trouter.message_loss",function(ue){se.onTrouterMessageLoss(ue)}),m.on("audience.subscriptionresult",function(ue,Te){se.onAudienceSubscriptionResult(Te)})},$.prototype.onNavigatorOnlineStatusUpdate=function(){var m=window.navigator.onLine;this.logger.debug("Browser online status update - new state: ".concat(m,", previously: ").concat(this.isNavigatorOnline)),m&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!m&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},$.prototype.onAllocationResponse=function(m,R){this.logger.info("Received allocation response ".concat(JSON.stringify(m))),this.allocateResult=m,this.populateAndCacheReconnectParams(this.allocateResult,"".concat(this.allocateResult.socketio,"v4/a")),this.populateConnectionStateFields(this.allocateResult),this.fsm.onAllocationSucceed(R)},$.prototype.populateAndCacheReconnectParams=function(m,R){this.reconnectParams=B({serviceUrl:this.options.trouterUrl,reconnectUrl:R},m.connectparams),this.manager.onConnectionParametersUpdated(this.reconnectParams)},$.prototype.populateConnectionStateFields=function(m){var R,Z,ie=typeof m.ttl=="string"?parseInt(m.ttl,10):m.ttl;if(this.connectionExpireTimestampInSecs=(0,v.calculateExpireTsInSec)(ie),this.connectionId=(R=m.id)!==null&&R!==void 0?R:"",this.connectedClientId=m.ccid,this.logger.debug("connected client id set {connectedClientId:".concat(this.connectedClientId,"}")),this.c2cUrlBase=(Z=m.curlb)!==null&&Z!==void 0?Z:"",this.c2cUrlBase===""){var se=m.surl.indexOf("://");se>=0&&(se=m.surl.indexOf("/",se+3))>=5&&m.surl.substr(se-5,5)===":3443"&&(this.c2cUrlBase=m.surl.substr(0,se-5))}},$.prototype.onPingResponse=function(){this.logger.debug("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},$.prototype.clearPingResponseTimer=function(){this.pingResponseTimerId!==void 0&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},$.prototype.buildQuery=function(m){for(var R=[],Z=0,ie=Object.keys(m);Z<ie.length;Z++){var se=ie[Z];m[se]!==void 0&&R.push("".concat(se,"=").concat(m[se]))}return R.join("&")},$.prototype.appendConnectedClientIds=function(m,R){var Z="";m.includes("ccid=")||(Z="ccid=".concat(this.connectedClientId,"&")),this.domId&&(Z+="dom=".concat(this.domId,"&")),Z.length>0&&(Z=Z.slice(0,-1));var ie=R||m.includes("?")?"&":"?";return this.appendCorrelationIds(m+ie+Z,R)},$.prototype.appendEndpointId=function(m,R){var Z=R||m.includes("?")?"&":"?";return!m.includes("epid")&&this.options.endpointId?"".concat(m).concat(Z,"epid=").concat(this.options.endpointId):m},$.prototype.appendCorrelationIds=function(m,R){var Z=R||m.includes("?")?"&":"?";return m.includes("cor_id")?m:"".concat(m).concat(Z,"cor_id=").concat(this.options.clientCorrelationID)+"&con_num=".concat(this.clientID,"_").concat(this.connectionAttempt)},$.prototype.safeString=function(m){return typeof m=="string"?m:""},$.prototype.sendResponse=function(m,R){var Z,ie,se;if(m.timedout)return this.logger.error("Request ".concat(m.id," already timed out")),1;if(m.replied)return this.logger.error("Response for request ".concat(m.id," already sent")),2;clearTimeout(m.timeoutTimerId),m.timeoutTimerId=void 0,m.replied=!0,R.headers=(Z=R.headers)!==null&&Z!==void 0?Z:{};var ue=m.correlationVector;this.logger.info("Sending response N ".concat(m.id," CV ").concat(ue," with status ").concat(R.status)),ue&&(R.headers[V]=ue),!((ie=m.headers)===null||ie===void 0)&&ie["trouter-request"]&&(R.headers["trouter-request"]=m.headers["trouter-request"]);var Te=Date.now()-m.startTS;if(R.headers["trouter-client"]=(0,v.toJson)({cd:Te}),!((se=m.headers)===null||se===void 0)&&se["trouter-is-broadcast"]&&(R.headers["trouter-is-broadcast"]=m.headers["trouter-is-broadcast"]),this.logger.debug("response: ".concat((0,v.toJson)(R))),!this.socket)return this.connectionTracker.sendResponseError("no socket",m,R),4;try{return this.socket.send((0,v.toJson)(R)),R.sentTS=Date.now(),m.incrementCorrelationVector(),this.connectionTracker.trackResponse(m,Te,R),this.transportTypeName==="websocket"&&this.sendPingRequest(),0}catch(Q){var Se="unable to send data on response.end. Error: ".concat(J(Q));return this.logger.error(Se),this.connectionTracker.sendResponseError(Se,m,R),4}},$.prototype.sendUserActivityStateMultiple=function(m){var R=this,Z=new le("user.activity"),ie=this.userActivityState.increaseCvAndGetEventObject();Z.args=ie,this.logger.debug("Sending user activity '".concat(this.userActivityState.toEventJSON(),"', remaining ").concat(m-1));var se=!1;this.sendDownstreamEvent(Z,function(){if(se!==!0&&(R.logger.info("User activity state: ".concat(ie.state,", cv: ").concat(ie.cv," accepted")),R.manager.onUserActivityStateAccepted(ie.cv),R.clearSentEventTimer(Z.timeoutTimerId),m>1)){var ue=setTimeout(function(){R.clearSentEventTimer(ue),R.sendUserActivityStateMultiple(m-1)},R.options.userActivitySecondResendDelayMs);R.registerSentEventTimer(ue,"user.activity/resend")}}),Z.timeoutTimerId=setTimeout(function(){R.logger.error("Activity state response timeout is fired"),se=!0,R.fsm.onActivityStateResponseTimeout(),R.clearSentEventTimer(Z.timeoutTimerId)},this.timeoutOptions.userActivityResponseTimeoutMs),this.registerSentEventTimer(Z.timeoutTimerId,"user.activity/response")},$.prototype.sendDownstreamEvent=function(m,R){this.logger.debug("Sending downstream event ".concat(m.name)),this.socket&&this.socket.emit(m.name,m.args,R)},$.prototype.registerSentEventTimer=function(m,R){this.logger.debug("registering timer ".concat(m," -> ").concat(R)),this.pendingSentEventTimers[m]=R},$.prototype.clearSentEventTimer=function(m){var R=this.pendingSentEventTimers[m];this.logger.debug("clearing timer ".concat(m," -> ").concat(R)),delete this.pendingSentEventTimers[m],clearTimeout(m)},$.prototype.getRegistrationTtl=function(){var m,R,Z=(0,v.calculateTtlInSec)(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in ".concat(Z," seconds")),((m=this.options.registration)===null||m===void 0?void 0:m.registrarTtlSec)&&Z>0){var ie=this.options.registration.registrarTtlSec<Z;return[Math.min(this.options.registration.registrarTtlSec,Z),ie]}return!((R=this.options.registration)===null||R===void 0)&&R.registrarTtlSec?[this.options.registration.registrarTtlSec,!1]:Z>0?[Z,!1]:[3600,!1]},$.prototype.clearIncallModeTimerId=function(){this.incallModeTimerId!==void 0&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},$.prototype.applyConnectionTrackerOptions=function(m){try{m.eventLogger&&typeof m.eventLogger.logEvent=="function"?(this.connectionTracker.mergeSettings(m.telemetrySettings),this.connectionTracker.enable(m.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(R){this.logger.warn("Trouter client event logging disabled. Error: ".concat(J(R))),this.connectionTracker.disable()}},$.prototype.canRetryTokenFetchRequest=function(m){var R=this.options.retryLimitOnTokenFetch;return R==null||m<R||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: ".concat(m,", retry limit: ").concat(R)),!1)},$}();M.TrouterConnection=re},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.MessageHandlerRegistry=void 0;var G=ne(1),oe=ne(0),J=function(){function X(B){this.messageHandlers=[],this.logger=new oe.Logger("MessageHandlers",B)}return X.prototype.register=function(B){if(this.messageHandlers.some(function(q){return q===B}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(B)},X.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},X.prototype.active=function(){return this.messageHandlers.length>0},X.prototype.handleMessage=function(B){for(var q={resultCode:G.UNHANDLED_MESSAGE_ACK,isHandled:!1},F=0,x=this.messageHandlers;F<x.length;F++){var P=x[F],v=this.safeExecuteHandle(P,B);if(v!==void 0&&(v.isHandled===void 0||v.isHandled))return v.resultCode===void 0&&(v.resultCode=G.HANDLED_MESSAGE_ACK),v}return q},X.prototype.safeExecuteHandle=function(B,q){try{return B.handleMessage(q)}catch(F){return void this.logger.warn("Trouter message handler threw an exception: ".concat(F))}},X}();M.MessageHandlerRegistry=J},function(K,M,ne){function G(X){var B,q=this;return function(F){return oe(q,void 0,void 0,function(){return J(this,function(x){return F&&(B=void 0),[2,new Promise(function(P,v){X(F).then(function(T){B=T,P(T)}).catch(function(T){B!==void 0&&B.length>0&&P(B),v(T)})})]})})}}var oe=this&&this.__awaiter||function(X,B,q,F){function x(P){return P instanceof q?P:new q(function(v){v(P)})}return new(q||(q=Promise))(function(P,v){function T(I){try{N(F.next(I))}catch(A){v(A)}}function _(I){try{N(F.throw(I))}catch(A){v(A)}}function N(I){I.done?P(I.value):x(I.value).then(T,_)}N((F=F.apply(X,B||[])).next())})},J=this&&this.__generator||function(X,B){function q(N){return function(I){return F([N,I])}}function F(N){if(x)throw new TypeError("Generator is already executing.");for(;T&&(T=0,N[0]&&(_=0)),_;)try{if(x=1,P&&(v=2&N[0]?P.return:N[0]?P.throw||((v=P.return)&&v.call(P),0):P.next)&&!(v=v.call(P,N[1])).done)return v;switch(P=0,v&&(N=[2&N[0],v.value]),N[0]){case 0:case 1:v=N;break;case 4:return _.label++,{value:N[1],done:!1};case 5:_.label++,P=N[1],N=[0];continue;case 7:N=_.ops.pop(),_.trys.pop();continue;default:if(v=_.trys,!(v=v.length>0&&v[v.length-1])&&(N[0]===6||N[0]===2)){_=0;continue}if(N[0]===3&&(!v||N[1]>v[0]&&N[1]<v[3])){_.label=N[1];break}if(N[0]===6&&_.label<v[1]){_.label=v[1],v=N;break}if(v&&_.label<v[2]){_.label=v[2],_.ops.push(N);break}v[2]&&_.ops.pop(),_.trys.pop();continue}N=B.call(X,_)}catch(I){N=[6,I],P=0}finally{x=v=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}var x,P,v,T,_={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return T={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T};Object.defineProperty(M,"__esModule",{value:!0}),M.addCacheAsBackupTo=void 0,M.addCacheAsBackupTo=G},function(K,M,ne){var G=this&&this.__awaiter||function(A,S,H,L){function C(y){return y instanceof H?y:new H(function(k){k(y)})}return new(H||(H=Promise))(function(y,k){function Y(W){try{z(L.next(W))}catch(le){k(le)}}function V(W){try{z(L.throw(W))}catch(le){k(le)}}function z(W){W.done?y(W.value):C(W.value).then(Y,V)}z((L=L.apply(A,S||[])).next())})},oe=this&&this.__generator||function(A,S){function H(z){return function(W){return L([z,W])}}function L(z){if(C)throw new TypeError("Generator is already executing.");for(;Y&&(Y=0,z[0]&&(V=0)),V;)try{if(C=1,y&&(k=2&z[0]?y.return:z[0]?y.throw||((k=y.return)&&k.call(y),0):y.next)&&!(k=k.call(y,z[1])).done)return k;switch(y=0,k&&(z=[2&z[0],k.value]),z[0]){case 0:case 1:k=z;break;case 4:return V.label++,{value:z[1],done:!1};case 5:V.label++,y=z[1],z=[0];continue;case 7:z=V.ops.pop(),V.trys.pop();continue;default:if(k=V.trys,!(k=k.length>0&&k[k.length-1])&&(z[0]===6||z[0]===2)){V=0;continue}if(z[0]===3&&(!k||z[1]>k[0]&&z[1]<k[3])){V.label=z[1];break}if(z[0]===6&&V.label<k[1]){V.label=k[1],k=z;break}if(k&&V.label<k[2]){V.label=k[2],V.ops.push(z);break}k[2]&&V.ops.pop(),V.trys.pop();continue}z=S.call(A,V)}catch(W){z=[6,W],y=0}finally{C=k=0}if(5&z[0])throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}var C,y,k,Y,V={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return Y={next:H(0),throw:H(1),return:H(2)},typeof Symbol=="function"&&(Y[Symbol.iterator]=function(){return this}),Y};Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterManager=M.AudienceSubscriptionState=M.UserActivityObject=void 0;var J=ne(3),X=ne(2),B=ne(4),q=ne(0),F=ne(5),x=ne(18),P=ne(7),v=ne(6),T=ne(19),_=function(){function A(S,H){this.state=S,this.correlationVector=H!==void 0?H:J.CorrelationVector.extend()}return A.prototype.getStateString=function(){switch(this.state){case X.UserActivityState.Active:return"active";case X.UserActivityState.Inactive:return"inactive";case X.UserActivityState.Unknown:return"unknown";default:return"undefined"}},A.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},A.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},A.prototype.toEventJSON=function(){return(0,J.toJson)(this.toEventObject())},A}();M.UserActivityObject=_;var N=function(){function A(S,H){H===void 0&&(H=J.CorrelationVector.extend()),this.audienceSubscriptionModel=S,this.correlationVector=H}return A.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},A.prototype.toEventObject=function(){return{audiences:this.audienceSubscriptionModel.audienceSubscriptions,cv:this.correlationVector.value()}},A.prototype.toEventJSON=function(){return(0,J.toJson)(this.toEventObject())},A}();M.AudienceSubscriptionState=N;var I=function(){function A(S,H,L,C,y,k){var Y=this;this.logFunc=S,this.options=H,this.tokenProvider=L,this.usingLegacyTokenApi=C,this.listener=y,this.tokenTypeProtocolSelector=function(V,z){return Y.options.forceV4aProtocol?"v4a":(0,F.usedProtocol)(V,z)},this.logger=new q.Logger("Manager",S),this.logger.info("Created TrouterManager with options ".concat((0,J.toJson)(this.options))),this.fsm=new T.TrouterManagerFsm(S,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new _(X.UserActivityState.Unknown),this.protocolSelector=k??this.tokenTypeProtocolSelector.bind(this)}return A.prototype.start=function(){this.fsm.start()},A.prototype.stop=function(S){this.fsm.stop(S)},A.prototype.configure=function(S){this.options=S,this.firstConnection!==void 0&&this.firstConnection.configure(S),this.secondConnection!==void 0&&this.secondConnection.configure(S),this.logger.info("Reconfigured TrouterManager with options ".concat((0,J.toJson)(this.options)))},A.prototype.checkConnection=function(S){this.firstConnection!==void 0&&this.firstConnection.checkConnection(S),this.secondConnection!==void 0&&this.secondConnection.checkConnection(S)},A.prototype.resendRegistration=function(){return G(this,void 0,void 0,function(){return oe(this,function(S){return this.secondConnection!==void 0?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):this.firstConnection!==void 0?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])})})},A.prototype.getServerState=function(){if(this.firstConnection!==void 0)return this.firstConnection.getServerState()},A.prototype.getState=function(){return this.fsm.getState()},A.prototype.isInTerminalState=function(){return this.fsm.getInternalState()===B.TrouterManagerState.TerminalError},A.prototype.reportStateInfo=function(){var S=this.firstConnection?v.State[this.firstConnection.getState()]:"Unknown",H=B.TrouterManagerState[this.fsm.getInternalState()];if(this.secondConnection){var L=v.State[this.secondConnection.getState()];return"Manager ".concat(H,"; 1st ").concat(S,"; 2nd ").concat(L)}return"Manager ".concat(H,"; Connection ").concat(S)},A.prototype.startFirstConnection=function(){var S=new P.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.firstConnection=S,this.getConnectionCache().then(function(H){S.start(H)}).catch(function(){})},A.prototype.startSecondConnection=function(S){var H=new P.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.secondConnection=H,this.firstConnection!==void 0&&this.firstConnection.disableRegistrationsAndAutoReconnect(),S?this.getConnectionCache().then(function(L){H.start(L)}).catch(function(){}):H.start()},A.prototype.stopFirstConnection=function(S){this.firstConnection!==void 0&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(S),this.firstConnection=void 0)},A.prototype.stopSecondConnection=function(S){this.secondConnection!==void 0&&(this.secondConnection.stop(S),this.secondConnection=void 0)},A.prototype.stopSecondConnectionDelayed=function(){if(this.secondConnection!==void 0){var S=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in ".concat(Math.round(this.options.lingeringConnectionDelayMs/1e3),"s")),setTimeout(function(){S.stop(!0)},this.options.lingeringConnectionDelayMs)}},A.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},A.prototype.switchConnections=function(){var S=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=S},A.prototype.doesSecondConnectionExist=function(){return this.secondConnection!==void 0},A.prototype.dispatchConnected=function(){if(this.firstConnection!==void 0){var S=this.firstConnection.getServerState(),H=S.url.endsWith("/")?S.url.slice(0,-1):S.url,L={baseEndpointUrl:H,newEndpointUrl:H!==this.baseEndpointUrl,c2cUrlBase:S.c2cUrlBase,clientId:S.connectedClientId,connectionId:S.connectionId,connectionTtlSec:S.getRemainingTtlInSec()};this.baseEndpointUrl=H,this.listener.onTrouterConnected(S.url,L)}},A.prototype.dispatchDisconnected=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},A.prototype.dispatchTerminalError=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},A.prototype.dispatchRegistrationState=function(S){this.options.registrationStateCallback&&this.options.registrationStateCallback(S)},A.prototype.expediteBackoffOnConnections=function(){var S;if(this.lastExpediteBackoffCallAt!==void 0&&Date.now()-this.lastExpediteBackoffCallAt<((S=this.options.expediteBackoffOnStartMinimumDelayMs)!==null&&S!==void 0?S:1e4))return void this.logger.info("Expedite backoff due to start() too frequent, skipping");this.lastExpediteBackoffCallAt=Date.now(),this.firstConnection!==void 0&&this.firstConnection.expediteBackoff(),this.secondConnection!==void 0&&this.secondConnection.expediteBackoff()},A.prototype.onDownstreamRequest=function(S,H,L){var C={id:H.id,method:H.method,path:"/".concat(H.shortUrl),body:H.body,headers:H.headers},y={id:H.id,status:0,headers:{},body:"",send:function(){return y.status<=100||y.status>=999?3:(L.writeHead(y.status,y.headers),L.end(y.body))}};this.listener.onTrouterRequest(C,y)},A.prototype.onConnected=function(S){this.fsm.onConnected(S===this.firstConnection)},A.prototype.onRegistered=function(S){this.fsm.onRegistered(S===this.firstConnection)},A.prototype.onUnregistered=function(S){this.fsm.onUnregistered(S===this.firstConnection||S===this.storedFirstConnection)},A.prototype.onReconnecting=function(S){this.fsm.onReconnecting(S===this.firstConnection)},A.prototype.onReconnectIsRequired=function(S,H,L){this.fsm.onReconnectionRequired(S===this.firstConnection,H,L)},A.prototype.onDisconnected=function(S){this.fsm.onDisconnected(S===this.firstConnection||S==this.storedFirstConnection),this.storedFirstConnection=void 0},A.prototype.onTerminalError=function(){this.fsm.onTerminalError(),this.storedFirstConnection=void 0},A.prototype.onUserActivityStateAccepted=function(S){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(S)},A.prototype.onAudiencesSetResolved=function(S,H){var L,C;(C=(L=this.listener).onAudiencesSetResolved)===null||C===void 0||C.call(L,S,H)},A.prototype.onConnectionParametersUpdated=function(S){this.setConnectionCache(S)},A.prototype.setUserActivityState=function(S,H){return this.userActivityObject=new _(S,J.CorrelationVector.extend(H)),this.secondConnection!==void 0?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the second/new connection")),void this.secondConnection.setUserActivityState(this.userActivityObject)):this.firstConnection!==void 0?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the first/current connection")),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},A.prototype.setAudienceSubscriptionsAsync=function(S,H,L){if(this.audienceSubscriptionState=new N(S,J.CorrelationVector.extend(L)),this.secondConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on second/new connection")),this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,H);if(this.firstConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on first/current connection")),this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,H);throw new Error("No connection found")},A.prototype.onTrouterMessageLost=function(S){var H=this;if(this.listener.onTrouterMessageLoss)if(S!=null&&S.length){var L=S.filter(function(y){return H.processedMessageLoss["".concat(y.tag,"-").concat(y.etag)]!==void 0});if(L.length&&(this.logger.info("onTrouterMessageLoss - immediately acknowledging ".concat(L.length," seen dropped indicators")),this.sendProcessedDroppedIndicators(L),S=S.filter(function(y){return H.processedMessageLoss["".concat(y.tag,"-").concat(y.etag)]===void 0}),!S.length))return void this.logger.info("onTrouterMessageLoss - all declared dropped indicators have been seen before");var C=this.listener.onTrouterMessageLoss(S.map(function(y){return y.tag}));if(!C)return void this.logger.warn("onTrouterMessageLoss - some flow tag(s) have not been processed by listeners");S.forEach(function(y){H.processedMessageLoss["".concat(y.tag,"-").concat(y.etag)]=""}),this.sendProcessedDroppedIndicators(S)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},A.prototype.getConnectionCache=function(){var S=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then(function(H){var L=H?JSON.parse(H):void 0;return typeof L=="object"?L:void 0}).catch(function(H){return S.logger.warn("Invalid connection cache content provided: ".concat(H)),S.connectionCache})):Promise.resolve(this.connectionCache)},A.prototype.setConnectionCache=function(S){if(this.connectionCache=S,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(S))}catch(H){this.logger.warn("Error setting external connection cache: ".concat(H))}},A.prototype.sendProcessedDroppedIndicators=function(S){return this.firstConnection!==void 0?void this.firstConnection.sendProcessedDroppedIndicators(S):this.secondConnection!==void 0?void this.secondConnection.sendProcessedDroppedIndicators(S):void 0},A.prototype.configuredTrouterManager=function(){return new x.RegistrationEnforcer(this,this.options.connectionDependsOnRegistration,this.options.delayEventsUntilRegistered)},A}();M.TrouterManager=I},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterUrlPromise=void 0;var G=ne(0),oe=function(){function J(X){this.logger=new G.Logger("UrlPromise",X)}return J.prototype.getPromise=function(){var X=this;return this.url!==void 0?(this.logger.debug("returning previously resolved url: ".concat(this.url)),Promise.resolve(this.url)):(this.pendingPromise===void 0?(this.logger.debug("creating and returning promise"),this.pendingPromise=new Promise(function(B,q){X.pendingPromiseResolveRef=B,X.pendingPromiseRejectRef=q})):this.logger.debug("returning existing promise"),this.pendingPromise)},J.prototype.resolveUrl=function(X){this.url=X,this.logger.debug("got url: ".concat(this.url));var B=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,B!==void 0&&(this.logger.debug("resolving promise"),B(X))},J.prototype.rejectUrl=function(X){this.logger.debug("aborting");var B=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,B!==void 0&&(this.logger.debug("rejecting promise"),B(X))},J.prototype.resetUrl=function(){this.logger.debug("resetting url"),this.url=void 0},J}();M.TrouterUrlPromise=oe},function(K,M,ne){(function(G,oe){(function(X,B){var q=X;q.version="0.9.6",q.protocol=1,q.transports=[],q.j=[],q.sockets={},q.connect=function(F,x){var P,v,T=q.util.parseUri(F);B&&B.location&&(T.protocol=T.protocol||B.location.protocol.slice(0,-1),T.host=T.host||(B.document?B.document.domain:B.location.hostname),T.port=T.port||B.location.port),P=q.util.uniqueUri(T);var _={host:T.host,secure:T.protocol=="https",port:T.port||(T.protocol=="https"?443:80),query:T.query||""};return q.util.merge(_,x),!_["force new connection"]&&q.sockets[P]||(v=new q.Socket(_)),!_["force new connection"]&&v&&(q.sockets[P]=v),v=v||q.sockets[P],_["skipped handshake data"]?v.of(""):v.of(T.path.length>1?T.path:"")}})(oe.exports,G===void 0?window:G);var J=oe.exports;(function(X,B){var q=X.util={},F=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,x=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];q.parseUri=function(v){for(var T=F.exec(v||""),_={},N=14;N--;)_[x[N]]=T[N]||"";return _},q.uniqueUri=function(v){var T=v.protocol,_=v.host,N=v.port;return"document"in B?(_=_||document.domain,N=N||(T=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(_=_||"localhost",N||T!="https"||(N=443)),(T||"http")+"://"+_+":"+(N||80)},q.query=function(v,T){var _=q.chunkQuery(v||""),N=[];q.merge(_,q.chunkQuery(T||""));for(var I in _)_.hasOwnProperty(I)&&N.push(I+"="+_[I]);return N.length?"?"+N.join("&"):""},q.chunkQuery=function(v){for(var T,_={},N=v.split("&"),I=0,A=N.length;I<A;++I)T=N[I].split("="),T[0]&&(_[T[0]]=T[1]);return _};var P=!1;q.load=function(v){if("document"in B&&document.readyState==="complete"||P)return v();q.on(B,"load",v,!1)},q.on=function(v,T,_,N){v.attachEvent?v.attachEvent("on"+T,_):v.addEventListener&&v.addEventListener(T,_,N)},q.request=function(v){if(v&&typeof XDomainRequest<"u")return new XDomainRequest;if(typeof XMLHttpRequest<"u"&&(!v||q.ua.hasCORS))return new XMLHttpRequest;if(!v)try{return new window[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}return null},typeof window<"u"&&q.load(function(){P=!0}),q.defer=function(v){if(!q.ua.webkit||typeof importScripts<"u")return v();q.load(function(){setTimeout(v,100)})},q.merge=function(v,T,_,N){var I,A=N||[],S=_===void 0?2:_;for(I in T)T.hasOwnProperty(I)&&q.indexOf(A,I)<0&&(typeof v[I]=="object"&&S?q.merge(v[I],T[I],S-1,A):(v[I]=T[I],A.push(T[I])));return v},q.mixin=function(v,T){q.merge(v.prototype,T.prototype)},q.inherit=function(v,T){function _(){}_.prototype=T.prototype,v.prototype=new _},q.isArray=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"},q.intersect=function(v,T){for(var _=[],N=v.length>T.length?v:T,I=v.length>T.length?T:v,A=0,S=I.length;A<S;A++)~q.indexOf(N,I[A])&&_.push(I[A]);return _},q.indexOf=function(v,T,_){for(var N=v.length,_=_<0?_+N<0?0:_+N:_||0;_<N&&v[_]!==T;_++);return N<=_?-1:_},q.toArray=function(v){for(var T=[],_=0,N=v.length;_<N;_++)T.push(v[_]);return T},q.ua={},q.ua.hasCORS=typeof XMLHttpRequest<"u"&&function(){try{var v=new XMLHttpRequest}catch{return!1}return v.withCredentials!=null}(),q.ua.webkit=typeof navigator<"u"&&/webkit/i.test(navigator.userAgent)})(J!==void 0?J:oe.exports,G===void 0?window:G),function(X,B){function q(){}X.EventEmitter=q,q.prototype.on=function(F,x){return this.$events||(this.$events={}),this.$events[F]?B.util.isArray(this.$events[F])?this.$events[F].push(x):this.$events[F]=[this.$events[F],x]:this.$events[F]=x,this},q.prototype.addListener=q.prototype.on,q.prototype.once=function(F,x){function P(){v.removeListener(F,P),x.apply(this,arguments)}var v=this;return P.listener=x,this.on(F,P),this},q.prototype.removeListener=function(F,x){if(this.$events&&this.$events[F]){var P=this.$events[F];if(B.util.isArray(P)){for(var v=-1,T=0,_=P.length;T<_;T++)if(P[T]===x||P[T].listener&&P[T].listener===x){v=T;break}if(v<0)return this;P.splice(v,1),P.length||delete this.$events[F]}else(P===x||P.listener&&P.listener===x)&&delete this.$events[F]}return this},q.prototype.removeAllListeners=function(F){return this.$events&&this.$events[F]&&(this.$events[F]=null),this},q.prototype.listeners=function(F){return this.$events||(this.$events={}),this.$events[F]||(this.$events[F]=[]),B.util.isArray(this.$events[F])||(this.$events[F]=[this.$events[F]]),this.$events[F]},q.prototype.emit=function(F){if(!this.$events)return!1;var x=this.$events[F];if(!x)return!1;var P=Array.prototype.slice.call(arguments,1);if(typeof x=="function")x.apply(this,P);else{if(!B.util.isArray(x))return!1;for(var v=x.slice(),T=0,_=v.length;T<_;T++)v[T].apply(this,P)}return!0}}(J!==void 0?J:oe.exports,J!==void 0?J:oe.parent.exports),function(X,B){if(B&&B.parse)return X.JSON={parse:B.parse,stringify:B.stringify};throw new Error("JSON not available")}(J!==void 0?J:oe.exports,typeof JSON<"u"?JSON:void 0),function(X,B){var q=X.parser={},F=q.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],x=q.reasons=["transport not supported","client not handshaken","unauthorized"],P=q.advice=["reconnect"],v=B.JSON,T=B.util.indexOf;q.encodePacket=function(N){var I=T(F,N.type),A=N.id||"",S=N.endpoint||"",H=N.ack,L=null;switch(N.type){case"error":var C=N.reason?T(x,N.reason):"",y=N.advice?T(P,N.advice):"";C===""&&y===""||(L=C+(y!==""?"+"+y:""));break;case"message":N.data!==""&&(L=N.data);break;case"event":var k={name:N.name};N.args&&N.args.length&&(k.args=N.args),L=v.stringify(k);break;case"json":L=v.stringify(N.data);break;case"connect":N.qs&&(L=N.qs);break;case"ack":L=N.ackId+(N.args&&N.args.length?"+"+v.stringify(N.args):"")}var Y=[I,A+(H=="data"?"+":""),S];return L!=null&&Y.push(L),Y.join(":")},q.encodePayload=function(N){var I="";if(N.length==1)return N[0];for(var A=0,S=N.length;A<S;A++)I+=""+N[A].length+""+N[A];return I};var _=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;q.decodePacket=function(S){var I=S.match(_);if(!I)return{};var A=I[2]||"",S=I[5]||"",H={type:F[I[1]],endpoint:I[4]||""};switch(A&&(H.id=A,I[3]?H.ack="data":H.ack=!0),H.type){case"error":var I=S.split("+");H.reason=x[I[0]]||"",H.advice=P[I[1]]||"";break;case"message":H.data=S||"";break;case"event":try{var L=v.parse(S);H.name=L.name,H.args=L.args}catch{}H.args=H.args||[];break;case"json":try{H.data=v.parse(S)}catch{}break;case"connect":H.qs=S||"";break;case"ack":var I=S.match(/^([0-9]+)(\+)?(.*)/);if(I&&(H.ackId=I[1],H.args=[],I[3]))try{H.args=I[3]?v.parse(I[3]):[]}catch{}break;case"disconnect":H.reason=S}return H},q.decodePayload=function(N){if(N.charAt(0)==""){for(var I=[],A=1,S="";A<N.length;A++)N.charAt(A)==""?(I.push(q.decodePacket(N.substr(A+1).substr(0,S))),A+=Number(S)+1,S=""):S+=N.charAt(A);return I}return[q.decodePacket(N)]}}(J!==void 0?J:oe.exports,J!==void 0?J:oe.parent.exports),function(X,B){function q(F,x){this.socket=F,this.sessid=x,this.connectErrorCallback=void 0,this.isOpened=!1}X.Transport=q,B.util.mixin(q,B.EventEmitter),q.prototype.onData=function(F){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),F!==""){var x=B.parser.decodePayload(F);if(x&&x.length)for(var P=0,v=x.length;P<v;P++)this.onPacket(x[P])}return this},q.prototype.onPacket=function(F){return this.socket.setHeartbeatTimeout(),F.type=="heartbeat"?this.onHeartbeat():(F.type=="connect"&&F.endpoint==""&&this.onConnect(),F.type=="error"&&F.advice=="reconnect"&&(this.isOpened=!1),this.socket.onPacket(F),this)},q.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var F=this;this.closeTimeout=setTimeout(function(){F.onDisconnect()},this.socket.closeTimeout)}},q.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},q.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},q.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},q.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},q.prototype.packet=function(F){this.send(B.parser.encodePacket(F))},q.prototype.onHeartbeat=function(F){this.packet({type:"heartbeat"})},q.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},q.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},q.prototype.prepareUrl=function(F){var x=this.socket.options;if(x["skipped handshake data"])return x.rewriteUrlForProxy(x["skipped handshake data"].websocketUrl+(F||""));var P=this.scheme()+"://"+x.host+":"+x.port+"/"+x.resource+"/"+B.protocol+"/"+this.name+"/"+this.sessid+(F||"");return x.rewriteUrlForProxy(P)},q.prototype.ready=function(F,x){x.call(this)},q.prototype.clearEventHandlers=function(){return this}}(J!==void 0?J:oe.exports,J!==void 0?J:oe.parent.exports),function(X,B,q){function F(P){if(this.options={port:80,secure:!1,document:"document"in q&&document,resource:"socket.io",transports:B.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},B.util.merge(this.options,P),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||B.util.ua.hasCORS)){var v=this;B.util.on(q,"unload",function(){v.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function x(){}X.Socket=F,B.util.mixin(F,B.EventEmitter),F.prototype.of=function(P){return this.namespaces[P]||(this.namespaces[P]=new B.SocketNamespace(this,P),P!==""&&this.namespaces[P].packet({type:"connect"})),this.namespaces[P]},F.prototype.publish=function(){this.emit.apply(this,arguments);var P;for(var v in this.namespaces)this.namespaces.hasOwnProperty(v)&&(P=this.of(v),P.$emit.apply(P,arguments))},F.prototype.handshake=function(P){function v(L){L instanceof Error?T.onError(L.message):P.apply(null,L.split(":"))}var T=this,_=this.options;if(!T.disconnected){var N=_.rewriteUrlForProxy(["http"+(_.secure?"s":"")+":/",_.host+":"+_.port,_.resource,B.protocol,B.util.query(this.options.query,"t="+ +new Date)].join("/"));if(this.isXDomain()&&!B.util.ua.hasCORS){var I=document.getElementsByTagName("script")[0],A=document.createElement("script");A.src=N+"&jsonp="+B.j.length,I.parentNode.insertBefore(A,I),B.j.push(function(L){v(L),A.parentNode.removeChild(A)})}else{var S=B.util.request();S.open("GET",N,!0);var H=this.options.requestHeaders;H!==void 0&&Object.keys(H).forEach(function(L){S.setRequestHeader(L,H[L])}),S.onreadystatechange=function(){S.readyState==4&&(S.onreadystatechange=x,S.status==200?v(S.responseText):!T.reconnecting&&T.onError(S.responseText))},S.send(null)}}},F.prototype.getTransport=function(P){for(var v,T=P||this.transports,_=0;v=T[_];_++)if(B.Transport[v]&&B.Transport[v].check(this)&&(!this.isXDomain()||B.Transport[v].xdomainCheck()))return new B.Transport[v](this,this.sessionid);return null},F.prototype.connect=function(P){if(this.connecting||this.disconnected)return this;var v=this,T=function(N,I,A,S){function H(){if(!v.connected&&!v.disconnected)if(v.connecting=!1,clearTimeout(v.connectTimeoutTimer),v.options["try multiple transports"]){for(;v.remainingTransports.length>0&&v.remainingTransports.splice(0,1)[0]!=v.transport.name;);v.remainingTransports.length?L(v.remainingTransports):v.publish("connect_failed")}else v.publish("connect_failed")}function L(C){if(v.transport&&(v.transport.clearTimeouts(),v.transport.clearEventHandlers()),v.transport=v.getTransport(C),!v.transport||v.disconnected)return v.publish("connect_failed");v.transport.ready(v,function(){v.connecting=!0,v.publish("connecting",v.transport.name),v.transport.open(H),v.options["connect timeout"]&&(v.connectTimeoutTimer=setTimeout(function(){H()},v.options["connect timeout"]))})}v.sessionid=N,v.closeTimeout=1e3*A+2e3,v.heartbeatTimeout=1e3*I+2e3,v.transports=S?B.util.intersect(S.split(","),v.options.transports):v.options.transports,v.setHeartbeatTimeout(),v.remainingTransports=v.transports.slice(0),L(v.transports),v.once("connect",function(){clearTimeout(v.connectTimeoutTimer),P&&typeof P=="function"&&P()})};if(this.options["skipped handshake data"]){var _=this.options["skipped handshake data"];T("v4c-"+new Date().getTime(),_.timeout,_.timeout,"websocket")}else this.handshake(T);return this},F.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var P=this;this.heartbeatTimeoutTimer=setTimeout(function(){P.transport.onClose()},this.heartbeatTimeout)},F.prototype.packet=function(P){return this.connected&&!this.doBuffer?this.transport.packet(P):this.buffer.push(P),this},F.prototype.setBuffer=function(P){this.doBuffer=P,!P&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},F.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},F.prototype.disconnectSync=function(){var P=B.util.request(),v=this.resource+"/"+B.protocol+"/"+this.sessionid;P.open("GET",v,!0),this.onDisconnect("booted")},F.prototype.isXDomain=function(){var P=q.location.port||(q.location.protocol=="https:"?443:80);return this.options.host!==q.location.hostname||this.options.port!=P},F.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},F.prototype.onOpen=function(){this.open=!0},F.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},F.prototype.onPacket=function(P){this.of(P.endpoint).onPacket(P)},F.prototype.onError=function(P){P&&P.advice&&P.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",P&&P.reason?P.reason:P)},F.prototype.onDisconnect=function(P){var v=this.connected,T=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(v||T)&&(this.transport.close(),this.transport.clearTimeouts(),v?(this.publish("disconnect",P),P!="booted"&&this.options.reconnect&&!this.reconnecting&&this.reconnect()):this.publish("close_during_connecting",P))},F.prototype.reconnect=function(){function P(){if(T.connected){for(var A in T.namespaces)T.namespaces.hasOwnProperty(A)&&A!==""&&T.namespaces[A].packet({type:"connect"});T.publish("reconnect",T.transport.name,T.reconnectionAttempts)}clearTimeout(T.reconnectionTimer),T.removeListener("connect_failed",v),T.removeListener("connect",v),T.reconnecting=!1,delete T.reconnectionAttempts,delete T.reconnectionDelay,delete T.reconnectionTimer,delete T.redoTransports,T.options["try multiple transports"]=N}function v(){if(T.reconnecting)return T.connected?P():T.connecting&&T.reconnecting?T.reconnectionTimer=setTimeout(v,1e3):void(T.reconnectionAttempts++>=_?T.redoTransports?(T.publish("reconnect_failed"),P()):(T.on("connect_failed",v),T.options["try multiple transports"]=!0,T.transport=T.getTransport(),T.redoTransports=!0,T.connect()):(T.reconnectionDelay<I&&(T.reconnectionDelay*=2),T.connect(),T.publish("reconnecting",T.reconnectionDelay,T.reconnectionAttempts),T.reconnectionTimer=setTimeout(v,T.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var T=this,_=this.options["max reconnection attempts"],N=this.options["try multiple transports"],I=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(v,this.reconnectionDelay),this.on("connect",v)}}(J!==void 0?J:oe.exports,J!==void 0?J:oe.parent.exports,G===void 0?window:G),function(X,B){function q(x,P){this.socket=x,this.name=P||"",this.flags={},this.json=new F(this,"json"),this.ackPackets=0,this.acks={}}function F(x,P){this.namespace=x,this.name=P}X.SocketNamespace=q,B.util.mixin(q,B.EventEmitter),q.prototype.$emit=B.EventEmitter.prototype.emit,q.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},q.prototype.packet=function(x){return x.endpoint=this.name,this.socket.packet(x),this.flags={},this},q.prototype.send=function(x,P){var v={type:this.flags.json?"json":"message",data:x};return typeof P=="function"&&(v.id=++this.ackPackets,v.ack=!0,this.acks[v.id]=P),this.packet(v)},q.prototype.emit=function(x){var P=Array.prototype.slice.call(arguments,1),v=P[P.length-1],T={type:"event",name:x};return typeof v=="function"&&(T.id=++this.ackPackets,T.ack="data",this.acks[T.id]=v,P=P.slice(0,P.length-1)),T.args=P,this.packet(T)},q.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},q.prototype.onPacket=function(x){function P(){v.packet({type:"ack",args:B.util.toArray(arguments),ackId:x.id})}var v=this;switch(x.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(x.reason||"booted"):this.$emit("disconnect",x.reason||"");break;case"message":case"json":var T=["message",x.data];x.ack=="data"?T.push(P):x.ack&&this.packet({type:"ack",ackId:x.id}),this.$emit.apply(this,T);break;case"event":var T=[x.name].concat(x.args);x.ack=="data"&&T.push(P),this.$emit.apply(this,T);break;case"ack":this.acks[x.ackId]&&(this.acks[x.ackId].apply(this,x.args),delete this.acks[x.ackId]);break;case"error":x.advice?this.socket.onError(x):x.reason=="unauthorized"?this.$emit("connect_failed",x.reason):this.$emit("error",x.reason)}},F.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},F.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(J!==void 0?J:oe.exports,J!==void 0?J:oe.parent.exports),function(X,B,q){function F(P){B.Transport.apply(this,arguments)}function x(){}X.websocket=F,B.util.inherit(F,B.Transport),F.prototype.name="websocket",F.prototype.open=function(P){var v,T=B.util.query(this.socket.options.query),_=this;return this.connectErrorCallback=P,v||(v=q.MozWebSocket||q.WebSocket),this.websocket=new v(this.prepareUrl(T)),this.websocket.onopen=function(){_.onOpen(),_.socket.setBuffer(!1)},this.websocket.onmessage=function(N){_.onData(N.data)},this.websocket.onclose=function(){_.onClose(),_.socket.setBuffer(!0)},this.websocket.onerror=function(N){_.onError(N)},this},F.prototype.send=function(P){return this.websocket.send(P),this},F.prototype.payload=function(P){for(var v=0,T=P.length;v<T;v++)this.packet(P[v]);return this},F.prototype.close=function(){return this.websocket.close(),this},F.prototype.onError=function(P){this.connectErrorCallback!==void 0&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(P)},F.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},F.check=function(){return"WebSocket"in q&&!("__addTask"in WebSocket)||"MozWebSocket"in q},F.xdomainCheck=function(){return!0},F.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=x),this},B.transports.push("websocket")}(J!==void 0?J.Transport:oe.exports,J!==void 0?J:oe.parent.exports,G===void 0?window:G),function(X,B,q){function F(P){P&&B.Transport.apply(this,arguments)}function x(){}X.XHR=F,B.util.inherit(F,B.Transport),F.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},F.prototype.payload=function(P){for(var v=[],T=0,_=P.length;T<_;T++)v.push(B.parser.encodePacket(P[T]));this.send(B.parser.encodePayload(v))},F.prototype.send=function(P){return this.post(P),this},F.prototype.post=function(P){function v(){this.readyState==4&&(this.onreadystatechange=x,this.status==200?(clearTimeout(this.ackTimeoutTimer),_.socket.setBuffer(!1)):_.onClose())}function T(){this.onload=x,_.socket.setBuffer(!1)}var _=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),q.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=T:this.sendXHR.onreadystatechange=v,this.sendXHR.send(P),_.sendXHR.ackTimeoutTimer=setTimeout(function(){_.onClose()},_.socket.options.ackTimeoutMs)},F.prototype.close=function(){return this.onClose(),this},F.prototype.request=function(P){var v=B.util.request(this.socket.isXDomain()),T=B.util.query(this.socket.options.query,"t="+ +new Date);v.open(P||"GET",this.prepareUrl(T),!0);var _=this.socket.options.requestHeaders;if(_!==void 0&&Object.keys(_).forEach(function(N){v.setRequestHeader(N,_[N])}),P=="POST")try{v.setRequestHeader?v.setRequestHeader("Content-type","text/plain;charset=UTF-8"):v.contentType="text/plain"}catch{}return v},F.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},F.check=function(P,v){try{var T=B.util.request(v),_=q.XDomainRequest&&T instanceof XDomainRequest,N=P&&P.options&&P.options.secure?"https:":"http:",I=N!=q.location.protocol;if(T&&(!_||!I))return!0}catch{}return!1},F.xdomainCheck=function(){return F.check(null,!0)},F.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=x),this}}(J!==void 0?J.Transport:oe.exports,J!==void 0?J:oe.parent.exports,G===void 0?window:G),function(X,B,q){function F(){B.Transport.XHR.apply(this,arguments)}function x(){}X["xhr-polling"]=F,B.util.inherit(F,B.Transport.XHR),B.util.merge(F,B.Transport.XHR),F.prototype.name="xhr-polling",F.prototype.open=function(P){var v=this;return v.connectErrorCallback=P,B.Transport.XHR.prototype.open.call(v),!1},F.prototype.get=function(){function P(){this.readyState==4&&(this.onreadystatechange=x,this.status==200?(_.connectErrorCallback=void 0,_.onData(this.responseText),_.get()):(_.onClose(),_.connectErrorCallback!==void 0&&(_.connectErrorCallback(),_.connectErrorCallback=void 0)))}function v(){_.connectErrorCallback=void 0,this.onload=x,this.onerror=x,_.onData(this.responseText),_.get()}function T(){_.onClose(),_.connectErrorCallback!==void 0&&(_.connectErrorCallback(),_.connectErrorCallback=void 0)}if(this.isOpened){var _=this;this.xhr=this.request(),q.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=v,this.xhr.onerror=T):this.xhr.onreadystatechange=P,this.xhr.send(null)}},F.prototype.onClose=function(){if(B.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=x;try{this.xhr.abort()}catch{}this.xhr=null}},F.prototype.ready=function(P,v){var T=this;B.util.defer(function(){v.call(T)})},F.prototype.clearEventHandlers=function(){return B.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=x),this},B.transports.push("xhr-polling")}(J!==void 0?J.Transport:oe.exports,J!==void 0?J:oe.parent.exports,G===void 0?window:G),M.io=J}).call(M,ne(13),ne(14)(K))},function(K,M){var ne;ne=function(){return this}();try{ne=ne||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(ne=window)}K.exports=ne},function(K,M){K.exports=function(ne){return ne.webpackPolyfill||(ne.deprecate=function(){},ne.paths=[],ne.children||(ne.children=[]),Object.defineProperty(ne,"loaded",{enumerable:!0,get:function(){return ne.l}}),Object.defineProperty(ne,"id",{enumerable:!0,get:function(){return ne.i}}),ne.webpackPolyfill=1),ne}},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.ConnectionTracker=M.Properties=M.TrackerStep=M.ClientEventName=M.ResponseData=void 0;var G=ne(3),oe=ne(1),J=ne(0),X=function(){function T(_){this.id=_,this.status=200,this.headers={},this.body=""}return T}();M.ResponseData=X;var B;(function(T){T.Connected="trouter_js_client_connected",T.Disconnected="trouter_js_client_disconnected",T.Error="trouter_js_client_error",T.Progress="trouter_js_client_progress",T.Response="trouter_js_client_response",T.Request="trouter_js_client_request",T.CheckConnection="trouter_js_client_check_connection",T.Registration="trouter_js_client_registration",T.Unregistration="trouter_js_client_unregistration"})(B||(M.ClientEventName=B={}));var q=function(){function T(_,N,I,A,S){this.stepName=_,this.operation=N,this.delta=I,this.ts=A,this.error=S}return T}();M.TrackerStep=q;var F=function(){function T(){}return T}();M.Properties=F;var x=function(){function T(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}return T}(),P=function(){function T(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}return T}(),v=function(){function T(_,N,I,A,S,H,L){this.clientId=N,this.clientInfo=I,this.getServerState=A,this.endpointId=S,this.clientCorrelationID=H,this.environment=L,this.logger=new J.Logger("ConnectionTracker",_),this.clientCorrelationID=H!==void 0?H:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new G.Timespan,this.eventLogSettings=new P,this.connectedInfo=new x}return T.prototype.enable=function(_){this.eventLogSettings.enabled=!0,this.eventLogger=_},T.prototype.disable=function(){this.eventLogSettings.enabled=!1},T.prototype.sendProgress=function(_){this.steps.length>0&&this.sendTelemetry(B.Progress,_,this.steps)},T.prototype.cancelProgressTimer=function(){this.progressTimeout!==void 0&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},T.prototype.resetProgressSendTimer=function(){var _=this;this.cancelProgressTimer(),this.eventLogSettings.sendProgressTimeoutSecs!==void 0&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){_.sendProgress({reason:"timeout",timeoutSecs:_.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},T.prototype.setConnectedInfo=function(_,N){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=_,this.connectedInfo.transportType=N,++this.connectedInfo.connectionNumber},T.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},T.prototype.copyProperties=function(_,N){for(var I=0,A=Object.keys(N);I<A.length;I++){var S=A[I];N[S]!==void 0&&(_[S.replace(/-/g,"_")]={value:N[S]})}},T.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},T.prototype.sendTelemetry=function(_,N,I){try{if(this.eventLogSettings.enabled===!0&&this.eventLogSettings[_]===!0&&this.eventLogger!==void 0){var A=this.getServerState(),S={name:_,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:(0,G.toJson)(I)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:oe.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:A.connectionId},connectedClientId:{value:A.connectedClientId},domId:{value:A.domId},url:{value:A.unsecureUrl},surl:{value:A.url},ttlInSecs:{value:A.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(S.properties,N),this.eventLogger.logEvent(S)}}catch(H){this.logger.warn("error in sending event ".concat(_,": ").concat((0,G.toJson)(H)))}},T.prototype.createStep=function(_,N,I){return new q(_,N,this.beginTimestamp.duration,Date.now(),I)},T.prototype.addStep=function(_,N,I){if(this.eventLogSettings.enabled!==!1&&(this.steps.length===0&&this.beginTimestamp.reset(),this.steps.push(this.createStep(_,N,I)),++this.totalStepCount,this.eventLogSettings.numberOfStepsToMaintain!==void 0&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var A=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(B.Progress,{reason:"flush"},A)}},T.prototype.trackStart=function(_){this.addStep(_,"start")},T.prototype.trackEnd=function(_){this.addStep(_,"end")},T.prototype.trackError=function(_,N,I,A){I===void 0&&(I=!0),_==="health"&&this.eventLogSettings.logHealthCheckError!==!0||_==="ping"&&this.eventLogSettings.logSendPingError===!1||(A===void 0&&(A="error"),I===!0&&this.addStep(_,A,N),this.sendTelemetry(B.Error,{},[this.createStep(_,A,N)]))},T.prototype.trackProgress=function(_,N){this.addStep(_,N)},T.prototype.trackConnected=function(_,N){this.setConnectedInfo(_,N);var I=this.steps.slice(0),A=this.totalStepCount,S=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(B.Connected,{stepCount:I.length,totalStepCount:A,connectionEstablishmentMs_Total:S},I),this.cancelProgressTimer()},T.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},T.prototype.trackDisconnected=function(_){_.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(B.Disconnected,_,[]),this.resetProgressSendTimer()},T.prototype.trackNewConnection=function(){++this.connectionAttempt},T.prototype.trackRequest=function(_,N){var I={};N!==void 0&&(I.hasError=!0,I.error=N);try{if(_){I.requestID=_.id,I.httpMethod=_.method,I.url=_.url,I.bodyLength=_.body.length,I.shortUrl=_.shortUrl,I.requestTimeStamp=_.startTS,I.correlationVector=_.correlationVector;for(var A=_.headers,S=0,H=Object.keys(A);S<H.length;S++){var L=H[S];I[L]=A[L]}}}catch(C){I.hasError=!0,I.error="".concat(I.error," error creating request context ").concat((0,G.toJson)(C))}this.sendTelemetry(B.Request,I,[])},T.prototype.trackResponse=function(_,N,I,A){var S={};A!==void 0&&(S.hasError=!0,S.error=A);try{if(S.responseTimestamp=I!==void 0?I.sentTS:Date.now(),_){S.requestID=_.id,S.httpMethod=_.method,S.shortUrl=_.shortUrl,S.correlationVector=_.correlationVector;for(var H=_.headers,L=0,C=Object.keys(H);L<C.length;L++){var y=C[L];S[y]=H[y]}}I&&(S.latencyMS=N,S.responseCode=I.status,S.responseLength=I.body.length)}catch(k){S.hasError=!0,S.error="".concat(S.error," error creating response context ").concat((0,G.toJson)(k))}this.sendTelemetry(B.Response,S,[])},T.prototype.sendResponseError=function(_,N,I){this.trackResponse(N,void 0,I,_)},T.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},T.prototype.mergeSettings=function(_){if(_){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,_.numberOfStepsToMaintain!==void 0?_.numberOfStepsToMaintain:0));var N=Math.min(3600,Math.max(55,_.sendProgressTimeoutSecs!==void 0?_.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=_.logHealthCheckError,this.eventLogSettings.logSendPingError=_.logSendPingError;for(var I=0,A=Object.keys(B).map(function(H){return B[H]});I<A.length;I++){var S=A[I];_[S]!==void 0&&(this.eventLogSettings[S]=_[S])}this.eventLogSettings.sendProgressTimeoutSecs!==N&&(this.eventLogSettings.sendProgressTimeoutSecs=N,this.resetProgressSendTimer())}},T}();M.ConnectionTracker=v},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.DisconnectReason=void 0;var G=function(){function oe(J,X,B){this.reason=J,this.claims=X,this.details=B}return oe.fromRawReason=function(J,X){if(J===""||J==="dup")return new oe(J);try{var B=JSON.parse(J);return typeof B!="object"||B.reason===void 0?(X==null||X.error("invalid disconnect reason format"),new oe("unknown",void 0,J)):new oe(B.reason,B.claims,B.details)}catch{return new oe("disconnect",void 0,J)}},oe.fromSocketIoEventData=function(J,X){return typeof X=="string"?new oe(J,void 0,X):void 0},oe.prototype.toTelemetryString=function(){return this.reason==="socketerror"||this.reason==="reconnecterror"||this.reason==="disconnect"?this.details:this.reason},oe}();M.DisconnectReason=G},function(K,M,ne){function G(J,X,B){if(J===void 0||X===void 0)return!1;var q=Date.now()-J;return q>X*B.tolerance&&q>B.minimumWaitMs}Object.defineProperty(M,"__esModule",{value:!0}),M.ExponentialBackoff=void 0;var oe=function(){function J(X,B,q){q===void 0&&(q={tolerance:2,minimumWaitMs:1e4}),this.logger=X,this.maxBackoffInMs=B,this.gapDetectionSettings=q,this.backoffId=0,this.backoffCount=0}return J.calculateNextBackoffMs=function(X,B){var q=1+.4*(Math.random()-.5),F=1e3*Math.pow(2,X)*q;return F=Math.round(F),Math.min(B,F)},J.prototype.setMaxBackoffMs=function(X){this.maxBackoffInMs=X},J.prototype.backoff=function(X,B){var q=this;if(this.timerHandle!==void 0&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.previousCompleteTime!==void 0){var F=Date.now()-this.previousCompleteTime;F>this.maxBackoffInMs*this.gapDetectionSettings.tolerance&&F>this.gapDetectionSettings.minimumWaitMs&&(this.logger.info("Back off for ".concat(X," with ID ").concat(this.backoffId," will be reset due to a lot of time having passed since the previous backoff (").concat(F," ms)")),this.backoffCount=0,this.previousCompleteTime=void 0)}var x=J.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off ".concat(X," for ").concat(x," milliseconds with ID ").concat(this.backoffId)),this.callback=function(v,T){G(v,T,q.gapDetectionSettings)&&(q.logger.info("Back off for ".concat(X," with ID ").concat(q.backoffId," will be reset due to the wait (").concat(Date.now()-(v??0)," ms) being longer than expected (").concat(T," ms)")),q.backoffCount=0),q.logger.info("Back off for ".concat(X," with ID ").concat(q.backoffId," complete, invoking handler")),q.timerHandle=void 0,q.callback=void 0,q.previousCompleteTime=Date.now(),B()};var P=Date.now();this.timerHandle=setTimeout(function(){var v;return(v=q.callback)===null||v===void 0?void 0:v.call(q,P,x)},x)},J.prototype.reset=function(){this.timerHandle!==void 0&&(this.logger.debug("Resetting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},J.prototype.expediteIfPending=function(){if(this.backoffCount=0,this.timerHandle!==void 0){this.logger.debug("Expediting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0;var X=this.callback;this.callback=void 0,X&&X()}},J}();M.ExponentialBackoff=oe},function(K,M,ne){var G=this&&this.__spreadArray||function(B,q,F){if(F||arguments.length===2)for(var x,P=0,v=q.length;P<v;P++)!x&&P in q||(x||(x=Array.prototype.slice.call(q,0,P)),x[P]=q[P]);return B.concat(x||Array.prototype.slice.call(q))};Object.defineProperty(M,"__esModule",{value:!0}),M.LoggingManagerConsumer=M.RegistrationEnforcer=void 0;var oe=ne(6),J=function(){function B(q,F,x){this.wrapped=q,this.shouldConnectionDependOnRegistration=F,this.shouldHoldBackEvents=x,this.isRegistered=!1,this.heldBackEvents=[]}return B.prototype.onDownstreamRequest=function(q,F,x){this.passIfRegisteredOrNotNeeded("onDownstreamRequest",q,F,x)},B.prototype.onConnected=function(q){this.passIfRegisteredOrNotNeeded("onConnected",q)},B.prototype.onRegistered=function(q){this.isRegistered=!0,this.wrapped.onRegistered(q),this.fireHeldBackEvents()},B.prototype.onUnregistered=function(q){this.isRegistered=!1,this.wrapped.onUnregistered(q),q.getState()===oe.State.Connected&&this.shouldConnectionDependOnRegistration()&&q.forceReconnectDueToNoRegistration()},B.prototype.onReconnecting=function(q){this.wrapped.onReconnecting(q)},B.prototype.onReconnectIsRequired=function(q,F,x){this.wrapped.onReconnectIsRequired(q,F,x)},B.prototype.onDisconnected=function(q){this.isRegistered=!1,this.dropHeldBackEvents(),this.wrapped.onDisconnected(q)},B.prototype.onTerminalError=function(q){this.wrapped.onTerminalError(q)},B.prototype.onConnectionParametersUpdated=function(q){this.wrapped.onConnectionParametersUpdated(q)},B.prototype.onTrouterMessageLost=function(q){this.passIfRegisteredOrNotNeeded("onTrouterMessageLost",q)},B.prototype.onUserActivityStateAccepted=function(q){this.passIfRegisteredOrNotNeeded("onUserActivityStateAccepted",q)},B.prototype.onAudiencesSetResolved=function(q,F){this.passIfRegisteredOrNotNeeded("onAudiencesSetResolved",q,F)},B.prototype.getState=function(){return this.wrapped.getState()},B.prototype.holdBackEvent=function(q){for(var F=[],x=1;x<arguments.length;x++)F[x-1]=arguments[x];this.heldBackEvents.push({kind:q,args:F})},B.prototype.passIfRegisteredOrNotNeeded=function(q){for(var F,x=[],P=1;P<arguments.length;P++)x[P-1]=arguments[P];var v=this.shouldConnectionDependOnRegistration(),T=this.shouldHoldBackEvents();v&&T||this.fireHeldBackEvents(v?function(_){return _.kind!=="onConnected"}:void 0),this.isRegistered||!v||T===!1&&q!=="onConnected"?(F=this.wrapped)[q].apply(F,x):this.holdBackEvent.apply(this,G([q],x,!1))},B.prototype.fireHeldBackEvents=function(q){for(var F,x=0,P=this.heldBackEvents;x<P.length;x++){var v=P[x];(q===void 0||q(v))&&(F=this.wrapped)[v.kind].apply(F,v.args)}this.heldBackEvents=q===void 0?[]:this.heldBackEvents.filter(function(T){return!q(T)})},B.prototype.dropHeldBackEvents=function(){this.heldBackEvents=[]},B}();M.RegistrationEnforcer=J;var X=function(){function B(q,F,x,P){this.wrapped=q,this.prefix=F,this.logger=x,this.onEventAction=P}return B.prototype.onEvent=function(q,F){var x;this.onEventAction!==void 0?this.onEventAction(q,F):((x=this.logger)!==null&&x!==void 0?x:console).log("".concat(this.prefix," TracingEnforcer: ").concat(q,"(").concat(F,")"))},B.prototype.onDownstreamRequest=function(q,F,x){this.onEvent("onDownstreamRequest",JSON.stringify({request:F,response:x})),this.wrapped.onDownstreamRequest(q,F,x)},B.prototype.onConnected=function(q){this.onEvent("onConnected",q.getState().toString()),this.wrapped.onConnected(q)},B.prototype.onRegistered=function(q){this.onEvent("onRegistered",q.getState().toString()),this.wrapped.onRegistered(q)},B.prototype.onUnregistered=function(q){this.onEvent("onUnregistered",q.getState().toString()),this.wrapped.onUnregistered(q)},B.prototype.onReconnecting=function(q){this.onEvent("onReconnecting",q.getState().toString()),this.wrapped.onReconnecting(q)},B.prototype.onReconnectIsRequired=function(q,F,x){this.onEvent("onReconnectIsRequired",JSON.stringify({connection:q.getState().toString(),useConnectParamsFromCache:F,reason:x})),this.wrapped.onReconnectIsRequired(q,F,x)},B.prototype.onDisconnected=function(q){this.onEvent("onDisconnected",q.getState().toString()),this.wrapped.onDisconnected(q)},B.prototype.onTerminalError=function(q){this.onEvent("onTerminalError",JSON.stringify({connection:q})),this.wrapped.onTerminalError(q)},B.prototype.onConnectionParametersUpdated=function(q){this.onEvent("onConnectionParametersUpdated",JSON.stringify({connectParams:q})),this.wrapped.onConnectionParametersUpdated(q)},B.prototype.onTrouterMessageLost=function(q){this.onEvent("onTrouterMessageLost",JSON.stringify({flowTags:q})),this.wrapped.onTrouterMessageLost(q)},B.prototype.onUserActivityStateAccepted=function(q){this.onEvent("onUserActivityStateAccepted",JSON.stringify({cv:q})),this.wrapped.onUserActivityStateAccepted(q)},B.prototype.onAudiencesSetResolved=function(q,F){this.onEvent("onAudiencesSetResolved",JSON.stringify({audienceSubscriptionsResponse:q,cv:F})),this.wrapped.onAudiencesSetResolved(q,F)},B.prototype.getState=function(){return this.wrapped.getState()},B}();M.LoggingManagerConsumer=X},function(K,M,ne){Object.defineProperty(M,"__esModule",{value:!0}),M.TrouterManagerFsm=void 0;var G=ne(2),oe=ne(4),J=ne(0),X=ne(7),B=function(){function q(F,x){this.worker=x,this.state=oe.TrouterManagerState.Unknown,this.logger=new J.Logger("ManagerFsm",F)}return q.prototype.start=function(){this.state===oe.TrouterManagerState.Unknown?(this.setState(oe.TrouterManagerState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):(this.logger.info("start called in state '".concat(oe.TrouterManagerState[this.state],"', expediting pending backoffs, if any")),this.worker.expediteBackoffOnConnections())},q.prototype.stop=function(F){this.state!==oe.TrouterManagerState.Unknown?(this.setState(oe.TrouterManagerState.Unknown),this.worker.stopFirstConnection(F===!0),this.worker.stopSecondConnection(F===!0)):this.showIgnored("stop")},q.prototype.getState=function(){switch(this.state){case oe.TrouterManagerState.Unknown:case oe.TrouterManagerState.Connected:case oe.TrouterManagerState.Disconnected:case oe.TrouterManagerState.Switching:return this.state;case oe.TrouterManagerState.TerminalError:return G.TrouterState.Disconnected}},q.prototype.getInternalState=function(){return this.state},q.prototype.onConnected=function(F){this.state===oe.TrouterManagerState.Disconnected&&F?this.worker.doesSecondConnectionExist()?this.setState(oe.TrouterManagerState.Switching):(this.setState(oe.TrouterManagerState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected(".concat(F,")"))},q.prototype.onRegistered=function(F){this.state!==oe.TrouterManagerState.Disconnected||F?this.state!==oe.TrouterManagerState.Switching||F?this.state===oe.TrouterManagerState.Disconnected&&F&&(this.setState(oe.TrouterManagerState.Connected),this.worker.dispatchConnected()):(this.setState(oe.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(oe.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},q.prototype.onUnregistered=function(F){F&&this.worker.dispatchRegistrationState(!1)},q.prototype.onReconnecting=function(F){this.state!==oe.TrouterManagerState.Connected&&this.state!==oe.TrouterManagerState.Switching||!F?this.showIgnored("onReconnecting(".concat(F,")")):(this.setState(oe.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected())},q.prototype.onReconnectionRequired=function(F,x,P){this.state===oe.TrouterManagerState.Connected&&F?(this.setState(oe.TrouterManagerState.Switching),this.worker.startSecondConnection(x)):this.state===oe.TrouterManagerState.Disconnected&&F?this.worker.startSecondConnection(x):this.state===oe.TrouterManagerState.Switching&&F&&P===X.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(x)):this.showIgnored("onReconnectionRequired(".concat(F,")"))},q.prototype.onDisconnected=function(F){this.state==oe.TrouterManagerState.Unknown&&F?this.worker.dispatchDisconnected():this.state==oe.TrouterManagerState.Switching&&F?(this.worker.switchConnections(),this.worker.stopSecondConnection(!1),this.setState(oe.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected()):this.showIgnored("onDisconnected(".concat(F,")"))},q.prototype.onTerminalError=function(){this.setState(oe.TrouterManagerState.TerminalError),this.worker.dispatchTerminalError()},q.prototype.showIgnored=function(F){this.logger.info("Ignoring event '".concat(F,"' in state '").concat(oe.TrouterManagerState[this.state],"'"))},q.prototype.setState=function(F){if(this.logger.info("Switching from state '".concat(oe.TrouterManagerState[this.state],"' to state '").concat(oe.TrouterManagerState[F],"'")),this.state===F)return void this.logger.error("Attempt to switch to the current state '".concat(oe.TrouterManagerState[F],"'"));this.state=F},q}();M.TrouterManagerFsm=B},function(K,M,ne){function G(C,y){if(!y)return C;var k=x(x({},C),{enabled:y.TelemetryEnabled});return y.ClientTelemetryEventEnabled!==void 0&&(k=x(x({},k),y.ClientTelemetryEventEnabled)),k}function oe(C,y,k){var Y,V,z,W,le,re,$,m,R,Z,ie=function(se){return C.proxyUrlRewrite?(y.info("Using rewritten URL for proxy"),C.proxyUrlRewrite(se)):se};return{clientInfo:{ua:C.trouterSettings.productName,v:C.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3,rewriteUrlForProxy:ie},clientCorrelationID:C.trouterSettings.sessionId,environment:C.trouterSettings.environment,telemetrySettings:G(C.telemetryConfig.settings,k),eventLogger:C.telemetryConfig.eventLogger,endpointId:C.trouterSettings.registrationId,trouterUrl:(k==null?void 0:k.TrouterConnectionUrl)||C.trouterSettings.trouterServiceUrl,registration:C.trouterSettings.registrarServiceUrl?{registrarUrl:C.trouterSettings.registrarServiceUrl,registrationId:(Y=C.trouterSettings.registrationId)!==null&&Y!==void 0?Y:"",pnhAppId:(V=C.trouterSettings.pnhAppId)!==null&&V!==void 0?V:"",platform:(z=C.trouterSettings.platform)!==null&&z!==void 0?z:"",pnhTemplateKey:(W=C.trouterSettings.pnhTemplate)!==null&&W!==void 0?W:"",platformUIVersion:(le=C.trouterSettings.platformUIVersion)!==null&&le!==void 0?le:"",productContext:C.trouterSettings.pnhProductContext||void 0,context:(re=C.trouterSettings.pnhContext)!==null&&re!==void 0?re:"",registrarTtlSec:(($=C.trouterSettings.maxRegistrationTimeInMs)!==null&&$!==void 0?$:0)/1e3}:void 0,connectionDependsOnRegistration:C.trouterSettings.registrarServiceUrl===void 0?function(){return!1}:(m=C.trouterSettings.connectionDependsOnRegistration)!==null&&m!==void 0?m:function(){return!1},delayEventsUntilRegistered:(R=C.trouterSettings.delayEventsUntilRegistered)!==null&&R!==void 0?R:function(){return!1},timeoutOptions:x({connectionTimeoutMs:C.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:C.trouterSettings.productName==="TeamsCDL"?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},C.trouterSettings.timeoutOptions),incallTimeoutOptions:x({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:C.trouterSettings.productName==="TeamsCDL"?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},C.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:(Z=C.trouterSettings.incallModeTimeoutMs)!==null&&Z!==void 0?Z:0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:C.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:C.connectionCache,registrationStateCallback:C.registrationStateCallbackForAcsDoNotUse,rewriteUrlForProxy:ie,retryLimitOnTokenFetch:C.trouterSettings.retryLimitOnTokenFetch,extraConnectionHeaders:C.trouterSettings.extraConnectionHeaders,expediteBackoffOnStartMinimumDelayMs:1e4,toJSON:function(){return x(x({},this),{connectionCache:this.connectionCache?{}:this.connectionCache})}}}function J(C){return new L(C)}function X(){return T.CLIENT_VERSION}function B(C,y){var k=C.indexOf("://");if(k>=0){var Y=C.indexOf("/",k+3);if(Y>=0)return y+C.substr(Y)}return""}function q(C){var y=this;return function(k){return P(y,void 0,void 0,function(){var Y;return v(this,function(V){switch(V.label){case 0:return Y={},[4,C(k.needFresh)];case 1:return[2,(Y.token=V.sent(),Y.tokenType="skype",Y)]}})})}}function F(C,y){var k,Y=this;return function(V){return P(Y,void 0,void 0,function(){var z,W,le;return v(this,function(re){switch(re.label){case 0:z=new Date,W=setInterval(function(){var $=Math.round((Date.now()-z.getTime())/6e4);C.warn("Note: Trouter auth token request promise from ".concat(z.toISOString()," has not been resolved for ").concat($," minutes. The client is blocked from operating properly"))},3e5),re.label=1;case 1:return re.trys.push([1,,3,4]),[4,y(V)];case 2:return le=re.sent(),V.needFresh&&le.token===k&&C.error("API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app"),k=le.token,[2,le];case 3:return clearInterval(W),[7];case 4:return[2]}})})}}var x=this&&this.__assign||function(){return x=Object.assign||function(C){for(var y,k=1,Y=arguments.length;k<Y;k++){y=arguments[k];for(var V in y)Object.prototype.hasOwnProperty.call(y,V)&&(C[V]=y[V])}return C},x.apply(this,arguments)},P=this&&this.__awaiter||function(C,y,k,Y){function V(z){return z instanceof k?z:new k(function(W){W(z)})}return new(k||(k=Promise))(function(z,W){function le(m){try{$(Y.next(m))}catch(R){W(R)}}function re(m){try{$(Y.throw(m))}catch(R){W(R)}}function $(m){m.done?z(m.value):V(m.value).then(le,re)}$((Y=Y.apply(C,y||[])).next())})},v=this&&this.__generator||function(C,y){function k($){return function(m){return Y([$,m])}}function Y($){if(V)throw new TypeError("Generator is already executing.");for(;le&&(le=0,$[0]&&(re=0)),re;)try{if(V=1,z&&(W=2&$[0]?z.return:$[0]?z.throw||((W=z.return)&&W.call(z),0):z.next)&&!(W=W.call(z,$[1])).done)return W;switch(z=0,W&&($=[2&$[0],W.value]),$[0]){case 0:case 1:W=$;break;case 4:return re.label++,{value:$[1],done:!1};case 5:re.label++,z=$[1],$=[0];continue;case 7:$=re.ops.pop(),re.trys.pop();continue;default:if(W=re.trys,!(W=W.length>0&&W[W.length-1])&&($[0]===6||$[0]===2)){re=0;continue}if($[0]===3&&(!W||$[1]>W[0]&&$[1]<W[3])){re.label=$[1];break}if($[0]===6&&re.label<W[1]){re.label=W[1],W=$;break}if(W&&re.label<W[2]){re.label=W[2],re.ops.push($);break}W[2]&&re.ops.pop(),re.trys.pop();continue}$=y.call(C,re)}catch(m){$=[6,m],z=0}finally{V=W=0}if(5&$[0])throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}var V,z,W,le,re={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return le={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(le[Symbol.iterator]=function(){return this}),le};Object.defineProperty(M,"__esModule",{value:!0}),M.replaceTrouterUrlBase=M.getTrouterServiceVersion=M.createTrouterService=M.TrouterService=M.UserActivityState=M.TrouterState=void 0;var T=ne(1),_=ne(2);Object.defineProperty(M,"TrouterState",{enumerable:!0,get:function(){return _.TrouterState}}),Object.defineProperty(M,"UserActivityState",{enumerable:!0,get:function(){return _.UserActivityState}});var N=ne(0),I=ne(8),A=ne(9),S=ne(10),H=ne(11),L=function(){function C(y){this.logProvider=y,this.stateChangedListeners=[],this.logger=new N.Logger("Trouter",y),this.trouterUrlPromise=new H.TrouterUrlPromise(y),this.messageHandlers=new I.MessageHandlerRegistry(y),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version ".concat(T.CLIENT_VERSION))}return C.prototype.start=function(y){var k;if(this.logger.info("Start"),!y.skypeTokenProvider&&!y.authTokenProvider)throw new Error("no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated");y.skypeTokenProvider&&!y.trouterSettings.disableInternalSkypeTokenCache&&(y.skypeTokenProvider=(0,A.addCacheAsBackupTo)(y.skypeTokenProvider)),this.trouterCfg=y;var Y=oe(y,this.logger,this.ecsCfg);y.internalEnableV4cProtocol===!1&&(Y.forceV4aProtocol=!0);var V=F(this.logger,(k=y.authTokenProvider)!==null&&k!==void 0?k:q(y.skypeTokenProvider));this.trouterServer===void 0&&(this.trouterServer=new S.TrouterManager(this.logProvider,Y,V,y.authTokenProvider===void 0,this)),this.pendingActivityState!==void 0&&(this.trouterServer.setUserActivityState(this.pendingActivityState[0],this.pendingActivityState[1]),this.pendingActivityState=void 0),this.trouterServer.start()},C.prototype.stop=function(y){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),this.trouterServer!==void 0&&this.trouterServer.stop(y)},C.prototype.setEcsConfig=function(y){return P(this,void 0,void 0,function(){var k=this;return v(this,function(Y){return[2,new Promise(function(V){if(k.ecsCfg=y.TrouterJScriptClient,k.logger.info("Setting ECS configuration to ".concat(JSON.stringify(k.ecsCfg))),k.trouterServer!==void 0&&k.trouterCfg!==void 0){var z=oe(k.trouterCfg,k.logger,k.ecsCfg);k.trouterServer.configure(z)}V()})]})})},C.prototype.checkConnection=function(y){this.trouterServer!==void 0&&this.trouterServer.checkConnection(y!=null&&y)},C.prototype.resendRegistration=function(){return P(this,void 0,void 0,function(){return v(this,function(y){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]})})},C.prototype.registerListener=function(y,k){return k===""||!k.startsWith("/")||k.includes("?")||k.includes("#")?(this.logger.error("Listener path '".concat(k,"' is not valid")),!1):this.listeners[k]?(this.logger.error("Another listener is already registered for path '".concat(k,"'")),!1):(this.listeners[k]=y,this.logger.debug("Listener for path '".concat(k,"' registered")),this.connectionInfo&&y.onTrouterConnected(this.connectionInfo.baseEndpointUrl+k,this.connectionInfo),!0)},C.prototype.unregisterListener=function(y){for(var k=[],Y=0,V=Object.keys(this.listeners);Y<V.length;Y++){var z=V[Y];this.listeners[z]===y&&k.push(z)}if(k.length===0)return!1;for(var W=0,le=k;W<le.length;W++){var z=le[W];delete this.listeners[z]}return this.logger.debug("Listener for path(s) '".concat(k.join("', '"),"' unregistered")),!0},C.prototype.onTrouterConnected=function(y,k){this.logger.debug("Trouter is now connected");for(var Y=0,V=Object.keys(this.listeners);Y<V.length;Y++){var z=V[Y];try{this.listeners[z].onTrouterConnected(k.baseEndpointUrl+z,k)}catch(W){this.logger.error("Listener '".concat(z,"' threw an exception from onTrouterConnected(): ").concat(W))}}this.connectionInfo=k,this.trouterUrlPromise.resolveUrl(y),this.notifyStateChanged(_.TrouterState.Connected,{url:y,getRemainingTtlInSec:function(){return k.connectionTtlSec}})},C.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var y=0,k=Object.keys(this.listeners);y<k.length;y++){var Y=k[y],V=this.listeners[Y];if(V.onTrouterDisconnected)try{V.onTrouterDisconnected()}catch(z){this.logger.error("Listener '".concat(Y,"' threw an exception from onTrouterDisconnected(): ").concat(z))}}this.notifyStateChanged(_.TrouterState.Disconnected)},C.prototype.onTrouterRequest=function(y,k){for(var Y="",V=0,z=Object.keys(this.listeners);V<z.length;V++){var W=z[V];y.path.startsWith(W)&&W.length>Y.length&&(Y=W)}if(Y==="")this.tryMessageHandlers(y,k)||(k.status=404,k.headers={"Trouter-Responder":"ClientLib"},k.send());else try{this.listeners[Y].onTrouterRequest(y,k)}catch(le){this.logger.error("Listener '".concat(Y,"' threw an exception from onTrouterRequest(): ").concat(le)),k.status=500,k.headers={"Trouter-Responder":"ClientLib"},k.send()}},C.prototype.onTrouterMessageLoss=function(y){this.logger.info("onTrouterMessageLoss called with tags [".concat(y,"]"));for(var k=!0,Y=0,V=Object.keys(this.listeners);Y<V.length;Y++){var z=V[Y],W=this.listeners[z];if(W.onTrouterMessageLoss)try{k=W.onTrouterMessageLoss(y)&&k,k===void 0&&(this.logger.error("Listener '".concat(z,"' did not return a boolean value from onTrouterMessageLoss()")),k=!1)}catch(le){this.logger.error("Listener '".concat(z,"' threw an exception from onTrouterMessageLoss(): ").concat(le)),k=!1}}return k},C.prototype.onTrouterUserActivityStateAccepted=function(y){this.logger.debug("onTrouterUserActivityStateAccepted cv: ".concat(y));for(var k=0,Y=Object.keys(this.listeners);k<Y.length;k++){var V=Y[k],z=this.listeners[V];if(z.onTrouterUserActivityStateAccepted)try{z.onTrouterUserActivityStateAccepted(y)}catch(W){this.logger.error("Listener '".concat(V,"' threw an exception from onTrouterUserActivityStateAccepted(): ").concat(W))}}},C.prototype.onAudiencesSetResolved=function(y,k){this.logger.debug("onAudiencesSetResolved cv: ".concat(k));for(var Y=0,V=Object.keys(this.listeners);Y<V.length;Y++){var z=V[Y],W=this.listeners[z];if(W.onAudiencesSetResolved)try{W.onAudiencesSetResolved(y,k)}catch(le){this.logger.error("Listener '".concat(z,"' threw an exception from onAudienceSubscribed(): ").concat(le))}}},C.prototype.setUserActivityState=function(y,k){if(y!==_.UserActivityState.Active&&y!==_.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value ".concat(y));this.logger.info("setUserActivityState called with value ".concat(_.UserActivityState[y])),this.trouterServer&&this.state()!==_.TrouterState.Unknown?this.trouterServer.setUserActivityState(y,k):(this.pendingActivityState=[y,k],this.logger.warn("setUserActivityState called before start() or after stop()"))},C.prototype.setAudienceSubscriptions=function(y,k){if(y.audienceSubscriptions.length>1)throw new Error("Only singular audience subscription is supported");if(this.trouterServer&&this.state()!==_.TrouterState.Unknown)return this.trouterServer.setAudienceSubscriptionsAsync(y,15e3,k);throw new Error("audience subscribe called before start() or after stop()")},C.prototype.state=function(){return this.trouterServer!==void 0?this.trouterServer.getState():_.TrouterState.Unknown},C.prototype.isInTerminalState=function(){return this.trouterServer!==void 0&&this.trouterServer.isInTerminalState()},C.prototype.reportStateInfo=function(){return this.trouterServer===void 0?"":this.trouterServer.reportStateInfo()},C.prototype.getServerState=function(){if(this.trouterServer!==void 0)return this.trouterServer.getServerState()},C.prototype.getTrouterUrlAsync=function(){return this.trouterServer!==void 0?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},C.prototype.onStateChanged=function(y){if(this.logger.info("onStateChanged called"),y===void 0)this.stateChangedListeners=this.stateChangedListeners.filter(function(Y){return Y.wrappedCallback===void 0});else{this.offStateChanged(y);var k=function(Y,V){y(Y,V?V.url:"")};k.wrappedCallback=y,this.stateChangedListeners.push(k)}},C.prototype.offStateChanged=function(y){this.logger.info("offStateChanged called");var k=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(Y){return Y.wrappedCallback!==y}),k>this.stateChangedListeners.length},C.prototype.addCallback=function(y){this.logger.info("addListener called"),this.stateChangedListeners.indexOf(y,0)===-1&&y!==void 0&&this.stateChangedListeners.push(y)},C.prototype.removeCallback=function(y){this.logger.info("removeListener called");var k=this.stateChangedListeners.indexOf(y,0);return k>-1&&(this.stateChangedListeners.splice(k,1),!0)},C.prototype.registerMessageHandler=function(y){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(y)},C.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},C.prototype.notifyStateChanged=function(y,k){var Y=this;this.logger.info("notifyStateChanged called, will forward to ".concat(this.stateChangedListeners.length," listeners")),this.stateChangedListeners.forEach(function(V){try{V(y,k)}catch(z){Y.logger.error("Error in callback ".concat(z))}})},C.prototype.tryMessageHandlers=function(y,k){if(!this.messageHandlers.active())return!1;var Y,V=null;try{Y=JSON.parse(y.body),V=Y&&(Y.evt||Y.eventId)||null}catch{}var z={eventId:V,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+y.path,body:Y,rawBody:y.body,headers:y.headers},W=this.messageHandlers.handleMessage(z);return!!W.isHandled&&(k.status=W.resultCode,W.responseHeaders&&(k.headers=W.responseHeaders),W.responseBody&&(k.body=W.responseBody),k.send(),!0)},C}();M.TrouterService=L,M.createTrouterService=J,M.getTrouterServiceVersion=X,M.replaceTrouterUrlBase=B},function(K,M){K.exports=j}])})});l(u);var d=c(function(p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.PACKAGE_VERSION=b.CONFIG_API_VERSION=b.EudbCountries=b.CloudPrefix=b.CloudType=b.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=void 0,b.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3;var j;(function(M){M.Public="Public",M.GccHigh="GCC High",M.Dod="DoD"})(j||(b.CloudType=j={}));var K;(function(M){M.OrgId="orgid",M.Acs="acs",M.Spool="spool",M.GccHigh="gcch",M.GccHighAcs="gcch-acs",M.Dod="dod",M.DodAcs="dod-acs"})(K||(b.CloudPrefix=K={})),b.EudbCountries=["europe","france","germany","norway","switzerland","sweden"],b.CONFIG_API_VERSION="2024-09-01",b.PACKAGE_VERSION="1.0.0-beta.29"});l(d),d.PACKAGE_VERSION,d.CONFIG_API_VERSION,d.EudbCountries,d.CloudPrefix,d.CloudType,d.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES;var f=c(function(p,b){var j=s&&s.__awaiter||function(V,z,W,le){function re($){return $ instanceof W?$:new W(function(m){m($)})}return new(W||(W=Promise))(function($,m){function R(se){try{ie(le.next(se))}catch(ue){m(ue)}}function Z(se){try{ie(le.throw(se))}catch(ue){m(ue)}}function ie(se){se.done?$(se.value):re(se.value).then(R,Z)}ie((le=le.apply(V,z||[])).next())})};Object.defineProperty(b,"__esModule",{value:!0}),b.isEudbLocation=b.parseTokenCredential=b.base64decode=b.toTelemetrySender=b.toLogProvider=b.toMessageHandler=void 0,b.generateUuid=y;const K=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]),M="8:orgid:",ne="8:dod:",G="8:gcch:",oe="8:teamsvisitor:",J="4:",X="8:acs:",B="8:gcch-acs:",q="8:dod-acs:",F="8:spool:",x=(V,z,W,le)=>{const re=K.get(V);return{handleMessage($){let m=null;if($!=null&&$.rawBody&&(m=JSON.parse($.rawBody)),m===null||m.eventId!==re)return;const R=P(V,m,W,le);if(R!==null)return z(R),{isHandled:!0,resultCode:200}}}};b.toMessageHandler=x;const P=(V,z,W,le)=>{if(V==="chatMessageReceived"){const re=z;return{threadId:re.groupId,sender:_(re.senderId),senderDisplayName:re.senderDisplayName,recipient:_(re.recipientMri),id:re.messageId,createdOn:new Date(re.originalArrivalTime),version:re.version,type:re.messageType,message:re.messageBody,metadata:N(re.acsChatMessageMetadata)||{},attachments:S(N(re.attachments)||[],W,le)}}if(V==="chatMessageEdited"){const re=z;return{threadId:re.groupId,sender:_(re.senderId),senderDisplayName:re.senderDisplayName,recipient:_(re.recipientMri),id:re.messageId,createdOn:new Date(re.originalArrivalTime),version:re.version,message:re.messageBody,editedOn:new Date(re.edittime),type:re.messageType,metadata:N(re.acsChatMessageMetadata)||{},attachments:S(N(re.attachments)||[],W,le)}}if(V==="chatMessageDeleted"){const re=z;return{threadId:re.groupId,sender:_(re.senderId),senderDisplayName:re.senderDisplayName,recipient:_(re.recipientMri),id:re.messageId,createdOn:new Date(re.originalArrivalTime),version:re.version,deletedOn:new Date(re.deletetime),type:re.messageType}}if(V==="typingIndicatorReceived"){const re=z;return{threadId:re.groupId,sender:_(re.senderId),senderDisplayName:re.senderDisplayName,recipient:_(re.recipientMri),version:re.version,receivedOn:new Date(re.originalArrivalTime)}}if(V==="readReceiptReceived"){const re=z,m=JSON.parse(re.messageBody).consumptionhorizon.split(";");return{threadId:re.groupId,sender:_(re.senderId),senderDisplayName:"",recipient:_(re.recipientMri),chatMessageId:re.messageId,readOn:new Date(+m[1])}}if(V==="chatThreadCreated"){const re=z,$=JSON.parse(unescape(re.createdBy)),m=JSON.parse(unescape(re.members)),R=JSON.parse(unescape(re.properties)),Z={id:_($.participantId),displayName:$.displayName},ie=m.map(ue=>({id:_(ue.participantId),displayName:ue.displayName}));return{threadId:re.threadId,createdOn:new Date(re.createTime),createdBy:Z,version:re.version,participants:ie,properties:R}}if(V==="chatThreadPropertiesUpdated"){const re=z,$=JSON.parse(unescape(re.editedBy)),m=JSON.parse(unescape(re.properties)),R={id:_($.participantId),displayName:$.displayName};return{threadId:re.threadId,updatedOn:new Date(re.editTime),updatedBy:R,version:re.version,properties:m}}if(V==="chatThreadDeleted"){const re=z,$=JSON.parse(unescape(re.deletedBy)),m={id:_($.participantId),displayName:$.displayName};return{threadId:re.threadId,deletedOn:new Date(re.deleteTime),deletedBy:m,version:re.version}}if(V==="participantsAdded"){const re=z,$=JSON.parse(unescape(re.addedBy)),m=JSON.parse(unescape(re.participantsAdded)),R={id:_($.participantId),displayName:$.displayName},Z=m.map(se=>({id:_(se.participantId),displayName:se.displayName,shareHistoryTime:new Date(se.shareHistoryTime)}));return{threadId:re.threadId,addedOn:new Date(re.time),addedBy:R,version:re.version,participantsAdded:Z}}if(V==="participantsRemoved"){const re=z,$=JSON.parse(unescape(re.removedBy)),m=JSON.parse(unescape(re.participantsRemoved)),R={id:_($.participantId),displayName:$.displayName},Z=m.map(se=>({id:_(se.participantId),displayName:se.displayName,shareHistoryTime:new Date(se.shareHistoryTime)}));return{threadId:re.threadId,removedOn:new Date(re.time),removedBy:R,version:re.version,participantsRemoved:Z}}return null},v=V=>({log:(...z)=>V.info(z),warn:(...z)=>V.warning(z),error:(...z)=>V.error(z),debug:(...z)=>V.verbose(z),info:(...z)=>V.verbose(z)});b.toLogProvider=v;const T=V=>({logEvent:z=>V.info(z)});b.toTelemetrySender=T;const _=V=>V.startsWith(M)?{kind:"microsoftTeamsUser",rawId:V,microsoftTeamsUserId:V.substring(M.length),isAnonymous:!1,cloud:"public"}:V.startsWith(ne)?{kind:"microsoftTeamsUser",rawId:V,microsoftTeamsUserId:V.substring(ne.length),isAnonymous:!1,cloud:"dod"}:V.startsWith(G)?{kind:"microsoftTeamsUser",rawId:V,microsoftTeamsUserId:V.substring(G.length),isAnonymous:!1,cloud:"gcch"}:V.startsWith(oe)?{kind:"microsoftTeamsUser",rawId:V,microsoftTeamsUserId:V.substring(oe.length),isAnonymous:!0}:V.startsWith(J)?{kind:"phoneNumber",rawId:V,phoneNumber:V.substring(J.length)}:V.startsWith(X)||V.startsWith(B)||V.startsWith(q)||V.startsWith(F)?{kind:"communicationUser",communicationUserId:V}:{kind:"unknown",id:V},N=V=>{if(!(V==null||V===""||V==="null"||V==="{}"||V==="[]"))return JSON.parse(V)},I=(V,z,W)=>{let le;try{le=new URL(V),(le.protocol==="http:"||le.protocol==="https:")&&(le=new URL(le.pathname,z))}catch{try{le=new URL(V,z)}catch{return V}}return le.searchParams.set("api-version",W),le.toString()},A=V=>{let z;try{z=new URL(V)}catch{return!1}return z.protocol==="http:"||z.protocol==="https:"},S=(V,z,W)=>(z==null||z===""||!A(z)||V.filter(le=>le.attachmentType.toLowerCase()==="image".toLowerCase()).map(le=>{le.previewUrl&&(le.previewUrl=I(le.previewUrl,z,W)),le.url&&(le.url=I(le.url,z,W))}),V),H=V=>r.isNodeLike?Buffer.from(V,"base64").toString():atob(V);b.base64decode=H;const L=V=>{let[,z]=V==null?void 0:V.split(".");if(z===void 0)throw new Error("Invalid token");return z=z.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape((0,b.base64decode)(z))))},C=V=>j(void 0,void 0,void 0,function*(){const z=yield V.getToken(),W=z==null?void 0:z.token,le=L(W),re=le.skypeid,$=le.resourceId,m=Y(re),R=le.resourceLocation||"";return{jwtToken:W,acsResourceId:$,identityMri:re,cloudType:m,resourceLocation:R}});b.parseTokenCredential=C;function y(){return(0,n.v4)()}const k=V=>!!V&&!!d.EudbCountries.find(z=>z===V);b.isEudbLocation=k;function Y(V){switch(V.substring(0,V.indexOf(":"))){case d.CloudPrefix.OrgId:case d.CloudPrefix.Acs:case d.CloudPrefix.Spool:return d.CloudType.Public;case d.CloudPrefix.GccHigh:case d.CloudPrefix.GccHighAcs:return d.CloudType.GccHigh;case d.CloudPrefix.Dod:case d.CloudPrefix.DodAcs:return d.CloudType.Dod;default:return d.CloudType.Public}}});l(f),f.isEudbLocation,f.parseTokenCredential,f.base64decode,f.toTelemetrySender,f.toLogProvider,f.toMessageHandler,f.generateUuid;var h=c(function(p,b){var j=s&&s.__createBinding||(Object.create?function(X,B,q,F){F===void 0&&(F=q);var x=Object.getOwnPropertyDescriptor(B,q);(!x||("get"in x?!B.__esModule:x.writable||x.configurable))&&(x={enumerable:!0,get:function(){return B[q]}}),Object.defineProperty(X,F,x)}:function(X,B,q,F){F===void 0&&(F=q),X[F]=B[q]}),K=s&&s.__setModuleDefault||(Object.create?function(X,B){Object.defineProperty(X,"default",{enumerable:!0,value:B})}:function(X,B){X.default=B}),M=s&&s.__importStar||function(X){if(X&&X.__esModule)return X;var B={};if(X!=null)for(var q in X)q!=="default"&&Object.prototype.hasOwnProperty.call(X,q)&&j(B,X,q);return K(B,X),B},ne=s&&s.__awaiter||function(X,B,q,F){function x(P){return P instanceof q?P:new q(function(v){v(P)})}return new(q||(q=Promise))(function(P,v){function T(I){try{N(F.next(I))}catch(A){v(A)}}function _(I){try{N(F.throw(I))}catch(A){v(A)}}function N(I){I.done?P(I.value):x(I.value).then(T,_)}N((F=F.apply(X,B||[])).next())})};Object.defineProperty(b,"__esModule",{value:!0}),b.RealTimeNotificationConfiguration=b.TrouterConfigClient=void 0;const G=M(i);class oe extends G.ServiceClient{constructor(B,q){q||(q={});const F=`azsdk-js-communication-signaling/${d.PACKAGE_VERSION}`,x=q.userAgentOptions&&q.userAgentOptions.userAgentPrefix?`${q.userAgentOptions.userAgentPrefix} ${F}`:`${F}`,P=Object.assign(Object.assign({},q),{userAgentOptions:{userAgentPrefix:x},additionalPolicies:q.additionalPolicies});super(P),this.apiVersion=d.CONFIG_API_VERSION,this.endpoint=B,this.httpClient=(0,o.createDefaultHttpClient)()}fetchServiceUrls(B){return ne(this,void 0,void 0,function*(){try{const q=(yield B.getToken()).token,F=(0,o.createPipelineRequest)({url:`${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,method:"GET",headers:(0,o.createHttpHeaders)({Authorization:`Bearer ${q}`})}),x=yield this.pipeline.sendRequest(this.httpClient,F);if(x.status!==200||!x.bodyAsText)throw new Error(`Failed to fetch service URLs. Status: ${x.status}, Body: ${x.bodyAsText||"No response body"}`);const P=JSON.parse(x.bodyAsText);if(!P.trouterServiceUrl||!P.registrarServiceUrl||!P.cloudType)throw new Error("One or more required fields are missing in the response data");return new J(P.trouterServiceUrl,P.registrarServiceUrl,P.cloudType)}catch(q){throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${q.message}`)}})}}b.TrouterConfigClient=oe;class J{constructor(B,q,F){this.trouterServiceUrl=B,this.registrarServiceUrl=q,this.cloudType=F}}b.RealTimeNotificationConfiguration=J});l(h),h.RealTimeNotificationConfiguration,h.TrouterConfigClient;var g=c(function(p,b){var j=s&&s.__awaiter||function(ne,G,oe,J){function X(B){return B instanceof oe?B:new oe(function(q){q(B)})}return new(oe||(oe=Promise))(function(B,q){function F(v){try{P(J.next(v))}catch(T){q(T)}}function x(v){try{P(J.throw(v))}catch(T){q(T)}}function P(v){v.done?B(v.value):X(v.value).then(F,x)}P((J=J.apply(ne,G||[])).next())})};Object.defineProperty(b,"__esModule",{value:!0}),b.defaultTelemetrySettings=b.createSettings=void 0;const K={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_1.8",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:"",registrarServiceUrl:"",registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5},M=(ne,G)=>j(void 0,void 0,void 0,function*(){var oe;const J=G==null?void 0:G.resourceEndpoint;if(J===void 0)throw new Error("'endpoint' cannot be null");const X=Object.assign({},K);X.registrationId=(0,f.generateUuid)(),X.sessionId=(0,f.generateUuid)();const q=yield new h.TrouterConfigClient(J,G).fetchServiceUrls(ne);return X.trouterServiceUrl=`${q.trouterServiceUrl}/v4/a`,X.registrarServiceUrl=`${q.registrarServiceUrl}/v3/registrations`,q.cloudType==="int"&&(X.pnhAppId="cns-e2e-test",X.pnhTemplate="cns-e2e-test:1.8"),X.maxRegistrationTimeInMs=(oe=G==null?void 0:G.registrationTimeInMs)!==null&&oe!==void 0?oe:K.maxRegistrationTimeInMs,X});b.createSettings=M,b.defaultTelemetrySettings={enabled:!1}});l(g),g.defaultTelemetrySettings,g.createSettings;var E=c(function(p,b){var j=s&&s.__awaiter||function(ne,G,oe,J){function X(B){return B instanceof oe?B:new oe(function(q){q(B)})}return new(oe||(oe=Promise))(function(B,q){function F(v){try{P(J.next(v))}catch(T){q(T)}}function x(v){try{P(J.throw(v))}catch(T){q(T)}}function P(v){v.done?B(v.value):X(v.value).then(F,x)}P((J=J.apply(ne,G||[])).next())})};Object.defineProperty(b,"__esModule",{value:!0}),b.CommunicationSignalingClient=b.ConnectionState=void 0;var K;(function(ne){ne[ne.Unknown=0]="Unknown",ne[ne.Connected=2]="Connected",ne[ne.Disconnected=3]="Disconnected",ne[ne.Switching=9]="Switching"})(K||(b.ConnectionState=K={}));class M{constructor(G,oe,J){this.credential=G,this.logger=oe,this.options=J,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=(0,u.createTrouterService)((0,f.toLogProvider)(oe))}start(){return j(this,void 0,void 0,function*(){var G,oe;if(this.resourceEndpoint=(G=this.options)===null||G===void 0?void 0:G.resourceEndpoint,this.resourceEndpoint===void 0)throw new Error("'endpoint' cannot be null");this.gatewayApiVersion=((oe=this.options)===null||oe===void 0?void 0:oe.gatewayApiVersion)||"2024-03-07",this.config===void 0&&(this.config={trouterSettings:yield(0,g.createSettings)(this.credential,this.options),skypeTokenProvider:J=>j(this,void 0,void 0,function*(){if(J){if(this.tokenFetchRetries+=1,this.tokenFetchRetries>d.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)throw yield this.stop(!0),new Error(`Access token is expired and failed to fetch a valid one after ${d.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`)}else this.tokenFetchRetries=0;return Promise.resolve((yield this.credential.getToken()).token)}),telemetryConfig:{eventLogger:(0,f.toTelemetrySender)(this.logger),settings:g.defaultTelemetrySettings}}),this.trouter.start(this.config),this.trouter.setUserActivityState(u.UserActivityState.Active)})}stop(G){return j(this,void 0,void 0,function*(){this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(G??this.tokenFetchRetries>d.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)})}on(G,oe){if(G==="connectionChanged"){this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=(J,X)=>oe(J),this.trouter.onStateChanged(this.stateChangedListener);return}this.trouter.registerMessageHandler((0,f.toMessageHandler)(G,oe,this.resourceEndpoint,this.gatewayApiVersion))}}b.CommunicationSignalingClient=M});l(E),E.CommunicationSignalingClient,E.ConnectionState;var D=c(function(p,b){var j=s&&s.__createBinding||(Object.create?function(M,ne,G,oe){oe===void 0&&(oe=G);var J=Object.getOwnPropertyDescriptor(ne,G);(!J||("get"in J?!ne.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return ne[G]}}),Object.defineProperty(M,oe,J)}:function(M,ne,G,oe){oe===void 0&&(oe=G),M[oe]=ne[G]}),K=s&&s.__exportStar||function(M,ne){for(var G in M)G!=="default"&&!Object.prototype.hasOwnProperty.call(ne,G)&&j(ne,M,G)};Object.defineProperty(b,"__esModule",{value:!0}),K(E,b)}),w=l(D);t.exports=w})(cF);var VE=cF.exports;const $K=t=>{const{participants:e,idempotencyToken:n}=t,r=Cn(t,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)},DF=t=>{const{id:e}=t,n=Cn(t,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:Nf(e)})},HK=t=>{var e;return{participants:(e=t.participants)===null||e===void 0?void 0:e.map(n=>DF(n))}},zE=t=>{const{communicationIdentifier:e}=t,n=Cn(t,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:Vo(e)})},qK=t=>{const{participants:e,initiatorCommunicationIdentifier:n}=t,r=Cn(t,["participants","initiatorCommunicationIdentifier"]);let i=Object.assign({},r);if(n){const o=Vo(n);i=Object.assign(Object.assign({},i),{initiator:o})}return e&&(i=Object.assign(Object.assign({},i),{participants:e==null?void 0:e.map(o=>zE(o))})),i},J0=t=>{const{content:e,senderCommunicationIdentifier:n}=t,r=Cn(t,["content","senderCommunicationIdentifier"]);let i=Object.assign({},r);if(e&&(i=Object.assign(Object.assign({},i),{content:qK(e)})),n){const o=Vo(n);i=Object.assign(Object.assign({},i),{sender:o})}return i},NF=t=>{const{createdByCommunicationIdentifier:e}=t,n=Cn(t,["createdByCommunicationIdentifier"]);return e?Object.assign(Object.assign({},n),{createdBy:Vo(e)}):Object.assign({},n)},jK=t=>{const{chatThread:e}=t,n=Cn(t,["chatThread"]);return e?Object.assign(Object.assign({},n),{chatThread:NF(e)}):Object.assign({},n)},BO=t=>{const{senderCommunicationIdentifier:e}=t,n=Cn(t,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:Vo(e)})},Ot=qb({namespace:"Azure.Communication",packageName:"@azure/communication-chat",packageVersion:"1.5.4"}),zb={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},VK={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},xF={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{kind:{serializedName:"kind",type:{name:"String"}},rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}},microsoftTeamsApp:{serializedName:"microsoftTeamsApp",type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel"}}}}},zK={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},GK={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},WK={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},KK={type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel",modelProperties:{appId:{serializedName:"appId",required:!0,type:{name:"String"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},ze={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},JK={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},LF={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},UF={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},FF={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Gb={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},BF={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},QK={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},XK={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}}}}},YK={type:{name:"Composite",className:"ChatAttachment",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",required:!0,type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}},url:{serializedName:"url",type:{name:"String"}},previewUrl:{serializedName:"previewUrl",type:{name:"String"}}}}},$F={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},Wb={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},HF={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},qF={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},jF={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},VF={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},zF={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}}}}},Kb={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},ZK={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},GF={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}}}}},WF={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},KF=Object.freeze(Object.defineProperty({__proto__:null,AddChatParticipantsRequest:HF,AddChatParticipantsResult:qF,ChatAttachment:YK,ChatError:JK,ChatMessage:BF,ChatMessageContent:QK,ChatMessageReadReceipt:VK,ChatMessageReadReceiptsCollection:zb,ChatMessagesCollection:Gb,ChatParticipant:XK,ChatParticipantsCollection:Wb,ChatThreadItem:ZK,ChatThreadProperties:zF,ChatThreadsItemCollection:Kb,CommunicationErrorResponse:ze,CommunicationIdentifierModel:xF,CommunicationUserIdentifierModel:zK,CreateChatThreadRequest:jF,CreateChatThreadResult:VF,MicrosoftTeamsAppIdentifierModel:KK,MicrosoftTeamsUserIdentifierModel:WK,PhoneNumberIdentifierModel:GK,SendChatMessageRequest:UF,SendChatMessageResult:FF,SendReadReceiptRequest:LF,SendTypingNotificationRequest:WF,UpdateChatMessageRequest:$F,UpdateChatThreadRequest:GF},Symbol.toStringTag,{value:"Module"})),Gn={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},Wn={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},Ur={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},iy={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},JF={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},Zr={parameterPath:"apiVersion",mapper:{defaultValue:"2024-03-07",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},Zu={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},e9={parameterPath:"sendReadReceiptRequest",mapper:LF},t9={parameterPath:"sendChatMessageRequest",mapper:UF},QF={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},Jb={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},XF={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},n9={parameterPath:"updateChatMessageRequest",mapper:$F},r9={parameterPath:"participantCommunicationIdentifier",mapper:xF},i9={parameterPath:"addChatParticipantsRequest",mapper:HF},o9={parameterPath:"updateChatThreadRequest",mapper:GF},s9={parameterPath:["options","sendTypingNotificationRequest"],mapper:WF},oy={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},a9={parameterPath:"createChatThreadRequest",mapper:jF},l9={parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}};let c9=class{constructor(e){this.client=e}async listChatReadReceipts(e,n){return Ot.withSpan("ChatApiClient.listChatReadReceipts",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},u9))}async sendChatReadReceipt(e,n,r){return Ot.withSpan("ChatApiClient.sendChatReadReceipt",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:n,options:i},d9))}async sendChatMessage(e,n,r){return Ot.withSpan("ChatApiClient.sendChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:n,options:i},h9))}async listChatMessages(e,n){return Ot.withSpan("ChatApiClient.listChatMessages",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},f9))}async getChatMessage(e,n,r){return Ot.withSpan("ChatApiClient.getChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,options:i},p9))}async updateChatMessage(e,n,r,i){return Ot.withSpan("ChatApiClient.updateChatMessage",i??{},async o=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,updateChatMessageRequest:r,options:o},g9))}async deleteChatMessage(e,n,r){return Ot.withSpan("ChatApiClient.deleteChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,options:i},m9))}async listChatParticipants(e,n){return Ot.withSpan("ChatApiClient.listChatParticipants",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},v9))}async removeChatParticipant(e,n,r){return Ot.withSpan("ChatApiClient.removeChatParticipant",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:n,options:i},y9))}async addChatParticipants(e,n,r){return Ot.withSpan("ChatApiClient.addChatParticipants",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:n,options:i},C9))}async updateChatThreadProperties(e,n,r){return Ot.withSpan("ChatApiClient.updateChatThreadProperties",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:n,options:i},S9))}async getChatThreadProperties(e,n){return Ot.withSpan("ChatApiClient.getChatThreadProperties",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},T9))}async sendTypingNotification(e,n){return Ot.withSpan("ChatApiClient.sendTypingNotification",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},E9))}async listChatReadReceiptsNext(e,n,r){return Ot.withSpan("ChatApiClient.listChatReadReceiptsNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},w9))}async listChatMessagesNext(e,n,r){return Ot.withSpan("ChatApiClient.listChatMessagesNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},I9))}async listChatParticipantsNext(e,n,r){return Ot.withSpan("ChatApiClient.listChatParticipantsNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},b9))}};const ei=xf(KF,!1),u9={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:zb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[iy,JF,Zr],urlParameters:[Wn,Ur],headerParameters:[Gn],serializer:ei},d9={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:e9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,Zu],mediaType:"json",serializer:ei},h9={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:FF},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:t9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,Zu],mediaType:"json",serializer:ei},f9={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:Gb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[iy,Zr,QF],urlParameters:[Wn,Ur],headerParameters:[Gn],serializer:ei},p9={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:BF},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[Zr],urlParameters:[Wn,Ur,Jb],headerParameters:[Gn],serializer:ei},g9={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:n9,queryParameters:[Zr],urlParameters:[Wn,Ur,Jb],headerParameters:[Gn,XF],mediaType:"json",serializer:ei},m9={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[Zr],urlParameters:[Wn,Ur,Jb],headerParameters:[Gn],serializer:ei},v9={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:Wb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[iy,JF,Zr],urlParameters:[Wn,Ur],headerParameters:[Gn],serializer:ei},y9={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:r9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,Zu],mediaType:"json",serializer:ei},C9={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:qF},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:i9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,Zu],mediaType:"json",serializer:ei},S9={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:o9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,XF],mediaType:"json",serializer:ei},T9={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:zF},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn],serializer:ei},E9={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:s9,queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn,Zu],mediaType:"json",serializer:ei},w9={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:zb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},urlParameters:[Wn,Ur,oy],headerParameters:[Gn],serializer:ei},I9={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Gb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},urlParameters:[Wn,Ur,oy],headerParameters:[Gn],serializer:ei},b9={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Wb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},urlParameters:[Wn,Ur,oy],headerParameters:[Gn],serializer:ei};let _9=class{constructor(e){this.client=e}async createChatThread(e,n){return Ot.withSpan("ChatApiClient.createChatThread",n??{},async r=>this.client.sendOperationRequest({createChatThreadRequest:e,options:r},A9))}async listChatThreads(e){return Ot.withSpan("ChatApiClient.listChatThreads",e??{},async n=>this.client.sendOperationRequest({options:n},R9))}async deleteChatThread(e,n){return Ot.withSpan("ChatApiClient.deleteChatThread",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},k9))}async listChatThreadsNext(e,n){return Ot.withSpan("ChatApiClient.listChatThreadsNext",n??{},async r=>this.client.sendOperationRequest({nextLink:e,options:r},P9))}};const sy=xf(KF,!1),A9={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:VF},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},requestBody:a9,queryParameters:[Zr],urlParameters:[Wn],headerParameters:[Gn,Zu,l9],mediaType:"json",serializer:sy},R9={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:Kb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[iy,Zr,QF],urlParameters:[Wn],headerParameters:[Gn],serializer:sy},k9={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},queryParameters:[Zr],urlParameters:[Wn,Ur],headerParameters:[Gn],serializer:sy},P9={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Kb},401:{bodyMapper:ze,isError:!0},403:{bodyMapper:ze,isError:!0},429:{bodyMapper:ze,isError:!0},503:{bodyMapper:ze,isError:!0}},urlParameters:[Wn,oy],headerParameters:[Gn],serializer:sy};let YF=class extends Vb{constructor(e,n){var r,i;if(e===void 0)throw new Error("'endpoint' cannot be null");n||(n={});const o={requestContentType:"application/json; charset=utf-8"},s="azsdk-js-communication-chat/1.5.4",l=n.userAgentOptions&&n.userAgentOptions.userAgentPrefix?`${n.userAgentOptions.userAgentPrefix} ${s}`:`${s}`,c=Object.assign(Object.assign(Object.assign({},o),n),{userAgentOptions:{userAgentPrefix:l},endpoint:(i=(r=n.endpoint)!==null&&r!==void 0?r:n.baseUri)!==null&&i!==void 0?i:"{endpoint}"});super(c),this.endpoint=e,this.apiVersion=n.apiVersion||"2024-03-07",this.chatThread=new c9(this),this.chat=new _9(this),this.addCustomApiVersionPolicy(n.apiVersion)}addCustomApiVersionPolicy(e){if(!e)return;const n={name:"CustomApiVersionPolicy",async sendRequest(r,i){const o=r.url.split("?");if(o.length>1){const s=o[1].split("&").map(l=>l.indexOf("api-version")>-1?"api-version="+e:l);r.url=o[0]+"?"+s.join("&")}return i(r)}};this.pipeline.addPolicy(n)}};const Dh=Mf("communication-chat"),ZF=t=>Df({credential:{getToken:(n,r)=>t.getToken({abortSignal:r==null?void 0:r.abortSignal})},scopes:[]}),O9=8e3;let e3=class{constructor(e,n,r,i={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=n,this.tokenCredential=r;const o=Object.assign(Object.assign({},i),{loggingOptions:{logger:Dh.info}});this.client=new YF(this.endpoint,Object.assign({endpoint:this.endpoint},o));const s=ZF(this.tokenCredential);this.client.pipeline.addPolicy(s)}getProperties(e={}){return Ot.withSpan("ChatClient-GetProperties",e,async n=>{const r=await this.client.chatThread.getChatThreadProperties(this.threadId,n);return NF(r)})}updateTopic(e,n={}){return Ot.withSpan("ChatThreadClient-UpdateTopic",n,async r=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},r)})}sendMessage(e,n={}){return Ot.withSpan("ChatThreadClient-SendMessage",n,async r=>(this.timeOfLastTypingRequest=void 0,await this.client.chatThread.sendChatMessage(this.threadId,Object.assign(Object.assign({},e),n),r)))}getMessage(e,n={}){return Ot.withSpan("ChatThreadClient-GetMessage",n,async r=>{const i=await this.client.chatThread.getChatMessage(this.threadId,e,r);return J0(i)})}listMessagesPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatMessages(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(J0,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatMessagesNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(J0,this));else break}})}listMessagesAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listMessagesPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listMessages(e={}){const{span:n,updatedOptions:r}=Ot.startSpan("ChatThreadClient-ListMessages",e);try{const i=this.listMessagesAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listMessagesPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}deleteMessage(e,n={}){return Ot.withSpan("ChatThreadClient-DeleteMessage",n,async r=>{await this.client.chatThread.deleteChatMessage(this.threadId,e,r)})}async updateMessage(e,n={}){return Ot.withSpan("ChatThreadClient-UpdateMessage",n,async r=>{await this.client.chatThread.updateChatMessage(this.threadId,e,n,r)})}async addParticipants(e,n={}){return Ot.withSpan("ChatThreadClient-AddParticipants",n,async r=>await this.client.chatThread.addChatParticipants(this.threadId,HK(e),r))}listParticipantsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatParticipants(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(zE,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatParticipantsNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(zE,this));else break}})}listParticipantsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listParticipantsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listParticipants(e={}){const{span:n,updatedOptions:r}=Ot.startSpan("ChatThreadClient-ListParticipants",e);try{const i=this.listParticipantsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listParticipantsPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}async removeParticipant(e,n={}){return Ot.withSpan("ChatThreadClient-RemoveParticipant",n,async r=>{await this.client.chatThread.removeChatParticipant(this.threadId,Nf(e),r)})}async sendTypingNotification(e={}){return Ot.withSpan("ChatThreadClient-SendTypingNotification",e,async n=>{const r=new Date,{senderDisplayName:i}=n,o=Cn(n,["senderDisplayName"]);return this.canPostTypingNotification(r)?(this.timeOfLastTypingRequest=r,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:i}},o)),!0):(Dh.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)})}async sendReadReceipt(e,n={}){return Ot.withSpan("ChatThreadClient-SendReadReceipt",n,async r=>{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,r)})}listReadReceiptsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatReadReceipts(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(BO,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatReadReceiptsNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(BO,this));else break}})}listReadReceiptsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listReadReceiptsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listReadReceipts(e={}){const{span:n,updatedOptions:r}=Ot.startSpan("ChatThreadClient-ListChatReadReceipts",e);try{const i=this.listReadReceiptsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listReadReceiptsPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}canPostTypingNotification(e){return this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<O9?(Dh.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1):!0}};var Qb={exports:{}},fu=typeof Reflect=="object"?Reflect:null,$O=fu&&typeof fu.apply=="function"?fu.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Em;fu&&typeof fu.ownKeys=="function"?Em=fu.ownKeys:Object.getOwnPropertySymbols?Em=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Em=function(e){return Object.getOwnPropertyNames(e)};function M9(t){console&&console.warn&&console.warn(t)}var t3=Number.isNaN||function(e){return e!==e};function Kt(){Kt.init.call(this)}Qb.exports=Kt;Qb.exports.once=L9;Kt.EventEmitter=Kt;Kt.prototype._events=void 0;Kt.prototype._eventsCount=0;Kt.prototype._maxListeners=void 0;var HO=10;function ay(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Kt,"defaultMaxListeners",{enumerable:!0,get:function(){return HO},set:function(t){if(typeof t!="number"||t<0||t3(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");HO=t}});Kt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Kt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||t3(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function n3(t){return t._maxListeners===void 0?Kt.defaultMaxListeners:t._maxListeners}Kt.prototype.getMaxListeners=function(){return n3(this)};Kt.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var l=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw l.context=s,l}var c=o[e];if(c===void 0)return!1;if(typeof c=="function")$O(c,this,n);else for(var a=c.length,u=a3(c,a),r=0;r<a;++r)$O(u[r],this,n);return!0};function r3(t,e,n,r){var i,o,s;if(ay(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),s===void 0)s=o[e]=n,++t._eventsCount;else if(typeof s=="function"?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),i=n3(t),i>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,M9(l)}return t}Kt.prototype.addListener=function(e,n){return r3(this,e,n,!1)};Kt.prototype.on=Kt.prototype.addListener;Kt.prototype.prependListener=function(e,n){return r3(this,e,n,!0)};function D9(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function i3(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=D9.bind(r);return i.listener=n,r.wrapFn=i,i}Kt.prototype.once=function(e,n){return ay(n),this.on(e,i3(this,e,n)),this};Kt.prototype.prependOnceListener=function(e,n){return ay(n),this.prependListener(e,i3(this,e,n)),this};Kt.prototype.removeListener=function(e,n){var r,i,o,s,l;if(ay(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){l=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():N9(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,l||n)}return this};Kt.prototype.off=Kt.prototype.removeListener;Kt.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function o3(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?x9(i):a3(i,i.length)}Kt.prototype.listeners=function(e){return o3(this,e,!0)};Kt.prototype.rawListeners=function(e){return o3(this,e,!1)};Kt.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):s3.call(t,e)};Kt.prototype.listenerCount=s3;function s3(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Kt.prototype.eventNames=function(){return this._eventsCount>0?Em(this._events):[]};function a3(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function N9(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function x9(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function L9(t,e){return new Promise(function(n,r){function i(s){t.removeListener(e,o),r(s)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}l3(t,e,o,{once:!0}),e!=="error"&&U9(t,i,{once:!0})})}function U9(t,e,n){typeof t.on=="function"&&l3(t,"error",e,n)}function l3(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(o){r.once&&t.removeEventListener(e,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var c3=Qb.exports;function F9(){return pF()}const B9=(t,e,n)=>{var r,i,o,s;return new VE.CommunicationSignalingClient(t,e,{resourceEndpoint:(r=n==null?void 0:n.resourceEndpoint)!==null&&r!==void 0?r:void 0,gatewayApiVersion:(i=n==null?void 0:n.gatewayApiVersion)!==null&&i!==void 0?i:void 0,additionalPolicies:(o=n==null?void 0:n.additionalPolicies)!==null&&o!==void 0?o:void 0,userAgentOptions:(s=n==null?void 0:n.userAgentOptions)!==null&&s!==void 0?s:void 0})};let $9=class{constructor(e,n,r={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new c3.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=n;const i=Object.assign(Object.assign({},r),{loggingOptions:{logger:Dh.info}});this.client=new YF(this.endpoint,Object.assign({endpoint:this.endpoint},i));const o=ZF(this.tokenCredential);this.client.pipeline.addPolicy(o),this.clientOptions=Object.assign({},r),this.clientOptions.signalingClientOptions=Object.assign(Object.assign({},this.clientOptions.signalingClientOptions),{resourceEndpoint:this.endpoint,gatewayApiVersion:this.client.apiVersion}),this.signalingClient=B9(n,Dh,this.clientOptions.signalingClientOptions)}getChatThreadClient(e){return new e3(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,n={}){return Ot.withSpan("ChatClient-CreateChatThread",n,async r=>{var i,o;r.idempotencyToken=(i=r.idempotencyToken)!==null&&i!==void 0?i:F9();const s=$K(r),l=await this.client.chat.createChatThread({topic:e.topic,participants:(o=n.participants)===null||o===void 0?void 0:o.map(c=>DF(c))},s);return jK(l)})}listChatThreadsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chat.listChatThreads(i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value))}for(;r.continuationToken;){const o=yield at(this.client.chat.listChatThreadsNext(r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value);else break}})}listChatThreadsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listChatThreadsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listChatThreads(e={}){const{span:n,updatedOptions:r}=Ot.startSpan("ChatClient-ListChatThreads",e);try{const i=this.listChatThreadsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listChatThreadsPage(o,r)}}catch(i){throw n.setStatus({error:i,status:"error"}),i}finally{n.end()}}async deleteChatThread(e,n={}){return Ot.withSpan("ChatClient-DeleteChatThread",n,async r=>{await this.client.chat.deleteChatThread(e,r)})}async startRealtimeNotifications(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,n){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&e!=="realTimeNotificationConnected"&&e!=="realTimeNotificationDisconnected")throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,n)}off(e,n){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,n)}subscribeToSignalingEvents(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",e=>{e===VE.ConnectionState.Connected?this.emitter.emit("realTimeNotificationConnected"):e===VE.ConnectionState.Disconnected&&this.emitter.emit("realTimeNotificationDisconnected")}),this.signalingClient.on("chatMessageReceived",e=>{this.emitter.emit("chatMessageReceived",e)}),this.signalingClient.on("chatMessageEdited",e=>{this.emitter.emit("chatMessageEdited",e)}),this.signalingClient.on("chatMessageDeleted",e=>{this.emitter.emit("chatMessageDeleted",e)}),this.signalingClient.on("typingIndicatorReceived",e=>{this.emitter.emit("typingIndicatorReceived",e)}),this.signalingClient.on("readReceiptReceived",e=>{this.emitter.emit("readReceiptReceived",e)}),this.signalingClient.on("chatThreadCreated",e=>{this.emitter.emit("chatThreadCreated",e)}),this.signalingClient.on("chatThreadDeleted",e=>{this.emitter.emit("chatThreadDeleted",e)}),this.signalingClient.on("chatThreadPropertiesUpdated",e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)}),this.signalingClient.on("participantsAdded",e=>{this.emitter.emit("participantsAdded",e)}),this.signalingClient.on("participantsRemoved",e=>{this.emitter.emit("participantsRemoved",e)})}};const H9=Object.freeze(Object.defineProperty({__proto__:null,ChatClient:$9,ChatThreadClient:e3},Symbol.toStringTag,{value:"Module"})),q9=Hs(H9);var ql={},ly={},ed={};Object.defineProperty(ed,"__esModule",{value:!0});ed.SupportedAdaptiveCards=void 0;var qO;(function(t){t.Adaptive="application/vnd.microsoft.card.adaptive",t.Audio="application/vnd.microsoft.card.audio",t.Hero="application/vnd.microsoft.card.hero",t.Receipt="application/vnd.microsoft.card.receipt",t.Thumbnail="application/vnd.microsoft.card.thumbnail",t.Signin="application/vnd.microsoft.card.signin",t.OAuth="application/vnd.microsoft.card.oauth",t.Video="application/vnd.microsoft.card.video"})(qO||(ed.SupportedAdaptiveCards=qO={}));Object.defineProperty(ly,"__esModule",{value:!0});ly.OmnichannelMessagePrinter=void 0;var j9=ed,V9=tl,z9=function(){function t(){}return t.printify=function(e){var n,r={};return e&&(r.id=e.id,r.tags=e==null?void 0:e.tags,r.bot=!(!((n=e==null?void 0:e.tags)===null||n===void 0)&&n.find(function(i){return i==="public"})),r.card=Object.values(j9.SupportedAdaptiveCards).some(function(i){var o;return(o=e==null?void 0:e.content)===null||o===void 0?void 0:o.includes(i)}),!r.card&&(e!=null&&e.content)&&(r.content=(0,V9.messageContentMetadata)(e==null?void 0:e.content)),r.created=e.timestamp),r},t}();ly.OmnichannelMessagePrinter=z9;var cy={};Object.defineProperty(cy,"__esModule",{value:!0});cy.PollingMessagePrinter=void 0;var G9=ed,W9=tl,K9=function(){function t(){}return t.printify=function(e){var n,r,i,o,s={};return e&&(s.id=e.id,s.tags=e&&(!((n=e.metadata)===null||n===void 0)&&n.tags)?e.metadata.tags.replace(/"/g,"").split(",").filter(function(l){return l.length>0}):[],s.card=Object.values(G9.SupportedAdaptiveCards).some(function(l){var c,a;return(a=(c=e==null?void 0:e.content)===null||c===void 0?void 0:c.message)===null||a===void 0?void 0:a.includes(l)}),s.bot=!(!((r=s.tags)===null||r===void 0)&&r.find(function(l){return l==="public"})),!s.card&&(!((i=e==null?void 0:e.content)===null||i===void 0)&&i.message)&&(s.content=(0,W9.messageContentMetadata)((o=e.content)===null||o===void 0?void 0:o.message)),s.created=e.createdOn),s},t}();cy.PollingMessagePrinter=K9;var uy={};Object.defineProperty(uy,"__esModule",{value:!0});uy.WebSocketMessagePrinter=void 0;var J9=ed,Q9=tl,X9=function(){function t(){}return t.printify=function(e){var n,r,i,o={};return e&&(o.id=e.id,o.tags=!((n=e==null?void 0:e.metadata)===null||n===void 0)&&n.tags?e.metadata.tags.replace(/"/g,"").split(",").filter(function(s){return s.length>0}):[],o.bot=!(!((i=(r=e==null?void 0:e.metadata)===null||r===void 0?void 0:r.tags)===null||i===void 0)&&i.includes("public")),o.card=Object.values(J9.SupportedAdaptiveCards).some(function(s){var l;return(l=e==null?void 0:e.message)===null||l===void 0?void 0:l.includes(s)}),!o.card&&(e!=null&&e.message)&&(o.content=(0,Q9.messageContentMetadata)(e==null?void 0:e.message)),o.created=e.createdOn),o},t}();uy.WebSocketMessagePrinter=X9;Object.defineProperty(ql,"__esModule",{value:!0});ql.MessagePrinterFactory=ql.PrinterType=void 0;var Y9=ly,Z9=cy,eJ=uy,ha;(function(t){t.Polling="Polling",t.WebSocket="WebSocket",t.Omnichannel="Rest"})(ha||(ql.PrinterType=ha={}));var tJ=function(){function t(){}t.getPrinter=function(n){switch(n){case ha.Polling:return Z9.PollingMessagePrinter;case ha.WebSocket:return eJ.WebSocketMessagePrinter;case ha.Omnichannel:return Y9.OmnichannelMessagePrinter;default:throw new Error("Invalid printer type")}};var e;return e=t,t.printifyMessage=function(n,r){var i=e.getPrinter(r);switch(r){case ha.Polling:return i.printify(n);case ha.WebSocket:return i.printify(n);case ha.Omnichannel:return i.printify(n);default:throw new Error("Invalid printer type")}},t}();ql.MessagePrinterFactory=tJ;var Xb={};Object.defineProperty(Xb,"__esModule",{value:!0});var GE;(function(t){t.Text="text",t.TopicUpdated="topicUpdated",t.ParticipantAdded="participantAdded",t.ParticipantRemoved="participantRemoved"})(GE||(GE={}));Xb.default=GE;var il={};Object.defineProperty(il,"__esModule",{value:!0});var WE;(function(t){t[t.V1=1]="V1",t[t.V2=2]="V2"})(WE||(WE={}));il.default=WE;var Lf={};Object.defineProperty(Lf,"__esModule",{value:!0});Lf.MessageSource=void 0;var jO;(function(t){t.Polling="Poll",t.WebSocket="WS",t.GetRestCall="Get"})(jO||(Lf.MessageSource=jO={}));var Vs={};Object.defineProperty(Vs,"__esModule",{value:!0});var KE;(function(t){t.ValidateOmnichannelConfig="ValidateOmnichannelConfig",t.ValidateSDKConfig="ValidateSDKConfig",t.InitializeChatSDK="InitializeChatSDK",t.InitializeChatSDKParallel="InitializeChatSDKParallel",t.InitializeMessagingClient="InitializeMessagingClient ",t.InitializeComponents="InitializeComponents",t.InitializeLoadChatConfig="InitializeLoadChatConfig",t.StartChat="StartChat",t.EndChat="EndChat",t.CloseChatSession="CloseChatSession",t.GetLiveChatConfig="GetLiveChatConfig",t.GetAuthToken="GetAuthToken",t.GetPreChatSurvey="GetPreChatSurvey",t.GetChatToken="GetChatToken",t.GetConversationDetails="GetConversationDetails",t.GetCurrentLiveChatContext="GetCurrentLiveChatContext",t.GetMessages="GetMessages",t.SendMessages="SendMessages",t.SendTypingEvent="SendTypingEvent",t.OnAgentEndSession="OnAgentEndSession",t.OnNewMessage="OnNewMessage",t.OnTypingEvent="OnTypingEvent",t.UploadFileAttachment="UploadFileAttachment",t.DownloadFileAttachment="DownloadFileAttachment",t.EmailLiveChatTranscript="EmailLiveChatTranscript",t.GetLiveChatTranscript="GetLiveChatTranscript",t.CreateIC3Adapter="CreateChatAdapter",t.CreateACSAdapter="CreateACSAdapter",t.CreateDirectLine="CreateDirectLine",t.GetVoiceVideoCalling="GetVoiceVideoCalling",t.GetIC3Client="GetIC3Client",t.InitializeVoiceVideoCallingSDK="InitializeVoiceVideoCallingSDK",t.AcceptVoiceCall="AcceptVoiceCall",t.AcceptVideoCall="AcceptVideoCall",t.RejectCall="RejectCall",t.StopCall="StopCall",t.OnCallDisconnected="OnCallDisconnected",t.UpdateChatToken="UpdateChatToken",t.GetChatReconnectContext="GetChatReconnectContext",t.GetPostChatSurveyContext="GetPostChatSurveyContext",t.GetAgentAvailability="GetAgentAvailability",t.GetGeolocation="GetGeolocation",t.GetChatReconnectContextWithReconnectId="GetChatReconnectContextWithReconnectId",t.GetChatReconnectContextWithAuthToken="GetChatReconnectContextWithAuthToken",t.StartPolling="StartPolling",t.StopPolling="StopPolling",t.MessageReceived="MessageReceived"})(KE||(KE={}));Vs.default=KE;var dy={},JE=_e&&_e.__assign||function(){return JE=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},JE.apply(this,arguments)};Object.defineProperty(dy,"__esModule",{value:!0});var VO=hr,zO=il,nJ=tl,rJ=function(t,e){var n={};if(n.liveChatVersion=e.liveChatVersion||zO.default.V1,e.debug&&console.log(t),e.liveChatVersion===zO.default.V2){var r=t,i=r.id,o=r.content,s=r.metadata,l=r.sender,c=r.senderDisplayName,a=r.createdOn,u=r.editedOn;if(n.id=i,n.messageid=void 0,n.clientmessageid=void 0,n.deliveryMode=void 0,n.properties={},n.content="",n.properties.tags=s&&s.tags?s.tags:[],n.tags=s&&s.tags?s.tags.replace(/\"/g,"").split(",").filter(function(w){return w.length>0}):[],n.timestamp=u??a,n.messageType=VO.MessageType.UserMessage,n.sender={id:l.communicationUserId,displayName:c,type:VO.PersonType.Bot},o?typeof o=="string"?n.content=o:typeof o=="object"&&typeof(o==null?void 0:o.message)=="string"&&(n.content=o.message):t.message&&(n.content=t.message),s&&s.amsMetadata&&s.amsReferences||s!=null&&s.amsreferences)try{var d=JSON.parse(s.amsMetadata),f=JSON.parse(s.amsreferences||(s==null?void 0:s.amsReferences)),h=d[0],g=h.fileName,E=h.contentType;n.fileMetadata={},n.fileMetadata.fileSharingProtocolType=0,n.fileMetadata.id=f[0],n.fileMetadata.name=g,n.fileMetadata.size=0,n.fileMetadata.type=E,n.fileMetadata.url=""}catch{}s&&s.OriginalMessageId?n.properties.originalMessageId=s.OriginalMessageId:n.properties.originalMessageId=i,s&&s.customEvent&&s.customEventName&&s.customEventValue&&(n.customEvent={isCustomEvent:!!s.customEvent,customEventName:s.customEventName,customEventValue:s.customEventValue}),n.role=(0,nJ.getMessageRole)(n)}else{var D=t.clientmessageid;n.id=D,n=JE({},t)}return n};dy.default=rJ;var hy={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMessageTags=t.customerMessageTag=t.channelIdTag=void 0,t.channelIdTag="ChannelId-lcw",t.customerMessageTag="FromCustomer",t.defaultMessageTags=[t.channelIdTag,t.customerMessageTag]})(hy);var QE=_e&&_e.__assign||function(){return QE=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},QE.apply(this,arguments)},$n=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},Rn=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},iJ=_e&&_e.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(kf,"__esModule",{value:!0});kf.ACSConversation=void 0;var oJ=f8,sJ=q9,fg=ql,aJ=Xb,GO=Gu,lJ=Ku,WO=il,KO=Lf,JO=Vs,QO=dy,XO=hy,wt;(function(t){t.InitializeACSClient="InitializeACSClient",t.InitializeACSConversation="InitializeACSConversation",t.GetParticipants="GetParticipants",t.RegisterOnNewMessage="RegisterOnNewMessage",t.RegisterOnThreadUpdate="RegisterOnThreadUpdate",t.OnTypingEvent="OnTypingEvent",t.GetMessages="GetMessages",t.SendMessage="SendMessage",t.SendTyping="SendTyping",t.StartPolling="StartPolling",t.StopPolling="StopPolling",t.Disconnect="Disconnect"})(wt||(wt={}));function cJ(){return Rn(this,function(t){switch(t.label){case 0:return[5,iJ([1e3,1e3,2e3,3e3,5e3,8e3,1e4])];case 1:return t.sent(),[2]}})}var u3=function(){function t(e,n,r){r===void 0&&(r=null),this.logger=null,this.keepPolling=!1,this.pollingTimer=null,this.logger=r,this.tokenCredential=e,this.chatClient=n,this.eventListeners={}}return t.prototype.startPolling=function(){return $n(this,void 0,void 0,function(){var e,n;return Rn(this,function(r){return(e=this.logger)===null||e===void 0||e.startScenario(wt.StartPolling),this.keepPolling=!0,(n=this.logger)===null||n===void 0||n.completeScenario(wt.StartPolling),[2]})})},t.prototype.stopPolling=function(){return $n(this,void 0,void 0,function(){var e,n;return Rn(this,function(r){return(e=this.logger)===null||e===void 0||e.startScenario(wt.StopPolling),this.keepPolling=!1,(n=this.logger)===null||n===void 0||n.completeScenario(wt.StopPolling),[2]})})},t.prototype.initialize=function(e){return $n(this,void 0,void 0,function(){var n,r,o,i,o,s,l,c,a,u;return Rn(this,function(d){switch(d.label){case 0:(s=this.logger)===null||s===void 0||s.startScenario(wt.InitializeACSConversation),this.sessionInfo=e,d.label=1;case 1:return d.trys.push([1,3,,4]),n=this,[4,(l=this.chatClient)===null||l===void 0?void 0:l.getChatThreadClient(e.threadId)];case 2:return n.chatThreadClient=d.sent(),[3,4];case 3:throw r=d.sent(),o={response:"ChatClientGetChatThreadClientFailure",errorObject:"".concat(r)},(c=this.logger)===null||c===void 0||c.failScenario(wt.InitializeACSConversation,{ExceptionDetails:JSON.stringify(o)}),new Error(JSON.stringify(o));case 4:return d.trys.push([4,6,,7]),[4,this.chatClient.startRealtimeNotifications()];case 5:return d.sent(),[3,7];case 6:throw i=d.sent(),o={response:"StartRealtimeNotificationsFailed",errorObject:"".concat(i)},(a=this.logger)===null||a===void 0||a.failScenario(wt.InitializeACSConversation,{ExceptionDetails:JSON.stringify(o)}),new Error(JSON.stringify(o));case 7:return(u=this.logger)===null||u===void 0||u.completeScenario(wt.InitializeACSConversation),[2]}})})},t.prototype.getMessages=function(){return $n(this,arguments,void 0,function(e){var n,r,i,o,s,l,c,a,u;return e===void 0&&(e={}),Rn(this,function(d){switch(d.label){case 0:(c=this.logger)===null||c===void 0||c.startScenario(wt.GetMessages),n=[],d.label=1;case 1:return d.trys.push([1,9,,10]),[4,this.chatThreadClient.listMessages()];case 2:return r=d.sent(),[4,r.next()];case 3:i=d.sent(),d.label=4;case 4:return i.done?[3,8]:(o=i.value,o.type===aJ.default.Text?[3,6]:[4,r.next()]);case 5:return i=d.sent(),[3,4];case 6:return(e==null?void 0:e.skipConversion)===!0?n.push(o):n.push((0,QO.default)(o,{liveChatVersion:WO.default.V2})),[4,r.next()];case 7:return i=d.sent(),[3,4];case 8:return(a=this.logger)===null||a===void 0||a.completeScenario(wt.GetMessages),[3,10];case 9:throw s=d.sent(),l={errorObject:"".concat(s)},(u=this.logger)===null||u===void 0||u.failScenario(wt.GetMessages,{ExceptionDetails:JSON.stringify(l)}),new Error(wt.GetMessages);case 10:return[2,((e==null?void 0:e.skipConversion)===!0,n)]}})})},t.prototype.getParticipants=function(){return $n(this,void 0,void 0,function(){var e,n,r,i,o,s,l,c,a;return Rn(this,function(u){switch(u.label){case 0:(l=this.logger)===null||l===void 0||l.startScenario(wt.GetParticipants),e=[],u.label=1;case 1:return u.trys.push([1,7,,8]),[4,this.chatThreadClient.listParticipants()];case 2:return n=u.sent(),[4,n.next()];case 3:r=u.sent(),u.label=4;case 4:return r.done?[3,6]:(i=r.value,e.push(i),[4,n.next()]);case 5:return r=u.sent(),[3,4];case 6:return(c=this.logger)===null||c===void 0||c.completeScenario(wt.GetParticipants),[3,8];case 7:throw o=u.sent(),s={errorObject:"".concat(o)},(a=this.logger)===null||a===void 0||a.failScenario(wt.GetParticipants,{ExceptionDetails:JSON.stringify(s)}),new Error(wt.GetParticipants);case 8:return[2,e]}})})},t.prototype.registerOnNewMessage=function(e){return $n(this,arguments,void 0,function(n,r){var i,o,s,l,c,a,u=this,d,f,h,g,E;return r===void 0&&(r={disablePolling:!1}),Rn(this,function(D){switch(D.label){case 0:(d=this.logger)===null||d===void 0||d.startScenario(wt.RegisterOnNewMessage),i=new Set,D.label=1;case 1:return D.trys.push([1,5,,6]),o=function(w){return $n(u,void 0,void 0,function(){var p,b,j,K,M,ne,G,oe,J,X,B;return Rn(this,function(q){switch(q.label){case 0:if(!this.keepPolling)return[3,4];q.label=1;case 1:return q.trys.push([1,3,,4]),[4,this.getMessages({skipConversion:!0})];case 2:for(p=q.sent(),b=0,j=p.reverse();b<j.length;b++){K=j[b];try{if(M=K,ne=M.id,G=M.senderDisplayName,oe=G===GO.default.Customer,oe)continue;i.has(ne)||((B=this.logger)===null||B===void 0||B.recordIndividualEvent(JO.default.MessageReceived,KO.MessageSource.Polling,fg.MessagePrinterFactory.printifyMessage(K,fg.PrinterType.Polling)),n(K),i.add(ne))}catch{console.warn("[ACSClient][registerOnNewMessage] Error occurred while processing messages")}}return[3,4];case 3:return q.sent(),[3,4];case 4:return J=r.pollingInterval||1e4,X=w.next(),this.pollingTimer=setTimeout(function(){o(w)},X.done===!0?J:X.value),[2]}})})},[4,this.startPolling()];case 2:return D.sent(),r.disablePolling!==!1?[3,4]:(s=cJ(),[4,o(s)]);case 3:D.sent(),D.label=4;case 4:return l=function(w){var p,b,j=w.id,K=w.sender,M=K.communicationUserId===((p=u.sessionInfo)===null||p===void 0?void 0:p.id),ne=Object.keys(w).includes("editedOn");M||i.has(j)&&!ne||(n(w),i.add(j),(b=u.logger)===null||b===void 0||b.recordIndividualEvent(JO.default.MessageReceived,KO.MessageSource.WebSocket,fg.MessagePrinterFactory.printifyMessage(w,fg.PrinterType.WebSocket)))},(f=this.chatClient)===null||f===void 0||f.on("chatMessageReceived",l),(h=this.chatClient)===null||h===void 0||h.on("chatMessageEdited",l),this.trackListener("chatMessageReceived",l),this.trackListener("chatMessageEdited",l),(g=this.logger)===null||g===void 0||g.completeScenario(wt.RegisterOnNewMessage),[3,6];case 5:throw c=D.sent(),a={errorObject:"".concat(c)},(E=this.logger)===null||E===void 0||E.failScenario(wt.RegisterOnNewMessage,{ExceptionDetails:JSON.stringify(a)}),new Error(wt.RegisterOnNewMessage);case 6:return[2]}})})},t.prototype.registerOnThreadUpdate=function(e){return $n(this,void 0,void 0,function(){var n,r,i,o,s;return Rn(this,function(l){(r=this.logger)===null||r===void 0||r.startScenario(wt.RegisterOnThreadUpdate);try{n=function(c){e(c)},(i=this.chatClient)===null||i===void 0||i.on("participantsRemoved",n),this.trackListener("participantsRemoved",n),(o=this.logger)===null||o===void 0||o.completeScenario(wt.RegisterOnThreadUpdate)}catch{(s=this.logger)===null||s===void 0||s.failScenario(wt.RegisterOnThreadUpdate)}return[2]})})},t.prototype.onTypingEvent=function(e){return $n(this,void 0,void 0,function(){var n,r,i,o,s;return Rn(this,function(l){(r=this.logger)===null||r===void 0||r.startScenario(wt.OnTypingEvent);try{n=function(c){var a=c.sender,u=c.recipient;a.communicationUserId!==u.communicationUserId&&e(c)},(i=this.chatClient)===null||i===void 0||i.on("typingIndicatorReceived",n),this.trackListener("typingIndicatorReceived",n),(o=this.logger)===null||o===void 0||o.completeScenario(wt.OnTypingEvent)}catch{(s=this.logger)===null||s===void 0||s.failScenario(wt.OnTypingEvent)}return[2]})})},t.prototype.sendMessage=function(e){return $n(this,void 0,void 0,function(){var n,r,i,o,s,l,c,a,u,d,f;return Rn(this,function(h){switch(h.label){case 0:(c=this.logger)===null||c===void 0||c.startScenario(wt.SendMessage),e.metadata||(e.metadata={}),n={content:e.content},r={senderDisplayName:GO.default.Customer,metadata:QE({deliveryMode:lJ.default.Bridged,tags:XO.defaultMessageTags.join(",")},e.metadata)},h.label=1;case 1:return h.trys.push([1,3,,4]),[4,(a=this.chatThreadClient)===null||a===void 0?void 0:a.sendMessage(n,r)];case 2:return i=h.sent(),(u=this.logger)===null||u===void 0||u.completeScenario(wt.SendMessage),i!=null&&i.id?(o={id:i==null?void 0:i.id,content:e.content,sender:{communicationUserId:(d=this.sessionInfo)===null||d===void 0?void 0:d.id},displayName:r.senderDisplayName,metadata:{tags:XO.defaultMessageTags.join(",")},createdOn:new Date(parseInt(i==null?void 0:i.id))||(i==null?void 0:i.id)},[2,(0,QO.default)(o,{liveChatVersion:WO.default.V2})]):[3,4];case 3:throw s=h.sent(),l={response:"SendMessageFailed",errorObject:"".concat(s)},(f=this.logger)===null||f===void 0||f.failScenario(wt.SendMessage,{ExceptionDetails:JSON.stringify(l)}),s;case 4:return[2,{}]}})})},t.prototype.sendTyping=function(){return $n(this,void 0,void 0,function(){var e,n,r,i,o,s;return Rn(this,function(l){switch(l.label){case 0:(r=this.logger)===null||r===void 0||r.startScenario(wt.SendTyping),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,(i=this.chatThreadClient)===null||i===void 0?void 0:i.sendTypingNotification()];case 2:return l.sent(),(o=this.logger)===null||o===void 0||o.completeScenario(wt.SendTyping),[3,4];case 3:throw e=l.sent(),n={response:"SendTypingFailed",errorObject:"".concat(e)},(s=this.logger)===null||s===void 0||s.failScenario(wt.SendTyping,{ExceptionDetails:JSON.stringify(n)}),new Error("SendTypingFailed");case 4:return[2]}})})},t.prototype.sendFileMessage=function(){return $n(this,void 0,void 0,function(){return Rn(this,function(e){return[2,void 0]})})},t.prototype.sendFileData=function(){return $n(this,void 0,void 0,function(){return Rn(this,function(e){return[2,void 0]})})},t.prototype.uploadFile=function(){return $n(this,void 0,void 0,function(){return Rn(this,function(e){return[2,void 0]})})},t.prototype.downloadFile=function(){return $n(this,void 0,void 0,function(){return Rn(this,function(e){return[2,void 0]})})},t.prototype.disconnect=function(){return $n(this,void 0,void 0,function(){var e,n,r,i,o,s,l=this,c,a,u;return Rn(this,function(d){switch(d.label){case 0:(c=this.logger)===null||c===void 0||c.startScenario(wt.Disconnect),d.label=1;case 1:for(d.trys.push([1,3,,4]),e=function(f,h){h.forEach(function(g){l.chatClient.off(f,g)})},n=0,r=Object.entries(this.eventListeners);n<r.length;n++)i=r[n],o=i[0],s=i[1],e(o,s);return[4,this.stopPolling()];case 2:return d.sent(),this.pollingTimer&&clearTimeout(this.pollingTimer),(a=this.logger)===null||a===void 0||a.completeScenario(wt.Disconnect),[3,4];case 3:return d.sent(),(u=this.logger)===null||u===void 0||u.failScenario(wt.Disconnect),[3,4];case 4:return[2]}})})},t.prototype.createParticipantsMapping=function(){return $n(this,void 0,void 0,function(){var e,n,r,i,o,s,l;return Rn(this,function(c){switch(c.label){case 0:return[4,this.getParticipants()];case 1:for(e=c.sent(),n={},r=0,i=e;r<i.length;r++)o=i[r],s=o.id,Object.keys(n).includes(s.communicationUserId)||Object.assign(n,(l={},l[s.communicationUserId]=o,l));return[2,n]}})})},t.prototype.trackListener=function(e,n){e in this.eventListeners||(this.eventListeners[e]=[]),this.eventListeners[e].push(n)},t}();kf.ACSConversation=u3;var uJ=function(){function t(e){e===void 0&&(e=null),this.logger=null,this.tokenCredential=null,this.chatClient=null,this.logger=e}return t.prototype.initialize=function(e){return $n(this,void 0,void 0,function(){var n,r,r,i=this,o,s,l,c;return Rn(this,function(a){(o=this.logger)===null||o===void 0||o.startScenario(wt.InitializeACSClient),n=function(){return $n(i,void 0,void 0,function(){var u;return Rn(this,function(d){switch(d.label){case 0:return e.tokenRefresher?[4,e.tokenRefresher()]:[3,2];case 1:return u=d.sent(),[2,u];case 2:return[2,e.token]}})})};try{this.tokenCredential=new oJ.AzureCommunicationTokenCredential({token:e.token,tokenRefresher:n,refreshProactively:!0})}catch(u){throw r={response:"CreateTokenCredentialFailure",errorObject:"".concat(u)},(s=this.logger)===null||s===void 0||s.failScenario(wt.InitializeACSClient,{ExceptionDetails:JSON.stringify(r)}),new Error(JSON.stringify(r))}try{this.chatClient=new sJ.ChatClient(e.environmentUrl,this.tokenCredential)}catch(u){throw r={response:"CreateChatClientFailure",errorObject:"".concat(u)},(l=this.logger)===null||l===void 0||l.failScenario(wt.InitializeACSClient,{ExceptionDetails:JSON.stringify(r)}),new Error(JSON.stringify(r))}return(c=this.logger)===null||c===void 0||c.completeScenario(wt.InitializeACSClient),[2]})})},t.prototype.joinConversation=function(e){return $n(this,void 0,void 0,function(){var n;return Rn(this,function(r){switch(r.label){case 0:return n=new u3(this.tokenCredential,this.chatClient,this.logger),[4,n.initialize(e)];case 1:return r.sent(),[2,n]}})})},t.prototype.getChatClient=function(){return this.chatClient},t}();kf.default=uJ;var Ms={},Uo={},Yb={};Object.defineProperty(Yb,"__esModule",{value:!0});var dJ=function(t){return new Promise(function(e){return setTimeout(e,t)})};Yb.default=dJ;var pg=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},gg=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},hJ=_e&&_e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Uo,"__esModule",{value:!0});Uo.sleep=Uo.removeElementById=Uo.loadScript=void 0;var Zb=Yb;Uo.sleep=Zb.default;var fJ=3,pJ=60,e_=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return pg(void 0,hJ([t],e,!0),void 0,function(r,i,o,s,l){return i===void 0&&(i=function(){}),o===void 0&&(o=function(){}),s===void 0&&(s=fJ),l===void 0&&(l=0),gg(this,function(c){return[2,new Promise(function(a,u){return pg(void 0,void 0,void 0,function(){var d,f,h;return gg(this,function(g){switch(g.label){case 0:return d=Array.from(document.getElementsByTagName("script")),f=d.filter(function(E){return E.src==r}),f.length?[4,i()]:[3,2];case 1:return g.sent(),[2,a()];case 2:return h=document.createElement("script"),h.setAttribute("src",r),h.setAttribute("type","text/javascript"),document.head.appendChild(h),h.addEventListener("load",function(){return pg(void 0,void 0,void 0,function(){return gg(this,function(E){switch(E.label){case 0:return[4,i()];case 1:return E.sent(),a(),[2]}})})}),h.addEventListener("error",function(){return pg(void 0,void 0,void 0,function(){var E,D;return gg(this,function(w){switch(w.label){case 0:return++l>=s?[4,o()]:[3,2];case 1:return w.sent(),[2,u(new Error("Resource failed to load, or can't be used."))];case 2:return h.remove(),E=Math.min(Math.pow(2,l)+Math.random(),pJ)*1e3,[4,(0,Zb.default)(E)];case 3:w.sent(),w.label=4;case 4:return w.trys.push([4,6,,7]),[4,e_(r,i,o,s,l)];case 5:return w.sent(),[3,7];case 6:return D=w.sent(),u(D),[3,7];case 7:return[2]}})})}),[2]}})})})]})})};Uo.loadScript=e_;var d3=function(t){var e;(e=document.getElementById(t))===null||e===void 0||e.remove()};Uo.removeElementById=d3;Uo.default={loadScript:e_,removeElementById:d3,sleep:Zb.default};var t_={};Object.defineProperty(t_,"__esModule",{value:!0});var mg=hy,gJ=hr,mJ=function(t){var e=function(){return function(n){return function(r){var i=r&&r.channelData;return i&&(r.channelData.tags||(r.channelData.tags=[]),r.channelData.tags.includes(mg.channelIdTag)||r.channelData.tags.push(mg.channelIdTag),r.channelData.tags.includes(mg.customerMessageTag)||r.channelData.tags.push(mg.customerMessageTag),r.channelData.metadata||(r.channelData.metadata={}),r.channelData.metadata.deliveryMode||(r.channelData.metadata.deliveryMode=gJ.DeliveryMode.Bridged),t.widgetId&&(r.channelData.metadata.widgetId=t.widgetId)),n(r)}}};return e};t_.default=mJ;var er;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSED=2]="CLOSED"})(er||(er={}));var YO=function(){return Math.random().toString(36).substring(7).split("").join(".")};""+YO(),""+YO();function fy(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===0?function(r){return r}:e.length===1?e[0]:e.reduce(function(r,i){return function(){return r(i.apply(void 0,arguments))}})}function vJ(t){return{close:(...e)=>t.close(...e),egress:(...e)=>t.egress(...e),getReadyState:(...e)=>t.getReadyState(...e),getState:e=>t.getState(e),ingress:(...e)=>t.ingress(...e),setReadyState:(...e)=>t.setReadyState(...e),setState:(e,n)=>t.setState(e,n),subscribe:(...e)=>t.subscribe(...e)}}function n_(t,e){return(...n)=>r=>i=>{const o=r(i);if(Object.getPrototypeOf(o)!==Object.prototype)throw new Error("One of the enhancer is returning the adapter as a class object. This is not supported.");let s=()=>{throw new Error("Calling function while constructing your middleware is not allowed. Other middleware would not be applied to this function.")};const l=(...u)=>s(...u),c=e(vJ(o),l),a=n.map(u=>u(c));if(a.some(u=>typeof u!="function"))throw new Error("All middlewares must return a function after caling with middleware API.");return s=fy(...a)(t(o)),Object.assign(Object.assign({},o),e(o,s))}}function yJ(...t){return n_(e=>e.egress,(e,n)=>Object.assign(Object.assign({},e),{egress:n}))(...t)}function CJ(...t){return n_(e=>e.ingress,(e,n)=>Object.assign(Object.assign({},e),{ingress:n}))(...t)}function SJ(...t){return n_(e=>e.setState,(e,n)=>Object.assign(Object.assign({},e),{setState:n}))(...t)}var zd=function(t){return t&&t.Math===Math&&t},Xt=zd(typeof globalThis=="object"&&globalThis)||zd(typeof window=="object"&&window)||zd(typeof self=="object"&&self)||zd(typeof _e=="object"&&_e)||zd(typeof _e=="object"&&_e)||function(){return this}()||Function("return this")(),td={},Sr=function(t){try{return!!t()}catch{return!0}},TJ=Sr,vi=!TJ(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),EJ=Sr,py=!EJ(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),wJ=py,vg=Function.prototype.call,zt=wJ?vg.bind(vg):function(){return vg.apply(vg,arguments)},r_={},h3={}.propertyIsEnumerable,f3=Object.getOwnPropertyDescriptor,IJ=f3&&!h3.call({1:2},1);r_.f=IJ?function(e){var n=f3(this,e);return!!n&&n.enumerable}:h3;var Uf=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},p3=py,g3=Function.prototype,XE=g3.call,bJ=p3&&g3.bind.bind(XE,XE),Nn=p3?bJ:function(t){return function(){return XE.apply(t,arguments)}},m3=Nn,_J=m3({}.toString),AJ=m3("".slice),rc=function(t){return AJ(_J(t),8,-1)},RJ=Nn,kJ=Sr,PJ=rc,Q0=Object,OJ=RJ("".split),v3=kJ(function(){return!Q0("z").propertyIsEnumerable(0)})?function(t){return PJ(t)==="String"?OJ(t,""):Q0(t)}:Q0,Ff=function(t){return t==null},MJ=Ff,DJ=TypeError,gy=function(t){if(MJ(t))throw new DJ("Can't call method on "+t);return t},NJ=v3,xJ=gy,ic=function(t){return NJ(xJ(t))},X0=typeof document=="object"&&document.all,fn=typeof X0>"u"&&X0!==void 0?function(t){return typeof t=="function"||t===X0}:function(t){return typeof t=="function"},LJ=fn,nr=function(t){return typeof t=="object"?t!==null:LJ(t)},Y0=Xt,UJ=fn,FJ=function(t){return UJ(t)?t:void 0},xn=function(t,e){return arguments.length<2?FJ(Y0[t]):Y0[t]&&Y0[t][e]},BJ=Nn,nd=BJ({}.isPrototypeOf),$J=Xt,ZO=$J.navigator,e1=ZO&&ZO.userAgent,Bf=e1?String(e1):"",y3=Xt,Z0=Bf,t1=y3.process,n1=y3.Deno,r1=t1&&t1.versions||n1&&n1.version,i1=r1&&r1.v8,ko,cv;i1&&(ko=i1.split("."),cv=ko[0]>0&&ko[0]<4?1:+(ko[0]+ko[1]));!cv&&Z0&&(ko=Z0.match(/Edge\/(\d+)/),(!ko||ko[1]>=74)&&(ko=Z0.match(/Chrome\/(\d+)/),ko&&(cv=+ko[1])));var my=cv,o1=my,HJ=Sr,qJ=Xt,jJ=qJ.String,rd=!!Object.getOwnPropertySymbols&&!HJ(function(){var t=Symbol("symbol detection");return!jJ(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&o1&&o1<41}),VJ=rd,C3=VJ&&!Symbol.sham&&typeof Symbol.iterator=="symbol",zJ=xn,GJ=fn,WJ=nd,KJ=C3,JJ=Object,$f=KJ?function(t){return typeof t=="symbol"}:function(t){var e=zJ("Symbol");return GJ(e)&&WJ(e.prototype,JJ(t))},QJ=String,Hf=function(t){try{return QJ(t)}catch{return"Object"}},XJ=fn,YJ=Hf,ZJ=TypeError,Di=function(t){if(XJ(t))return t;throw new ZJ(YJ(t)+" is not a function")},e7=Di,t7=Ff,hs=function(t,e){var n=t[e];return t7(n)?void 0:e7(n)},eS=zt,tS=fn,nS=nr,n7=TypeError,r7=function(t,e){var n,r;if(e==="string"&&tS(n=t.toString)&&!nS(r=eS(n,t))||tS(n=t.valueOf)&&!nS(r=eS(n,t))||e!=="string"&&tS(n=t.toString)&&!nS(r=eS(n,t)))return r;throw new n7("Can't convert object to primitive value")},S3={exports:{}},i7=!1,s1=Xt,o7=Object.defineProperty,i_=function(t,e){try{o7(s1,t,{value:e,configurable:!0,writable:!0})}catch{s1[t]=e}return e},s7=Xt,a7=i_,a1="__core-js_shared__",l1=S3.exports=s7[a1]||a7(a1,{});(l1.versions||(l1.versions=[])).push({version:"3.47.0",mode:"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"});var vy=S3.exports,c1=vy,id=function(t,e){return c1[t]||(c1[t]=e||{})},l7=gy,c7=Object,od=function(t){return c7(l7(t))},u7=Nn,d7=od,h7=u7({}.hasOwnProperty),Tr=Object.hasOwn||function(e,n){return h7(d7(e),n)},f7=Nn,p7=0,g7=Math.random(),m7=f7(1.1.toString),yy=function(t){return"Symbol("+(t===void 0?"":t)+")_"+m7(++p7+g7,36)},v7=Xt,y7=id,u1=Tr,C7=yy,S7=rd,T7=C3,Zc=v7.Symbol,rS=y7("wks"),E7=T7?Zc.for||Zc:Zc&&Zc.withoutSetter||C7,Gt=function(t){return u1(rS,t)||(rS[t]=S7&&u1(Zc,t)?Zc[t]:E7("Symbol."+t)),rS[t]},w7=zt,d1=nr,h1=$f,I7=hs,b7=r7,_7=Gt,A7=TypeError,R7=_7("toPrimitive"),k7=function(t,e){if(!d1(t)||h1(t))return t;var n=I7(t,R7),r;if(n){if(e===void 0&&(e="default"),r=w7(n,t,e),!d1(r)||h1(r))return r;throw new A7("Can't convert object to primitive value")}return e===void 0&&(e="number"),b7(t,e)},P7=k7,O7=$f,o_=function(t){var e=P7(t,"string");return O7(e)?e:e+""},M7=Xt,f1=nr,YE=M7.document,D7=f1(YE)&&f1(YE.createElement),Cy=function(t){return D7?YE.createElement(t):{}},N7=vi,x7=Sr,L7=Cy,T3=!N7&&!x7(function(){return Object.defineProperty(L7("div"),"a",{get:function(){return 7}}).a!==7}),U7=vi,F7=zt,B7=r_,$7=Uf,H7=ic,q7=o_,j7=Tr,V7=T3,p1=Object.getOwnPropertyDescriptor;td.f=U7?p1:function(e,n){if(e=H7(e),n=q7(n),V7)try{return p1(e,n)}catch{}if(j7(e,n))return $7(!F7(B7.f,e,n),e[n])};var yi={},z7=vi,G7=Sr,E3=z7&&G7(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),W7=nr,K7=String,J7=TypeError,bn=function(t){if(W7(t))return t;throw new J7(K7(t)+" is not an object")},Q7=vi,X7=T3,Y7=E3,yg=bn,g1=o_,Z7=TypeError,iS=Object.defineProperty,eQ=Object.getOwnPropertyDescriptor,oS="enumerable",sS="configurable",aS="writable";yi.f=Q7?Y7?function(e,n,r){if(yg(e),n=g1(n),yg(r),typeof e=="function"&&n==="prototype"&&"value"in r&&aS in r&&!r[aS]){var i=eQ(e,n);i&&i[aS]&&(e[n]=r.value,r={configurable:sS in r?r[sS]:i[sS],enumerable:oS in r?r[oS]:i[oS],writable:!1})}return iS(e,n,r)}:iS:function(e,n,r){if(yg(e),n=g1(n),yg(r),X7)try{return iS(e,n,r)}catch{}if("get"in r||"set"in r)throw new Z7("Accessors not supported");return"value"in r&&(e[n]=r.value),e};var tQ=vi,nQ=yi,rQ=Uf,sd=tQ?function(t,e,n){return nQ.f(t,e,rQ(1,n))}:function(t,e,n){return t[e]=n,t},w3={exports:{}},ZE=vi,iQ=Tr,I3=Function.prototype,oQ=ZE&&Object.getOwnPropertyDescriptor,b3=iQ(I3,"name"),sQ=b3&&(function(){}).name==="something",aQ=b3&&(!ZE||ZE&&oQ(I3,"name").configurable),_3={PROPER:sQ,CONFIGURABLE:aQ},lQ=Nn,cQ=fn,ew=vy,uQ=lQ(Function.toString);cQ(ew.inspectSource)||(ew.inspectSource=function(t){return uQ(t)});var s_=ew.inspectSource,dQ=Xt,hQ=fn,m1=dQ.WeakMap,fQ=hQ(m1)&&/native code/.test(String(m1)),pQ=id,gQ=yy,v1=pQ("keys"),Sy=function(t){return v1[t]||(v1[t]=gQ(t))},Ty={},mQ=fQ,A3=Xt,vQ=nr,yQ=sd,lS=Tr,cS=vy,CQ=Sy,SQ=Ty,y1="Object already initialized",tw=A3.TypeError,TQ=A3.WeakMap,uv,af,dv,EQ=function(t){return dv(t)?af(t):uv(t,{})},wQ=function(t){return function(e){var n;if(!vQ(e)||(n=af(e)).type!==t)throw new tw("Incompatible receiver, "+t+" required");return n}};if(mQ||cS.state){var es=cS.state||(cS.state=new TQ);es.get=es.get,es.has=es.has,es.set=es.set,uv=function(t,e){if(es.has(t))throw new tw(y1);return e.facade=t,es.set(t,e),e},af=function(t){return es.get(t)||{}},dv=function(t){return es.has(t)}}else{var bc=CQ("state");SQ[bc]=!0,uv=function(t,e){if(lS(t,bc))throw new tw(y1);return e.facade=t,yQ(t,bc,e),e},af=function(t){return lS(t,bc)?t[bc]:{}},dv=function(t){return lS(t,bc)}}var zs={set:uv,get:af,has:dv,enforce:EQ,getterFor:wQ},a_=Nn,IQ=Sr,bQ=fn,Cg=Tr,nw=vi,_Q=_3.CONFIGURABLE,AQ=s_,R3=zs,RQ=R3.enforce,kQ=R3.get,C1=String,wm=Object.defineProperty,PQ=a_("".slice),OQ=a_("".replace),MQ=a_([].join),DQ=nw&&!IQ(function(){return wm(function(){},"length",{value:8}).length!==8}),NQ=String(String).split("String"),xQ=w3.exports=function(t,e,n){PQ(C1(e),0,7)==="Symbol("&&(e="["+OQ(C1(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Cg(t,"name")||_Q&&t.name!==e)&&(nw?wm(t,"name",{value:e,configurable:!0}):t.name=e),DQ&&n&&Cg(n,"arity")&&t.length!==n.arity&&wm(t,"length",{value:n.arity});try{n&&Cg(n,"constructor")&&n.constructor?nw&&wm(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var r=RQ(t);return Cg(r,"source")||(r.source=MQ(NQ,typeof e=="string"?e:"")),t};Function.prototype.toString=xQ(function(){return bQ(this)&&kQ(this).source||AQ(this)},"toString");var k3=w3.exports,LQ=fn,UQ=yi,FQ=k3,BQ=i_,mo=function(t,e,n,r){r||(r={});var i=r.enumerable,o=r.name!==void 0?r.name:e;if(LQ(n)&&FQ(n,o,r),r.global)i?t[e]=n:BQ(e,n);else{try{r.unsafe?t[e]&&(i=!0):delete t[e]}catch{}i?t[e]=n:UQ.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},Ey={},$Q=Math.ceil,HQ=Math.floor,qQ=Math.trunc||function(e){var n=+e;return(n>0?HQ:$Q)(n)},jQ=qQ,wy=function(t){var e=+t;return e!==e||e===0?0:jQ(e)},VQ=wy,zQ=Math.max,GQ=Math.min,WQ=function(t,e){var n=VQ(t);return n<0?zQ(n+e,0):GQ(n,e)},KQ=wy,JQ=Math.min,QQ=function(t){var e=KQ(t);return e>0?JQ(e,9007199254740991):0},XQ=QQ,Iy=function(t){return XQ(t.length)},YQ=ic,ZQ=WQ,eX=Iy,tX=function(t){return function(e,n,r){var i=YQ(e),o=eX(i);if(o===0)return!t&&-1;var s=ZQ(r,o),l;if(t&&n!==n){for(;o>s;)if(l=i[s++],l!==l)return!0}else for(;o>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},nX={indexOf:tX(!1)},rX=Nn,uS=Tr,iX=ic,oX=nX.indexOf,sX=Ty,S1=rX([].push),P3=function(t,e){var n=iX(t),r=0,i=[],o;for(o in n)!uS(sX,o)&&uS(n,o)&&S1(i,o);for(;e.length>r;)uS(n,o=e[r++])&&(~oX(i,o)||S1(i,o));return i},l_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],aX=P3,lX=l_,cX=lX.concat("length","prototype");Ey.f=Object.getOwnPropertyNames||function(e){return aX(e,cX)};var by={};by.f=Object.getOwnPropertySymbols;var uX=xn,dX=Nn,hX=Ey,fX=by,pX=bn,gX=dX([].concat),mX=uX("Reflect","ownKeys")||function(e){var n=hX.f(pX(e)),r=fX.f;return r?gX(n,r(e)):n},T1=Tr,vX=mX,yX=td,CX=yi,O3=function(t,e,n){for(var r=vX(e),i=CX.f,o=yX.f,s=0;s<r.length;s++){var l=r[s];!T1(t,l)&&!(n&&T1(n,l))&&i(t,l,o(e,l))}},SX=Sr,TX=fn,EX=/#|\.prototype\./,qf=function(t,e){var n=IX[wX(t)];return n===_X?!0:n===bX?!1:TX(e)?SX(e):!!e},wX=qf.normalize=function(t){return String(t).replace(EX,".").toLowerCase()},IX=qf.data={},bX=qf.NATIVE="N",_X=qf.POLYFILL="P",M3=qf,Sg=Xt,AX=td.f,RX=sd,kX=mo,PX=i_,OX=O3,MX=M3,Rt=function(t,e){var n=t.target,r=t.global,i=t.stat,o,s,l,c,a,u;if(r?s=Sg:i?s=Sg[n]||PX(n,{}):s=Sg[n]&&Sg[n].prototype,s)for(l in e){if(a=e[l],t.dontCallGetSet?(u=AX(s,l),c=u&&u.value):c=s[l],o=MX(r?l:n+(i?".":"#")+l,t.forced),!o&&c!==void 0){if(typeof a==typeof c)continue;OX(a,c)}(t.sham||c&&c.sham)&&RX(a,"sham",!0),kX(s,l,a,t)}},DX=rc,c_=Array.isArray||function(e){return DX(e)==="Array"},NX=TypeError,xX=9007199254740991,D3=function(t){if(t>xX)throw NX("Maximum allowed index exceeded");return t},LX=vi,UX=yi,FX=Uf,BX=function(t,e,n){LX?UX.f(t,e,FX(0,n)):t[e]=n},$X=Gt,HX=$X("toStringTag"),N3={};N3[HX]="z";var u_=String(N3)==="[object z]",qX=u_,jX=fn,Im=rc,VX=Gt,zX=VX("toStringTag"),GX=Object,WX=Im(function(){return arguments}())==="Arguments",KX=function(t,e){try{return t[e]}catch{}},_y=qX?Im:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=KX(e=GX(t),zX))=="string"?n:WX?Im(e):(r=Im(e))==="Object"&&jX(e.callee)?"Arguments":r},JX=Nn,QX=Sr,x3=fn,XX=_y,YX=xn,ZX=s_,L3=function(){},U3=YX("Reflect","construct"),d_=/^\s*(?:class|function)\b/,eY=JX(d_.exec),tY=!d_.test(L3),Gd=function(e){if(!x3(e))return!1;try{return U3(L3,[],e),!0}catch{return!1}},F3=function(e){if(!x3(e))return!1;switch(XX(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return tY||!!eY(d_,ZX(e))}catch{return!0}};F3.sham=!0;var Ay=!U3||QX(function(){var t;return Gd(Gd.call)||!Gd(Object)||!Gd(function(){t=!0})||t})?F3:Gd,E1=c_,nY=Ay,rY=nr,iY=Gt,oY=iY("species"),w1=Array,sY=function(t){var e;return E1(t)&&(e=t.constructor,nY(e)&&(e===w1||E1(e.prototype))?e=void 0:rY(e)&&(e=e[oY],e===null&&(e=void 0))),e===void 0?w1:e},aY=sY,B3=function(t,e){return new(aY(t))(e===0?0:e)},lY=Sr,cY=Gt,uY=my,dY=cY("species"),hY=function(t){return uY>=51||!lY(function(){var e=[],n=e.constructor={};return n[dY]=function(){return{foo:1}},e[t](Boolean).foo!==1})},fY=Rt,pY=Sr,gY=c_,mY=nr,vY=od,yY=Iy,I1=D3,b1=BX,CY=B3,SY=hY,TY=Gt,EY=my,$3=TY("isConcatSpreadable"),wY=EY>=51||!pY(function(){var t=[];return t[$3]=!1,t.concat()[0]!==t}),IY=function(t){if(!mY(t))return!1;var e=t[$3];return e!==void 0?!!e:gY(t)},bY=!wY||!SY("concat");fY({target:"Array",proto:!0,arity:1,forced:bY},{concat:function(e){var n=vY(this),r=CY(n,0),i=0,o,s,l,c,a;for(o=-1,l=arguments.length;o<l;o++)if(a=o===-1?n:arguments[o],IY(a))for(c=yY(a),I1(i+c),s=0;s<c;s++,i++)s in a&&b1(r,i,a[s]);else I1(i+1),b1(r,i++,a);return r.length=i,r}});var _Y=u_,AY=_y,RY=_Y?{}.toString:function(){return"[object "+AY(this)+"]"},kY=u_,PY=mo,OY=RY;kY||PY(Object.prototype,"toString",OY,{unsafe:!0});var MY=_y,DY=String,ad=function(t){if(MY(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return DY(t)},h_={},NY=P3,xY=l_,H3=Object.keys||function(e){return NY(e,xY)},LY=vi,UY=E3,FY=yi,BY=bn,$Y=ic,HY=H3;h_.f=LY&&!UY?Object.defineProperties:function(e,n){BY(e);for(var r=$Y(n),i=HY(n),o=i.length,s=0,l;o>s;)FY.f(e,l=i[s++],r[l]);return e};var qY=xn,q3=qY("document","documentElement"),jY=bn,VY=h_,_1=l_,zY=Ty,GY=q3,WY=Cy,KY=Sy,A1=">",R1="<",rw="prototype",iw="script",j3=KY("IE_PROTO"),dS=function(){},V3=function(t){return R1+iw+A1+t+R1+"/"+iw+A1},k1=function(t){t.write(V3("")),t.close();var e=t.parentWindow.Object;return t=null,e},JY=function(){var t=WY("iframe"),e="java"+iw+":",n;return t.style.display="none",GY.appendChild(t),t.src=String(e),n=t.contentWindow.document,n.open(),n.write(V3("document.F=Object")),n.close(),n.F},Tg,bm=function(){try{Tg=new ActiveXObject("htmlfile")}catch{}bm=typeof document<"u"?document.domain&&Tg?k1(Tg):JY():k1(Tg);for(var t=_1.length;t--;)delete bm[rw][_1[t]];return bm()};zY[j3]=!0;var jf=Object.create||function(e,n){var r;return e!==null?(dS[rw]=jY(e),r=new dS,dS[rw]=null,r[j3]=e):r=bm(),n===void 0?r:VY.f(r,n)},z3={},QY=Nn,f_=QY([].slice),XY=rc,YY=ic,G3=Ey.f,ZY=f_,W3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],eZ=function(t){try{return G3(t)}catch{return ZY(W3)}};z3.f=function(e){return W3&&XY(e)==="Window"?eZ(e):G3(YY(e))};var P1=k3,tZ=yi,Ry=function(t,e,n){return n.get&&P1(n.get,e,{getter:!0}),n.set&&P1(n.set,e,{setter:!0}),tZ.f(t,e,n)},p_={},nZ=Gt;p_.f=nZ;var rZ=Xt,ld=rZ,O1=ld,iZ=Tr,oZ=p_,sZ=yi.f,Sn=function(t){var e=O1.Symbol||(O1.Symbol={});iZ(e,t)||sZ(e,t,{value:oZ.f(t)})},aZ=zt,lZ=xn,cZ=Gt,uZ=mo,K3=function(){var t=lZ("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,r=cZ("toPrimitive");e&&!e[r]&&uZ(e,r,function(i){return aZ(n,this)},{arity:1})},dZ=yi.f,hZ=Tr,fZ=Gt,M1=fZ("toStringTag"),Gs=function(t,e,n){t&&!n&&(t=t.prototype),t&&!hZ(t,M1)&&dZ(t,M1,{configurable:!0,value:e})},pZ=rc,gZ=Nn,mZ=function(t){if(pZ(t)==="Function")return gZ(t)},D1=mZ,vZ=Di,yZ=py,CZ=D1(D1.bind),ky=function(t,e){return vZ(t),e===void 0?t:yZ?CZ(t,e):function(){return t.apply(e,arguments)}},SZ=ky,TZ=Nn,EZ=v3,wZ=od,IZ=Iy,bZ=B3,N1=TZ([].push),_Z=function(t){var e=t===1,n=t===2,r=t===3,i=t===4,o=t===6,s=t===7,l=t===5||o;return function(c,a,u,d){for(var f=wZ(c),h=EZ(f),g=IZ(h),E=SZ(a,u),D=0,w=d||bZ,p=e?w(c,g):n||s?w(c,0):void 0,b,j;g>D;D++)if((l||D in h)&&(b=h[D],j=E(b,D,f),t))if(e)p[D]=j;else if(j)switch(t){case 3:return!0;case 5:return b;case 6:return D;case 2:N1(p,b)}else switch(t){case 4:return!1;case 7:N1(p,b)}return o?-1:r||i?i:p}},AZ={forEach:_Z(0)},Py=Rt,Vf=Xt,g_=zt,RZ=Nn,Ru=vi,ku=rd,kZ=Sr,gr=Tr,PZ=nd,ow=bn,Oy=ic,m_=o_,OZ=ad,sw=Uf,Pu=jf,J3=H3,MZ=Ey,Q3=z3,DZ=by,X3=td,Y3=yi,NZ=h_,Z3=r_,hS=mo,xZ=Ry,v_=id,LZ=Sy,eB=Ty,x1=yy,UZ=Gt,FZ=p_,BZ=Sn,$Z=K3,HZ=Gs,tB=zs,My=AZ.forEach,bi=LZ("hidden"),Dy="Symbol",lf="prototype",qZ=tB.set,L1=tB.getterFor(Dy),so=Object[lf],kl=Vf.Symbol,vh=kl&&kl[lf],jZ=Vf.RangeError,VZ=Vf.TypeError,fS=Vf.QObject,nB=X3.f,Pl=Y3.f,rB=Q3.f,zZ=Z3.f,iB=RZ([].push),Fs=v_("symbols"),zf=v_("op-symbols"),GZ=v_("wks"),aw=!fS||!fS[lf]||!fS[lf].findChild,oB=function(t,e,n){var r=nB(so,e);r&&delete so[e],Pl(t,e,n),r&&t!==so&&Pl(so,e,r)},lw=Ru&&kZ(function(){return Pu(Pl({},"a",{get:function(){return Pl(this,"a",{value:7}).a}})).a!==7})?oB:Pl,pS=function(t,e){var n=Fs[t]=Pu(vh);return qZ(n,{type:Dy,tag:t,description:e}),Ru||(n.description=e),n},Ny=function(e,n,r){e===so&&Ny(zf,n,r),ow(e);var i=m_(n);return ow(r),gr(Fs,i)?(r.enumerable?(gr(e,bi)&&e[bi][i]&&(e[bi][i]=!1),r=Pu(r,{enumerable:sw(0,!1)})):(gr(e,bi)||Pl(e,bi,sw(1,Pu(null))),e[bi][i]=!0),lw(e,i,r)):Pl(e,i,r)},y_=function(e,n){ow(e);var r=Oy(n),i=J3(r).concat(lB(r));return My(i,function(o){(!Ru||g_(cw,r,o))&&Ny(e,o,r[o])}),e},WZ=function(e,n){return n===void 0?Pu(e):y_(Pu(e),n)},cw=function(e){var n=m_(e),r=g_(zZ,this,n);return this===so&&gr(Fs,n)&&!gr(zf,n)?!1:r||!gr(this,n)||!gr(Fs,n)||gr(this,bi)&&this[bi][n]?r:!0},sB=function(e,n){var r=Oy(e),i=m_(n);if(!(r===so&&gr(Fs,i)&&!gr(zf,i))){var o=nB(r,i);return o&&gr(Fs,i)&&!(gr(r,bi)&&r[bi][i])&&(o.enumerable=!0),o}},aB=function(e){var n=rB(Oy(e)),r=[];return My(n,function(i){!gr(Fs,i)&&!gr(eB,i)&&iB(r,i)}),r},lB=function(t){var e=t===so,n=rB(e?zf:Oy(t)),r=[];return My(n,function(i){gr(Fs,i)&&(!e||gr(so,i))&&iB(r,Fs[i])}),r};ku||(kl=function(){if(PZ(vh,this))throw new VZ("Symbol is not a constructor");var e=!arguments.length||arguments[0]===void 0?void 0:OZ(arguments[0]),n=x1(e),r=function(i){var o=this===void 0?Vf:this;o===so&&g_(r,zf,i),gr(o,bi)&&gr(o[bi],n)&&(o[bi][n]=!1);var s=sw(1,i);try{lw(o,n,s)}catch(l){if(!(l instanceof jZ))throw l;oB(o,n,s)}};return Ru&&aw&&lw(so,n,{configurable:!0,set:r}),pS(n,e)},vh=kl[lf],hS(vh,"toString",function(){return L1(this).tag}),hS(kl,"withoutSetter",function(t){return pS(x1(t),t)}),Z3.f=cw,Y3.f=Ny,NZ.f=y_,X3.f=sB,MZ.f=Q3.f=aB,DZ.f=lB,FZ.f=function(t){return pS(UZ(t),t)},Ru&&(xZ(vh,"description",{configurable:!0,get:function(){return L1(this).description}}),hS(so,"propertyIsEnumerable",cw,{unsafe:!0})));Py({global:!0,constructor:!0,wrap:!0,forced:!ku,sham:!ku},{Symbol:kl});My(J3(GZ),function(t){BZ(t)});Py({target:Dy,stat:!0,forced:!ku},{useSetter:function(){aw=!0},useSimple:function(){aw=!1}});Py({target:"Object",stat:!0,forced:!ku,sham:!Ru},{create:WZ,defineProperty:Ny,defineProperties:y_,getOwnPropertyDescriptor:sB});Py({target:"Object",stat:!0,forced:!ku},{getOwnPropertyNames:aB});$Z();HZ(kl,Dy);eB[bi]=!0;var KZ=rd,cB=KZ&&!!Symbol.for&&!!Symbol.keyFor,JZ=Rt,QZ=xn,XZ=Tr,YZ=ad,uB=id,ZZ=cB,gS=uB("string-to-symbol-registry"),eee=uB("symbol-to-string-registry");JZ({target:"Symbol",stat:!0,forced:!ZZ},{for:function(t){var e=YZ(t);if(XZ(gS,e))return gS[e];var n=QZ("Symbol")(e);return gS[e]=n,eee[n]=e,n}});var tee=Rt,nee=Tr,ree=$f,iee=Hf,oee=id,see=cB,U1=oee("symbol-to-string-registry");tee({target:"Symbol",stat:!0,forced:!see},{keyFor:function(e){if(!ree(e))throw new TypeError(iee(e)+" is not a symbol");if(nee(U1,e))return U1[e]}});var aee=py,dB=Function.prototype,F1=dB.apply,B1=dB.call,hB=typeof Reflect=="object"&&Reflect.apply||(aee?B1.bind(F1):function(){return B1.apply(F1,arguments)}),lee=nr,cee=zs.get,uee=function(e){if(!lee(e))return!1;var n=cee(e);return!!n&&n.type==="RawJSON"},C_=Nn,dee=Tr,Eg=SyntaxError,hee=parseInt,fee=String.fromCharCode,pee=C_("".charAt),$1=C_("".slice),H1=C_(/./.exec),q1={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},gee=/^[\da-f]{4}$/i,mee=/^[\u0000-\u001F]$/,vee=function(t,e){for(var n=!0,r="";e<t.length;){var i=pee(t,e);if(i==="\\"){var o=$1(t,e,e+2);if(dee(q1,o))r+=q1[o],e+=2;else if(o==="\\u"){e+=2;var s=$1(t,e,e+4);if(!H1(gee,s))throw new Eg("Bad Unicode escape at: "+e);r+=fee(hee(s,16)),e+=4}else throw new Eg('Unknown escape sequence: "'+o+'"')}else if(i==='"'){n=!1,e++;break}else{if(H1(mee,i))throw new Eg("Bad control character in string literal at: "+e);r+=i,e++}}if(n)throw new Eg("Unterminated string at: "+e);return{value:r,end:e}},yee=Sr,Cee=!yee(function(){var t="9007199254740993",e=JSON.rawJSON(t);return!JSON.isRawJSON(e)||JSON.stringify(e)!==t}),See=Rt,fB=xn,Tee=hB,pB=zt,oc=Nn,gB=Sr,j1=c_,hv=fn,Eee=uee,V1=$f,z1=rc,wee=ad,Iee=f_,bee=vee,_ee=yy,Aee=rd,mS=Cee,mB=String,Da=fB("JSON","stringify"),wg=oc(/./.exec),uw=oc("".charAt),Ree=oc("".charCodeAt),kee=oc("".replace),vS=oc("".slice),dw=oc([].push),Pee=oc(1.1.toString),Oee=/[\uD800-\uDFFF]/g,G1=/^[\uD800-\uDBFF]$/,W1=/^[\uDC00-\uDFFF]$/,hw=_ee(),K1=hw.length,vB=!Aee||gB(function(){var t=fB("Symbol")("stringify detection");return Da([t])!=="[null]"||Da({a:t})!=="{}"||Da(Object(t))!=="{}"}),J1=gB(function(){return Da("\uDF06\uD834")!=='"\\udf06\\ud834"'||Da("\uDEAD")!=='"\\udead"'}),Mee=vB?function(t,e){var n=Iee(arguments),r=yB(e);if(!(!hv(r)&&(t===void 0||V1(t))))return n[1]=function(i,o){if(hv(r)&&(o=pB(r,this,mB(i),o)),!V1(o))return o},Tee(Da,null,n)}:Da,Dee=function(t,e,n){var r=uw(n,e-1),i=uw(n,e+1);return wg(G1,t)&&!wg(W1,i)||wg(W1,t)&&!wg(G1,r)?"\\u"+Pee(Ree(t,0),16):t},yB=function(t){if(hv(t))return t;if(j1(t)){for(var e=t.length,n=[],r=0;r<e;r++){var i=t[r];typeof i=="string"?dw(n,i):(typeof i=="number"||z1(i)==="Number"||z1(i)==="String")&&dw(n,wee(i))}var o=n.length,s=!0;return function(l,c){if(s)return s=!1,c;if(j1(this))return c;for(var a=0;a<o;a++)if(n[a]===l)return c}}};Da&&See({target:"JSON",stat:!0,arity:3,forced:vB||J1||!mS},{stringify:function(e,n,r){var i=yB(n),o=[],s=Mee(e,function(h,g){var E=hv(i)?pB(i,this,mB(h),g):g;return!mS&&Eee(E)?hw+(dw(o,E.rawJSON)-1):E},r);if(typeof s!="string"||(J1&&(s=kee(s,Oee,Dee)),mS))return s;for(var l="",c=s.length,a=0;a<c;a++){var u=uw(s,a);if(u==='"'){var d=bee(s,++a).end-1,f=vS(s,a,d);l+=vS(f,0,K1)===hw?o[vS(f,K1)]:'"'+f+'"',a=d}else l+=u}return l}});var Nee=Rt,xee=rd,Lee=Sr,CB=by,Uee=od,Fee=!xee||Lee(function(){CB.f(1)});Nee({target:"Object",stat:!0,forced:Fee},{getOwnPropertySymbols:function(e){var n=CB.f;return n?n(Uee(e)):[]}});var Bee=Xt,$ee=Sn,Hee=yi.f,qee=td.f,yS=Bee.Symbol;$ee("asyncDispose");if(yS){var Ig=qee(yS,"asyncDispose");Ig.enumerable&&Ig.configurable&&Ig.writable&&Hee(yS,"asyncDispose",{value:Ig.value,enumerable:!1,configurable:!1,writable:!1})}var jee=Sn;jee("asyncIterator");var Vee=Rt,zee=vi,Gee=Xt,bg=Nn,Wee=Tr,Kee=fn,Jee=nd,Qee=ad,Xee=Ry,Yee=O3,Is=Gee.Symbol,hl=Is&&Is.prototype;if(zee&&Kee(Is)&&(!("description"in hl)||Is().description!==void 0)){var Q1={},_g=function(){var e=arguments.length<1||arguments[0]===void 0?void 0:Qee(arguments[0]),n=Jee(hl,this)?new Is(e):e===void 0?Is():Is(e);return e===""&&(Q1[n]=!0),n};Yee(_g,Is),_g.prototype=hl,hl.constructor=_g;var Zee=String(Is("description detection"))==="Symbol(description detection)",ete=bg(hl.valueOf),tte=bg(hl.toString),nte=/^Symbol\((.*)\)[^)]+$/,rte=bg("".replace),ite=bg("".slice);Xee(hl,"description",{configurable:!0,get:function(){var e=ete(this);if(Wee(Q1,e))return"";var n=tte(e),r=Zee?ite(n,7,-1):rte(n,nte,"$1");return r===""?void 0:r}}),Vee({global:!0,constructor:!0,forced:!0},{Symbol:_g})}var ote=Xt,ste=Sn,ate=yi.f,lte=td.f,CS=ote.Symbol;ste("dispose");if(CS){var Ag=lte(CS,"dispose");Ag.enumerable&&Ag.configurable&&Ag.writable&&ate(CS,"dispose",{value:Ag.value,enumerable:!1,configurable:!1,writable:!1})}var cte=Sn;cte("hasInstance");var ute=Sn;ute("isConcatSpreadable");var dte=Sn;dte("iterator");var hte=Sn;hte("match");var fte=Sn;fte("matchAll");var pte=Sn;pte("replace");var gte=Sn;gte("search");var mte=Sn;mte("species");var vte=Sn;vte("split");var yte=Sn,Cte=K3;yte("toPrimitive");Cte();var Ste=xn,Tte=Sn,Ete=Gs;Tte("toStringTag");Ete(Ste("Symbol"),"Symbol");var wte=Sn;wte("unscopables");var Ite=Xt,bte=Gs;bte(Ite.JSON,"JSON",!0);var _te=Gs;_te(Math,"Math",!0);var Ate=Rt,Rte=Xt,kte=Gs;Ate({global:!0},{Reflect:{}});kte(Rte.Reflect,"Reflect",!0);var Pte=ld;Pte.Symbol;var Ote={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Mte=Cy,SS=Mte("span").classList,X1=SS&&SS.constructor&&SS.constructor.prototype,Dte=X1===Object.prototype?void 0:X1,Nte=Gt,xte=jf,Lte=yi.f,fw=Nte("unscopables"),pw=Array.prototype;pw[fw]===void 0&&Lte(pw,fw,{configurable:!0,value:xte(null)});var Ute=function(t){pw[fw][t]=!0},Gf={},Fte=Sr,Bte=!Fte(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),$te=Tr,Hte=fn,qte=od,jte=Sy,Vte=Bte,Y1=jte("IE_PROTO"),gw=Object,zte=gw.prototype,xy=Vte?gw.getPrototypeOf:function(t){var e=qte(t);if($te(e,Y1))return e[Y1];var n=e.constructor;return Hte(n)&&e instanceof n?n.prototype:e instanceof gw?zte:null},Gte=Sr,Wte=fn,Kte=nr,Z1=xy,Jte=mo,Qte=Gt,mw=Qte("iterator"),SB=!1,jl,TS,ES;[].keys&&(ES=[].keys(),"next"in ES?(TS=Z1(Z1(ES)),TS!==Object.prototype&&(jl=TS)):SB=!0);var Xte=!Kte(jl)||Gte(function(){var t={};return jl[mw].call(t)!==t});Xte&&(jl={});Wte(jl[mw])||Jte(jl,mw,function(){return this});var TB={IteratorPrototype:jl,BUGGY_SAFARI_ITERATORS:SB},Yte=TB.IteratorPrototype,Zte=jf,ene=Uf,tne=Gs,nne=Gf,rne=function(){return this},ine=function(t,e,n,r){var i=e+" Iterator";return t.prototype=Zte(Yte,{next:ene(+!r,n)}),tne(t,i,!1),nne[i]=rne,t},one=Nn,sne=Di,ane=function(t,e,n){try{return one(sne(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},lne=nr,cne=function(t){return lne(t)||t===null},une=cne,dne=String,hne=TypeError,fne=function(t){if(une(t))return t;throw new hne("Can't set "+dne(t)+" as a prototype")},pne=ane,gne=nr,mne=gy,vne=fne,EB=Object.setPrototypeOf||("__proto__"in{}?function(){var t=!1,e={},n;try{n=pne(Object.prototype,"__proto__","set"),n(e,[]),t=e instanceof Array}catch{}return function(i,o){return mne(i),vne(o),gne(i)&&(t?n(i,o):i.__proto__=o),i}}():void 0),yne=Rt,Cne=zt,wB=_3,Sne=fn,Tne=ine,eM=xy,tM=EB,Ene=Gs,wne=sd,wS=mo,Ine=Gt,bne=Gf,IB=TB,_ne=wB.PROPER,Ane=wB.CONFIGURABLE,nM=IB.IteratorPrototype,Rg=IB.BUGGY_SAFARI_ITERATORS,Wd=Ine("iterator"),rM="keys",Kd="values",iM="entries",Rne=function(){return this},bB=function(t,e,n,r,i,o,s){Tne(n,e,r);var l=function(w){if(w===i&&f)return f;if(!Rg&&w&&w in u)return u[w];switch(w){case rM:return function(){return new n(this,w)};case Kd:return function(){return new n(this,w)};case iM:return function(){return new n(this,w)}}return function(){return new n(this)}},c=e+" Iterator",a=!1,u=t.prototype,d=u[Wd]||u["@@iterator"]||i&&u[i],f=!Rg&&d||l(i),h=e==="Array"&&u.entries||d,g,E,D;if(h&&(g=eM(h.call(new t)),g!==Object.prototype&&g.next&&(eM(g)!==nM&&(tM?tM(g,nM):Sne(g[Wd])||wS(g,Wd,Rne)),Ene(g,c,!0))),_ne&&i===Kd&&d&&d.name!==Kd&&(Ane?wne(u,"name",Kd):(a=!0,f=function(){return Cne(d,this)})),i)if(E={values:l(Kd),keys:o?f:l(rM),entries:l(iM)},s)for(D in E)(Rg||a||!(D in u))&&wS(u,D,E[D]);else yne({target:e,proto:!0,forced:Rg||a},E);return u[Wd]!==f&&wS(u,Wd,f,{name:i}),bne[e]=f,E},Ws=function(t,e){return{value:t,done:e}},kne=ic,S_=Ute,oM=Gf,_B=zs,Pne=yi.f,One=bB,kg=Ws,Mne=vi,AB="Array Iterator",Dne=_B.set,Nne=_B.getterFor(AB),xne=One(Array,"Array",function(t,e){Dne(this,{type:AB,target:kne(t),index:0,kind:e})},function(){var t=Nne(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,kg(void 0,!0);switch(t.kind){case"keys":return kg(n,!1);case"values":return kg(e[n],!1)}return kg([n,e[n]],!1)},"values"),sM=oM.Arguments=oM.Array;S_("keys");S_("values");S_("entries");if(Mne&&sM.name!=="values")try{Pne(sM,"name",{value:"values"})}catch{}var aM=Xt,RB=Ote,Lne=Dte,yh=xne,lM=sd,Une=Gs,Fne=Gt,IS=Fne("iterator"),bS=yh.values,kB=function(t,e){if(t){if(t[IS]!==bS)try{lM(t,IS,bS)}catch{t[IS]=bS}if(Une(t,e,!0),RB[e]){for(var n in yh)if(t[n]!==yh[n])try{lM(t,n,yh[n])}catch{t[n]=yh[n]}}}};for(var _S in RB)kB(aM[_S]&&aM[_S].prototype,_S);kB(Lne,"DOMTokenList");var Bne=Gt,$ne=yi.f,cM=Bne("metadata"),uM=Function.prototype;uM[cM]===void 0&&$ne(uM,cM,{value:null});var Hne=Sn;Hne("metadata");var qne=xn,jne=Nn,T_=qne("Symbol"),Vne=T_.keyFor,zne=jne(T_.prototype.valueOf),PB=T_.isRegisteredSymbol||function(e){try{return Vne(zne(e))!==void 0}catch{return!1}},Gne=Rt,Wne=PB;Gne({target:"Symbol",stat:!0},{isRegisteredSymbol:Wne});var Kne=id,OB=xn,Jne=Nn,Qne=$f,Xne=Gt,fv=OB("Symbol"),dM=fv.isWellKnownSymbol,MB=OB("Object","getOwnPropertyNames"),Yne=Jne(fv.prototype.valueOf),hM=Kne("wks");for(var AS=0,fM=MB(fv),Zne=fM.length;AS<Zne;AS++)try{var pM=fM[AS];Qne(fv[pM])&&Xne(pM)}catch{}var DB=function(e){if(dM&&dM(e))return!0;try{for(var n=Yne(e),r=0,i=MB(hM),o=i.length;r<o;r++)if(hM[i[r]]==n)return!0}catch{}return!1},ere=Rt,tre=DB;ere({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:tre});var nre=Sn;nre("customMatcher");var rre=Sn;rre("observable");var ire=Rt,ore=PB;ire({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:ore});var sre=Rt,are=DB;sre({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:are});var lre=Sn;lre("matcher");var cre=Sn;cre("metadataKey");var ure=Sn;ure("patternMatch");var dre=Sn;dre("replaceAll");var Jd=Xt,hre=Bf,fre=rc,Pg=function(t){return hre.slice(0,t.length)===t},NB=function(){return Pg("Bun/")?"BUN":Pg("Cloudflare-Workers")?"CLOUDFLARE":Pg("Deno/")?"DENO":Pg("Node.js/")?"NODE":Jd.Bun&&typeof Bun.version=="string"?"BUN":Jd.Deno&&typeof Deno.version=="object"?"DENO":fre(Jd.process)==="process"?"NODE":Jd.window&&Jd.document?"BROWSER":"REST"}(),pre=NB,E_=pre==="NODE",gre=xn,mre=Ry,vre=Gt,yre=vi,gM=vre("species"),xB=function(t){var e=gre(t);yre&&e&&!e[gM]&&mre(e,gM,{configurable:!0,get:function(){return this}})},Cre=nd,Sre=TypeError,w_=function(t,e){if(Cre(e,t))return t;throw new Sre("Incorrect invocation")},Tre=Ay,Ere=Hf,wre=TypeError,Ire=function(t){if(Tre(t))return t;throw new wre(Ere(t)+" is not a constructor")},mM=bn,bre=Ire,_re=Ff,Are=Gt,Rre=Are("species"),kre=function(t,e){var n=mM(t).constructor,r;return n===void 0||_re(r=mM(n)[Rre])?e:bre(r)},Pre=TypeError,Ore=function(t,e){if(t<e)throw new Pre("Not enough arguments");return t},Mre=Bf,LB=/(?:ipad|iphone|ipod).*applewebkit/i.test(Mre),Fi=Xt,Dre=hB,Nre=ky,vM=fn,xre=Tr,UB=Sr,yM=q3,Lre=f_,CM=Cy,Ure=Ore,Fre=LB,Bre=E_,vw=Fi.setImmediate,SM=Fi.clearImmediate,$re=Fi.process,RS=Fi.Dispatch,Hre=Fi.Function,TM=Fi.MessageChannel,qre=Fi.String,kS=0,Nh={},EM="onreadystatechange",cf,fl,PS,OS;UB(function(){cf=Fi.location});var I_=function(t){if(xre(Nh,t)){var e=Nh[t];delete Nh[t],e()}},MS=function(t){return function(){I_(t)}},wM=function(t){I_(t.data)},IM=function(t){Fi.postMessage(qre(t),cf.protocol+"//"+cf.host)};(!vw||!SM)&&(vw=function(e){Ure(arguments.length,1);var n=vM(e)?e:Hre(e),r=Lre(arguments,1);return Nh[++kS]=function(){Dre(n,void 0,r)},fl(kS),kS},SM=function(e){delete Nh[e]},Bre?fl=function(t){$re.nextTick(MS(t))}:RS&&RS.now?fl=function(t){RS.now(MS(t))}:TM&&!Fre?(PS=new TM,OS=PS.port2,PS.port1.onmessage=wM,fl=Nre(OS.postMessage,OS)):Fi.addEventListener&&vM(Fi.postMessage)&&!Fi.importScripts&&cf&&cf.protocol!=="file:"&&!UB(IM)?(fl=IM,Fi.addEventListener("message",wM,!1)):EM in CM("script")?fl=function(t){yM.appendChild(CM("script"))[EM]=function(){yM.removeChild(this),I_(t)}}:fl=function(t){setTimeout(MS(t),0)});var FB={set:vw},bM=Xt,jre=vi,Vre=Object.getOwnPropertyDescriptor,zre=function(t){if(!jre)return bM[t];var e=Vre(bM,t);return e&&e.value},BB=function(){this.head=null,this.tail=null};BB.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t){var e=this.head=t.next;return e===null&&(this.tail=null),t.item}}};var $B=BB,Gre=Bf,Wre=/ipad|iphone|ipod/i.test(Gre)&&typeof Pebble<"u",Kre=Bf,Jre=/web0s(?!.*chrome)/i.test(Kre),Ou=Xt,Qre=zre,_M=ky,DS=FB.set,Xre=$B,Yre=LB,Zre=Wre,eie=Jre,NS=E_,AM=Ou.MutationObserver||Ou.WebKitMutationObserver,RM=Ou.document,kM=Ou.process,Og=Ou.Promise,yw=Qre("queueMicrotask"),_c,xS,LS,Mg,PM;if(!yw){var Dg=new Xre,Ng=function(){var t,e;for(NS&&(t=kM.domain)&&t.exit();e=Dg.get();)try{e()}catch(n){throw Dg.head&&_c(),n}t&&t.enter()};!Yre&&!NS&&!eie&&AM&&RM?(xS=!0,LS=RM.createTextNode(""),new AM(Ng).observe(LS,{characterData:!0}),_c=function(){LS.data=xS=!xS}):!Zre&&Og&&Og.resolve?(Mg=Og.resolve(void 0),Mg.constructor=Og,PM=_M(Mg.then,Mg),_c=function(){PM(Ng)}):NS?_c=function(){kM.nextTick(Ng)}:(DS=_M(DS,Ou),_c=function(){DS(Ng)}),yw=function(t){Dg.head||_c(),Dg.add(t)}}var tie=yw,HB=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},Ly=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},nie=Xt,Uy=nie.Promise,rie=Xt,xh=Uy,iie=fn,oie=M3,sie=s_,aie=Gt,OM=NB,US=my;xh&&xh.prototype;var lie=aie("species"),Cw=!1,qB=iie(rie.PromiseRejectionEvent),cie=oie("Promise",function(){var t=sie(xh),e=t!==String(xh);if(!e&&US===66)return!0;if(!US||US<51||!/native code/.test(t)){var n=new xh(function(o){o(1)}),r=function(o){o(function(){},function(){})},i=n.constructor={};if(i[lie]=r,Cw=n.then(function(){})instanceof r,!Cw)return!0}return!e&&(OM==="BROWSER"||OM==="DENO")&&!qB}),Wf={CONSTRUCTOR:cie,REJECTION_EVENT:qB,SUBCLASSING:Cw},cd={},MM=Di,uie=TypeError,die=function(t){var e,n;this.promise=new t(function(r,i){if(e!==void 0||n!==void 0)throw new uie("Bad Promise constructor");e=r,n=i}),this.resolve=MM(e),this.reject=MM(n)};cd.f=function(t){return new die(t)};var hie=Rt,pv=E_,qa=Xt,fie=ld,Mu=zt,DM=mo,NM=EB,pie=Gs,gie=xB,mie=Di,_m=fn,vie=nr,yie=w_,Cie=kre,jB=FB.set,b_=tie,Sie=HB,Tie=Ly,Eie=$B,VB=zs,gv=Uy,__=Wf,zB=cd,Fy="Promise",GB=__.CONSTRUCTOR,wie=__.REJECTION_EVENT,Iie=__.SUBCLASSING,FS=VB.getterFor(Fy),bie=VB.set,Bc=gv&&gv.prototype,Tl=gv,xg=Bc,WB=qa.TypeError,Sw=qa.document,A_=qa.process,Tw=zB.f,_ie=Tw,Aie=!!(Sw&&Sw.createEvent&&qa.dispatchEvent),KB="unhandledrejection",Rie="rejectionhandled",xM=0,JB=1,kie=2,R_=1,QB=2,Lg,LM,XB,UM,YB=function(t){var e;return vie(t)&&_m(e=t.then)?e:!1},ZB=function(t,e){var n=e.value,r=e.state===JB,i=r?t.ok:t.fail,o=t.resolve,s=t.reject,l=t.domain,c,a,u;try{i?(r||(e.rejection===QB&&Oie(e),e.rejection=R_),i===!0?c=n:(l&&l.enter(),c=i(n),l&&(l.exit(),u=!0)),c===t.promise?s(new WB("Promise-chain cycle")):(a=YB(c))?Mu(a,c,o,s):o(c)):s(n)}catch(d){l&&!u&&l.exit(),s(d)}},e4=function(t,e){t.notified||(t.notified=!0,b_(function(){for(var n=t.reactions,r;r=n.get();)ZB(r,t);t.notified=!1,e&&!t.rejection&&Pie(t)}))},t4=function(t,e,n){var r,i;Aie?(r=Sw.createEvent("Event"),r.promise=e,r.reason=n,r.initEvent(t,!1,!0),qa.dispatchEvent(r)):r={promise:e,reason:n},!wie&&(i=qa["on"+t])?i(r):t===KB&&Sie("Unhandled promise rejection",n)},Pie=function(t){Mu(jB,qa,function(){var e=t.facade,n=t.value,r=FM(t),i;if(r&&(i=Tie(function(){pv?A_.emit("unhandledRejection",n,e):t4(KB,e,n)}),t.rejection=pv||FM(t)?QB:R_,i.error))throw i.value})},FM=function(t){return t.rejection!==R_&&!t.parent},Oie=function(t){Mu(jB,qa,function(){var e=t.facade;pv?A_.emit("rejectionHandled",e):t4(Rie,e,t.value)})},eu=function(t,e,n){return function(r){t(e,r,n)}},pu=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=kie,e4(t,!0))},Ew=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new WB("Promise can't be resolved itself");var r=YB(e);r?b_(function(){var i={done:!1};try{Mu(r,e,eu(Ew,i,t),eu(pu,i,t))}catch(o){pu(i,o,t)}}):(t.value=e,t.state=JB,e4(t,!1))}catch(i){pu({done:!1},i,t)}}};if(GB&&(Tl=function(e){yie(this,xg),mie(e),Mu(Lg,this);var n=FS(this);try{e(eu(Ew,n),eu(pu,n))}catch(r){pu(n,r)}},xg=Tl.prototype,Lg=function(e){bie(this,{type:Fy,done:!1,notified:!1,parent:!1,reactions:new Eie,rejection:!1,state:xM,value:null})},Lg.prototype=DM(xg,"then",function(e,n){var r=FS(this),i=Tw(Cie(this,Tl));return r.parent=!0,i.ok=_m(e)?e:!0,i.fail=_m(n)&&n,i.domain=pv?A_.domain:void 0,r.state===xM?r.reactions.add(i):b_(function(){ZB(i,r)}),i.promise}),LM=function(){var t=new Lg,e=FS(t);this.promise=t,this.resolve=eu(Ew,e),this.reject=eu(pu,e)},zB.f=Tw=function(t){return t===Tl||t===XB?new LM(t):_ie(t)},_m(gv)&&Bc!==Object.prototype)){UM=Bc.then,Iie||DM(Bc,"then",function(e,n){var r=this;return new Tl(function(i,o){Mu(UM,r,i,o)}).then(e,n)},{unsafe:!0});try{delete Bc.constructor}catch{}NM&&NM(Bc,xg)}hie({global:!0,constructor:!0,wrap:!0,forced:GB},{Promise:Tl});XB=fie.Promise;pie(Tl,Fy,!1);gie(Fy);var Mie=Gt,Die=Gf,Nie=Mie("iterator"),xie=Array.prototype,Lie=function(t){return t!==void 0&&(Die.Array===t||xie[Nie]===t)},Uie=_y,BM=hs,Fie=Ff,Bie=Gf,$ie=Gt,Hie=$ie("iterator"),k_=function(t){if(!Fie(t))return BM(t,Hie)||BM(t,"@@iterator")||Bie[Uie(t)]},qie=zt,jie=Di,Vie=bn,zie=Hf,Gie=k_,Wie=TypeError,n4=function(t,e){var n=arguments.length<2?Gie(t):e;if(jie(n))return Vie(qie(n,t));throw new Wie(zie(t)+" is not iterable")},Kie=zt,$M=bn,Jie=hs,P_=function(t,e,n){var r,i;$M(t);try{if(r=Jie(t,"return"),!r){if(e==="throw")throw n;return n}r=Kie(r,t)}catch(o){i=!0,r=o}if(e==="throw")throw n;if(i)throw r;return $M(r),n},Qie=ky,Xie=zt,Yie=bn,Zie=Hf,eoe=Lie,toe=Iy,HM=nd,noe=n4,roe=k_,qM=P_,ioe=TypeError,Am=function(t,e){this.stopped=t,this.result=e},jM=Am.prototype,O_=function(t,e,n){var r=n&&n.that,i=!!(n&&n.AS_ENTRIES),o=!!(n&&n.IS_RECORD),s=!!(n&&n.IS_ITERATOR),l=!!(n&&n.INTERRUPTED),c=Qie(e,r),a,u,d,f,h,g,E,D=function(p){return a&&qM(a,"normal"),new Am(!0,p)},w=function(p){return i?(Yie(p),l?c(p[0],p[1],D):c(p[0],p[1])):l?c(p,D):c(p)};if(o)a=t.iterator;else if(s)a=t;else{if(u=roe(t),!u)throw new ioe(Zie(t)+" is not iterable");if(eoe(u)){for(d=0,f=toe(t);f>d;d++)if(h=w(t[d]),h&&HM(jM,h))return h;return new Am(!1)}a=noe(t,u)}for(g=o?t.next:a.next;!(E=Xie(g,a)).done;){try{h=w(E.value)}catch(p){qM(a,"throw",p)}if(typeof h=="object"&&h&&HM(jM,h))return h}return new Am(!1)},ooe=Gt,r4=ooe("iterator"),i4=!1;try{var soe=0,VM={next:function(){return{done:!!soe++}},return:function(){i4=!0}};VM[r4]=function(){return this},Array.from(VM,function(){throw 2})}catch{}var aoe=function(t,e){try{if(!e&&!i4)return!1}catch{return!1}var n=!1;try{var r={};r[r4]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch{}return n},loe=Uy,coe=aoe,uoe=Wf.CONSTRUCTOR,o4=uoe||!coe(function(t){loe.all(t).then(void 0,function(){})}),doe=Rt,hoe=zt,foe=Di,poe=cd,goe=Ly,moe=O_,voe=o4;doe({target:"Promise",stat:!0,forced:voe},{all:function(e){var n=this,r=poe.f(n),i=r.resolve,o=r.reject,s=goe(function(){var l=foe(n.resolve),c=[],a=0,u=1;moe(e,function(d){var f=a++,h=!1;u++,hoe(l,n,d).then(function(g){h||(h=!0,c[f]=g,--u||i(c))},o)}),--u||i(c)});return s.error&&o(s.value),r.promise}});var yoe=Rt,Coe=Wf.CONSTRUCTOR,ww=Uy,Soe=xn,Toe=fn,Eoe=mo,zM=ww&&ww.prototype;yoe({target:"Promise",proto:!0,forced:Coe,real:!0},{catch:function(t){return this.then(void 0,t)}});if(Toe(ww)){var GM=Soe("Promise").prototype.catch;zM.catch!==GM&&Eoe(zM,"catch",GM,{unsafe:!0})}var woe=Rt,Ioe=zt,boe=Di,_oe=cd,Aoe=Ly,Roe=O_,koe=o4;woe({target:"Promise",stat:!0,forced:koe},{race:function(e){var n=this,r=_oe.f(n),i=r.reject,o=Aoe(function(){var s=boe(n.resolve);Roe(e,function(l){Ioe(s,n,l).then(r.resolve,i)})});return o.error&&i(o.value),r.promise}});var Poe=Rt,Ooe=cd,Moe=Wf.CONSTRUCTOR;Poe({target:"Promise",stat:!0,forced:Moe},{reject:function(e){var n=Ooe.f(this),r=n.reject;return r(e),n.promise}});var Doe=bn,Noe=nr,xoe=cd,Loe=function(t,e){if(Doe(t),Noe(e)&&e.constructor===t)return e;var n=xoe.f(t),r=n.resolve;return r(e),n.promise},Uoe=Rt,Foe=xn,Boe=Wf.CONSTRUCTOR,$oe=Loe;Foe("Promise");Uoe({target:"Promise",stat:!0,forced:Boe},{resolve:function(e){return $oe(this,e)}});var s4=Xt,a4=vy,l4=fn,Ug=xy,Hoe=mo,qoe=Gt,WM="USE_FUNCTION_CONSTRUCTOR",KM=qoe("asyncIterator"),JM=s4.AsyncIterator,QM=a4.AsyncIteratorPrototype,Na,BS;if(QM)Na=QM;else if(l4(JM))Na=JM.prototype;else if(a4[WM]||s4[WM])try{BS=Ug(Ug(Ug(Function("return async function*(){}()")()))),Ug(BS)===Object.prototype&&(Na=BS)}catch{}Na||(Na={});l4(Na[KM])||Hoe(Na,KM,function(){return this});var Kf=Na,joe=zt,Voe=mo,zoe=xn,Goe=hs,Woe=Tr,Koe=Gt,XM=Kf,YM=Koe("asyncDispose"),ZM=zoe("Promise");Woe(XM,YM)||Voe(XM,YM,function(){var t=this;return new ZM(function(e,n){var r=Goe(t,"return");r?ZM.resolve(joe(r,t)).then(function(){e(void 0)},n):e(void 0)})});var M_=Nn,Joe=wy,Qoe=ad,Xoe=gy,Yoe=M_("".charAt),eD=M_("".charCodeAt),Zoe=M_("".slice),ese=function(t){return function(e,n){var r=Qoe(Xoe(e)),i=Joe(n),o=r.length,s,l;return i<0||i>=o?t?"":void 0:(s=eD(r,i),s<55296||s>56319||i+1===o||(l=eD(r,i+1))<56320||l>57343?t?Yoe(r,i):s:t?Zoe(r,i,i+2):(s-55296<<10)+(l-56320)+65536)}},tse={charAt:ese(!0)},nse=tse.charAt,rse=ad,c4=zs,ise=bB,tD=Ws,u4="String Iterator",ose=c4.set,sse=c4.getterFor(u4);ise(String,"String",function(t){ose(this,{type:u4,string:rse(t),index:0})},function(){var e=sse(this),n=e.string,r=e.index,i;return r>=n.length?tD(void 0,!0):(i=nse(n,r),e.index+=i.length,tD(i,!1))});var ase=Rt,lse=w_,cse=xy,d4=sd,h4=Tr,use=Gt,xa=Kf,dse=i7,nD=use("toStringTag"),hse=TypeError,D_=function(){if(lse(this,xa),cse(this)===xa)throw new hse("Abstract class AsyncIterator not directly constructable")};D_.prototype=xa;h4(xa,nD)||d4(xa,nD,"AsyncIterator");(!h4(xa,"constructor")||xa.constructor===Object)&&d4(xa,"constructor",D_);ase({global:!0,constructor:!0,forced:dse},{AsyncIterator:D_});var ol=function(t){return{iterator:t,next:t.next,done:!1}},fse=RangeError,f4=function(t){if(t===t)return t;throw new fse("NaN is not allowed")},pse=wy,gse=RangeError,p4=function(t){var e=pse(t);if(e<0)throw new gse("The argument can't be less than 0");return e},mse=mo,N_=function(t,e,n){for(var r in e)mse(t,r,e[r],n);return t},vse=zt,Fg=Ly,rD=bn,yse=jf,Cse=sd,Sse=N_,Tse=Gt,g4=zs,Ese=xn,wse=hs,Ise=Kf,$S=Ws,iD=P_,ts=Ese("Promise"),bse=Tse("toStringTag"),m4="AsyncIteratorHelper",v4="WrapForValidAsyncIterator",_se=g4.set,y4=function(t){var e=!t,n=g4.getterFor(t?v4:m4),r=function(i){var o=Fg(function(){return n(i)}),s=o.error,l=o.value;return s||e&&l.done?{exit:!0,value:s?ts.reject(l):ts.resolve($S(void 0,!0))}:{exit:!1,value:l}};return Sse(yse(Ise),{next:function(){var o=r(this),s=o.value;if(o.exit)return s;var l=Fg(function(){return rD(s.nextHandler(ts))}),c=l.error,a=l.value;return c&&(s.done=!0),c?ts.reject(a):ts.resolve(a)},return:function(){var i=r(this),o=i.value;if(i.exit)return o;o.done=!0;var s=o.iterator,l,c,a=Fg(function(){if(o.inner)try{iD(o.inner.iterator,"normal")}catch(u){return iD(s,"throw",u)}return wse(s,"return")});return l=c=a.value,a.error?ts.reject(c):l===void 0?ts.resolve($S(void 0,!0)):(a=Fg(function(){return vse(l,s)}),c=a.value,a.error?ts.reject(c):t?ts.resolve(c):ts.resolve(c).then(function(u){return rD(u),$S(void 0,!0)}))}})},Ase=y4(!0),C4=y4(!1);Cse(C4,bse,"Async Iterator Helper");var ud=function(t,e){var n=function(i,o){o?(o.iterator=i.iterator,o.next=i.next):o=i,o.type=e?v4:m4,o.nextHandler=t,o.counter=0,o.done=!1,_se(this,o)};return n.prototype=e?Ase:C4,n},Rse=Rt,kse=zt,Iw=bn,Pse=ol,Ose=f4,Mse=p4,Dse=ud,oD=Ws,Nse=Dse(function(t){var e=this;return new t(function(n,r){var i=function(s){e.done=!0,r(s)},o=function(){try{t.resolve(Iw(kse(e.next,e.iterator))).then(function(s){try{Iw(s).done?(e.done=!0,n(oD(void 0,!0))):e.remaining?(e.remaining--,o()):n(oD(s.value,!1))}catch(l){i(l)}},i)}catch(s){i(s)}};o()})});Rse({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{drop:function(e){Iw(this);var n=Mse(Ose(+e));return new Nse(Pse(this),{remaining:n})}});var xse=zt,Lse=xn,Use=hs,Jf=function(t,e,n,r){try{var i=Use(t,"return");if(i)return Lse("Promise").resolve(xse(i,t)).then(function(){e(n)},function(o){r(o)})}catch(o){return r(o)}e(n)},Fse=zt,Bse=Di,HS=bn,$se=nr,Hse=D3,qse=xn,jse=ol,qS=Jf,Qd=function(t){var e=t===0,n=t===1,r=t===2,i=t===3;return function(o,s,l){HS(o);var c=s!==void 0;(c||!e)&&Bse(s);var a=jse(o),u=qse("Promise"),d=a.iterator,f=a.next,h=0;return new u(function(g,E){var D=function(p){qS(d,E,p,E)},w=function(){try{if(c)try{Hse(h)}catch(p){D(p)}u.resolve(HS(Fse(f,d))).then(function(p){try{if(HS(p).done)e?(l.length=h,g(l)):g(i?!1:r||void 0);else{var b=p.value;try{if(c){var j=s(b,h),K=function(M){if(n)w();else if(r)M?w():qS(d,g,!1,E);else if(e)try{l[h++]=M,w()}catch(ne){D(ne)}else M?qS(d,g,i||b,E):w()};$se(j)?u.resolve(j).then(K,D):K(j)}else l[h++]=b,w()}catch(M){D(M)}}}catch(M){E(M)}},E)}catch(p){E(p)}};w()})}},Qf={toArray:Qd(0),forEach:Qd(1),every:Qd(2),some:Qd(3),find:Qd(4)},Vse=Rt,zse=Qf.every;Vse({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{every:function(e){return zse(this,e)}});var Gse=Rt,Wse=zt,Kse=Di,bw=bn,Jse=nr,Qse=ol,Xse=ud,sD=Ws,Yse=Jf,Zse=Xse(function(t){var e=this,n=e.iterator,r=e.predicate;return new t(function(i,o){var s=function(a){e.done=!0,o(a)},l=function(a){Yse(n,s,a,s)},c=function(){try{t.resolve(bw(Wse(e.next,n))).then(function(a){try{if(bw(a).done)e.done=!0,i(sD(void 0,!0));else{var u=a.value;try{var d=r(u,e.counter++),f=function(h){h?i(sD(u,!1)):c()};Jse(d)?t.resolve(d).then(f,l):f(d)}catch(h){l(h)}}}catch(h){s(h)}},s)}catch(a){s(a)}};c()})});Gse({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{filter:function(e){return bw(this),Kse(e),new Zse(Qse(this),{predicate:e})}});var eae=Rt,tae=Qf.find;eae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{find:function(e){return tae(this,e)}});var aD=zt,lD=bn,nae=jf,rae=hs,iae=N_,S4=zs,oae=P_,sae=xn,aae=Kf,T4=Ws,_w=sae("Promise"),E4="AsyncFromSyncIterator",lae=S4.set,cD=S4.getterFor(E4),uD=function(t,e,n,r,i){var o=t.done;_w.resolve(t.value).then(function(s){e(T4(s,o))},function(s){if(!o&&i)try{oae(r,"throw",s)}catch(l){s=l}n(s)})},w4=function(e){e.type=E4,lae(this,e)};w4.prototype=iae(nae(aae),{next:function(){var e=cD(this);return new _w(function(n,r){var i=lD(aD(e.next,e.iterator));uD(i,n,r,e.iterator,!0)})},return:function(){var t=cD(this).iterator;return new _w(function(e,n){var r=rae(t,"return");if(r===void 0)return e(T4(void 0,!0));var i=lD(aD(r,t));uD(i,e,n,t)})}});var cae=w4,uae=zt,dae=fn,dD=bn,hD=ol,hae=k_,fae=hs,pae=Gt,gae=cae,mae=pae("asyncIterator"),I4=function(t){var e=dD(t),n=!0,r=fae(e,mae),i;return dae(r)||(r=hae(e),n=!1),r!==void 0?i=uae(r,e):(i=e,n=!0),dD(i),hD(n?i:new gae(hD(i)))},vae=Rt,fD=zt,yae=Di,Ch=bn,Cae=nr,Sae=ol,Tae=ud,pD=Ws,Eae=I4,wae=Jf,Iae=Tae(function(t){var e=this,n=e.iterator,r=e.mapper;return new t(function(i,o){var s=function(u){e.done=!0,o(u)},l=function(u){wae(n,s,u,s)},c=function(){try{t.resolve(Ch(fD(e.next,n))).then(function(u){try{if(Ch(u).done)e.done=!0,i(pD(void 0,!0));else{var d=u.value;try{var f=r(d,e.counter++),h=function(g){try{e.inner=Eae(g),a()}catch(E){l(E)}};Cae(f)?t.resolve(f).then(h,l):h(f)}catch(g){l(g)}}}catch(g){s(g)}},s)}catch(u){s(u)}},a=function(){var u=e.inner;if(u)try{t.resolve(Ch(fD(u.next,u.iterator))).then(function(d){try{Ch(d).done?(e.inner=null,c()):i(pD(d.value,!1))}catch(f){l(f)}},l)}catch(d){l(d)}else c()};a()})});vae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{flatMap:function(e){return Ch(this),yae(e),new Iae(Sae(this),{mapper:e,inner:null})}});var bae=Rt,_ae=Qf.forEach;bae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{forEach:function(e){return _ae(this,e)}});var Aae=zt,Rae=ud,kae=Rae(function(){return Aae(this.next,this.iterator)},!0),Pae=Rt,Oae=od,Mae=nd,Dae=I4,Nae=Kf,xae=kae;Pae({target:"AsyncIterator",stat:!0,forced:!0},{from:function(e){var n=Dae(typeof e=="string"?Oae(e):e);return Mae(Nae,n.iterator)?n.iterator:new xae(n)}});var Lae=zt,Uae=Di,Aw=bn,Fae=nr,Bae=ol,$ae=ud,gD=Ws,Hae=Jf,qae=$ae(function(t){var e=this,n=e.iterator,r=e.mapper;return new t(function(i,o){var s=function(c){e.done=!0,o(c)},l=function(c){Hae(n,s,c,s)};t.resolve(Aw(Lae(e.next,n))).then(function(c){try{if(Aw(c).done)e.done=!0,i(gD(void 0,!0));else{var a=c.value;try{var u=r(a,e.counter++),d=function(f){i(gD(f,!1))};Fae(u)?t.resolve(u).then(d,l):d(u)}catch(f){l(f)}}}catch(f){s(f)}},s)})}),b4=function(e){return Aw(this),Uae(e),new qae(Bae(this),{mapper:e})},jae=Rt,Vae=b4;jae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{map:Vae});var zae=Rt,Gae=zt,Wae=Di,jS=bn,Kae=nr,Jae=xn,Qae=ol,Xae=Jf,VS=Jae("Promise"),Yae=TypeError;zae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{reduce:function(e){jS(this),Wae(e);var n=Qae(this),r=n.iterator,i=n.next,o=arguments.length<2,s=o?void 0:arguments[1],l=0;return new VS(function(c,a){var u=function(f){Xae(r,a,f,a)},d=function(){try{VS.resolve(jS(Gae(i,r))).then(function(f){try{if(jS(f).done)o?a(new Yae("Reduce of empty iterator with no initial value")):c(s);else{var h=f.value;if(o)o=!1,s=h,d();else try{var g=e(s,h,l),E=function(D){s=D,d()};Kae(g)?VS.resolve(g).then(E,u):E(g)}catch(D){u(D)}}l++}catch(D){a(D)}},a)}catch(f){a(f)}};d()})}});var Zae=Rt,ele=Qf.some;Zae({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{some:function(e){return ele(this,e)}});var tle=Rt,mD=zt,_4=bn,nle=ol,rle=f4,ile=p4,ole=ud,zS=Ws,sle=ole(function(t){var e=this,n=e.iterator,r;if(!e.remaining--){var i=zS(void 0,!0);return e.done=!0,r=n.return,r!==void 0?t.resolve(mD(r,n,void 0)).then(function(){return i}):i}return t.resolve(mD(e.next,n)).then(function(o){return _4(o).done?(e.done=!0,zS(void 0,!0)):zS(o.value,!1)}).then(null,function(o){throw e.done=!0,o})});tle({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{take:function(e){_4(this);var n=ile(rle(+e));return new sle(nle(this),{remaining:n})}});var ale=Rt,lle=Qf.toArray;ale({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{toArray:function(){return lle(this,void 0,[])}});var cle=ld;cle.AsyncIterator;var ule=zt,dle=b4,hle=function(t,e){return[e,t]},A4=function(){return ule(dle,this,hle)},fle=Rt,ple=A4;fle({target:"AsyncIterator",name:"indexed",proto:!0,real:!0,forced:!0},{asIndexedPairs:ple});var gle=Rt,mle=A4;gle({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{indexed:mle});function R4(){const t={};return t.promise=new Promise((e,n)=>{t.resolve=e,t.reject=n}),t}var vle=Object.is||function(e,n){return e===n?e!==0||1/e===1/n:e!==e&&n!==n},yle=Rt,Cle=vle;yle({target:"Object",stat:!0},{is:Cle});var Sle=ld,Tle=Sle.Object.is,Ele=Tle,wle=Ele,Ile=wle,ble=Ile,_le=ble,Ale=_le,Rle=Ale;const kle=Ov(Rle);function Ple(t){const e=new Error("aborted");if(t&&t.aborted)return Promise.reject(e);const n=R4(),r=()=>{t.removeEventListener("abort",r),n.reject(e)};return t&&t.addEventListener("abort",r),n.promise}const vD=Symbol();function Ole(t={}){const e=Ple(t.signal),n=[];e.catch(()=>{});let r,i;return{iterable:{[Symbol.asyncIterator](){return Ar(this,arguments,function*(){if(r)throw new Error("asyncIterableQueue: You can only iterate once. The iteration has already started or finished.");for(r=!0;;){n.length?yield at(t.signal&&t.signal.aborted&&e):(yield at(Promise.race([e,(i||(i=R4())).promise])),i=null);const s=n.shift();if(kle(s,vD))break;yield yield at(s)}})}},end(){n.push(vD)},push(o){n.push(o),i&&i.resolve()},watermark(){return n.length}}}function x_(t,e,...n){if(!t)throw new TypeError(k4(e,n))}function k4(t,e){let n=0;return t.replace(/%[os]/gu,()=>P4(e[n++]))}function P4(t){return typeof t!="object"||t===null?String(t):Object.prototype.toString.call(t)}let Mle;function Dle(t){try{const e=t instanceof Error?t:new Error(P4(t));if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:e,message:e.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)}catch{}}const Fo=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:typeof globalThis<"u"?globalThis:void 0;let Nle;class Ks{constructor(e,n){this.code=e,this.message=n}warn(...e){var n;try{const r=((n=new Error().stack)!==null&&n!==void 0?n:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...e,r)}catch{}}}const xle=new Ks("W01","Unable to initialize event under dispatching."),Lle=new Ks("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),Ule=new Ks("W03","Assigning any truthy value to 'returnValue' property has no effect."),Fle=new Ks("W04","Unable to preventDefault on non-cancelable events."),Ble=new Ks("W05","Unable to preventDefault inside passive event listener invocation."),$le=new Ks("W06","An event listener wasn't added because it has been added already: %o, %o"),GS=new Ks("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),yD=new Ks("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),Hle=new Ks("W09","Event attribute handler must be a function: %o");class zo{static get NONE(){return CD}static get CAPTURING_PHASE(){return SD}static get AT_TARGET(){return TD}static get BUBBLING_PHASE(){return ED}constructor(e,n){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const r=n??{};Rw.set(this,{type:String(e),bubbles:!!r.bubbles,cancelable:!!r.cancelable,composed:!!r.composed,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return Bn(this).type}get target(){return Bn(this).target}get srcElement(){return Bn(this).target}get currentTarget(){return Bn(this).currentTarget}composedPath(){const e=Bn(this).currentTarget;return e?[e]:[]}get NONE(){return CD}get CAPTURING_PHASE(){return SD}get AT_TARGET(){return TD}get BUBBLING_PHASE(){return ED}get eventPhase(){return Bn(this).dispatchFlag?2:0}stopPropagation(){Bn(this).stopPropagationFlag=!0}get cancelBubble(){return Bn(this).stopPropagationFlag}set cancelBubble(e){e?Bn(this).stopPropagationFlag=!0:Lle.warn()}stopImmediatePropagation(){const e=Bn(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return Bn(this).bubbles}get cancelable(){return Bn(this).cancelable}get returnValue(){return!Bn(this).canceledFlag}set returnValue(e){e?Ule.warn():wD(Bn(this))}preventDefault(){wD(Bn(this))}get defaultPrevented(){return Bn(this).canceledFlag}get composed(){return Bn(this).composed}get isTrusted(){return!1}get timeStamp(){return Bn(this).timeStamp}initEvent(e,n=!1,r=!1){const i=Bn(this);if(i.dispatchFlag){xle.warn();return}Rw.set(this,{...i,type:String(e),bubbles:!!n,cancelable:!!r,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const CD=0,SD=1,TD=2,ED=3,Rw=new WeakMap;function Bn(t,e="this"){const n=Rw.get(t);return x_(n!=null,"'%s' must be an object that Event constructor created, but got another one: %o",e,t),n}function wD(t){if(t.inPassiveListenerFlag){Ble.warn();return}if(!t.cancelable){Fle.warn();return}t.canceledFlag=!0}Object.defineProperty(zo,"NONE",{enumerable:!0});Object.defineProperty(zo,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(zo,"AT_TARGET",{enumerable:!0});Object.defineProperty(zo,"BUBBLING_PHASE",{enumerable:!0});const WS=Object.getOwnPropertyNames(zo.prototype);for(let t=0;t<WS.length;++t)WS[t]!=="constructor"&&Object.defineProperty(zo.prototype,WS[t],{enumerable:!0});typeof Fo<"u"&&typeof Fo.Event<"u"&&Object.setPrototypeOf(zo.prototype,Fo.Event.prototype);function qle(t){return Fo.DOMException?new Fo.DOMException(t,"InvalidStateError"):(Ac==null&&(Ac=class O4 extends Error{constructor(n){super(n),Error.captureStackTrace&&Error.captureStackTrace(this,O4)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(Ac.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),bD(Ac),bD(Ac.prototype)),new Ac(t))}let Ac;const ID={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function bD(t){const e=Object.keys(ID);for(let n=0;n<e.length;++n){const r=e[n],i=ID[r];Object.defineProperty(t,r,{get(){return i},configurable:!0,enumerable:!0})}}class By extends zo{static wrap(e){return new(D4(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),M4.set(this,{original:e});const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];i in this||Object.defineProperty(this,i,N4(e,i))}}stopPropagation(){super.stopPropagation();const{original:e}=fa(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:n}=fa(this);"cancelBubble"in n&&(n.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=fa(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:n}=fa(this);"returnValue"in n&&(n.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=fa(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=fa(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const M4=new WeakMap;function fa(t){const e=M4.get(t);return x_(e!=null,"'this' is expected an Event object, but got",t),e}const mv=new WeakMap;mv.set(Object.prototype,By);typeof Fo<"u"&&typeof Fo.Event<"u"&&mv.set(Fo.Event.prototype,By);function D4(t){const e=Object.getPrototypeOf(t);if(e==null)return By;let n=mv.get(e);return n==null&&(n=jle(D4(e),e),mv.set(e,n)),n}function jle(t,e){class n extends t{}const r=Object.keys(e);for(let i=0;i<r.length;++i)Object.defineProperty(n.prototype,r[i],N4(e,r[i]));return n}function N4(t,e){const n=Object.getOwnPropertyDescriptor(t,e);return{get(){const r=fa(this).original,i=r[e];return typeof i=="function"?i.bind(r):i},set(r){const i=fa(this).original;i[e]=r},configurable:n.configurable,enumerable:n.enumerable}}function Vle(t,e,n,r,i,o){return{callback:t,flags:(e?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:o}}function zle(t){t.flags|=8}function x4(t){return(t.flags&1)===1}function L4(t){return(t.flags&2)===2}function U4(t){return(t.flags&4)===4}function Gle(t){return(t.flags&8)===8}function Wle({callback:t},e,n){try{typeof t=="function"?t.call(e,n):typeof t.handleEvent=="function"&&t.handleEvent(n)}catch(r){Dle(r)}}function F4({listeners:t},e,n){for(let r=0;r<t.length;++r)if(t[r].callback===e&&x4(t[r])===n)return r;return-1}function B4(t,e,n,r,i,o){let s;o&&(s=L_.bind(null,t,e,n),o.addEventListener("abort",s));const l=Vle(e,n,r,i,o,s);return t.cow?(t.cow=!1,t.listeners=[...t.listeners,l]):t.listeners.push(l),l}function L_(t,e,n){const r=F4(t,e,n);return r!==-1?$4(t,r):!1}function $4(t,e,n=!1){const r=t.listeners[e];return zle(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),t.cow&&!n?(t.cow=!1,t.listeners=t.listeners.filter((i,o)=>o!==e),!1):(t.listeners.splice(e,1),!0)}function Kle(){return Object.create(null)}function H4(t,e){var n;return(n=t[e])!==null&&n!==void 0?n:t[e]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}class Xf{constructor(){q4.set(this,Kle())}addEventListener(e,n,r){const i=gu(this),{callback:o,capture:s,once:l,passive:c,signal:a,type:u}=Jle(e,n,r);if(o==null||a!=null&&a.aborted)return;const d=H4(i,u),f=F4(d,o,s);if(f!==-1){Xle(d.listeners[f],c,l,a);return}B4(d,o,s,c,l,a)}removeEventListener(e,n,r){const i=gu(this),{callback:o,capture:s,type:l}=Qle(e,n,r),c=i[l];o!=null&&c&&L_(c,o,s)}dispatchEvent(e){const n=gu(this)[String(e.type)];if(n==null)return!0;const r=e instanceof zo?e:By.wrap(e),i=Bn(r,"event");if(i.dispatchFlag)throw qle("This event has been in dispatching.");if(i.dispatchFlag=!0,i.target=i.currentTarget=this,!i.stopPropagationFlag){const{cow:o,listeners:s}=n;n.cow=!0;for(let l=0;l<s.length;++l){const c=s[l];if(!Gle(c)&&(U4(c)&&$4(n,l,!o)&&(l-=1),i.inPassiveListenerFlag=L4(c),Wle(c,this,r),i.inPassiveListenerFlag=!1,i.stopImmediatePropagationFlag))break}o||(n.cow=!1)}return i.target=null,i.currentTarget=null,i.stopImmediatePropagationFlag=!1,i.stopPropagationFlag=!1,i.dispatchFlag=!1,!i.canceledFlag}}const q4=new WeakMap;function gu(t,e="this"){const n=q4.get(t);return x_(n!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",e,t),n}function Jle(t,e,n){var r;return j4(e),typeof n=="object"&&n!==null?{type:String(t),callback:e??void 0,capture:!!n.capture,passive:!!n.passive,once:!!n.once,signal:(r=n.signal)!==null&&r!==void 0?r:void 0}:{type:String(t),callback:e??void 0,capture:!!n,passive:!1,once:!1,signal:void 0}}function Qle(t,e,n){return j4(e),typeof n=="object"&&n!==null?{type:String(t),callback:e??void 0,capture:!!n.capture}:{type:String(t),callback:e??void 0,capture:!!n}}function j4(t){if(!(typeof t=="function"||typeof t=="object"&&t!==null&&typeof t.handleEvent=="function")){if(t==null||typeof t=="object"){yD.warn(t);return}throw new TypeError(k4(yD.message,[t]))}}function Xle(t,e,n,r){$le.warn(x4(t)?"capture":"bubble",t.callback),L4(t)!==e&&GS.warn("passive"),U4(t)!==n&&GS.warn("once"),t.signal!==r&&GS.warn("signal")}const KS=Object.getOwnPropertyNames(Xf.prototype);for(let t=0;t<KS.length;++t)KS[t]!=="constructor"&&Object.defineProperty(Xf.prototype,KS[t],{enumerable:!0});typeof Fo<"u"&&typeof Fo.EventTarget<"u"&&Object.setPrototypeOf(Xf.prototype,Fo.EventTarget.prototype);function Yle(t,e){var n,r;return(r=(n=gu(t,"target")[e])===null||n===void 0?void 0:n.attrCallback)!==null&&r!==void 0?r:null}function Zle(t,e,n){n!=null&&typeof n!="function"&&Hle.warn(n),typeof n=="function"||typeof n=="object"&&n!==null?ece(t,e,n):tce(t,e)}function ece(t,e,n){const r=H4(gu(t,"target"),String(e));r.attrCallback=n,r.attrListener==null&&(r.attrListener=B4(r,nce(r),!1,!1,!1,void 0))}function tce(t,e){const r=gu(t,"target")[String(e)];r&&r.attrListener&&(L_(r,r.attrListener.callback,!1),r.attrCallback=r.attrListener=void 0)}function nce(t){return function(e){const n=t.attrCallback;typeof n=="function"&&n.call(this,e)}}function Yf(t,e,n){Object.defineProperty(t,`on${e}`,{get(){return Yle(this,e)},set(r){Zle(this,e,r)},configurable:!0,enumerable:!0})}function rce(t,e){const{getReadyState:n}=t,r=Cn(t,["getReadyState"]),i=Object.assign(Object.assign({},r),{readyState:-1});for(const o in e)Object.defineProperty(i,o,{enumerable:!0,get(){return e[o]}});return Object.defineProperty(i,"readyState",{get(){return n()}}),Object.seal(i)}const ice=t=>e=>t(e);function oce(t={},e=ice){const n={};let r=!1,i;const o=e(()=>{const l=new Xf,c=[];let a=er.CONNECTING;return{addEventListener:l.addEventListener.bind(l),dispatchEvent:l.dispatchEvent.bind(l),removeEventListener:l.removeEventListener.bind(l),activities:({signal:u}={})=>{const d=Ole({signal:u});return c.push(d),u&&u.addEventListener("abort",()=>{const f=c.indexOf(d);~f||c.splice(f,1)}),d.iterable},close:()=>{c.forEach(u=>u.end()),c.splice(0,1/0),i&&i.unsubscribe(),i=null},egress:()=>Promise.resolve(),getState:u=>n[u],getReadyState:()=>a,ingress:u=>{c.forEach(d=>d.push(u))},setState:(u,d)=>{if(r&&!(u in n))throw new Error(`Cannot set config "${String(u)}" because it was not set before being sealed.`);n[u]=d},setReadyState:u=>{if(u!==a){if(a===er.CLOSED)throw new Error('Cannot change "readyState" after it is CLOSED.');if(u!==er.CLOSED&&u!==er.CONNECTING&&u!==er.OPEN)throw new Error('"readyState" must be either CLOSED, CONNECTING or OPEN.');a=u,u===er.CLOSED&&(i&&i.unsubscribe(),i=null),l.dispatchEvent(new zo(u===er.OPEN?"open":"error"))}},subscribe:u=>{if(i&&i.unsubscribe(),i=null,!u)return;let d;u.subscribe({start(f){i=f,d=f},complete(){i===d&&(i=null)},error(){i===d&&(i=null)},next(f){o.ingress(f)}})}}})(t);if(Object.getPrototypeOf(o)!==Object.prototype)throw new Error("Object returned from enhancer must not be a class object.");const s=rce(o,n);return r=!0,s}var sce=Rt,Rm=zt,Zf=vi,ace=xB,V4=Di,lce=bn,cce=w_,z4=fn,uce=Ff,dce=nr,km=hs,hce=mo,U_=N_,G4=Ry,tu=HB,fce=Gt,W4=zs,pce=fce("observable"),F_="Observable",K4="Subscription",J4="SubscriptionObserver",B_=W4.getterFor,$_=W4.set,gce=B_(F_),Q4=B_(K4),Pm=B_(J4),X4=function(t){this.observer=lce(t),this.cleanup=null,this.subscriptionObserver=null};X4.prototype={type:K4,clean:function(){var t=this.cleanup;if(t){this.cleanup=null;try{t()}catch(e){tu(e)}}},close:function(){if(!Zf){var t=this.facade,e=this.subscriptionObserver;t.closed=!0,e&&(e.closed=!0)}this.observer=null},isClosed:function(){return this.observer===null}};var H_=function(t,e){var n=$_(this,new X4(t)),r;Zf||(this.closed=!1);try{(r=km(t,"start"))&&Rm(r,t,this)}catch(l){tu(l)}if(!n.isClosed()){var i=n.subscriptionObserver=new q_(n);try{var o=e(i),s=o;uce(o)||(n.cleanup=z4(o.unsubscribe)?function(){s.unsubscribe()}:V4(o))}catch(l){i.error(l);return}n.isClosed()&&n.clean()}};H_.prototype=U_({},{unsubscribe:function(){var e=Q4(this);e.isClosed()||(e.close(),e.clean())}});Zf&&G4(H_.prototype,"closed",{configurable:!0,get:function(){return Q4(this).isClosed()}});var q_=function(t){$_(this,{type:J4,subscriptionState:t}),Zf||(this.closed=!1)};q_.prototype=U_({},{next:function(e){var n=Pm(this).subscriptionState;if(!n.isClosed()){var r=n.observer;try{var i=km(r,"next");i&&Rm(i,r,e)}catch(o){tu(o)}}},error:function(e){var n=Pm(this).subscriptionState;if(!n.isClosed()){var r=n.observer;n.close();try{var i=km(r,"error");i?Rm(i,r,e):tu(e)}catch(o){tu(o)}n.clean()}},complete:function(){var e=Pm(this).subscriptionState;if(!e.isClosed()){var n=e.observer;e.close();try{var r=km(n,"complete");r&&Rm(r,n)}catch(i){tu(i)}e.clean()}}});Zf&&G4(q_.prototype,"closed",{configurable:!0,get:function(){return Pm(this).subscriptionState.isClosed()}});var Y4=function(e){cce(this,j_),$_(this,{type:F_,subscriber:V4(e)})},j_=Y4.prototype;U_(j_,{subscribe:function(e){var n=arguments.length;return new H_(z4(e)?{next:e,error:n>1?arguments[1]:void 0,complete:n>2?arguments[2]:void 0}:dce(e)?e:{},gce(this).subscriber)}});hce(j_,pce,function(){return this});sce({global:!0,constructor:!0,forced:!0},{Observable:Y4});ace(F_);var mce=Rt,vce=xn,yce=zt,_D=bn,Cce=Ay,Sce=n4,Tce=hs,Ece=O_,wce=Gt,Ice=wce("observable");mce({target:"Observable",stat:!0,forced:!0},{from:function(e){var n=Cce(this)?this:vce("Observable"),r=Tce(_D(e),Ice);if(r){var i=_D(yce(r,e));return i.constructor===n?i:new n(function(s){return i.subscribe(s)})}var o=Sce(e);return new n(function(s){Ece(o,function(l,c){if(s.next(l),s.closed)return c()},{IS_ITERATOR:!0,INTERRUPTED:!0}),s.complete()})}});var bce=Rt,Z4=xn,_ce=Ay,Ace=Z4("Array");bce({target:"Observable",stat:!0,forced:!0},{of:function(){for(var e=_ce(this)?this:Z4("Observable"),n=arguments.length,r=Ace(n),i=0;i<n;)r[i]=arguments[i++];return new e(function(o){for(var s=0;s<n;s++)if(o.next(r[s]),o.closed)return;o.complete()})}});var Rce=ld,kce=Rce.Observable,Pce=kce;const Lh=Ov(Pce);function AD(t){let e=[],n;return new Lh(r=>(e=[...e,r],n||(n=t.subscribe({complete:()=>e.forEach(i=>i.complete()),error:i=>e.forEach(o=>o.error(i)),next:i=>e.forEach(o=>o.next(i))})),()=>{e=e.filter(i=>i!==r),e.length||(n.unsubscribe(),n=void 0)}))}var ye;(function(t){t.BotId="acs.botId",t.ChatClient="acs.chatClient",t.ChatThreadClient="acs.chatThreadClient",t.Reconnect="acs.reconnect",t.UserId="acs.userId",t.UserDisplayName="acs.userDisplayName",t.AuthConfig="acs.authConfig",t.ConnectionStatusObserverReady="dl.connectionStatusObserverReady",t.ThreadId="acs.threadId",t.DisconnectUTC="acs.disconnectUTC",t.AdapterOptions="acs.adapterOptions",t.EventManager="acs.eventManager",t.EnvironmentUrl="acs.environmentUrl",t.Token="acs.token",t.FileManager="fileManager",t.PollingInterval="pollingInterval",t.WebChatStatus="webChatStatus",t.MessagePollingHandleInstance="messagePollingHandleInstance"})(ye||(ye={}));var Fe;(function(t){t.INFO="INFO",t.DEBUG="DEBUG",t.WARN="WARN",t.ERROR="ERROR"})(Fe||(Fe={}));const Ue={loggerInstance:void 0,setInstance:t=>{Ue.loggerInstance=t},logEvent:(t,e)=>{Ue.loggerInstance!==void 0&&Ue.loggerInstance.logEvent(t,e)}};var Le;(function(t){t.ADAPTER_STATE_UPDATE="ADAPTER_STATE_UPDATE",t.ACS_SDK_START_INIT="ACS_SDK_START_INIT",t.ACS_SDK_START_INIT_ERROR="ACS_SDK_START_INIT_ERROR",t.ACS_SDK_CHATCLIENT_ERROR="ACS_SDK_CHATCLIENT_ERROR",t.ACS_SDK_JOINTHREAD_ERROR="ACS_SDK_JOINTHREAD_ERROR",t.ACS_SDK_CHATCLIENT_RECONNECT_ERROR="ACS_SDK_CHATCLIENT_RECONNECT_ERROR",t.ACS_ADAPTER_ATTACHMENT_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_DOWNLOADED",t.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR="ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR",t.ACS_ADAPTER_ATTACHMENT_NEW="ACS_ADAPTER_ATTACHMENT_NEW",t.ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED",t.ACS_ADAPTER_PROCESSED_ATTACHMENTS="ACS_ADAPTER_PROCESSED_ATTACHMENTS",t.ACS_ADAPTER_CONVERT_HISTORY="ACS_ADAPTER_CONVERT_HISTORY",t.ACS_ADAPTER_CONVERT_TYPING_MESSAGE="ACS_ADAPTER_CONVERT_TYPING_MESSAGE",t.ACS_ADAPTER_CONVERT_MESSAGE="ACS_ADAPTER_CONVERT_MESSAGE",t.ACS_ADAPTER_CONVERT_EDITED_MESSAGE="ACS_ADAPTER_CONVERT_EDITED_MESSAGE",t.ACS_ADAPTER_CONVERT_DELETED_MESSAGE="ACS_ADAPTER_CONVERT_DELETED_MESSAGE",t.ACS_ADAPTER_CONVERT_THREAD_UPDATED="ACS_ADAPTER_CONVERT_THREAD_UPDATED",t.ACS_ADAPTER_CONVERT_THREAD_DELETED="ACS_ADAPTER_CONVERT_THREAD_DELETED",t.ACS_ADAPTER_INGRESS_MESSAGE="ACS_ADAPTER_INGRESS_MESSAGE",t.ACS_ADAPTER_INGRESS_FAILED="ACS_ADAPTER_INGRESS_FAILED",t.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED="ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED",t.ACS_ADAPTER_EGRESS_MESSAGE="ACS_ADAPTER_EGRESS_MESSAGE",t.ACS_ADAPTER_EGRESS_SEND_MESSAGE="ACS_ADAPTER_EGRESS_SEND_MESSAGE",t.ACS_ADAPTER_EGRESS_FAILED="ACS_ADAPTER_EGRESS_FAILED",t.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS="ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS",t.ACS_ADAPTER_SEND_MESSAGE_FAILED="ACS_ADAPTER_SEND_MESSAGE_FAILED",t.ACS_ADAPTER_SEND_MESSAGE_SUCCESS="ACS_ADAPTER_SEND_MESSAGE_SUCCESS",t.ACS_ADAPTER_SEND_MESSAGE_RETRY="ACS_ADAPTER_SEND_MESSAGE_RETRY",t.ACS_ADAPTER_INGRESS_TYPING_FAILED="ACS_ADAPTER_INGRESS_TYPING_FAILED",t.ACS_ADAPTER_INGRESS_TYPING_SUCCESS="ACS_ADAPTER_INGRESS_TYPING_SUCCESS",t.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST="ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST",t.ACS_ADAPTER_EGRESS_TYPING_FAILED="ACS_ADAPTER_EGRESS_TYPING_FAILED",t.ACS_ADAPTER_EGRESS_TYPING_SUCCESS="ACS_ADAPTER_EGRESS_TYPING_SUCCESS",t.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED",t.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED",t.ACS_PROCESSING_POLLED_MESSAGE="ACS_PROCESSING_POLLED_MESSAGE",t.ACS_PROCESSING_NEW_MESSAGE="ACS_PROCESSING_NEW_MESSAGE",t.ACS_PROCESSING_EDITED_MESSAGE="ACS_PROCESSING_EDITED_MESSAGE",t.ACS_PROCESSING_DELETED_MESSAGE="ACS_PROCESSING_DELETED_MESSAGE",t.ACS_SKIP_POLLED_MESSAGE="ACS_SKIP_POLLED_MESSAGE",t.ACS_CANCEL_POLLING_CALLBACK="ACS_CANCEL_POLLING_CALLBACK",t.ACS_CREATE_POLLING_CALLBACK="ACS_CREATE_POLLING_CALLBACK",t.ACS_ADAPTER_POLLING_STATUSCODE="ACS_ADAPTER_POLLING_STATUSCODE",t.ACS_SEND_POLLING_REQUEST="ACS_SEND_POLLING_REQUEST",t.ACS_ADAPTER_POLLING_SKIPPED="ACS_ADAPTER_POLLING_SKIPPED",t.ACS_ADAPTER_POLLING_STOPPED="ACS_ADAPTER_POLLING_STOPPED",t.ACS_SKIP_NEW_MESSAGE="ACS_SKIP_NEW_MESSAGE",t.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK="ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK",t.ACS_SKIP_EDITED_MESSAGE="ACS_SKIP_EDITED_MESSAGE",t.ACS_SKIP_DELETED_MESSAGE="ACS_SKIP_DELETED_MESSAGE",t.ACS_ADAPTER_POST_ACTIVITY="ACS_ADAPTER_POST_ACTIVITY",t.ACS_ADAPTER_POST_FILE_ACTIVITY="ACS_ADAPTER_POST_FILE_ACTIVITY",t.ACS_SDK_RECONNECT="ACS_SDK_RECONNECT",t.MESSAGE_RECEIVED="ADAPTER_MESSAGE_RECEIVED",t.PROCESS_CACHED_PAGED_HISTORY_MESSAGE="PROCESS_CACHED_PAGED_HISTORY_MESSAGE",t.PROCESS_CACHED_HISTORY_MESSAGE="PROCESS_CACHED_HISTORY_MESSAGE",t.PROCESS_CACHED_NEW_MESSAGE="PROCESS_CACHED_NEW_MESSAGE",t.CACHE_PAGED_HISTORY_MESSAGE="CACHE_PAGED_HISTORY_MESSAGE",t.CACHE_POLLED_HISTORY_MESSAGE="CACHE_POLLED_HISTORY_MESSAGE",t.CACHE_NEW_MESSAGE="CACHE_NEW_MESSAGE",t.TYPING_MESSAGE_RECEIVED="ADAPTER_TYPING_MESSAGE_RECEIVED",t.THREAD_THREAD_UPDATED="ADAPTER_THREAD_UPDATED_RECEIVED",t.THREAD_DELETED_RECEIVED="ADAPTER_THREAD_DELETED_RECEIVED",t.PARTICIPANT_REMOVED_RECEIVED="ADAPTER_PARTICIPANT_REMOVED_RECEIVED",t.PARTICIPANT_ADDED_RECEIVED="ADAPTER_PARTICIPANT_ADDED_RECEIVED",t.MESSAGE_EDIT_RECEIVED="ADAPTER_MESSAGE_EDIT_RECEIVED",t.MESSAGE_DELETED_RECEIVED="ADAPTER_MESSAGE_DELETED_RECEIVED",t.REGISTER_ON_NEW_MESSAGE="ADAPTER_REGISTER_ON_NEW_MESSAGE",t.REGISTER_ON_TYPING_INDICATOR="ADAPTER_REGISTER_ON_TYPING_INDICATOR",t.REGISTER_ON_MESSAGE_EDIT="ADAPTER_REGISTER_ON_MESSAGE_EDIT",t.REGISTER_ON_MESSAGE_DELETED="REGISTER_ON_MESSAGE_DELETED",t.REGISTER_ON_THREAD_DELETED="ADAPTER_REGISTER_ON_THREAD_DELETED",t.REGISTER_ON_THREAD_UPDATED="ADAPTER_REGISTER_ON_THREAD_UPDATED",t.REGISTER_ON_PARTICIPANT_ADDED="ADAPTER_REGISTER_ON_PARTICIPANT_ADDED",t.REGISTER_ON_PARTICIPANT_REMOVED="ADAPTER_REGISTER_ON_PARTICIPANT_REMOVED",t.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED",t.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED",t.NETWORK_ONLINE="NETWORK_ONLINE",t.NETWORK_OFFLINE="NETWORK_OFFLINE",t.FILEMANAGER_DOWNLOAD_FILE_FAILED="FILEMANAGER_DOWNLOAD_FILE_FAILED",t.FILEMANAGER_UPLOAD_FILE_FAILED="FILEMANAGER_UPLOAD_FILE_FAILED",t.FILEMANAGER_UPLOAD_FILE_REQUEST="FILEMANAGER_UPLOAD_FILE_REQUEST",t.WEBCHAT_SUBSCRIPTION_TIMEOUT="WEBCHAT_SUBSCRIPTION_TIMEOUT",t.WEBCHAT_SUBSCRIPTION_SUCCESS="WEBCHAT_SUBSCRIPTION_SUCCESS",t.WEBCHAT_STATUS_CONNECTED="WEBCHAT_STATUS_CONNECTED",t.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",t.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",t.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK="ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK",t.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK="ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK",t.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT="ACS_PROCESSING_PARTICIPANT_ADDED_EVENT",t.ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT="ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT",t.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED="ACS_PARTICIPANT_ADDED_EVENT_PROCESSED",t.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED="ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED",t.UNSUPPORTED_MESSAGE_TYPE="UNSUPPORTED_MESSAGE_TYPE"})(Le||(Le={}));var _r;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.FailedToConnect=4]="FailedToConnect"})(_r||(_r={}));function Oce(t){return new Promise(e=>setTimeout(()=>{e()},t))}function Mce(){return t=>e=>{const n=t(e);let r;n.setState(ye.WebChatStatus,_r.Uninitialized),n.addEventListener("open",()=>We(this,void 0,void 0,function*(){const o=n.getState(ye.EventManager);if(Ue.logEvent(Fe.INFO,{Event:Le.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to open"}),r)Ue.logEvent(Fe.INFO,{Event:Le.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:"WebChat already connected"}),r.next(_r.Connected),n.setState(ye.WebChatStatus,_r.Connected),o.raiseCustomEvent("webchat-status-connected",{});else{let s=5;const l=e!=null&&e.webChatInitTimeout?e==null?void 0:e.webChatInitTimeout:2e3;for(;!r&&s<l;)yield Oce(s),s=s*2;r?(Ue.logEvent(Fe.INFO,{Event:Le.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:`WebChat subscribed to connection status changes in ${s} ms`}),r.next(_r.Connected),n.setState(ye.WebChatStatus,_r.Connected),o.raiseCustomEvent("webchat-status-connected",{})):(Ue.logEvent(Fe.ERROR,{Event:Le.WEBCHAT_SUBSCRIPTION_TIMEOUT,Description:`WebChat couldn't subscribe to connection status changes in ${l} ms`}),o.handleError(new Error("WebChat subscription timeout to connection status changes")),n.setState(ye.WebChatStatus,_r.FailedToConnect))}})),n.addEventListener("error",()=>{Ue.logEvent(Fe.INFO,{Event:Le.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to error"});const o=n.getReadyState()===er.CLOSED?_r.FailedToConnect:_r.Connecting;r&&r.next(o),n.setState(ye.WebChatStatus,o)});let i=!0;return Object.assign(Object.assign({},n),{activity$:AD(new Lh(o=>{const s=new AbortController;return function(){var l,c,a,u;return We(this,void 0,void 0,function*(){try{try{for(var d=!0,f=Rr(n.activities({signal:s.signal})),h;h=yield f.next(),l=h.done,!l;){u=h.value,d=!1;try{const g=u;o.next(g)}finally{d=!0}}}catch(g){c={error:g}}finally{try{!d&&!l&&(a=f.return)&&(yield a.call(f))}finally{if(c)throw c.error}}o.complete()}catch(g){o.error(g)}})}(),i?i=!1:(n.setReadyState(er.CONNECTING),n.setReadyState(er.OPEN),n.setState(ye.Reconnect,!0)),()=>{s.abort()}})),connectionStatus$:AD(new Lh(o=>(o.next(_r.Uninitialized),o.next(_r.Connecting),r=o,()=>{r=void 0}))),end:()=>{n.close()},postActivity(o){return new Lh(s=>{(function(){return We(this,void 0,void 0,function*(){yield n.egress(o,{progress:({id:l})=>l&&s.next(l)}),s.complete()})})()})}})}}const{CLOSED:fye,CONNECTING:pye,OPEN:gye}=er,Dce=t=>{const{participants:e,idempotencyToken:n}=t,r=Cn(t,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)},e$=t=>{const{id:e}=t,n=Cn(t,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:Nf(e)})},Nce=t=>{var e;return{participants:(e=t.participants)===null||e===void 0?void 0:e.map(n=>e$(n))}},t$=t=>{const{attachmentType:e}=t,n=Cn(t,["attachmentType"]);if(e==="unknown")throw new Error("'unknown' attachmentType not supported");return Object.assign(Object.assign({},n),{attachmentType:e})},xce=(t,e)=>{const{attachments:n}=e,r=Cn(e,["attachments"]);let i=Object.assign(Object.assign({},t),r);return n&&(i=Object.assign(Object.assign({},i),{attachments:n==null?void 0:n.map(o=>t$(o))})),i},Lce=t=>{const{attachments:e}=t,n=Cn(t,["attachments"]);let r=Object.assign({},n);return e&&(r=Object.assign(Object.assign({},r),{attachments:e==null?void 0:e.map(i=>t$(i))})),r},kw=t=>{const{communicationIdentifier:e}=t,n=Cn(t,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:Vo(e)})},Uce=t=>{const{attachmentType:e}=t,n=Cn(t,["attachmentType"]);return Object.assign(Object.assign({},n),{attachmentType:e})},Fce=t=>{const{participants:e,attachments:n,initiatorCommunicationIdentifier:r}=t,i=Cn(t,["participants","attachments","initiatorCommunicationIdentifier"]);let o=Object.assign({},i);if(r){const s=Vo(r);o=Object.assign(Object.assign({},o),{initiator:s})}return e&&(o=Object.assign(Object.assign({},o),{participants:e==null?void 0:e.map(s=>kw(s))})),n&&(o=Object.assign(Object.assign({},o),{attachments:n==null?void 0:n.map(s=>Uce(s))})),o},Bce=t=>{const{state:e}=t;return{result:e}},JS=t=>{const{content:e,senderCommunicationIdentifier:n,policyViolation:r}=t,i=Cn(t,["content","senderCommunicationIdentifier","policyViolation"]);let o=Object.assign({},i);if(e&&(o=Object.assign(Object.assign({},o),{content:Fce(e)})),n){const s=Vo(n);o=Object.assign(Object.assign({},o),{sender:s})}return r&&(o=Object.assign(Object.assign({},o),{policyViolation:Bce(r)})),o},$ce=t=>{if(t.kind==="threadCreationDate"||t.kind==="none")return t;throw new Error(`Retention Policy ${t.kind} is not supported`)},n$=t=>{const{createdByCommunicationIdentifier:e,retentionPolicy:n}=t,r=Cn(t,["createdByCommunicationIdentifier","retentionPolicy"]);let i=Object.assign({},r);return e&&(i=Object.assign(Object.assign({},i),{createdBy:Vo(e)})),n&&(i=Object.assign(Object.assign({},i),{retentionPolicy:$ce(n)})),i},Hce=t=>{const{chatThread:e}=t,n=Cn(t,["chatThread"]);return e?Object.assign(Object.assign({},n),{chatThread:n$(e)}):Object.assign({},n)},RD=t=>{const{senderCommunicationIdentifier:e}=t,n=Cn(t,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:Vo(e)})};var kD;(function(t){t.Unknown="unknown",t.CommunicationUser="communicationUser",t.PhoneNumber="phoneNumber",t.MicrosoftTeamsUser="microsoftTeamsUser",t.MicrosoftTeamsApp="microsoftTeamsApp"})(kD||(kD={}));var PD;(function(t){t.Public="public",t.Dod="dod",t.Gcch="gcch"})(PD||(PD={}));var OD;(function(t){t.Original="original",t.Small="small"})(OD||(OD={}));const Et=qb({namespace:"Azure.Communication",packageName:"@azure/communication-chat",packageVersion:"1.6.0-beta.4"}),V_={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},qce={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},r$={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{kind:{serializedName:"kind",type:{name:"String"}},rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}},microsoftTeamsApp:{serializedName:"microsoftTeamsApp",type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel"}}}}},jce={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Vce={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},zce={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Gce={type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel",modelProperties:{appId:{serializedName:"appId",required:!0,type:{name:"String"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Ge={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},Wce={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},i$={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},o$={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},Kce={type:{name:"Composite",className:"ChatAttachment",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",required:!0,type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}},url:{serializedName:"url",type:{name:"String"}},previewUrl:{serializedName:"previewUrl",type:{name:"String"}}}}},s$={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},z_={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},a$={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},policyViolation:{serializedName:"policyViolation",type:{name:"Composite",className:"PolicyViolation"}}}}},Jce={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},Qce={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},Xce={type:{name:"Composite",className:"PolicyViolation",modelProperties:{state:{serializedName:"state",required:!0,type:{name:"Enum",allowedValues:["contentBlocked","warning"]}}}}},l$={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},G_={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},c$={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},u$={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},d$={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},Du={type:{name:"Composite",className:"ChatRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:{serializedName:"kind",clientName:"kind"},modelProperties:{kind:{serializedName:"kind",required:!0,type:{name:"Enum",allowedValues:["threadCreationDate","none"]}}}}},h$={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},f$={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}},messagingPolicy:{serializedName:"messagingPolicy",type:{name:"Composite",className:"MessagingPolicy"}}}}},Yce={type:{name:"Composite",className:"MessagingPolicy",modelProperties:{textOnlyChat:{serializedName:"textOnlyChat",type:{name:"Boolean"}}}}},W_={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Zce={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},p$={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},g$={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},m$={type:{name:"Composite",className:"UploadChatImageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}}}}},$y={type:{name:"Composite",className:"ErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ErrorModel"}}}}},eue={type:{name:"Composite",className:"ErrorModel",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},details:{serializedName:"details",type:{name:"Sequence",element:{type:{name:"Composite",className:"ErrorDetail"}}}}}}},tue={type:{name:"Composite",className:"ErrorDetail",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}}}}},v$={serializedName:"threadCreationDate",type:{name:"Composite",className:"ThreadCreationDateRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:Du.type.polymorphicDiscriminator,modelProperties:Object.assign(Object.assign({},Du.type.modelProperties),{deleteThreadAfterDays:{serializedName:"deleteThreadAfterDays",required:!0,type:{name:"Number"}}})}},y$={serializedName:"none",type:{name:"Composite",className:"NoneRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:Du.type.polymorphicDiscriminator,modelProperties:Object.assign({},Du.type.modelProperties)}};let nue={ChatRetentionPolicy:Du,"ChatRetentionPolicy.threadCreationDate":v$,"ChatRetentionPolicy.none":y$};const C$=Object.freeze(Object.defineProperty({__proto__:null,AddChatParticipantsRequest:c$,AddChatParticipantsResult:u$,ChatAttachment:Kce,ChatError:Wce,ChatMessage:a$,ChatMessageContent:Jce,ChatMessageReadReceipt:qce,ChatMessageReadReceiptsCollection:V_,ChatMessagesCollection:z_,ChatParticipant:Qce,ChatParticipantsCollection:G_,ChatRetentionPolicy:Du,ChatThreadItem:Zce,ChatThreadProperties:f$,ChatThreadsItemCollection:W_,CommunicationErrorResponse:Ge,CommunicationIdentifierModel:r$,CommunicationUserIdentifierModel:jce,CreateChatThreadRequest:d$,CreateChatThreadResult:h$,ErrorDetail:tue,ErrorModel:eue,ErrorResponse:$y,MessagingPolicy:Yce,MicrosoftTeamsAppIdentifierModel:Gce,MicrosoftTeamsUserIdentifierModel:zce,NoneRetentionPolicy:y$,PhoneNumberIdentifierModel:Vce,PolicyViolation:Xce,SendChatMessageRequest:o$,SendChatMessageResult:s$,SendReadReceiptRequest:i$,SendTypingNotificationRequest:g$,ThreadCreationDateRetentionPolicy:v$,UpdateChatMessageRequest:l$,UpdateChatThreadRequest:p$,UploadChatImageResult:m$,discriminators:nue},Symbol.toStringTag,{value:"Module"})),Ln={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},Tn={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},Kn={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},Hy={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},S$={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},rr={parameterPath:"apiVersion",mapper:{defaultValue:"2024-06-05-preview",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},dd={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},rue={parameterPath:"sendReadReceiptRequest",mapper:i$},iue={parameterPath:"sendChatMessageRequest",mapper:o$},T$={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},K_={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},E$={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},oue={parameterPath:"updateChatMessageRequest",mapper:l$},sue={parameterPath:"participantCommunicationIdentifier",mapper:r$},aue={parameterPath:"addChatParticipantsRequest",mapper:c$},lue={parameterPath:"updateChatThreadRequest",mapper:p$},cue={parameterPath:["options","sendTypingNotificationRequest"],mapper:g$},uue={parameterPath:["options","contentType"],mapper:{defaultValue:"application/octet-stream",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},due={parameterPath:"chatImageFile",mapper:{serializedName:"chatImageFile",required:!0,type:{name:"Stream"}}},hue={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},fue={parameterPath:["options","imageFilename"],mapper:{serializedName:"image-filename",type:{name:"String"}}},pue={parameterPath:"accept",mapper:{defaultValue:"application/json, image/gif, image/jpeg, image/png, image/bmp, image/tiff",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},w$={parameterPath:"imageId",mapper:{serializedName:"imageId",required:!0,type:{name:"String"}}},gue={parameterPath:"imageViewType",mapper:{serializedName:"imageViewType",required:!0,type:{name:"String"}}},qy={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},mue={parameterPath:"createChatThreadRequest",mapper:d$},vue={parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}};class yue{constructor(e){this.client=e}async listChatReadReceipts(e,n){return Et.withSpan("ChatApiClient.listChatReadReceipts",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},Cue))}async sendChatReadReceipt(e,n,r){return Et.withSpan("ChatApiClient.sendChatReadReceipt",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:n,options:i},Sue))}async sendChatMessage(e,n,r){return Et.withSpan("ChatApiClient.sendChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:n,options:i},Tue))}async listChatMessages(e,n){return Et.withSpan("ChatApiClient.listChatMessages",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},Eue))}async getChatMessage(e,n,r){return Et.withSpan("ChatApiClient.getChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,options:i},wue))}async updateChatMessage(e,n,r,i){return Et.withSpan("ChatApiClient.updateChatMessage",i??{},async o=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,updateChatMessageRequest:r,options:o},Iue))}async deleteChatMessage(e,n,r){return Et.withSpan("ChatApiClient.deleteChatMessage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:n,options:i},bue))}async listChatParticipants(e,n){return Et.withSpan("ChatApiClient.listChatParticipants",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},_ue))}async removeChatParticipant(e,n,r){return Et.withSpan("ChatApiClient.removeChatParticipant",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:n,options:i},Aue))}async addChatParticipants(e,n,r){return Et.withSpan("ChatApiClient.addChatParticipants",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:n,options:i},Rue))}async updateChatThreadProperties(e,n,r){return Et.withSpan("ChatApiClient.updateChatThreadProperties",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:n,options:i},kue))}async getChatThreadProperties(e,n){return Et.withSpan("ChatApiClient.getChatThreadProperties",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},Pue))}async sendTypingNotification(e,n){return Et.withSpan("ChatApiClient.sendTypingNotification",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},Oue))}async uploadChatImage(e,n,r){return Et.withSpan("ChatApiClient.uploadChatImage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,chatImageFile:n,options:i},Mue))}async getChatImage(e,n,r,i){return Et.withSpan("ChatApiClient.getChatImage",i??{},async o=>this.client.sendOperationRequest({chatThreadId:e,imageId:n,imageViewType:r,options:o},Due))}async deleteChatImage(e,n,r){return Et.withSpan("ChatApiClient.deleteChatImage",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,imageId:n,options:i},Nue))}async listChatReadReceiptsNext(e,n,r){return Et.withSpan("ChatApiClient.listChatReadReceiptsNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},xue))}async listChatMessagesNext(e,n,r){return Et.withSpan("ChatApiClient.listChatMessagesNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},Lue))}async listChatParticipantsNext(e,n,r){return Et.withSpan("ChatApiClient.listChatParticipantsNext",r??{},async i=>this.client.sendOperationRequest({chatThreadId:e,nextLink:n,options:i},Uue))}}const ir=xf(C$,!1),Cue={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:V_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[Hy,S$,rr],urlParameters:[Tn,Kn],headerParameters:[Ln],serializer:ir},Sue={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:rue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,dd],mediaType:"json",serializer:ir},Tue={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:s$},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:iue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,dd],mediaType:"json",serializer:ir},Eue={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:z_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[Hy,rr,T$],urlParameters:[Tn,Kn],headerParameters:[Ln],serializer:ir},wue={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:a$},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[rr],urlParameters:[Tn,Kn,K_],headerParameters:[Ln],serializer:ir},Iue={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:oue,queryParameters:[rr],urlParameters:[Tn,Kn,K_],headerParameters:[Ln,E$],mediaType:"json",serializer:ir},bue={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[rr],urlParameters:[Tn,Kn,K_],headerParameters:[Ln],serializer:ir},_ue={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:G_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[Hy,S$,rr],urlParameters:[Tn,Kn],headerParameters:[Ln],serializer:ir},Aue={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:sue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,dd],mediaType:"json",serializer:ir},Rue={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:u$},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:aue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,dd],mediaType:"json",serializer:ir},kue={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:lue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,E$],mediaType:"json",serializer:ir},Pue={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:f$},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln],serializer:ir},Oue={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:cue,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln,dd],mediaType:"json",serializer:ir},Mue={path:"/chat/threads/{chatThreadId}/images",httpMethod:"POST",responses:{201:{bodyMapper:m$},default:{bodyMapper:$y}},requestBody:due,queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[uue,hue,fue],mediaType:"binary",serializer:ir},Due={path:"/chat/threads/{chatThreadId}/images/{imageId}/view/{imageViewType}",httpMethod:"GET",responses:{200:{bodyMapper:{type:{name:"Stream"},serializedName:"parsedResponse"}},default:{bodyMapper:$y}},queryParameters:[rr],urlParameters:[Tn,Kn,w$,gue],headerParameters:[pue],serializer:ir},Nue={path:"/chat/threads/{chatThreadId}/images/{imageId}",httpMethod:"DELETE",responses:{204:{},default:{bodyMapper:$y}},queryParameters:[rr],urlParameters:[Tn,Kn,w$],headerParameters:[Ln],serializer:ir},xue={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:V_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},urlParameters:[Tn,Kn,qy],headerParameters:[Ln],serializer:ir},Lue={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:z_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},urlParameters:[Tn,Kn,qy],headerParameters:[Ln],serializer:ir},Uue={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:G_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},urlParameters:[Tn,Kn,qy],headerParameters:[Ln],serializer:ir};class Fue{constructor(e){this.client=e}async createChatThread(e,n){return Et.withSpan("ChatApiClient.createChatThread",n??{},async r=>this.client.sendOperationRequest({createChatThreadRequest:e,options:r},Bue))}async listChatThreads(e){return Et.withSpan("ChatApiClient.listChatThreads",e??{},async n=>this.client.sendOperationRequest({options:n},$ue))}async deleteChatThread(e,n){return Et.withSpan("ChatApiClient.deleteChatThread",n??{},async r=>this.client.sendOperationRequest({chatThreadId:e,options:r},Hue))}async listChatThreadsNext(e,n){return Et.withSpan("ChatApiClient.listChatThreadsNext",n??{},async r=>this.client.sendOperationRequest({nextLink:e,options:r},que))}}const jy=xf(C$,!1),Bue={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:h$},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},requestBody:mue,queryParameters:[rr],urlParameters:[Tn],headerParameters:[Ln,dd,vue],mediaType:"json",serializer:jy},$ue={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:W_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[Hy,rr,T$],urlParameters:[Tn],headerParameters:[Ln],serializer:jy},Hue={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},queryParameters:[rr],urlParameters:[Tn,Kn],headerParameters:[Ln],serializer:jy},que={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:W_},401:{bodyMapper:Ge,isError:!0},403:{bodyMapper:Ge,isError:!0},429:{bodyMapper:Ge,isError:!0},503:{bodyMapper:Ge,isError:!0}},urlParameters:[Tn,qy],headerParameters:[Ln],serializer:jy};class Pw extends Vb{constructor(e,n){var r,i;if(e===void 0)throw new Error("'endpoint' cannot be null");n||(n={});const o={requestContentType:"application/json; charset=utf-8"},s="azsdk-js-communication-chat/1.6.0-beta.4",l=n.userAgentOptions&&n.userAgentOptions.userAgentPrefix?`${n.userAgentOptions.userAgentPrefix} ${s}`:`${s}`,c=Object.assign(Object.assign(Object.assign({},o),n),{userAgentOptions:{userAgentPrefix:l},endpoint:(i=(r=n.endpoint)!==null&&r!==void 0?r:n.baseUri)!==null&&i!==void 0?i:"{endpoint}"});super(c),this.endpoint=e,this.apiVersion=n.apiVersion||"2024-06-05-preview",this.chatThread=new yue(this),this.chat=new Fue(this),this.addCustomApiVersionPolicy(n.apiVersion)}addCustomApiVersionPolicy(e){if(!e)return;const n={name:"CustomApiVersionPolicy",async sendRequest(r,i){const o=r.url.split("?");if(o.length>1){const s=o[1].split("&").map(l=>l.indexOf("api-version")>-1?"api-version="+e:l);r.url=o[0]+"?"+s.join("&")}return i(r)}};this.pipeline.addPolicy(n)}}const Uh=Mf("communication-chat");function jue(t){return t&&typeof t.pipe=="function"}function Vue(t){return(typeof Blob=="function"||typeof Blob=="object")&&t instanceof Blob}function Sh(t){return!!(t&&typeof t.getReader=="function"&&typeof t.tee=="function")}class zue{async sendRequest(e){var n;if(new URL(e.url).protocol!=="https:"&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);const o=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const s=e.abortSignal;if(s){if(s.aborted)throw new Nb("The operation was aborted.");const c=()=>{o.abort()};s.addEventListener("abort",c),o.addEventListener("readystatechange",()=>{o.readyState===XMLHttpRequest.DONE&&s.removeEventListener("abort",c)})}MD(o.upload,e.onUploadProgress),MD(o,e.onDownloadProgress),o.open(e.method,e.url),o.timeout=e.timeout,o.withCredentials=e.withCredentials;for(const[c,a]of e.headers)o.setRequestHeader(c,a);o.responseType=!((n=e.streamResponseStatusCodes)===null||n===void 0)&&n.size?"blob":"text";const l=typeof e.body=="function"?e.body():e.body;if(jue(l)||Sh(l))throw new Error("Streams are not supported by xhrHttpClient.");return o.send(l===void 0?null:l),o.responseType==="blob"?new Promise((c,a)=>{Gue(o,e,c,a),Ow(e,o,a)}):new Promise(function(c,a){o.addEventListener("load",()=>c({request:e,status:o.status,headers:Om(o),bodyAsText:o.responseText})),Ow(e,o,a)})}}function Gue(t,e,n,r){t.addEventListener("readystatechange",()=>{var i,o;if(t.readyState===XMLHttpRequest.HEADERS_RECEIVED)if(!((i=e.streamResponseStatusCodes)===null||i===void 0)&&i.has(Number.POSITIVE_INFINITY)||!((o=e.streamResponseStatusCodes)===null||o===void 0)&&o.has(t.status)){const s=new Promise((l,c)=>{t.addEventListener("load",()=>{l(t.response)}),Ow(e,t,c)});n({request:e,status:t.status,headers:Om(t),blobBody:s})}else t.addEventListener("load",()=>{t.response?t.response.text().then(s=>{n({request:e,status:t.status,headers:Om(t),bodyAsText:s})}).catch(s=>{r(s)}):n({request:e,status:t.status,headers:Om(t)})})})}function MD(t,e){e&&t.addEventListener("progress",n=>e({loadedBytes:n.loaded}))}function Om(t){const e=X2(),n=t.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const r of n){const i=r.indexOf(":"),o=r.slice(0,i),s=r.slice(i+2);e.set(o,s)}return e}function Ow(t,e,n){e.addEventListener("error",()=>n(new Hl(`Failed to send request to ${t.url}`,{code:Hl.REQUEST_SEND_ERROR,request:t})));const r=new Nb("The operation was aborted.");e.addEventListener("abort",()=>n(r)),e.addEventListener("timeout",()=>n(r))}function Wue(){return new zue}const I$=t=>Df({credential:{getToken:(n,r)=>t.getToken({abortSignal:r==null?void 0:r.abortSignal})},scopes:[]}),Kue=8e3;class Jue{constructor(e,n,r,i={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=n,this.tokenCredential=r;const o=Object.assign(Object.assign({},i),{loggingOptions:{logger:Uh.info}});this.client=new Pw(this.endpoint,Object.assign({endpoint:this.endpoint},o));const s=I$(this.tokenCredential);this.client.pipeline.addPolicy(s),typeof XMLHttpRequest<"u"&&(this.xhrClient=new Pw(this.endpoint,Object.assign(Object.assign({endpoint:this.endpoint},o),{httpClient:Wue()})),this.xhrClient.pipeline.addPolicy(s))}getProperties(e={}){return Et.withSpan("ChatClient-GetProperties",e,async n=>{const r=await this.client.chatThread.getChatThreadProperties(this.threadId,n);return n$(r)})}updateTopic(e,n={}){return Et.withSpan("ChatThreadClient-UpdateTopic",n,async r=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},r)})}updateProperties(e={}){return Et.withSpan("ChatThreadClient-UpdateProperties",e,async n=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,e,n)})}sendMessage(e,n={}){return Et.withSpan("ChatThreadClient-SendMessage",n,async r=>(this.timeOfLastTypingRequest=void 0,await this.client.chatThread.sendChatMessage(this.threadId,xce(e,n),r)))}getMessage(e,n={}){return Et.withSpan("ChatThreadClient-GetMessage",n,async r=>{const i=await this.client.chatThread.getChatMessage(this.threadId,e,r);return JS(i)})}listMessagesPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatMessages(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(JS,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatMessagesNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(JS,this));else break}})}listMessagesAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listMessagesPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listMessages(e={}){const{span:n,updatedOptions:r}=Et.startSpan("ChatThreadClient-ListMessages",e);try{const i=this.listMessagesAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listMessagesPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}deleteMessage(e,n={}){return Et.withSpan("ChatThreadClient-DeleteMessage",n,async r=>{await this.client.chatThread.deleteChatMessage(this.threadId,e,r)})}async updateMessage(e,n={}){return Et.withSpan("ChatThreadClient-UpdateMessage",n,async r=>{await this.client.chatThread.updateChatMessage(this.threadId,e,Lce(n),r)})}async addParticipants(e,n={}){return Et.withSpan("ChatThreadClient-AddParticipants",n,async r=>await this.client.chatThread.addChatParticipants(this.threadId,Nce(e),r))}listParticipantsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatParticipants(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(kw,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatParticipantsNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(kw,this));else break}})}listParticipantsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listParticipantsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listParticipants(e={}){const{span:n,updatedOptions:r}=Et.startSpan("ChatThreadClient-ListParticipants",e);try{const i=this.listParticipantsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listParticipantsPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}async removeParticipant(e,n={}){return Et.withSpan("ChatThreadClient-RemoveParticipant",n,async r=>{await this.client.chatThread.removeChatParticipant(this.threadId,Nf(e),r)})}async sendTypingNotification(e={}){return Et.withSpan("ChatThreadClient-SendTypingNotification",e,async n=>{const r=new Date,{senderDisplayName:i}=n,o=Cn(n,["senderDisplayName"]);return this.canPostTypingNotification(r)?(this.timeOfLastTypingRequest=r,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:i}},o)),!0):(Uh.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)})}async sendReadReceipt(e,n={}){return Et.withSpan("ChatThreadClient-SendReadReceipt",n,async r=>{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,r)})}listReadReceiptsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chatThread.listChatReadReceipts(this.threadId,i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value.map(RD,this)))}for(;r.continuationToken;){const o=yield at(this.client.chatThread.listChatReadReceiptsNext(this.threadId,r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value.map(RD,this));else break}})}listReadReceiptsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listReadReceiptsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listReadReceipts(e={}){const{span:n,updatedOptions:r}=Et.startSpan("ChatThreadClient-ListChatReadReceipts",e);try{const i=this.listReadReceiptsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listReadReceiptsPage(o,r)}}catch(i){throw n.setStatus({status:"error",error:i}),i}finally{n.end()}}canPostTypingNotification(e){return this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<Kue?(Uh.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1):!0}async uploadImage(e,n,r,i={}){let o={};return r!==void 0&&(typeof r=="number"?o=Object.assign(Object.assign({},i),{imageBytesLength:r}):o=Object.assign(Object.assign({},i),r)),Et.withSpan("ChatThreadClient-UploadImage",o,async s=>{let l;if(this.xhrClient&&(!this.supportsReadableStream()&&Sh(e)||!Sh(e)))l=await this.xhrClient.chatThread.uploadChatImage(this.threadId,Sh(e)?await this.getArrayBufferFromReadableStream(e):e,Object.assign({imageFilename:n},s));else{let c=e;Vue(e)?c=await this.getArrayBufferFromBlob(e):Sh(e)&&(c=await this.getArrayBufferFromReadableStream(e)),l=await this.client.chatThread.uploadChatImage(this.threadId,c,Object.assign({imageFilename:n},s))}return l})}deleteImage(e,n={}){return Et.withSpan("ChatThreadClient-DeleteImage",n,async r=>{await this.client.chatThread.deleteChatImage(this.threadId,e,r)})}supportsReadableStream(){let e=!1;const n=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}async getArrayBufferFromReadableStream(e){const n=await new Response(e).arrayBuffer();return new Uint8Array(n)}async getArrayBufferFromBlob(e){return new Uint8Array(await e.arrayBuffer())}}function Que(){return l2()}var b$={exports:{}};(function(t){var e=gF,n=mF,r=OF,i=MF;function o(X){return X&&typeof X=="object"&&"default"in X?X:{default:X}}var s=o(e),l=o(n),c=o(r),a=o(i),u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _e<"u"?_e:typeof self<"u"?self:{};function d(X){return X&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X}function f(X,B){return B={exports:{}},X(B,B.exports),B.exports}var h=f(function(X,B){(function(q,F){X.exports=F()})(u,function(){return function(q){function F(P){if(x[P])return x[P].exports;var v=x[P]={i:P,l:!1,exports:{}};return q[P].call(v.exports,v,v.exports,F),v.l=!0,v.exports}var x={};return F.m=q,F.c=x,F.i=function(P){return P},F.d=function(P,v,T){F.o(P,v)||Object.defineProperty(P,v,{configurable:!1,enumerable:!0,get:T})},F.n=function(P){var v=P&&P.__esModule?function(){return P.default}:function(){return P};return F.d(v,"a",v),v},F.o=function(P,v){return Object.prototype.hasOwnProperty.call(P,v)},F.p="",F(F.s=1)}([function(q,F,x){function P(_,N){var I,A=new Promise(function(H,L){fetch(_).then(function(C){I!==void 0&&clearTimeout(I),H(C)}).catch(function(C){I!==void 0&&clearTimeout(I),L(C)})});if(N!==0){var S=new Promise(function(H,L){I=setTimeout(L,N,new Error("Fetch for '".concat(_.url,"' timed out")))});return Promise.race([A,S])}return A}function v(_){try{return JSON.stringify(_)}catch{return"Unable to serialize object of type ".concat(typeof _)}}Object.defineProperty(F,"__esModule",{value:!0}),F.Timespan=F.toJson=F.fetchWithTimeout=void 0,F.fetchWithTimeout=P,F.toJson=v;var T=function(){function _(){this.start=Date.now()}return Object.defineProperty(_.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),_.prototype.reset=function(){this.start=Date.now()},_}();F.Timespan=T},function(q,F,x){function P(C,y,k){return new L(C,y,k)}var v=this&&this.__extends||function(){var C=function(y,k){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,V){Y.__proto__=V}||function(Y,V){for(var z in V)Object.prototype.hasOwnProperty.call(V,z)&&(Y[z]=V[z])})(y,k)};return function(y,k){function Y(){this.constructor=y}if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");C(y,k),y.prototype=k===null?Object.create(k):(Y.prototype=k.prototype,new Y)}}(),T=this&&this.__assign||function(){return T=Object.assign||function(C){for(var y,k=1,Y=arguments.length;k<Y;k++){y=arguments[k];for(var V in y)Object.prototype.hasOwnProperty.call(y,V)&&(C[V]=y[V])}return C},T.apply(this,arguments)},_=this&&this.__awaiter||function(C,y,k,Y){function V(z){return z instanceof k?z:new k(function(W){W(z)})}return new(k||(k=Promise))(function(z,W){function le(m){try{$(Y.next(m))}catch(R){W(R)}}function re(m){try{$(Y.throw(m))}catch(R){W(R)}}function $(m){m.done?z(m.value):V(m.value).then(le,re)}$((Y=Y.apply(C,y||[])).next())})},N=this&&this.__generator||function(C,y){function k($){return function(m){return Y([$,m])}}function Y($){if(V)throw new TypeError("Generator is already executing.");for(;le&&(le=0,$[0]&&(re=0)),re;)try{if(V=1,z&&(W=2&$[0]?z.return:$[0]?z.throw||((W=z.return)&&W.call(z),0):z.next)&&!(W=W.call(z,$[1])).done)return W;switch(z=0,W&&($=[2&$[0],W.value]),$[0]){case 0:case 1:W=$;break;case 4:return re.label++,{value:$[1],done:!1};case 5:re.label++,z=$[1],$=[0];continue;case 7:$=re.ops.pop(),re.trys.pop();continue;default:if(W=re.trys,!(W=W.length>0&&W[W.length-1])&&($[0]===6||$[0]===2)){re=0;continue}if($[0]===3&&(!W||$[1]>W[0]&&$[1]<W[3])){re.label=$[1];break}if($[0]===6&&re.label<W[1]){re.label=W[1],W=$;break}if(W&&re.label<W[2]){re.label=W[2],re.ops.push($);break}W[2]&&re.ops.pop(),re.trys.pop();continue}$=y.call(C,re)}catch(m){$=[6,m],z=0}finally{V=W=0}if(5&$[0])throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}var V,z,W,le,re={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return le={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(le[Symbol.iterator]=function(){return this}),le};Object.defineProperty(F,"__esModule",{value:!0}),F.createRegistrarClient=F.RegistrarClient=void 0;var I=x(0),A=["skype","aad","cae"],S=function(C){function y(k){var Y=C.call(this,k)||this;return Y.name="CancelationError",Y}return v(y,C),y}(Error),H=function(){function C(y,k,Y){this.logger=y,this.maxBackoffInMs=k,this.initialDelay=Y,this.backoffCount=0,this.id=++C.idCounter}return C.prototype.delay=function(y){var k=this;if(this.timerHandle!==void 0)throw new Error("Retry sequence logical failure");if(this.backoffCount===-1)return new Promise(function(V,z){z(new S("Cancelled"))});var Y=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off ".concat(y," for ").concat(Y," milliseconds with ID ").concat(this.id)),new Promise(function(V,z){k.cancelFunc=z,k.timerHandle=setTimeout(function(){k.logger.info("[RegistrarClient] Back off for ".concat(y," with ID ").concat(k.id," complete")),k.timerHandle=void 0,V()},Y)})},C.prototype.cancel=function(){this.timerHandle!==void 0&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.cancelFunc!==void 0&&this.cancelFunc(new S("Cancelled"))),this.backoffCount=-1},C.prototype.calculateNextBackoffMs=function(){var y=1+.4*(Math.random()-.5),k=this.initialDelay*Math.pow(2,this.backoffCount)*y;return k=Math.round(k),Math.min(this.maxBackoffInMs,k)},C.idCounter=0,C}(),L=function(){function C(y,k,Y){var V;this.logger=y,this.tokenProvider=k,this.options=Y,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=Y.maxRetriesForGetToken===void 0||Y.maxRetriesForGetToken===null?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:Y.maxRetriesForGetToken,this.proxyUrlRewrite=(V=Y.proxyUrlRewrite)!==null&&V!==void 0?V:function(z){return z}}return C.prototype.setTelemetryLogger=function(y){this.eventLogger=y},C.prototype.register=function(y,k){return _(this,void 0,void 0,function(){return N(this,function(Y){switch(Y.label){case 0:return[4,this.performRegistration(y,k,"pr_set_registration")];case 1:return Y.sent(),this.cachedRegistrationParams=[y,k],[2]}})})},C.prototype.unregister=function(){return _(this,void 0,void 0,function(){var y;return N(this,function(k){switch(k.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),y=new Request(this.proxyUrlRewrite("".concat(this.options.registrarUrl,"/").concat(this.options.registrationId)),{method:"DELETE",mode:"cors",headers:new Headers(T(T({},this.options.extraRegistrationHeaders),{accept:"application/json, text/javascript"}))}),[4,this.callRegistrar(y,"pr_delete_registration")];case 1:return k.sent(),[2]}})})},C.prototype.cancelPendingRequests=function(){var y=this;Object.keys(this.backoffs).forEach(function(k){y.backoffs[k].cancel()}),this.backoffs={}},C.prototype.resendRegistration=function(){return _(this,void 0,void 0,function(){return N(this,function(y){switch(y.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return y.sent(),[2]}})})},C.prototype.performRegistration=function(y,k,Y){return _(this,void 0,void 0,function(){var V,z;return N(this,function(W){switch(W.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),V={clientDescription:y,registrationId:this.options.registrationId,nodeId:"",transports:k},z=new Request(this.proxyUrlRewrite(this.options.registrarUrl),{method:"POST",mode:"cors",headers:new Headers(T(T({},this.options.extraRegistrationHeaders),{"content-type":"application/json",accept:"application/json, text/javascript"})),body:(0,I.toJson)(V)}),[4,this.callRegistrar(z,Y)];case 1:return W.sent(),[2]}})})},C.prototype.startBackoff=function(){var y=new H(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[y.id]=y,y},C.prototype.stopBackoff=function(y){y.cancel(),delete this.backoffs[y.id]},C.prototype.getToken=function(y){return _(this,void 0,void 0,function(){var k,Y,V,z,W,le,re;return N(this,function($){switch($.label){case 0:k=this.startBackoff(),Y=0,$.label=1;case 1:return $.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new token"),[4,this.tokenProvider({needFresh:!0,supportedTokenTypes:A,wwwAuthenticateHeader:y,purpose:"registrar"})];case 2:return V=$.sent(),this.stopBackoff(k),[2,V];case 3:z=$.sent(),$.label=4;case 4:return $.trys.push([4,6,,7]),Y++,W=JSON.stringify(z),Y>this.maxRetriesForGetToken?(le="[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ".concat(W),this.logger.error(le),this.stopBackoff(k),[2,Promise.reject(le)]):(this.logger.warn("[RegistrarClient] Retrying for a new token. Retry Count: ".concat(Y," Error: ").concat(W)),[4,k.delay("Fetching a new token")]);case 5:return $.sent(),[3,8];case 6:throw re=$.sent(),this.stopBackoff(k),re;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})},C.prototype.callRegistrar=function(y,k){var Y,V,z;return _(this,void 0,void 0,function(){var W,le,re,$,m,R,Z,ie,se,ue,Te,Se,Q,O,U,ae;return N(this,function(ce){switch(ce.label){case 0:return W=this.startBackoff(),[4,this.tokenProvider({needFresh:!1,supportedTokenTypes:A,wwwAuthenticateHeader:void 0,purpose:"registrar"})];case 1:le=ce.sent(),this.setTokenHeader(y,le),re=new I.Timespan,$=0,ce.label=2;case 2:m=void 0,ce.label=3;case 3:return ce.trys.push([3,10,15,16]),R=y.clone(),[4,(0,I.fetchWithTimeout)(R,this.options.requestTimeoutMs)];case 4:return m=ce.sent(),m.status!==401?[3,8]:++$>this.maxRetriesForGetToken?(Z="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '".concat(y.url,"' failed with ").concat(m.status," ").concat(m.statusText),this.logger.error(Z),this.stopBackoff(W),[2,Promise.reject(Z)]):(this.logger.warn("[RegistrarClient] Retry Count ".concat($,". Request '").concat(y.url,"' failed with ").concat(m.status," ").concat(m.statusText)),ie=(V=(Y=m.headers)===null||Y===void 0?void 0:Y.get("www-authenticate"))!==null&&V!==void 0?V:void 0,se=this.setTokenHeader,ue=[y],[4,this.getToken(ie)]);case 5:return se.apply(this,ue.concat([ce.sent()])),$>1?[4,W.delay("Registrar call retry after 401")]:[3,7];case 6:ce.sent(),ce.label=7;case 7:return[3,22];case 8:if(m.status>=500&&m.status<600)throw new Error("Fetch for '".concat(y.url,"' failed with ").concat(m.status," ").concat(m.statusText));ce.label=9;case 9:return[3,16];case 10:Te=ce.sent(),this.logger.error("[RegistrarClient] Request failed with ".concat(Te)),ce.label=11;case 11:return ce.trys.push([11,13,,14]),[4,W.delay("Registrar call retry")];case 12:return ce.sent(),[3,22];case 13:throw Se=ce.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(W),Se;case 14:return[3,16];case 15:return this.sendTelemetryEvent(k,y,m,re),[7];case 16:return this.stopBackoff(W),m.ok?[2,m]:[3,17];case 17:Q=void 0,ce.label=18;case 18:return ce.trys.push([18,20,,21]),U=(O=JSON).stringify,[4,m.json()];case 19:return Q=U.apply(O,[ce.sent()]),[3,21];case 20:return ce.sent(),Q="no details",[3,21];case 21:throw ae="Fetch for '".concat(y.url,"' failed with ").concat(m.status," ").concat(m.statusText," (").concat(Q,", MS-CV: ").concat((z=m.headers)===null||z===void 0?void 0:z.get("MS-CV"),")"),this.logger.error("[RegistrarClient] ".concat(ae)),new Error(ae);case 22:return[3,2];case 23:return[2]}})})},C.prototype.setTokenHeader=function(y,k){switch(y.headers.delete("X-Skypetoken"),y.headers.delete("Authorization"),y.headers.delete("X-MS-Migration"),k.tokenType.toLowerCase()){case"skype":y.headers.set("X-Skypetoken",k.token);break;case"aad":case"cae":y.headers.set("Authorization","Bearer ".concat(k.token));break;default:throw new Error("unsupported token type: ".concat(k.tokenType))}this.options.usingLegacyTokenApi===!1&&y.headers.set("X-MS-Migration","True")},C.prototype.sendTelemetryEvent=function(y,k,Y,V){if(this.eventLogger!==void 0){var z={name:y,properties:{url:{value:k.url},result_code:{value:Y!==void 0?Y.status:0},begin_timestamp:{value:V.startTime},elapsed:{value:V.duration}}};this.eventLogger.logEvent(z)}},C}();F.RegistrarClient=L,F.createRegistrarClient=P}])})});d(h);var g=f(function(X,B){(function(q,F){X.exports=F(h)})(u,function(q){return function(F){function x(v){if(P[v])return P[v].exports;var T=P[v]={i:v,l:!1,exports:{}};return F[v].call(T.exports,T,T.exports,x),T.l=!0,T.exports}var P={};return x.m=F,x.c=P,x.i=function(v){return v},x.d=function(v,T,_){x.o(v,T)||Object.defineProperty(v,T,{configurable:!1,enumerable:!0,get:_})},x.n=function(v){var T=v&&v.__esModule?function(){return v.default}:function(){return v};return x.d(T,"a",T),T},x.o=function(v,T){return Object.prototype.hasOwnProperty.call(v,T)},x.p="",x(x.s=20)}([function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.Logger=void 0;var v=function(){function T(_,N){this.name=_,this.logger=N}return T.prototype.debug=function(_){this.logger.debug("[".concat(this.name,"] ").concat(_))},T.prototype.info=function(_){this.logger.info("[".concat(this.name,"] ").concat(_))},T.prototype.warn=function(_){this.logger.warn("[".concat(this.name,"] ").concat(_))},T.prototype.error=function(_){this.logger.error("[".concat(this.name,"] ").concat(_))},T}();x.Logger=v},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.USER_AUTHENTICATE_EVENT_NAME=x.SUPPORTED_TOKEN_TYPES=x.FAILED_MESSAGE_ACK=x.UNHANDLED_MESSAGE_ACK=x.HANDLED_MESSAGE_ACK=x.CLIENT_VERSION=x.constants=void 0,x.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},x.CLIENT_VERSION="2024.14.01.55",x.HANDLED_MESSAGE_ACK=200,x.UNHANDLED_MESSAGE_ACK=404,x.FAILED_MESSAGE_ACK=500,x.SUPPORTED_TOKEN_TYPES=["skype","aad","cae"],x.USER_AUTHENTICATE_EVENT_NAME="user.authenticate"},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterState=x.UserActivityState=void 0;var v;(function(_){_[_.Unknown=0]="Unknown",_[_.Active=1]="Active",_[_.Inactive=2]="Inactive"})(v||(x.UserActivityState=v={}));var T;(function(_){_[_.Unknown=0]="Unknown",_[_.Connected=2]="Connected",_[_.Disconnected=3]="Disconnected",_[_.Switching=9]="Switching"})(T||(x.TrouterState=T={}))},function(F,x,P){function v(L){try{return JSON.stringify(L)}catch{return"Unable to serialize object of type ".concat(typeof L)}}function T(L){var C=Math.round(new Date().getTime()/1e3);return L!==void 0&&L>C?L-C:0}function _(L){return Math.round(new Date().getTime()/1e3)+L}function N(L,C){return I(this,void 0,void 0,function(){var y,k,Y;return A(this,function(V){return k=new Promise(function(z,W){fetch(L).then(function(le){clearTimeout(y),z(le)}).catch(function(le){clearTimeout(y),W(le)})}),C!==0?(Y=new Promise(function(z,W){var le=new URL(L.url),re=new Error("".concat(L.method," ").concat(le.origin).concat(le.pathname," timed out"));y=setTimeout(W,C,re)}),[2,Promise.race([k,Y])]):[2,k]})})}var I=this&&this.__awaiter||function(L,C,y,k){function Y(V){return V instanceof y?V:new y(function(z){z(V)})}return new(y||(y=Promise))(function(V,z){function W($){try{re(k.next($))}catch(m){z(m)}}function le($){try{re(k.throw($))}catch(m){z(m)}}function re($){$.done?V($.value):Y($.value).then(W,le)}re((k=k.apply(L,C||[])).next())})},A=this&&this.__generator||function(L,C){function y(re){return function($){return k([re,$])}}function k(re){if(Y)throw new TypeError("Generator is already executing.");for(;W&&(W=0,re[0]&&(le=0)),le;)try{if(Y=1,V&&(z=2&re[0]?V.return:re[0]?V.throw||((z=V.return)&&z.call(V),0):V.next)&&!(z=z.call(V,re[1])).done)return z;switch(V=0,z&&(re=[2&re[0],z.value]),re[0]){case 0:case 1:z=re;break;case 4:return le.label++,{value:re[1],done:!1};case 5:le.label++,V=re[1],re=[0];continue;case 7:re=le.ops.pop(),le.trys.pop();continue;default:if(z=le.trys,!(z=z.length>0&&z[z.length-1])&&(re[0]===6||re[0]===2)){le=0;continue}if(re[0]===3&&(!z||re[1]>z[0]&&re[1]<z[3])){le.label=re[1];break}if(re[0]===6&&le.label<z[1]){le.label=z[1],z=re;break}if(z&&le.label<z[2]){le.label=z[2],le.ops.push(re);break}z[2]&&le.ops.pop(),le.trys.pop();continue}re=C.call(L,le)}catch($){re=[6,$],V=0}finally{Y=z=0}if(5&re[0])throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}var Y,V,z,W,le={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return W={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W};Object.defineProperty(x,"__esModule",{value:!0}),x.Timespan=x.CorrelationVector=x.fetchWithTimeout=x.calculateExpireTsInSec=x.calculateTtlInSec=x.toJson=void 0,x.toJson=v,x.calculateTtlInSec=T,x.calculateExpireTsInSec=_,x.fetchWithTimeout=N;var S=function(){function L(C){this.base=C!==void 0?C:this.createCorrelationVectorBase(),this.extension=0}return L.extend=function(C){return new L(C)},L.prototype.increase=function(){this.extension++},L.prototype.value=function(){return"".concat(this.base,".").concat(this.extension)},L.prototype.createCorrelationVectorBase=function(){for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",y="AQgw",k="",Y=0;Y<21;Y++)k+=C.charAt(Math.floor(Math.random()*C.length));return k+=y.charAt(Math.floor(Math.random()*y.length))},L}();x.CorrelationVector=S;var H=function(){function L(){this.start=Date.now()}return Object.defineProperty(L.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),L.prototype.reset=function(){this.start=Date.now()},L}();x.Timespan=H},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterManagerState=x.UserActivityEventReason=x.ServerState=void 0;var v=P(3),T=function(){function I(A,S,H,L,C,y,k){this.connectionId=A,this.connectedClientId=S,this.domId=H,this.unsecureUrl=L,this.url=C,this.c2cUrlBase=y,this.expirationTsSec=k}return I.prototype.getRemainingTtlInSec=function(){return(0,v.calculateTtlInSec)(this.expirationTsSec)},I}();x.ServerState=T;var _;(function(I){I[I.Unknown=0]="Unknown",I[I.Modified=1]="Modified",I[I.Snapshot=2]="Snapshot",I[I.Connected=3]="Connected"})(_||(x.UserActivityEventReason=_={}));var N;(function(I){I[I.Unknown=0]="Unknown",I[I.Connected=2]="Connected",I[I.Disconnected=3]="Disconnected",I[I.Switching=9]="Switching",I[I.TerminalError=10]="TerminalError"})(N||(x.TrouterManagerState=N={}))},function(F,x,P){function v(C,y){return C==="skype"&&T(y==null?void 0:y.scae)!=="1"?"v4a":"v4c"}function T(C){return typeof C=="string"?C:typeof C=="number"?C.toString():void 0}function _(C,y){return(y==null?void 0:y.kind)==="v4c-websocket-failure"?"v4a":C}function N(C){return Object.prototype.hasOwnProperty.call(C,"connectparams")}function I(C,y){return y==="v4a"?C.replace(/\/v4\/c\b/,"/v4/a").replace("wss://","https://").replace("ws://","http://"):C.replace(/\/v4\/a\b/,"/v4/c").replace("https://","wss://").replace("http://","ws://")}function A(C){if(C!==void 0)return L(L({},C),{reconnectUrl:void 0,serviceUrl:void 0})}function S(C){return typeof C=="string"?parseInt(C,10):C}function H(C){if((C==null?void 0:C.kind)==="redirect"&&C.host!==void 0){var y=C.host;return y.endsWith("/")&&(y=y.substring(0,y.length-1)),y.endsWith("/v4/c")||y.endsWith("/v4/a")||(y+="/v4/c"),y}}var L=this&&this.__assign||function(){return L=Object.assign||function(C){for(var y,k=1,Y=arguments.length;k<Y;k++){y=arguments[k];for(var V in y)Object.prototype.hasOwnProperty.call(y,V)&&(C[V]=y[V])}return C},L.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0}),x.redirectUrlIfPresent=x.ensureNumber=x.reconnectParamsWithoutUrls=x.adaptUrl=x.isV4ConnectEvent=x.usedProtocolAfterFallback=x.usedProtocol=void 0,x.usedProtocol=v,x.usedProtocolAfterFallback=_,x.isV4ConnectEvent=N,x.adaptUrl=I,x.reconnectParamsWithoutUrls=A,x.ensureNumber=S,x.redirectUrlIfPresent=H},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterFsm=x.State=void 0;var v,T=P(4),_=P(0),N=P(5);(function(S){S[S.Initial=0]="Initial",S[S.RetrievingToken=1]="RetrievingToken",S[S.Allocating=2]="Allocating",S[S.Handshaking=3]="Handshaking",S[S.Connecting=4]="Connecting",S[S.AnonymousConnecting=5]="AnonymousConnecting",S[S.WebsocketAuthenticating=6]="WebsocketAuthenticating",S[S.Connected=7]="Connected",S[S.Unregistering=8]="Unregistering",S[S.TerminalError=9]="TerminalError"})(v||(x.State=v={}));var I;(function(S){S[S.Initial=0]="Initial",S[S.Registering=1]="Registering",S[S.RegisteringButResendPending=2]="RegisteringButResendPending",S[S.Retrying=3]="Retrying",S[S.Registered=4]="Registered",S[S.RegistrationDisabled=5]="RegistrationDisabled"})(I||(I={}));var A=function(){function S(H,L,C,y){this.worker=L,this.incallModeEnabled=C,this.protocolSelector=y,this.state=v.Initial,this.autoReconnect=!0,this.logger=new _.Logger("ConnectionFsm",H),this.registrationState=I.Initial}return S.prototype.getState=function(){return this.state},S.prototype.isActive=function(){return this.state===v.Allocating||this.state===v.Connected||this.state===v.Handshaking||this.state===v.Connecting||this.state===v.RetrievingToken||this.state===v.AnonymousConnecting||this.state===v.WebsocketAuthenticating},S.prototype.isConnecting=function(){return this.state===v.Allocating||this.state===v.Handshaking||this.state===v.Connecting||this.state===v.AnonymousConnecting},S.prototype.start=function(){return this.state===v.Initial?(this.setState(v.RetrievingToken),this.worker.getToken(!0,!1,void 0),!0):(this.showIgnored("start"),!1)},S.prototype.stop=function(H,L){H&&(this.registrationState=I.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.state===v.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped"),this.registrationState!==I.Registered&&this.registrationState!==I.Registering&&this.registrationState!==I.RegisteringButResendPending||this.state===v.Unregistering?L?(this.setState(v.TerminalError),this.worker.dispatchTerminalError()):(this.setState(v.Initial),this.worker.dispatchDisconnected()):(this.registrationState=I.Initial,this.setState(v.Unregistering),this.worker.sendUnregisterRequest())},S.prototype.onTokenReceived=function(H,L,C){this.state===v.RetrievingToken?(0,N.usedProtocolAfterFallback)(this.protocolSelector(H.tokenType,C),L)==="v4c"?(this.setState(v.AnonymousConnecting),this.worker.startConnectionTimer(),this.worker.connectV4c(H,L)):(this.setState(v.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(H)):this.showIgnored("onTokenReceived")},S.prototype.checkConnection=function(H){H&&this.onPingInterval()},S.prototype.onAllocationSucceed=function(H){return this.state===v.Allocating&&this.registrationState===I.Registered&&this.worker.dispatchUnregistered(),this.state===v.Allocating?(this.setState(v.Handshaking),this.registrationState=I.Initial,this.worker.startSocketIo(H),!0):(this.showIgnored("onAllocationSucceed"),!1)},S.prototype.onAllocationFailed=function(H,L){this.state===v.Allocating?this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!H,claimsChallenge:L}):this.showIgnored("onAllocationFailed")},S.prototype.onV4cException=function(){this.state!==v.AnonymousConnecting&&this.state!==v.WebsocketAuthenticating||(this.logger.error("v4c exception, falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}}))},S.prototype.onConnectingTimeout=function(){this.state===v.Allocating||this.state===v.Connecting||this.state===v.Handshaking||this.state===v.AnonymousConnecting||this.state===v.WebsocketAuthenticating?this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0}):this.showIgnored("onConnectingTimeout")},S.prototype.onConnecting=function(){this.state===v.Handshaking?this.setState(v.Connecting):this.showIgnored("onConnecting")},S.prototype.onSocketConnect=function(H){this.state===v.AnonymousConnecting?(this.setState(v.WebsocketAuthenticating),this.worker.sendV4cAuthenticationEvent(H)):this.showIgnored("onSocketConnect")},S.prototype.onConnectingFailed=function(){this.state===v.Connecting?this.onConnectingTimeout():this.state===v.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.state===v.AnonymousConnecting||this.state===v.WebsocketAuthenticating?(this.logger.info("/v4/c falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}})):this.showIgnored("onConnectingFailed")},S.prototype.onSocketDisconnect=function(H){this.state===v.Handshaking||this.state===v.Connected||this.state===v.WebsocketAuthenticating?(this.state===v.Connected&&this.worker.sendDisconnectTelemetryEvent(H==null?void 0:H.toTelemetryString()),this.state===v.WebsocketAuthenticating&&this.worker.countDisconnectBeforeConnectionEstablishment(),(H==null?void 0:H.reason)==="skypetoken-deprecated"?(this.logger.error("Skypetoken deprecated response, not retrying any further"),this.onTerminalError()):this.cleanUpAndInitiateReconnect({backoff:this.state!==v.Connected&&(H==null?void 0:H.reason)!=="dup",allowCachedToken:(H==null?void 0:H.reason)!=="unauthorized",claimsChallenge:H==null?void 0:H.claims})):this.showIgnored("onSocketDisconnect")},S.prototype.onTrouterConnected=function(){this.state===v.Connecting||this.state===v.WebsocketAuthenticating?(this.setState(v.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(T.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.registrationState=I.RegistrationDisabled,this.worker.dispatchRegistered()):(this.registrationState=I.Registering,this.worker.sendRegisterRequest())):this.showIgnored("onTrouterConnected")},S.prototype.onReconnectRequired=function(H,L,C){this.state===v.AnonymousConnecting||this.state===v.WebsocketAuthenticating?C===void 0||C.target!=="host"||C.url===void 0||C.url===""?(this.logger.error("unexpected reconnect arguments: ".concat(C==null?void 0:C.target," ").concat(C==null?void 0:C.url,", reconnecting without cache")),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect-no-host"}})):this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect",host:C.url}}):this.worker.dispatchReconnectIsRequired(H,L)},S.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},S.prototype.onDownstreamRequest=function(H){this.state===v.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(H)):this.showIgnored("onDownstreamRequest")},S.prototype.onTrouterMessageLost=function(H){this.state===v.Connected?this.worker.dispatchTrouterMessageLost(H):this.showIgnored("onTrouterMessageLost")},S.prototype.onPingInterval=function(){this.state===v.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},S.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},S.prototype.onPingResponse=function(){this.state===v.Connected||this.showIgnored("onPingResponse")},S.prototype.onRegistrationFailed=function(){this.state===v.Connected&&this.registrationState===I.Registering?(this.worker.dispatchUnregistered(),this.registrationState=I.Retrying,this.worker.startRegistrationRetryTimer()):this.state===v.Connected&&this.registrationState===I.RegisteringButResendPending?(this.registrationState=I.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationFailed")},S.prototype.onRetryRegistration=function(){this.state===v.Connected&&this.registrationState===I.Retrying?(this.registrationState=I.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRetryRegistration")},S.prototype.onRegistrationSucceeded=function(){this.state===v.Connected&&this.registrationState===I.Registering?(this.registrationState=I.Registered,this.worker.dispatchRegistered(),this.worker.startRegistrationTimer()):this.state===v.Connected&&this.registrationState===I.RegisteringButResendPending?(this.registrationState=I.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationSucceeded")},S.prototype.onRegistrationNearExpiry=function(){this.state===v.Connected&&this.registrationState===I.Registered?(this.registrationState=I.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationNearExpiry")},S.prototype.onUnregistrationDone=function(){this.state===v.Unregistering?(this.setState(v.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationDone")},S.prototype.onResendRegistration=function(){this.worker.dispatchUnregistered(),this.state===v.Connected&&this.registrationState===I.Registered?(this.registrationState=I.Registering,this.worker.stopRegistrationTimer(),this.worker.sendRegisterRequest()):this.state===v.Connected&&this.registrationState===I.Registering&&(this.registrationState=I.RegisteringButResendPending)},S.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===v.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},S.prototype.onSetNewUserActivityState=function(){this.worker.sendUserActivityState(T.UserActivityEventReason.Modified,this.state===v.Connected)},S.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},S.prototype.forceReconnect=function(H){this.state===v.Connected&&this.worker.sendDisconnectTelemetryEvent(H),this.worker.resetTokenBackoff(),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})},S.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '".concat(v[this.state],"' to ").concat(v[v.TerminalError])),this.stop(!0,!0),this.setState(v.TerminalError)},S.prototype.onMissedResponse=function(H){this.state===v.Connected?(this.worker.sendDisconnectTelemetryEvent(H),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})):this.showIgnored(H)},S.prototype.showIgnored=function(H){this.logger.debug("Ignoring event '".concat(H,"' in state '").concat(v[this.state],"'"))},S.prototype.setState=function(H){if(this.logger.info("Switching from state '".concat(v[this.state],"' to state '").concat(v[H],"'")),this.state===H)return void this.logger.error("Attempt to switch to the current state '".concat(v[H],"'"));this.state=H},S.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},S.prototype.cleanUpAndInitiateReconnect=function(H){if(!this.autoReconnect)return this.logger.info("Automatic reconnect is disabled, stopping this connection"),void this.stop(!0);this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.setState(v.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(H.allowCachedToken,H.backoff,H.claimsChallenge,H.fallbackReason)},S}();x.TrouterFsm=A},function(F,x,P){function v(Q,O){var U=O?void 0:{"X-MS-Migration":"True"};switch(Q.tokenType.toLowerCase()){case"skype":return I({"X-Skypetoken":Q.token},U);case"aad":case"cae":return I({Authorization:"Bearer ".concat(Q.token)},U);default:throw new Error("unsupported token type: ".concat(Q.tokenType))}}function T(Q){return Q!=null&&typeof Q.toString=="function"?Q.toString():"[".concat(typeof Q,"]")}function _(Q){return typeof Q=="object"&&Q!==null&&Q.stack!==void 0?(0,C.toJson)(Q.stack):'"(no error.stack)"'}function N(Q){return typeof Q=="object"&&Q!==null&&typeof Q.message=="string"?Q.message:"(no error.message)"}var I=this&&this.__assign||function(){return I=Object.assign||function(Q){for(var O,U=1,ae=arguments.length;U<ae;U++){O=arguments[U];for(var ce in O)Object.prototype.hasOwnProperty.call(O,ce)&&(Q[ce]=O[ce])}return Q},I.apply(this,arguments)},A=this&&this.__awaiter||function(Q,O,U,ae){function ce(fe){return fe instanceof U?fe:new U(function(ve){ve(fe)})}return new(U||(U=Promise))(function(fe,ve){function Pe(Ne){try{ke(ae.next(Ne))}catch(Oe){ve(Oe)}}function Me(Ne){try{ke(ae.throw(Ne))}catch(Oe){ve(Oe)}}function ke(Ne){Ne.done?fe(Ne.value):ce(Ne.value).then(Pe,Me)}ke((ae=ae.apply(Q,O||[])).next())})},S=this&&this.__generator||function(Q,O){function U(ke){return function(Ne){return ae([ke,Ne])}}function ae(ke){if(ce)throw new TypeError("Generator is already executing.");for(;Pe&&(Pe=0,ke[0]&&(Me=0)),Me;)try{if(ce=1,fe&&(ve=2&ke[0]?fe.return:ke[0]?fe.throw||((ve=fe.return)&&ve.call(fe),0):fe.next)&&!(ve=ve.call(fe,ke[1])).done)return ve;switch(fe=0,ve&&(ke=[2&ke[0],ve.value]),ke[0]){case 0:case 1:ve=ke;break;case 4:return Me.label++,{value:ke[1],done:!1};case 5:Me.label++,fe=ke[1],ke=[0];continue;case 7:ke=Me.ops.pop(),Me.trys.pop();continue;default:if(ve=Me.trys,!(ve=ve.length>0&&ve[ve.length-1])&&(ke[0]===6||ke[0]===2)){Me=0;continue}if(ke[0]===3&&(!ve||ke[1]>ve[0]&&ke[1]<ve[3])){Me.label=ke[1];break}if(ke[0]===6&&Me.label<ve[1]){Me.label=ve[1],ve=ke;break}if(ve&&Me.label<ve[2]){Me.label=ve[2],Me.ops.push(ke);break}ve[2]&&Me.ops.pop(),Me.trys.pop();continue}ke=O.call(Q,Me)}catch(Ne){ke=[6,Ne],fe=0}finally{ce=ve=0}if(5&ke[0])throw ke[1];return{value:ke[0]?ke[1]:void 0,done:!0}}var ce,fe,ve,Pe,Me={label:0,sent:function(){if(1&ve[0])throw ve[1];return ve[1]},trys:[],ops:[]};return Pe={next:U(0),throw:U(1),return:U(2)},typeof Symbol=="function"&&(Pe[Symbol.iterator]=function(){return this}),Pe};Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterConnection=x.ReconnectReason=void 0;var H,L=P(21),C=P(3),y=P(15),k=P(1),Y=P(16),V=P(17),z=P(2),W=P(4),le=P(0),re=P(5),$=P(6),m=P(12),R=function(){function Q(){this.cv=k.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}return Q}(),Z=function(){function Q(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return Q.prototype.rewriteUrlForProxy=function(O){return O},Q}(),ie="MS-CV",se=function(){function Q(O,U){this.logger=U,this.cvCounter=0;var ae=JSON.parse(O);this.startTS=this.safeJsonNumber(ae,"startTS",0),this.url=this.safeJsonString(ae,"url",""),this.shortUrl=this.safeJsonString(ae,"shortUrl",""),this.body=this.safeJsonString(ae,"body",""),this.headers=this.safeJsonRecord(ae,"headers",{}),this.id=this.safeJsonNumber(ae,"id",-1),this.method=this.safeJsonString(ae,"method",""),this.replied=!1,this.timedout=!1,this.receivedCv=this.headers[ie],this.updateCvHeader()}return Object.defineProperty(Q.prototype,"correlationVector",{get:function(){return this.receivedCv?"".concat(this.receivedCv,".").concat(this.cvCounter):""},enumerable:!1,configurable:!0}),Q.prototype.on=function(O,U){O==="data"?this.dataCallback=U:O==="end"&&(typeof this.dataCallback=="function"&&this.dataCallback(this.body),U())},Q.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},Q.prototype.updateCvHeader=function(){var O=this.correlationVector;O&&(this.headers[ie]=O)},Q.prototype.safeJsonNumber=function(O,U,ae){var ce;if(O!=null&&Object.prototype.hasOwnProperty.call(O,U)){var fe=O;if(typeof fe[U]=="number")return fe[U];if(typeof fe[U]=="string")return parseFloat(fe[U]);(ce=this.logger)===null||ce===void 0||ce.warn("unexpected type of '".concat(U,"': ").concat(typeof fe[U]))}return ae},Q.prototype.safeJsonString=function(O,U,ae){var ce;if(O!=null&&Object.prototype.hasOwnProperty.call(O,U)){var fe=O;if(typeof fe[U]=="string")return fe[U];(ce=this.logger)===null||ce===void 0||ce.warn("unexpected type of '".concat(U,"': ").concat(typeof fe[U]))}return ae},Q.prototype.safeJsonRecord=function(O,U,ae){var ce;if(O!=null&&Object.prototype.hasOwnProperty.call(O,U)){var fe=O;if(typeof fe[U]=="object")return fe[U];(ce=this.logger)===null||ce===void 0||ce.warn("unexpected type of '".concat(U,"': ").concat(typeof fe[U]))}return ae},Q}(),ue=function(){function Q(O,U,ae){this.request=O,this.responseData=U,this.sendResponse=ae}return Q.prototype.writeHead=function(O,U){this.responseData.status=O,this.responseData.headers=U},Q.prototype.write=function(O){this.responseData.body+=O},Q.prototype.end=function(O){return O&&(this.responseData.body+=O),this.sendResponse(this.request,this.responseData)},Q}(),Te=function(){function Q(O){this.name=O,this.args={},this.timeoutTimerId=0}return Q}();(function(Q){Q[Q.Configuration=0]="Configuration",Q[Q.ServerInitiated=1]="ServerInitiated"})(H||(x.ReconnectReason=H={}));var Se=function(){function Q(O,U,ae,ce,fe,ve,Pe,Me){var ke,Ne=this;this.options=U,this.manager=ae,this.tokenProvider=ce,this.usingLegacyTokenApi=fe,this.protocolSelector=Pe,this.audienceSubscriptionState=Me,this.WEBSOCKET_TRANSPORT_NAME="websocket",this.XHR_POLLING_TRANSPORT_NAME="xhr-polling",this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR="Error",this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED="Unsubscribed",this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT="Timeout",this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST="BadRequest",this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX=/&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.connectingErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingSentEventTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.connectingErrorsThreshold=3,this.pendingAudienceSubscription=void 0,this.logger=new le.Logger("Connection",O),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new V.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),typeof window<"u"&&window.location&&(this.domId=window.location.hostname);var Oe=new R;Oe.cv=k.CLIENT_VERSION,Oe.ua="",!((ke=this.options)===null||ke===void 0)&&ke.clientInfo&&(Oe.ua=this.safeString(this.options.clientInfo.ua),Oe.v=this.safeString(this.options.clientInfo.v)),this.clientInfo=Oe,this.connectionTracker=new y.ConnectionTracker(O,this.clientID,this.clientInfo,function(){return Ne.getServerState()},this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(U);var Qe=this.options.incallModeTimeoutMs>0;if(this.fsm=new $.TrouterFsm(O,this,Qe,this.protocolSelector),U.registration){var et={registrarUrl:U.registration.registrarUrl,proxyUrlRewrite:U.rewriteUrlForProxy,registrationId:U.registration.registrationId,requestTimeoutMs:U.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:U.timeoutOptions.maxBackoffMs,usingLegacyTokenApi:this.usingLegacyTokenApi,maxRetriesForGetToken:U.retryLimitOnTokenFetch,extraRegistrationHeaders:U.extraConnectionHeaders};this.registrarClient=(0,L.createRegistrarClient)(O,this.tokenProvider,et)}this.userActivityState=ve}return Q.prototype.start=function(O){this.logger.info("Starting"),this.reconnectParams=O,typeof window<"u"&&window.navigator&&window.addEventListener?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: ".concat(this.isNavigatorOnline))):this.isNavigatorOnline=!0,this.fsm.start()},Q.prototype.stop=function(O){this.logger.info("Stopping"),typeof window<"u"&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(O),this.connectionTracker.close()},Q.prototype.configure=function(O){var U=this.options.trouterUrl!==O.trouterUrl;this.options=O,this.applyConnectionTrackerOptions(O),U&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,H.Configuration))},Q.prototype.checkConnection=function(O){this.logger.info("checkConnection called with ".concat(O)),this.fsm.checkConnection(O),O&&this.connectionTracker.sendTelemetry(y.ClientEventName.CheckConnection,{disconnectDetected:O},[])},Q.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegistrationTimer(),this.cancelPendingRegistrationRequests(),this.fsm.disableAutoReconnect()},Q.prototype.getServerState=function(){return new W.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},Q.prototype.getState=function(){return this.fsm.getState()},Q.prototype.getToken=function(O,U,ae,ce,fe){var ve=this;fe===void 0&&(fe=0),this.logger.info("Getting token ".concat(U?"with backoff":"without backoff"));var Pe=function(){ve.connectionTracker.trackStart("token");var Me={needFresh:!O,wwwAuthenticateHeader:ae,supportedTokenTypes:k.SUPPORTED_TOKEN_TYPES,purpose:"trouter"};ve.logger.info("Requesting token: needFresh=".concat(Me.needFresh," ")+"types=[".concat(k.SUPPORTED_TOKEN_TYPES,"], ")+"wwwAuthenticateHeader is ".concat(Me.wwwAuthenticateHeader?"non empty":"empty")),ve.tokenProvider(Me).then(function(ke){ve.logger.debug("".concat(ke.tokenType," token is received")),ve.connectionTracker.trackEnd("token"),ve.fsm.onTokenReceived(ke,ce,ve.reconnectParams)}).catch(function(ke){var Ne=(0,C.toJson)(ke.stack);if(ve.logger.error("Getting token failed, will retry after timeout. Error: ".concat(Ne)),ve.connectionTracker.trackError("token",Ne),!ve.canRetryTokenFetchRequest(fe+ve.unauthorizedErrorCount))return ve.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),ve.resetTokenBackoff(),void ve.fsm.onTerminalError();ve.getToken(O,!0,ae,ce,fe+1)})};U?this.tokenBackoff.backoff("getting token",Pe):(this.resetTokenBackoff(),Pe())},Q.prototype.startConnectionTimer=function(){var O=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for ".concat(this.timeoutOptions.connectionTimeoutMs," ms")),this.connectionTimeoutId=setTimeout(function(){O.logger.info("Connection timeout is fired"),O.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},Q.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},Q.prototype.startPingTimer=function(){var O=this;this.transportTypeName==="websocket"?(this.logger.debug("Starting ping timeout for ".concat(this.timeoutOptions.pingTimeoutMs," ms")),this.pingTimerId=setInterval(function(){O.logger.info("Ping interval fired"),O.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport ".concat(this.transportTypeName))},Q.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},Q.prototype.shouldSkipRegistration=function(){return this.options.registration===void 0},Q.prototype.hasCustomRegistrationTtl=function(){var O,U;return((O=this.options.registration)===null||O===void 0?void 0:O.registrarTtlSec)!==void 0&&((U=this.options.registration)===null||U===void 0?void 0:U.registrarTtlSec)!==0},Q.prototype.startRegistrationTimer=function(){var O=this;this.stopRegistrationTimer();var U=this.getRegistrationTtl(),ae=U[0],ce=U[1];if(ae<=30||!ce)return this.logger.debug("Starting registration expiration timer (TTL ".concat(ae," sec)")),void(this.registrationTimerId=setTimeout(function(){O.registrationTimerId=void 0,O.logger.warn("Registration expired but the connection is still alive. Should never happen"),O.dispatchUnregistered()},1e3*ae));var fe=ae-30;this.logger.debug("Starting registration extension timer for ".concat(fe," sec")),this.registrationTimerId=setTimeout(function(){O.logger.info("Registration extension timer fired"),O.registrationTimerId=setTimeout(function(){O.registrationTimerId=void 0,O.logger.debug("Registration extension did not happen in time"),O.dispatchUnregistered()},3e4),O.fsm.onRegistrationNearExpiry()},1e3*fe)},Q.prototype.startRegistrationRetryTimer=function(){var O=this;this.stopRegistrationTimer(),this.registrationTimerId=setTimeout(function(){O.registrationTimerId=void 0,O.fsm.onRetryRegistration()},123e3)},Q.prototype.stopRegistrationTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},Q.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.fsm.onResendRegistration(),Promise.resolve()},Q.prototype.buildSocketIoUrlParams=function(O,U){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var ae={},ce=this.allocateResult.connectparams,fe=0,ve=Object.keys(ce);fe<ve.length;fe++){var Pe=ve[fe];if(ce[Pe]!==void 0){var Me=ce[Pe];typeof Me=="string"||typeof Me=="number"?ae[Pe]=Me:this.logger.error("signatureData[".concat(Pe,"] has unsupported type ").concat(typeof Me))}}return ae.v="v4",ae.tc=encodeURI((0,C.toJson)(this.clientInfo)),ae.timeout=this.timeoutOptions.pingTimeoutMs/1e3,ae.auth="true",this.options.endpointId&&(ae.epid=this.options.endpointId),O&&(ae.userActivity=encodeURI((0,C.toJson)(O))),U&&(ae.audienceSubscriptionState=encodeURIComponent((0,C.toJson)(U))),this.appendConnectedClientIds(this.buildQuery(ae),!0)},Q.prototype.startSocketIo=function(O){var U,ae;if(this.logger.debug("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var ce=this.options.ioOptions?I({},this.options.ioOptions):new Z,fe=this.userActivityState.state!==z.UserActivityState.Unknown?this.userActivityState.increaseCvAndGetEventObject():void 0,ve=(U=this.audienceSubscriptionState)===null||U===void 0?void 0:U.increaseCvAndGetEventObject();if(ce["force new connection"]=!0,ce.reconnect=!1,ce.rewriteUrlForProxy=this.options.rewriteUrlForProxy,ce.requestHeaders=I(I({},this.options.extraConnectionHeaders),v(O,this.usingLegacyTokenApi)),ce.query=this.buildSocketIoUrlParams(fe,ve),this.logger.info("connecting to ".concat(this.allocateResult.socketio,"?").concat(ce.query)),this.stopSocketIo(),this.socket=((ae=this.options.io)!==null&&ae!==void 0?ae:m).connect(this.allocateResult.socketio,ce),this.socket===void 0)throw new Error("Can't create Socket.io object");this.attachSocketIoHandlers(this.socket,O,fe,ve)},Q.prototype.stopSocketIo=function(){if(this.socket){this.logger.debug("clearing socket.io");try{for(var O=0,U=["connecting","connect","connect_failed","close_during_connecting","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];O<U.length;O++){var ae=U[O];this.socket.removeAllListeners(ae)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(ce){this.logger.error("exception in disconnecting previous socket. Error: ".concat(_(ce)))}}},Q.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},Q.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},Q.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},Q.prototype.dispatchDownstreamRequest=function(O){var U=this;this.logger.debug("dispatching downstream request");try{var ae=new ue(O,new y.ResponseData(O.id),function(ce,fe){return U.logger.debug("sending response to downstream"),U.sendResponse(ce,fe)});this.manager.onDownstreamRequest(this,O,ae)}catch(ce){this.logger.error("exception in socket.on message. Error : ".concat(_(ce)))}},Q.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},Q.prototype.dispatchReconnectIsRequired=function(O,U){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,O,U)},Q.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},Q.prototype.dispatchTerminalError=function(){this.logger.info("dispatching terminal error"),this.manager.onTerminalError(this)},Q.prototype.dispatchTrouterMessageLost=function(O){this.logger.info("dispatching trouter message lost"),this.manager.onTrouterMessageLost(O)},Q.prototype.countDisconnectBeforeConnectionEstablishment=function(){this.logger.warn("counting disconnect before connection was fully established as a connection failure"),++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold()},Q.prototype.sendProcessedDroppedIndicators=function(O){var U=this;try{this.logger.debug("emitting processed flow tags to the server");var ae=new Te("trouter.processed_message_loss");ae.args={droppedIndicators:O},this.sendDownstreamEvent(ae,function(){U.logger.info("emitted processed flow tags to the server")})}catch(fe){var ce=_(fe);this.logger.error("unable to send processed message loss event. Error: ".concat(ce)),this.connectionTracker.trackError("trouter.processed_message_loss",ce,!1)}},Q.prototype.sendAllocateRequest=function(O){var U=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var ae,ce=this.options.trouterUrl,fe=this.reconnectParams,ve=typeof(fe==null?void 0:fe.se)=="string"?parseInt(fe.se,10):typeof(fe==null?void 0:fe.se)=="number"?fe.se:void 0;ve&&ve<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: ".concat(new Date(ve))),this.reconnectParams=fe=void 0),fe&&fe.serviceUrl!==ce&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(fe.serviceUrl,", now ").concat(ce,")")),this.reconnectParams=fe=void 0),fe!=null&&fe.reconnectUrl&&(ce=fe.reconnectUrl),ae=fe?I(I({},fe),{serviceUrl:void 0,reconnectUrl:void 0}):null,ce=(0,re.adaptUrl)(ce,"v4a"),ce=this.appendCorrelationIds(ce,!1),ce=this.appendEndpointId(ce,!1),ae&&(ce+="&".concat(this.buildQuery(ae)),ae.v||(ce+="&v=".concat("v4"))),ce=this.options.rewriteUrlForProxy(ce);var Pe=new Request(ce,{method:"POST",mode:"cors",headers:new Headers(I(I({"Content-Type":"text/plain"},this.options.extraConnectionHeaders),v(O,this.usingLegacyTokenApi)))});this.logger.info("sendAllocateRequest: POST ".concat(ce)),this.connectionTracker.trackStart("allocation");var Me,ke=Date.now(),Ne=-1,Oe=!1;(0,C.fetchWithTimeout)(Pe,this.timeoutOptions.fetchTimeoutMs).then(function(Qe){var et;if(Ne=Qe.status,!Qe.ok)throw Me=(et=Qe.headers.get("www-authenticate"))!==null&&et!==void 0?et:void 0,Oe=Qe.headers.get("x-trouter-skypetoken-deprecated")==="1",U.logger.warn("Allocation request got response status ".concat(Qe.status,", www-authenticate header was ").concat(Me?"not empty":"empty")),new Error(Qe.statusText);var Xe=Qe.headers.get("content-type");if(!Xe||Xe!=="application/json"&&!Xe.startsWith("application/json;"))throw new Error("Content-type '".concat(Xe,"' is unexpected"));return U.connectionTracker.trackEnd("allocation"),Qe.json()}).then(function(Qe){U.unauthorizedErrorCount=0,U.onAllocationResponse(Qe,O)}).catch(function(Qe){U.connectingErrorsInRow++;var et="".concat(Qe).concat(Ne>=0?", status code ".concat(Ne):"");if(U.logger.error("".concat(U.connectingErrorsInRow," failed connecting attempt(s) in a row. ").concat(et)),U.connectionTracker.trackError("allocation",et),Oe){var Xe="Skypetoken deprecated response, not retrying any further";return U.logger.error(Xe),U.connectionTracker.trackError("allocation",Xe),void U.fsm.onTerminalError()}if(Ne===401&&U.unauthorizedErrorCount++,!U.canRetryTokenFetchRequest(U.unauthorizedErrorCount)){var Xe="getToken retry limit hit, reached terminal error state";return U.connectionTracker.trackError("allocation",Xe),void U.fsm.onTerminalError()}if(Ne!==-1||U.isNavigatorOnline){if(U.reconnectParams&&U.connectingErrorsInRow>=U.connectingErrorsThreshold){if(Ne>=400&&Ne<=599)U.resetReconnectParamsOnErrorThreshold();else if(U.reconnectParams.reconnectUrl&&U.connectingErrorsInRow%3==0){U.logger.warn("".concat(U.connectingErrorsInRow," connection attempts, testing nominal service URL"));var Nt=Math.min(U.timeoutOptions.connectionTimeoutMs-(Date.now()-ke)-500,U.timeoutOptions.fetchTimeoutMs);return void U.testNominalUrlConnectivity(Nt).then(function(kt){U.connectionTracker.trackProgress("nomcheck",kt?"ok":"failed"),kt?(U.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),U.reconnectParams&&delete U.reconnectParams.reconnectUrl):U.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),U.fsm.onAllocationFailed(!1,void 0)},function(){U.fsm.onAllocationFailed(!1,void 0)})}}}else U.logger.info("Expected failure, the browser says it is not online at the moment");U.fsm.onAllocationFailed(Ne===401,Me)})},Q.prototype.testNominalUrlConnectivity=function(O){var U=this;if(O<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check (".concat(O," ms), falling back to assuming that the connectivity is fine")),Promise.resolve(!0);var ae;try{var ce=new URL(this.options.trouterUrl);ce.pathname="/",ce.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent((0,C.toJson)(this.clientInfo))}),ae=new Request(this.options.rewriteUrlForProxy(ce.toString()),{method:"GET",headers:{Accept:"text/plain"}})}catch(fe){return this.logger.warn("Nominal service URL connectivity test request could not be created (".concat(fe,"), falling back to assuming that the connectivity is fine")),Promise.resolve(!0)}return(0,C.fetchWithTimeout)(ae,O).then(function(fe){if(fe.status!==200)throw new Error("Not 200 OK: ".concat(fe.status," ").concat(fe.statusText));return fe.text()}).then(function(fe){if(fe!=="Trouter")throw new Error('Not "Trouter": '.concat(fe.substring(0,16)).concat(fe.length>16?"...":""));return!0}).catch(function(fe){return U.logger.error("Nominal service URL connectivity test failed: ".concat(fe)),!1})},Q.prototype.sendPingRequest=function(){var O=this;if(this.socket&&this.pingResponseTimerId===void 0)try{this.logger.debug("emitting ping event");var U=!1;this.socket.emit("ping",function(){U!==!0&&O.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){O.logger.error("Ping response timeout is fired"),U=!0,O.clearPingResponseTimer(),O.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(ce){var ae=_(ce);this.logger.error("unable to send ping. Error: ".concat(ae)),this.connectionTracker.trackError("ping",ae,!1)}},Q.prototype.connectV4c=function(O,U){var ae,ce,fe,ve,Pe,Me,ke=this.options.ioOptions?I({},this.options.ioOptions):new Z;ke["force new connection"]=!0,ke.reconnect=!1,!((ae=this.reconnectParams)===null||ae===void 0)&&ae.serviceUrl&&(0,re.adaptUrl)(this.reconnectParams.serviceUrl,"v4c")!==(0,re.adaptUrl)(this.options.trouterUrl,"v4c")&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(this.reconnectParams.serviceUrl,", now ").concat(this.options.trouterUrl,")")),this.reconnectParams=void 0);var Ne=(ve=(ce=(0,re.redirectUrlIfPresent)(U))!==null&&ce!==void 0?ce:(U==null?void 0:U.kind)!=="redirect-no-host"?(fe=this.reconnectParams)===null||fe===void 0?void 0:fe.reconnectUrl:void 0)!==null&&ve!==void 0?ve:this.options.trouterUrl,Oe=(0,re.adaptUrl)(Ne,"v4c");ke["skipped handshake data"]={timeout:70,websocketUrl:Oe},ke.query=this.buildV4cUrlParams(),ke.rewriteUrlForProxy=this.options.rewriteUrlForProxy;try{if(this.stopSocketIo(),this.transportTypeName="websocket",this.socket=((Pe=this.options.io)!==null&&Pe!==void 0?Pe:m).connect(this.options.trouterUrl,ke),this.socket===void 0)throw new Error("failed to create Socket.io object");var Qe=(Me=this.audienceSubscriptionState)===null||Me===void 0?void 0:Me.increaseCvAndGetEventObject();this.attachSocketIoHandlers(this.socket,O,void 0,Qe)}catch(et){this.logger.error("".concat(et)),this.connectionTracker.trackError("v4c","".concat(et)),this.fsm.onV4cException()}},Q.prototype.sendV4cAuthenticationEvent=function(O){var U,ae={headers:I(I({},this.options.extraConnectionHeaders),v(O,this.usingLegacyTokenApi)),connectparams:(0,re.reconnectParamsWithoutUrls)(this.reconnectParams)};(U=this.socket)===null||U===void 0||U.emit(k.USER_AUTHENTICATE_EVENT_NAME,ae)},Q.prototype.setUserActivityState=function(O){var U=O.state!==this.userActivityState.state;this.userActivityState=O,U?(this.logger.info("Changing user activity state to '".concat(O.toEventJSON(),"'")),this.fsm.onSetNewUserActivityState()):(this.logger.debug("Not changing the same user activity state '".concat(O.toEventJSON(),"'")),this.manager.onUserActivityStateAccepted(O.correlationVector.value()))},Q.prototype.sendUserActivityState=function(O,U){this.userActivityState.state!==z.UserActivityState.Unknown&&(this.transportTypeName==="websocket"&&U?O===W.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):this.transportTypeName==="xhr-polling"&&O===W.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},Q.prototype.setAudienceSubscriptionsAsync=function(O,U){var ae=this.audienceSubscriptionState;if(this.audienceSubscriptionState=O,this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME)return this.setAudienceSubscriptionsInternalAsync(O.increaseCvAndGetEventObject(),U);if(this.transportTypeName===this.XHR_POLLING_TRANSPORT_NAME){var ce=this.setAudienceSubscriptionsLongpollInternalAsync(O.increaseCvAndGetEventObject(),U,ae);return this.fsm.forceReconnect("set audience subscription force reconnect"),ce}throw new Error("set audience subscription executed on an unknown transport")},Q.prototype.setAudienceSubscriptionsUnsafeAsync=function(O){if(O)return this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?this.setAudienceSubscriptionsInternalAsync(O,15e3):void 0},Q.prototype.setAudienceSubscriptionsInternalAsync=function(O,U){return A(this,void 0,void 0,function(){var ae,ce,fe=this;return S(this,function(ve){switch(ve.label){case 0:return this.logger.info("[WebSocket] Audience subscription set requested."),ae=new Te("audience.subscribe"),ae.args=O,[4,new Promise(function(Pe){var Me=!1,ke=setTimeout(function(){return Me=!0,Pe(fe.buildAudienceSubscriptionsTimeoutResponse(O))},U);fe.sendDownstreamEvent(ae,function(Ne,Oe){Me||(clearTimeout(ke),fe.logger.debug("[Websocket] Audience subscription response: ".concat(Oe)),fe.pendingAudienceSubscription&&fe.onAudienceSubscriptionResult(Oe),Pe(Oe))})})];case 1:return ce=ve.sent(),this.manager.onAudiencesSetResolved(ce,O.cv),[2,ce]}})})},Q.prototype.setAudienceSubscriptionsLongpollInternalAsync=function(O,U,ae){var ce;return A(this,void 0,void 0,function(){var fe,ve,Pe,Me,ke,Ne,Oe=this;return S(this,function(Qe){switch(Qe.label){case 0:return this.logger.info("[XHR Polling] Audience subscription set requested."),this.pendingAudienceSubscription&&(this.logger.error("Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons."),clearTimeout(this.pendingAudienceSubscription.timeoutId)),O.audiences.length===0?[2,this.handleAudienceUnsubscribeLongpoll(O.cv,ae)]:[4,new Promise(function(et){var Xe=setTimeout(function(){return Oe.pendingAudienceSubscription=void 0,et(Oe.buildAudienceSubscriptionsTimeoutResponse(O))},U);Oe.pendingAudienceSubscription={audienceSetResolve:et,timeoutId:Xe}})];case 1:return fe=Qe.sent(),this.manager.getState()===z.TrouterState.Unknown||this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?[2,fe]:(ve=fe.responses[0],(ve==null?void 0:ve.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(fe,O.cv),[2,fe]):(Pe=fe.responses.find(function(et){return et.audienceId===O.audiences[0].id}),(Pe==null?void 0:Pe.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(fe,O.cv),[2,fe]):(Me=((ce=ae==null?void 0:ae.audienceSubscriptionModel.audienceSubscriptions[0])===null||ce===void 0?void 0:ce.id)!==(ve==null?void 0:ve.audienceId),ae&&Me&&(ke=this.mapToSyntheticAudienceSubscriptionResponses(ae.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200),(Ne=fe.responses).push.apply(Ne,ke)),this.manager.onAudiencesSetResolved(fe,O.cv),[2,fe])))}})})},Q.prototype.clearAudienceSubscriptionStateQueryParam=function(){var O,U,ae;!((ae=(U=(O=this.socket)===null||O===void 0?void 0:O.socket)===null||U===void 0?void 0:U.options)===null||ae===void 0)&&ae.query&&(this.socket.socket.options.query=this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX,""))},Q.prototype.handleAudienceUnsubscribeLongpoll=function(O,U){var ae;this.audienceSubscriptionState=void 0;var ce={responses:[]};if(U){var fe=this.mapToSyntheticAudienceSubscriptionResponses(U.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200);(ae=ce.responses).push.apply(ae,fe)}return this.manager.onAudiencesSetResolved(ce,O),ce},Q.prototype.buildAudienceSubscriptionsTimeoutResponse=function(O){return this.logger.error("Audience subscription attempt has timed out."),{responses:this.mapToSyntheticAudienceSubscriptionResponses(O.audiences,this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)}},Q.prototype.mapToSyntheticAudienceSubscriptionResponses=function(O,U,ae){return O.map(function(ce){return{audienceId:ce.id,result:{audienceSubscriptionState:U,responseStatus:ae}}})},Q.prototype.expediteBackoff=function(){this.tokenBackoff.expediteIfPending()},Q.prototype.sendRegisterRequest=function(){var O=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var U=new C.Timespan;this.connectionTracker.trackStart("registration");var ae=this.getRegistrationTtl()[0];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:ae}]}).then(function(){O.logger.info("Register request successful"),O.connectionTracker.trackEnd("registration"),O.fsm.onRegistrationSucceeded(),O.connectionTracker.sendTelemetry(y.ClientEventName.Registration,{duration:U.duration},[])}).catch(function(ce){O.logger.error("Register request failed. Error: ".concat(ce)),O.connectionTracker.trackError("registration",N(ce)),O.fsm.onRegistrationFailed(),O.connectionTracker.sendTelemetry(y.ClientEventName.Registration,{duration:U.duration},[])})},Q.prototype.sendUnregisterRequest=function(){var O=this;this.logger.info("sending unregister request");var U=new C.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then(function(){O.logger.info("Unregister request successful"),O.connectionTracker.trackEnd("unregistration"),O.fsm.onUnregistrationDone(),O.connectionTracker.sendTelemetry(y.ClientEventName.Unregistration,{duration:U.duration},[])}).catch(function(ae){O.logger.error("Unregister request failed. Error: ".concat(ae)),O.connectionTracker.trackError("unregistration",N(ae)),O.fsm.onUnregistrationDone(),O.connectionTracker.sendTelemetry(y.ClientEventName.Unregistration,{duration:U.duration},[])})},Q.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},Q.prototype.cancelPendingRegistrationRequests=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},Q.prototype.clearSentEventTimers=function(){var O=Object.keys(this.pendingSentEventTimers);if(O.length>0){this.logger.debug("Clearing all pending downstream events related timers");for(var U=0,ae=O;U<ae.length;U++){var ce=ae[U];this.clearSentEventTimer(Number(ce))}}},Q.prototype.restartIncallModeTimer=function(){var O=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){O.logger.info("Call mode timer fired"),O.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},Q.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},Q.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},Q.prototype.isIncallMode=function(){return this.inIncallMode},Q.prototype.sendDisconnectTelemetryEvent=function(O){var U={reason:O,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(U),this.connectionTracker.clearConnectedInfo()},Q.prototype.forceReconnectDueToNoRegistration=function(){this.fsm.forceReconnect("force reconnect due to no registration")},Q.prototype.resetReconnectParamsOnErrorThreshold=function(){this.logger.warn("".concat(this.connectingErrorsInRow," connection attempts, server-side failure: erasing cached connection parameters")),this.reconnectParams=void 0},Q.prototype.onSocketConnecting=function(O){this.logger.info("onSocketConnecting(".concat(O,")")),this.transportTypeName=O,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},Q.prototype.onSocketConnect=function(O){this.logger.info("onSocketConnect"),this.fsm.onSocketConnect(O)},Q.prototype.onSocketConnectFailed=function(O){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",O,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},Q.prototype.onSocketDisconnect=function(O){var U=this.connectionTracker.getSessionLength()||0,ae=Y.DisconnectReason.fromRawReason(O);this.logger.error("onSocketDisconnect, reason: ".concat(ae.reason)),ae.reason==="dup"&&this.lastDisconnectReason==="dup"&&U<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row "+"after ".concat(U," ms which is below the threshold of ")+"".concat(this.options.duplicateDisconnectThresholdMs," ms. Resetting cached ")+"connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=ae.reason,this.fsm.onSocketDisconnect(ae),this.connectionExpireTimestampInSecs=void 0},Q.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},Q.prototype.onSocketReconnectFailed=function(O){this.logger.error("onSocketReconnectFailed with '".concat(O,"'")),this.fsm.onSocketDisconnect(Y.DisconnectReason.fromSocketIoEventData("reconnecterror",O))},Q.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},Q.prototype.onSocketError=function(O){this.logger.error("onSocketError with '".concat((0,C.toJson)(O),"'")),this.fsm.isConnecting()&&++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold(),this.connectionTracker.trackError("connectSocket",T(O)),this.fsm.onSocketDisconnect(Y.DisconnectReason.fromSocketIoEventData("socketerror",O))},Q.prototype.onSocketMessage=function(O){var U,ae=this;this.logger.debug("onSocketMessage");var ce;try{ce=new se(O,this.logger);var fe=(U=ce.headers)===null||U===void 0?void 0:U["X-Microsoft-Skype-Chain-ID"],ve=fe?" Chain-Id ".concat(fe):"";this.logger.info("Received request N ".concat(ce.id).concat(ve," CV ").concat(ce.correlationVector," to '").concat(ce.url,"'")),ce.startTS=Date.now(),ce.url&&this.urlPath&&ce.url.startsWith(this.urlPath)&&(ce.shortUrl=ce.url.substring(this.urlPath.length))}catch(Me){var Pe=_(Me);return this.logger.error("unable to parse request. Error: ".concat(Pe)),this.connectionTracker.trackRequest(void 0,Pe),void this.connectionTracker.sendResponseError("unable to parse request, error: ".concat(Me))}ce.timeoutTimerId=setTimeout(function(){if(!ce.replied){ae.logger.error("Request ".concat(ce.id," timed out"));var Me=new y.ResponseData(ce.id);Me.status=504,Me.headers={"Trouter-Responder":"ClientLib"},ae.sendResponse(ce,Me),ce.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(ce),this.fsm.onDownstreamRequest(ce)}catch(Me){this.logger.error("exception in socket.on message. Error: ".concat(_(Me))),this.connectionTracker.sendResponseError(N(Me),ce,void 0)}},Q.prototype.onTrouterConnected=function(O,U,ae){var ce,fe,ve,Pe,Me=this;if((0,re.isV4ConnectEvent)(O)){var ke=O;this.allocateResult=I(I({},ke),{ttl:O.ttl.toString()}),this.populateAndCacheReconnectParams(ke,ke.reconnectUrl),this.populateConnectionStateFields(ke)}else if(!this.allocateResult)return void this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set");this.connectingErrorsInRow=0,this.logger.info("onTrouterConnected: ".concat(this.allocateResult.url)),this.transportTypeName==="xhr-polling"&&U&&this.manager.onUserActivityStateAccepted(U.cv),!((ve=(fe=(ce=this.socket)===null||ce===void 0?void 0:ce.socket)===null||fe===void 0?void 0:fe.options)===null||ve===void 0)&&ve.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var Ne=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=(0,C.calculateExpireTsInSec)((0,re.ensureNumber)(O.ttl)),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(Ne,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),(Pe=this.setAudienceSubscriptionsUnsafeAsync(ae))===null||Pe===void 0||Pe.catch(function(Oe){return Me.logger.error("Re-subscribe to audiences has failed with ".concat(Oe))}),this.fsm.onTrouterConnected()},Q.prototype.onTrouterReconnect=function(O){var U=O.target;this.logger.info("onTrouterReconnect target: ".concat(U)),U==="self"?this.fsm.onReconnectRequired(!0,H.ServerInitiated):this.fsm.onReconnectRequired(!1,H.ServerInitiated,O)},Q.prototype.onTrouterMessageLoss=function(O){this.logger.debug("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(O.droppedIndicators)},Q.prototype.onAudienceSubscriptionResult=function(O){this.logger.info("onAudienceSubscriptionResult"),this.pendingAudienceSubscription&&(clearTimeout(this.pendingAudienceSubscription.timeoutId),this.pendingAudienceSubscription.audienceSetResolve(O),this.pendingAudienceSubscription=void 0)},Q.prototype.buildV4cUrlParams=function(){var O={};return O.tc=encodeURI((0,C.toJson)(this.clientInfo)),O.timeout=Math.floor(this.timeoutOptions.pingTimeoutMs/1e3),this.options.endpointId&&(O.epid=this.options.endpointId),this.appendConnectedClientIds(this.buildQuery(O),!0)},Q.prototype.attachSocketIoHandlers=function(O,U,ae,ce){var fe=this;O.on("connecting",function(ve){fe.onSocketConnecting(ve)}),O.on("connect",function(){fe.onSocketConnect(U)}),O.on("connect_failed",function(ve){fe.onSocketConnectFailed(ve)}),O.on("close_during_connecting",function(ve){fe.onSocketConnectFailed(ve)}),O.on("disconnect",function(ve){fe.onSocketDisconnect(ve)}),O.on("reconnect",function(){fe.onSocketReconnect()}),O.on("reconnect_failed",function(ve){fe.onSocketReconnectFailed(ve)}),O.on("reconnecting",function(){fe.onSocketReconnecting()}),O.on("error",function(ve){fe.onSocketError(ve)}),O.on("message",function(ve){fe.onSocketMessage(ve)}),O.on("trouter.connected",function(ve){fe.onTrouterConnected(ve,ae,ce)}),O.on("trouter.reconnect",function(ve){fe.onTrouterReconnect(ve)}),O.on("trouter.message_loss",function(ve){fe.onTrouterMessageLoss(ve)}),O.on("audience.subscriptionresult",function(ve,Pe){fe.onAudienceSubscriptionResult(Pe)})},Q.prototype.onNavigatorOnlineStatusUpdate=function(){var O=window.navigator.onLine;this.logger.debug("Browser online status update - new state: ".concat(O,", previously: ").concat(this.isNavigatorOnline)),O&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!O&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},Q.prototype.onAllocationResponse=function(O,U){this.logger.info("Received allocation response ".concat(JSON.stringify(O))),this.allocateResult=O,this.populateAndCacheReconnectParams(this.allocateResult,"".concat(this.allocateResult.socketio,"v4/a")),this.populateConnectionStateFields(this.allocateResult),this.fsm.onAllocationSucceed(U)},Q.prototype.populateAndCacheReconnectParams=function(O,U){this.reconnectParams=I({serviceUrl:this.options.trouterUrl,reconnectUrl:U},O.connectparams),this.manager.onConnectionParametersUpdated(this.reconnectParams)},Q.prototype.populateConnectionStateFields=function(O){var U,ae,ce=typeof O.ttl=="string"?parseInt(O.ttl,10):O.ttl;if(this.connectionExpireTimestampInSecs=(0,C.calculateExpireTsInSec)(ce),this.connectionId=(U=O.id)!==null&&U!==void 0?U:"",this.connectedClientId=O.ccid,this.logger.debug("connected client id set {connectedClientId:".concat(this.connectedClientId,"}")),this.c2cUrlBase=(ae=O.curlb)!==null&&ae!==void 0?ae:"",this.c2cUrlBase===""){var fe=O.surl.indexOf("://");fe>=0&&(fe=O.surl.indexOf("/",fe+3))>=5&&O.surl.substr(fe-5,5)===":3443"&&(this.c2cUrlBase=O.surl.substr(0,fe-5))}},Q.prototype.onPingResponse=function(){this.logger.debug("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},Q.prototype.clearPingResponseTimer=function(){this.pingResponseTimerId!==void 0&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},Q.prototype.buildQuery=function(O){for(var U=[],ae=0,ce=Object.keys(O);ae<ce.length;ae++){var fe=ce[ae];O[fe]!==void 0&&U.push("".concat(fe,"=").concat(O[fe]))}return U.join("&")},Q.prototype.appendConnectedClientIds=function(O,U){var ae="";O.includes("ccid=")||(ae="ccid=".concat(this.connectedClientId,"&")),this.domId&&(ae+="dom=".concat(this.domId,"&")),ae.length>0&&(ae=ae.slice(0,-1));var ce=U||O.includes("?")?"&":"?";return this.appendCorrelationIds(O+ce+ae,U)},Q.prototype.appendEndpointId=function(O,U){var ae=U||O.includes("?")?"&":"?";return!O.includes("epid")&&this.options.endpointId?"".concat(O).concat(ae,"epid=").concat(this.options.endpointId):O},Q.prototype.appendCorrelationIds=function(O,U){var ae=U||O.includes("?")?"&":"?";return O.includes("cor_id")?O:"".concat(O).concat(ae,"cor_id=").concat(this.options.clientCorrelationID)+"&con_num=".concat(this.clientID,"_").concat(this.connectionAttempt)},Q.prototype.safeString=function(O){return typeof O=="string"?O:""},Q.prototype.sendResponse=function(O,U){var ae,ce,fe;if(O.timedout)return this.logger.error("Request ".concat(O.id," already timed out")),1;if(O.replied)return this.logger.error("Response for request ".concat(O.id," already sent")),2;clearTimeout(O.timeoutTimerId),O.timeoutTimerId=void 0,O.replied=!0,U.headers=(ae=U.headers)!==null&&ae!==void 0?ae:{};var ve=O.correlationVector;this.logger.info("Sending response N ".concat(O.id," CV ").concat(ve," with status ").concat(U.status)),ve&&(U.headers[ie]=ve),!((ce=O.headers)===null||ce===void 0)&&ce["trouter-request"]&&(U.headers["trouter-request"]=O.headers["trouter-request"]);var Pe=Date.now()-O.startTS;if(U.headers["trouter-client"]=(0,C.toJson)({cd:Pe}),!((fe=O.headers)===null||fe===void 0)&&fe["trouter-is-broadcast"]&&(U.headers["trouter-is-broadcast"]=O.headers["trouter-is-broadcast"]),this.logger.debug("response: ".concat((0,C.toJson)(U))),!this.socket)return this.connectionTracker.sendResponseError("no socket",O,U),4;try{return this.socket.send((0,C.toJson)(U)),U.sentTS=Date.now(),O.incrementCorrelationVector(),this.connectionTracker.trackResponse(O,Pe,U),this.transportTypeName==="websocket"&&this.sendPingRequest(),0}catch(ke){var Me="unable to send data on response.end. Error: ".concat(_(ke));return this.logger.error(Me),this.connectionTracker.sendResponseError(Me,O,U),4}},Q.prototype.sendUserActivityStateMultiple=function(O){var U=this,ae=new Te("user.activity"),ce=this.userActivityState.increaseCvAndGetEventObject();ae.args=ce,this.logger.debug("Sending user activity '".concat(this.userActivityState.toEventJSON(),"', remaining ").concat(O-1));var fe=!1;this.sendDownstreamEvent(ae,function(){if(fe!==!0&&(U.logger.info("User activity state: ".concat(ce.state,", cv: ").concat(ce.cv," accepted")),U.manager.onUserActivityStateAccepted(ce.cv),U.clearSentEventTimer(ae.timeoutTimerId),O>1)){var ve=setTimeout(function(){U.clearSentEventTimer(ve),U.sendUserActivityStateMultiple(O-1)},U.options.userActivitySecondResendDelayMs);U.registerSentEventTimer(ve,"user.activity/resend")}}),ae.timeoutTimerId=setTimeout(function(){U.logger.error("Activity state response timeout is fired"),fe=!0,U.fsm.onActivityStateResponseTimeout(),U.clearSentEventTimer(ae.timeoutTimerId)},this.timeoutOptions.userActivityResponseTimeoutMs),this.registerSentEventTimer(ae.timeoutTimerId,"user.activity/response")},Q.prototype.sendDownstreamEvent=function(O,U){this.logger.debug("Sending downstream event ".concat(O.name)),this.socket&&this.socket.emit(O.name,O.args,U)},Q.prototype.registerSentEventTimer=function(O,U){this.logger.debug("registering timer ".concat(O," -> ").concat(U)),this.pendingSentEventTimers[O]=U},Q.prototype.clearSentEventTimer=function(O){var U=this.pendingSentEventTimers[O];this.logger.debug("clearing timer ".concat(O," -> ").concat(U)),delete this.pendingSentEventTimers[O],clearTimeout(O)},Q.prototype.getRegistrationTtl=function(){var O,U,ae=(0,C.calculateTtlInSec)(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in ".concat(ae," seconds")),((O=this.options.registration)===null||O===void 0?void 0:O.registrarTtlSec)&&ae>0){var ce=this.options.registration.registrarTtlSec<ae;return[Math.min(this.options.registration.registrarTtlSec,ae),ce]}return!((U=this.options.registration)===null||U===void 0)&&U.registrarTtlSec?[this.options.registration.registrarTtlSec,!1]:ae>0?[ae,!1]:[3600,!1]},Q.prototype.clearIncallModeTimerId=function(){this.incallModeTimerId!==void 0&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},Q.prototype.applyConnectionTrackerOptions=function(O){try{O.eventLogger&&typeof O.eventLogger.logEvent=="function"?(this.connectionTracker.mergeSettings(O.telemetrySettings),this.connectionTracker.enable(O.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(U){this.logger.warn("Trouter client event logging disabled. Error: ".concat(_(U))),this.connectionTracker.disable()}},Q.prototype.canRetryTokenFetchRequest=function(O){var U=this.options.retryLimitOnTokenFetch;return U==null||O<U||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: ".concat(O,", retry limit: ").concat(U)),!1)},Q}();x.TrouterConnection=Se},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.MessageHandlerRegistry=void 0;var v=P(1),T=P(0),_=function(){function N(I){this.messageHandlers=[],this.logger=new T.Logger("MessageHandlers",I)}return N.prototype.register=function(I){if(this.messageHandlers.some(function(A){return A===I}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(I)},N.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},N.prototype.active=function(){return this.messageHandlers.length>0},N.prototype.handleMessage=function(I){for(var A={resultCode:v.UNHANDLED_MESSAGE_ACK,isHandled:!1},S=0,H=this.messageHandlers;S<H.length;S++){var L=H[S],C=this.safeExecuteHandle(L,I);if(C!==void 0&&(C.isHandled===void 0||C.isHandled))return C.resultCode===void 0&&(C.resultCode=v.HANDLED_MESSAGE_ACK),C}return A},N.prototype.safeExecuteHandle=function(I,A){try{return I.handleMessage(A)}catch(S){return void this.logger.warn("Trouter message handler threw an exception: ".concat(S))}},N}();x.MessageHandlerRegistry=_},function(F,x,P){function v(N){var I,A=this;return function(S){return T(A,void 0,void 0,function(){return _(this,function(H){return S&&(I=void 0),[2,new Promise(function(L,C){N(S).then(function(y){I=y,L(y)}).catch(function(y){I!==void 0&&I.length>0&&L(I),C(y)})})]})})}}var T=this&&this.__awaiter||function(N,I,A,S){function H(L){return L instanceof A?L:new A(function(C){C(L)})}return new(A||(A=Promise))(function(L,C){function y(V){try{Y(S.next(V))}catch(z){C(z)}}function k(V){try{Y(S.throw(V))}catch(z){C(z)}}function Y(V){V.done?L(V.value):H(V.value).then(y,k)}Y((S=S.apply(N,I||[])).next())})},_=this&&this.__generator||function(N,I){function A(Y){return function(V){return S([Y,V])}}function S(Y){if(H)throw new TypeError("Generator is already executing.");for(;y&&(y=0,Y[0]&&(k=0)),k;)try{if(H=1,L&&(C=2&Y[0]?L.return:Y[0]?L.throw||((C=L.return)&&C.call(L),0):L.next)&&!(C=C.call(L,Y[1])).done)return C;switch(L=0,C&&(Y=[2&Y[0],C.value]),Y[0]){case 0:case 1:C=Y;break;case 4:return k.label++,{value:Y[1],done:!1};case 5:k.label++,L=Y[1],Y=[0];continue;case 7:Y=k.ops.pop(),k.trys.pop();continue;default:if(C=k.trys,!(C=C.length>0&&C[C.length-1])&&(Y[0]===6||Y[0]===2)){k=0;continue}if(Y[0]===3&&(!C||Y[1]>C[0]&&Y[1]<C[3])){k.label=Y[1];break}if(Y[0]===6&&k.label<C[1]){k.label=C[1],C=Y;break}if(C&&k.label<C[2]){k.label=C[2],k.ops.push(Y);break}C[2]&&k.ops.pop(),k.trys.pop();continue}Y=I.call(N,k)}catch(V){Y=[6,V],L=0}finally{H=C=0}if(5&Y[0])throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}var H,L,C,y,k={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return y={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y};Object.defineProperty(x,"__esModule",{value:!0}),x.addCacheAsBackupTo=void 0,x.addCacheAsBackupTo=v},function(F,x,P){var v=this&&this.__awaiter||function(z,W,le,re){function $(m){return m instanceof le?m:new le(function(R){R(m)})}return new(le||(le=Promise))(function(m,R){function Z(ue){try{se(re.next(ue))}catch(Te){R(Te)}}function ie(ue){try{se(re.throw(ue))}catch(Te){R(Te)}}function se(ue){ue.done?m(ue.value):$(ue.value).then(Z,ie)}se((re=re.apply(z,W||[])).next())})},T=this&&this.__generator||function(z,W){function le(se){return function(ue){return re([se,ue])}}function re(se){if($)throw new TypeError("Generator is already executing.");for(;Z&&(Z=0,se[0]&&(ie=0)),ie;)try{if($=1,m&&(R=2&se[0]?m.return:se[0]?m.throw||((R=m.return)&&R.call(m),0):m.next)&&!(R=R.call(m,se[1])).done)return R;switch(m=0,R&&(se=[2&se[0],R.value]),se[0]){case 0:case 1:R=se;break;case 4:return ie.label++,{value:se[1],done:!1};case 5:ie.label++,m=se[1],se=[0];continue;case 7:se=ie.ops.pop(),ie.trys.pop();continue;default:if(R=ie.trys,!(R=R.length>0&&R[R.length-1])&&(se[0]===6||se[0]===2)){ie=0;continue}if(se[0]===3&&(!R||se[1]>R[0]&&se[1]<R[3])){ie.label=se[1];break}if(se[0]===6&&ie.label<R[1]){ie.label=R[1],R=se;break}if(R&&ie.label<R[2]){ie.label=R[2],ie.ops.push(se);break}R[2]&&ie.ops.pop(),ie.trys.pop();continue}se=W.call(z,ie)}catch(ue){se=[6,ue],m=0}finally{$=R=0}if(5&se[0])throw se[1];return{value:se[0]?se[1]:void 0,done:!0}}var $,m,R,Z,ie={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return Z={next:le(0),throw:le(1),return:le(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z};Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterManager=x.AudienceSubscriptionState=x.UserActivityObject=void 0;var _=P(3),N=P(2),I=P(4),A=P(0),S=P(5),H=P(18),L=P(7),C=P(6),y=P(19),k=function(){function z(W,le){this.state=W,this.correlationVector=le!==void 0?le:_.CorrelationVector.extend()}return z.prototype.getStateString=function(){switch(this.state){case N.UserActivityState.Active:return"active";case N.UserActivityState.Inactive:return"inactive";case N.UserActivityState.Unknown:return"unknown";default:return"undefined"}},z.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},z.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},z.prototype.toEventJSON=function(){return(0,_.toJson)(this.toEventObject())},z}();x.UserActivityObject=k;var Y=function(){function z(W,le){le===void 0&&(le=_.CorrelationVector.extend()),this.audienceSubscriptionModel=W,this.correlationVector=le}return z.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},z.prototype.toEventObject=function(){return{audiences:this.audienceSubscriptionModel.audienceSubscriptions,cv:this.correlationVector.value()}},z.prototype.toEventJSON=function(){return(0,_.toJson)(this.toEventObject())},z}();x.AudienceSubscriptionState=Y;var V=function(){function z(W,le,re,$,m,R){var Z=this;this.logFunc=W,this.options=le,this.tokenProvider=re,this.usingLegacyTokenApi=$,this.listener=m,this.tokenTypeProtocolSelector=function(ie,se){return Z.options.forceV4aProtocol?"v4a":(0,S.usedProtocol)(ie,se)},this.logger=new A.Logger("Manager",W),this.logger.info("Created TrouterManager with options ".concat((0,_.toJson)(this.options))),this.fsm=new y.TrouterManagerFsm(W,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new k(N.UserActivityState.Unknown),this.protocolSelector=R??this.tokenTypeProtocolSelector.bind(this)}return z.prototype.start=function(){this.fsm.start()},z.prototype.stop=function(W){this.fsm.stop(W)},z.prototype.configure=function(W){this.options=W,this.firstConnection!==void 0&&this.firstConnection.configure(W),this.secondConnection!==void 0&&this.secondConnection.configure(W),this.logger.info("Reconfigured TrouterManager with options ".concat((0,_.toJson)(this.options)))},z.prototype.checkConnection=function(W){this.firstConnection!==void 0&&this.firstConnection.checkConnection(W),this.secondConnection!==void 0&&this.secondConnection.checkConnection(W)},z.prototype.resendRegistration=function(){return v(this,void 0,void 0,function(){return T(this,function(W){return this.secondConnection!==void 0?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):this.firstConnection!==void 0?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])})})},z.prototype.getServerState=function(){if(this.firstConnection!==void 0)return this.firstConnection.getServerState()},z.prototype.getState=function(){return this.fsm.getState()},z.prototype.isInTerminalState=function(){return this.fsm.getInternalState()===I.TrouterManagerState.TerminalError},z.prototype.reportStateInfo=function(){var W=this.firstConnection?C.State[this.firstConnection.getState()]:"Unknown",le=I.TrouterManagerState[this.fsm.getInternalState()];if(this.secondConnection){var re=C.State[this.secondConnection.getState()];return"Manager ".concat(le,"; 1st ").concat(W,"; 2nd ").concat(re)}return"Manager ".concat(le,"; Connection ").concat(W)},z.prototype.startFirstConnection=function(){var W=new L.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.firstConnection=W,this.getConnectionCache().then(function(le){W.start(le)}).catch(function(){})},z.prototype.startSecondConnection=function(W){var le=new L.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.secondConnection=le,this.firstConnection!==void 0&&this.firstConnection.disableRegistrationsAndAutoReconnect(),W?this.getConnectionCache().then(function(re){le.start(re)}).catch(function(){}):le.start()},z.prototype.stopFirstConnection=function(W){this.firstConnection!==void 0&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(W),this.firstConnection=void 0)},z.prototype.stopSecondConnection=function(W){this.secondConnection!==void 0&&(this.secondConnection.stop(W),this.secondConnection=void 0)},z.prototype.stopSecondConnectionDelayed=function(){if(this.secondConnection!==void 0){var W=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in ".concat(Math.round(this.options.lingeringConnectionDelayMs/1e3),"s")),setTimeout(function(){W.stop(!0)},this.options.lingeringConnectionDelayMs)}},z.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},z.prototype.switchConnections=function(){var W=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=W},z.prototype.doesSecondConnectionExist=function(){return this.secondConnection!==void 0},z.prototype.dispatchConnected=function(){if(this.firstConnection!==void 0){var W=this.firstConnection.getServerState(),le=W.url.endsWith("/")?W.url.slice(0,-1):W.url,re={baseEndpointUrl:le,newEndpointUrl:le!==this.baseEndpointUrl,c2cUrlBase:W.c2cUrlBase,clientId:W.connectedClientId,connectionId:W.connectionId,connectionTtlSec:W.getRemainingTtlInSec()};this.baseEndpointUrl=le,this.listener.onTrouterConnected(W.url,re)}},z.prototype.dispatchDisconnected=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},z.prototype.dispatchTerminalError=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},z.prototype.dispatchRegistrationState=function(W){this.options.registrationStateCallback&&this.options.registrationStateCallback(W)},z.prototype.expediteBackoffOnConnections=function(){var W;if(this.lastExpediteBackoffCallAt!==void 0&&Date.now()-this.lastExpediteBackoffCallAt<((W=this.options.expediteBackoffOnStartMinimumDelayMs)!==null&&W!==void 0?W:1e4))return void this.logger.info("Expedite backoff due to start() too frequent, skipping");this.lastExpediteBackoffCallAt=Date.now(),this.firstConnection!==void 0&&this.firstConnection.expediteBackoff(),this.secondConnection!==void 0&&this.secondConnection.expediteBackoff()},z.prototype.onDownstreamRequest=function(W,le,re){var $={id:le.id,method:le.method,path:"/".concat(le.shortUrl),body:le.body,headers:le.headers},m={id:le.id,status:0,headers:{},body:"",send:function(){return m.status<=100||m.status>=999?3:(re.writeHead(m.status,m.headers),re.end(m.body))}};this.listener.onTrouterRequest($,m)},z.prototype.onConnected=function(W){this.fsm.onConnected(W===this.firstConnection)},z.prototype.onRegistered=function(W){this.fsm.onRegistered(W===this.firstConnection)},z.prototype.onUnregistered=function(W){this.fsm.onUnregistered(W===this.firstConnection||W===this.storedFirstConnection)},z.prototype.onReconnecting=function(W){this.fsm.onReconnecting(W===this.firstConnection)},z.prototype.onReconnectIsRequired=function(W,le,re){this.fsm.onReconnectionRequired(W===this.firstConnection,le,re)},z.prototype.onDisconnected=function(W){this.fsm.onDisconnected(W===this.firstConnection||W==this.storedFirstConnection),this.storedFirstConnection=void 0},z.prototype.onTerminalError=function(){this.fsm.onTerminalError(),this.storedFirstConnection=void 0},z.prototype.onUserActivityStateAccepted=function(W){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(W)},z.prototype.onAudiencesSetResolved=function(W,le){var re,$;($=(re=this.listener).onAudiencesSetResolved)===null||$===void 0||$.call(re,W,le)},z.prototype.onConnectionParametersUpdated=function(W){this.setConnectionCache(W)},z.prototype.setUserActivityState=function(W,le){return this.userActivityObject=new k(W,_.CorrelationVector.extend(le)),this.secondConnection!==void 0?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the second/new connection")),void this.secondConnection.setUserActivityState(this.userActivityObject)):this.firstConnection!==void 0?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the first/current connection")),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},z.prototype.setAudienceSubscriptionsAsync=function(W,le,re){if(this.audienceSubscriptionState=new Y(W,_.CorrelationVector.extend(re)),this.secondConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on second/new connection")),this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,le);if(this.firstConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on first/current connection")),this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,le);throw new Error("No connection found")},z.prototype.onTrouterMessageLost=function(W){var le=this;if(this.listener.onTrouterMessageLoss)if(W!=null&&W.length){var re=W.filter(function(m){return le.processedMessageLoss["".concat(m.tag,"-").concat(m.etag)]!==void 0});if(re.length&&(this.logger.info("onTrouterMessageLoss - immediately acknowledging ".concat(re.length," seen dropped indicators")),this.sendProcessedDroppedIndicators(re),W=W.filter(function(m){return le.processedMessageLoss["".concat(m.tag,"-").concat(m.etag)]===void 0}),!W.length))return void this.logger.info("onTrouterMessageLoss - all declared dropped indicators have been seen before");var $=this.listener.onTrouterMessageLoss(W.map(function(m){return m.tag}));if(!$)return void this.logger.warn("onTrouterMessageLoss - some flow tag(s) have not been processed by listeners");W.forEach(function(m){le.processedMessageLoss["".concat(m.tag,"-").concat(m.etag)]=""}),this.sendProcessedDroppedIndicators(W)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},z.prototype.getConnectionCache=function(){var W=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then(function(le){var re=le?JSON.parse(le):void 0;return typeof re=="object"?re:void 0}).catch(function(le){return W.logger.warn("Invalid connection cache content provided: ".concat(le)),W.connectionCache})):Promise.resolve(this.connectionCache)},z.prototype.setConnectionCache=function(W){if(this.connectionCache=W,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(W))}catch(le){this.logger.warn("Error setting external connection cache: ".concat(le))}},z.prototype.sendProcessedDroppedIndicators=function(W){return this.firstConnection!==void 0?void this.firstConnection.sendProcessedDroppedIndicators(W):this.secondConnection!==void 0?void this.secondConnection.sendProcessedDroppedIndicators(W):void 0},z.prototype.configuredTrouterManager=function(){return new H.RegistrationEnforcer(this,this.options.connectionDependsOnRegistration,this.options.delayEventsUntilRegistered)},z}();x.TrouterManager=V},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterUrlPromise=void 0;var v=P(0),T=function(){function _(N){this.logger=new v.Logger("UrlPromise",N)}return _.prototype.getPromise=function(){var N=this;return this.url!==void 0?(this.logger.debug("returning previously resolved url: ".concat(this.url)),Promise.resolve(this.url)):(this.pendingPromise===void 0?(this.logger.debug("creating and returning promise"),this.pendingPromise=new Promise(function(I,A){N.pendingPromiseResolveRef=I,N.pendingPromiseRejectRef=A})):this.logger.debug("returning existing promise"),this.pendingPromise)},_.prototype.resolveUrl=function(N){this.url=N,this.logger.debug("got url: ".concat(this.url));var I=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,I!==void 0&&(this.logger.debug("resolving promise"),I(N))},_.prototype.rejectUrl=function(N){this.logger.debug("aborting");var I=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,I!==void 0&&(this.logger.debug("rejecting promise"),I(N))},_.prototype.resetUrl=function(){this.logger.debug("resetting url"),this.url=void 0},_}();x.TrouterUrlPromise=T},function(F,x,P){(function(v,T){(function(N,I){var A=N;A.version="0.9.6",A.protocol=1,A.transports=[],A.j=[],A.sockets={},A.connect=function(S,H){var L,C,y=A.util.parseUri(S);I&&I.location&&(y.protocol=y.protocol||I.location.protocol.slice(0,-1),y.host=y.host||(I.document?I.document.domain:I.location.hostname),y.port=y.port||I.location.port),L=A.util.uniqueUri(y);var k={host:y.host,secure:y.protocol=="https",port:y.port||(y.protocol=="https"?443:80),query:y.query||""};return A.util.merge(k,H),!k["force new connection"]&&A.sockets[L]||(C=new A.Socket(k)),!k["force new connection"]&&C&&(A.sockets[L]=C),C=C||A.sockets[L],k["skipped handshake data"]?C.of(""):C.of(y.path.length>1?y.path:"")}})(T.exports,v===void 0?window:v);var _=T.exports;(function(N,I){var A=N.util={},S=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,H=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];A.parseUri=function(C){for(var y=S.exec(C||""),k={},Y=14;Y--;)k[H[Y]]=y[Y]||"";return k},A.uniqueUri=function(C){var y=C.protocol,k=C.host,Y=C.port;return"document"in I?(k=k||document.domain,Y=Y||(y=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(k=k||"localhost",Y||y!="https"||(Y=443)),(y||"http")+"://"+k+":"+(Y||80)},A.query=function(C,y){var k=A.chunkQuery(C||""),Y=[];A.merge(k,A.chunkQuery(y||""));for(var V in k)k.hasOwnProperty(V)&&Y.push(V+"="+k[V]);return Y.length?"?"+Y.join("&"):""},A.chunkQuery=function(C){for(var y,k={},Y=C.split("&"),V=0,z=Y.length;V<z;++V)y=Y[V].split("="),y[0]&&(k[y[0]]=y[1]);return k};var L=!1;A.load=function(C){if("document"in I&&document.readyState==="complete"||L)return C();A.on(I,"load",C,!1)},A.on=function(C,y,k,Y){C.attachEvent?C.attachEvent("on"+y,k):C.addEventListener&&C.addEventListener(y,k,Y)},A.request=function(C){if(C&&typeof XDomainRequest<"u")return new XDomainRequest;if(typeof XMLHttpRequest<"u"&&(!C||A.ua.hasCORS))return new XMLHttpRequest;if(!C)try{return new window[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}return null},typeof window<"u"&&A.load(function(){L=!0}),A.defer=function(C){if(!A.ua.webkit||typeof importScripts<"u")return C();A.load(function(){setTimeout(C,100)})},A.merge=function(C,y,k,Y){var V,z=Y||[],W=k===void 0?2:k;for(V in y)y.hasOwnProperty(V)&&A.indexOf(z,V)<0&&(typeof C[V]=="object"&&W?A.merge(C[V],y[V],W-1,z):(C[V]=y[V],z.push(y[V])));return C},A.mixin=function(C,y){A.merge(C.prototype,y.prototype)},A.inherit=function(C,y){function k(){}k.prototype=y.prototype,C.prototype=new k},A.isArray=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"},A.intersect=function(C,y){for(var k=[],Y=C.length>y.length?C:y,V=C.length>y.length?y:C,z=0,W=V.length;z<W;z++)~A.indexOf(Y,V[z])&&k.push(V[z]);return k},A.indexOf=function(C,y,k){for(var Y=C.length,k=k<0?k+Y<0?0:k+Y:k||0;k<Y&&C[k]!==y;k++);return Y<=k?-1:k},A.toArray=function(C){for(var y=[],k=0,Y=C.length;k<Y;k++)y.push(C[k]);return y},A.ua={},A.ua.hasCORS=typeof XMLHttpRequest<"u"&&function(){try{var C=new XMLHttpRequest}catch{return!1}return C.withCredentials!=null}(),A.ua.webkit=typeof navigator<"u"&&/webkit/i.test(navigator.userAgent)})(_!==void 0?_:T.exports,v===void 0?window:v),function(N,I){function A(){}N.EventEmitter=A,A.prototype.on=function(S,H){return this.$events||(this.$events={}),this.$events[S]?I.util.isArray(this.$events[S])?this.$events[S].push(H):this.$events[S]=[this.$events[S],H]:this.$events[S]=H,this},A.prototype.addListener=A.prototype.on,A.prototype.once=function(S,H){function L(){C.removeListener(S,L),H.apply(this,arguments)}var C=this;return L.listener=H,this.on(S,L),this},A.prototype.removeListener=function(S,H){if(this.$events&&this.$events[S]){var L=this.$events[S];if(I.util.isArray(L)){for(var C=-1,y=0,k=L.length;y<k;y++)if(L[y]===H||L[y].listener&&L[y].listener===H){C=y;break}if(C<0)return this;L.splice(C,1),L.length||delete this.$events[S]}else(L===H||L.listener&&L.listener===H)&&delete this.$events[S]}return this},A.prototype.removeAllListeners=function(S){return this.$events&&this.$events[S]&&(this.$events[S]=null),this},A.prototype.listeners=function(S){return this.$events||(this.$events={}),this.$events[S]||(this.$events[S]=[]),I.util.isArray(this.$events[S])||(this.$events[S]=[this.$events[S]]),this.$events[S]},A.prototype.emit=function(S){if(!this.$events)return!1;var H=this.$events[S];if(!H)return!1;var L=Array.prototype.slice.call(arguments,1);if(typeof H=="function")H.apply(this,L);else{if(!I.util.isArray(H))return!1;for(var C=H.slice(),y=0,k=C.length;y<k;y++)C[y].apply(this,L)}return!0}}(_!==void 0?_:T.exports,_!==void 0?_:T.parent.exports),function(N,I){if(I&&I.parse)return N.JSON={parse:I.parse,stringify:I.stringify};throw new Error("JSON not available")}(_!==void 0?_:T.exports,typeof JSON<"u"?JSON:void 0),function(N,I){var A=N.parser={},S=A.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],H=A.reasons=["transport not supported","client not handshaken","unauthorized"],L=A.advice=["reconnect"],C=I.JSON,y=I.util.indexOf;A.encodePacket=function(Y){var V=y(S,Y.type),z=Y.id||"",W=Y.endpoint||"",le=Y.ack,re=null;switch(Y.type){case"error":var $=Y.reason?y(H,Y.reason):"",m=Y.advice?y(L,Y.advice):"";$===""&&m===""||(re=$+(m!==""?"+"+m:""));break;case"message":Y.data!==""&&(re=Y.data);break;case"event":var R={name:Y.name};Y.args&&Y.args.length&&(R.args=Y.args),re=C.stringify(R);break;case"json":re=C.stringify(Y.data);break;case"connect":Y.qs&&(re=Y.qs);break;case"ack":re=Y.ackId+(Y.args&&Y.args.length?"+"+C.stringify(Y.args):"")}var Z=[V,z+(le=="data"?"+":""),W];return re!=null&&Z.push(re),Z.join(":")},A.encodePayload=function(Y){var V="";if(Y.length==1)return Y[0];for(var z=0,W=Y.length;z<W;z++)V+=""+Y[z].length+""+Y[z];return V};var k=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;A.decodePacket=function(W){var V=W.match(k);if(!V)return{};var z=V[2]||"",W=V[5]||"",le={type:S[V[1]],endpoint:V[4]||""};switch(z&&(le.id=z,V[3]?le.ack="data":le.ack=!0),le.type){case"error":var V=W.split("+");le.reason=H[V[0]]||"",le.advice=L[V[1]]||"";break;case"message":le.data=W||"";break;case"event":try{var re=C.parse(W);le.name=re.name,le.args=re.args}catch{}le.args=le.args||[];break;case"json":try{le.data=C.parse(W)}catch{}break;case"connect":le.qs=W||"";break;case"ack":var V=W.match(/^([0-9]+)(\+)?(.*)/);if(V&&(le.ackId=V[1],le.args=[],V[3]))try{le.args=V[3]?C.parse(V[3]):[]}catch{}break;case"disconnect":le.reason=W}return le},A.decodePayload=function(Y){if(Y.charAt(0)==""){for(var V=[],z=1,W="";z<Y.length;z++)Y.charAt(z)==""?(V.push(A.decodePacket(Y.substr(z+1).substr(0,W))),z+=Number(W)+1,W=""):W+=Y.charAt(z);return V}return[A.decodePacket(Y)]}}(_!==void 0?_:T.exports,_!==void 0?_:T.parent.exports),function(N,I){function A(S,H){this.socket=S,this.sessid=H,this.connectErrorCallback=void 0,this.isOpened=!1}N.Transport=A,I.util.mixin(A,I.EventEmitter),A.prototype.onData=function(S){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),S!==""){var H=I.parser.decodePayload(S);if(H&&H.length)for(var L=0,C=H.length;L<C;L++)this.onPacket(H[L])}return this},A.prototype.onPacket=function(S){return this.socket.setHeartbeatTimeout(),S.type=="heartbeat"?this.onHeartbeat():(S.type=="connect"&&S.endpoint==""&&this.onConnect(),S.type=="error"&&S.advice=="reconnect"&&(this.isOpened=!1),this.socket.onPacket(S),this)},A.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var S=this;this.closeTimeout=setTimeout(function(){S.onDisconnect()},this.socket.closeTimeout)}},A.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},A.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},A.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},A.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},A.prototype.packet=function(S){this.send(I.parser.encodePacket(S))},A.prototype.onHeartbeat=function(S){this.packet({type:"heartbeat"})},A.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},A.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},A.prototype.prepareUrl=function(S){var H=this.socket.options;if(H["skipped handshake data"])return H.rewriteUrlForProxy(H["skipped handshake data"].websocketUrl+(S||""));var L=this.scheme()+"://"+H.host+":"+H.port+"/"+H.resource+"/"+I.protocol+"/"+this.name+"/"+this.sessid+(S||"");return H.rewriteUrlForProxy(L)},A.prototype.ready=function(S,H){H.call(this)},A.prototype.clearEventHandlers=function(){return this}}(_!==void 0?_:T.exports,_!==void 0?_:T.parent.exports),function(N,I,A){function S(L){if(this.options={port:80,secure:!1,document:"document"in A&&document,resource:"socket.io",transports:I.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},I.util.merge(this.options,L),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||I.util.ua.hasCORS)){var C=this;I.util.on(A,"unload",function(){C.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function H(){}N.Socket=S,I.util.mixin(S,I.EventEmitter),S.prototype.of=function(L){return this.namespaces[L]||(this.namespaces[L]=new I.SocketNamespace(this,L),L!==""&&this.namespaces[L].packet({type:"connect"})),this.namespaces[L]},S.prototype.publish=function(){this.emit.apply(this,arguments);var L;for(var C in this.namespaces)this.namespaces.hasOwnProperty(C)&&(L=this.of(C),L.$emit.apply(L,arguments))},S.prototype.handshake=function(L){function C(re){re instanceof Error?y.onError(re.message):L.apply(null,re.split(":"))}var y=this,k=this.options;if(!y.disconnected){var Y=k.rewriteUrlForProxy(["http"+(k.secure?"s":"")+":/",k.host+":"+k.port,k.resource,I.protocol,I.util.query(this.options.query,"t="+ +new Date)].join("/"));if(this.isXDomain()&&!I.util.ua.hasCORS){var V=document.getElementsByTagName("script")[0],z=document.createElement("script");z.src=Y+"&jsonp="+I.j.length,V.parentNode.insertBefore(z,V),I.j.push(function(re){C(re),z.parentNode.removeChild(z)})}else{var W=I.util.request();W.open("GET",Y,!0);var le=this.options.requestHeaders;le!==void 0&&Object.keys(le).forEach(function(re){W.setRequestHeader(re,le[re])}),W.onreadystatechange=function(){W.readyState==4&&(W.onreadystatechange=H,W.status==200?C(W.responseText):!y.reconnecting&&y.onError(W.responseText))},W.send(null)}}},S.prototype.getTransport=function(L){for(var C,y=L||this.transports,k=0;C=y[k];k++)if(I.Transport[C]&&I.Transport[C].check(this)&&(!this.isXDomain()||I.Transport[C].xdomainCheck()))return new I.Transport[C](this,this.sessionid);return null},S.prototype.connect=function(L){if(this.connecting||this.disconnected)return this;var C=this,y=function(Y,V,z,W){function le(){if(!C.connected&&!C.disconnected)if(C.connecting=!1,clearTimeout(C.connectTimeoutTimer),C.options["try multiple transports"]){for(;C.remainingTransports.length>0&&C.remainingTransports.splice(0,1)[0]!=C.transport.name;);C.remainingTransports.length?re(C.remainingTransports):C.publish("connect_failed")}else C.publish("connect_failed")}function re($){if(C.transport&&(C.transport.clearTimeouts(),C.transport.clearEventHandlers()),C.transport=C.getTransport($),!C.transport||C.disconnected)return C.publish("connect_failed");C.transport.ready(C,function(){C.connecting=!0,C.publish("connecting",C.transport.name),C.transport.open(le),C.options["connect timeout"]&&(C.connectTimeoutTimer=setTimeout(function(){le()},C.options["connect timeout"]))})}C.sessionid=Y,C.closeTimeout=1e3*z+2e3,C.heartbeatTimeout=1e3*V+2e3,C.transports=W?I.util.intersect(W.split(","),C.options.transports):C.options.transports,C.setHeartbeatTimeout(),C.remainingTransports=C.transports.slice(0),re(C.transports),C.once("connect",function(){clearTimeout(C.connectTimeoutTimer),L&&typeof L=="function"&&L()})};if(this.options["skipped handshake data"]){var k=this.options["skipped handshake data"];y("v4c-"+new Date().getTime(),k.timeout,k.timeout,"websocket")}else this.handshake(y);return this},S.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var L=this;this.heartbeatTimeoutTimer=setTimeout(function(){L.transport.onClose()},this.heartbeatTimeout)},S.prototype.packet=function(L){return this.connected&&!this.doBuffer?this.transport.packet(L):this.buffer.push(L),this},S.prototype.setBuffer=function(L){this.doBuffer=L,!L&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},S.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},S.prototype.disconnectSync=function(){var L=I.util.request(),C=this.resource+"/"+I.protocol+"/"+this.sessionid;L.open("GET",C,!0),this.onDisconnect("booted")},S.prototype.isXDomain=function(){var L=A.location.port||(A.location.protocol=="https:"?443:80);return this.options.host!==A.location.hostname||this.options.port!=L},S.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},S.prototype.onOpen=function(){this.open=!0},S.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},S.prototype.onPacket=function(L){this.of(L.endpoint).onPacket(L)},S.prototype.onError=function(L){L&&L.advice&&L.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",L&&L.reason?L.reason:L)},S.prototype.onDisconnect=function(L){var C=this.connected,y=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(C||y)&&(this.transport.close(),this.transport.clearTimeouts(),C?(this.publish("disconnect",L),L!="booted"&&this.options.reconnect&&!this.reconnecting&&this.reconnect()):this.publish("close_during_connecting",L))},S.prototype.reconnect=function(){function L(){if(y.connected){for(var z in y.namespaces)y.namespaces.hasOwnProperty(z)&&z!==""&&y.namespaces[z].packet({type:"connect"});y.publish("reconnect",y.transport.name,y.reconnectionAttempts)}clearTimeout(y.reconnectionTimer),y.removeListener("connect_failed",C),y.removeListener("connect",C),y.reconnecting=!1,delete y.reconnectionAttempts,delete y.reconnectionDelay,delete y.reconnectionTimer,delete y.redoTransports,y.options["try multiple transports"]=Y}function C(){if(y.reconnecting)return y.connected?L():y.connecting&&y.reconnecting?y.reconnectionTimer=setTimeout(C,1e3):void(y.reconnectionAttempts++>=k?y.redoTransports?(y.publish("reconnect_failed"),L()):(y.on("connect_failed",C),y.options["try multiple transports"]=!0,y.transport=y.getTransport(),y.redoTransports=!0,y.connect()):(y.reconnectionDelay<V&&(y.reconnectionDelay*=2),y.connect(),y.publish("reconnecting",y.reconnectionDelay,y.reconnectionAttempts),y.reconnectionTimer=setTimeout(C,y.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var y=this,k=this.options["max reconnection attempts"],Y=this.options["try multiple transports"],V=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(C,this.reconnectionDelay),this.on("connect",C)}}(_!==void 0?_:T.exports,_!==void 0?_:T.parent.exports,v===void 0?window:v),function(N,I){function A(H,L){this.socket=H,this.name=L||"",this.flags={},this.json=new S(this,"json"),this.ackPackets=0,this.acks={}}function S(H,L){this.namespace=H,this.name=L}N.SocketNamespace=A,I.util.mixin(A,I.EventEmitter),A.prototype.$emit=I.EventEmitter.prototype.emit,A.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},A.prototype.packet=function(H){return H.endpoint=this.name,this.socket.packet(H),this.flags={},this},A.prototype.send=function(H,L){var C={type:this.flags.json?"json":"message",data:H};return typeof L=="function"&&(C.id=++this.ackPackets,C.ack=!0,this.acks[C.id]=L),this.packet(C)},A.prototype.emit=function(H){var L=Array.prototype.slice.call(arguments,1),C=L[L.length-1],y={type:"event",name:H};return typeof C=="function"&&(y.id=++this.ackPackets,y.ack="data",this.acks[y.id]=C,L=L.slice(0,L.length-1)),y.args=L,this.packet(y)},A.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},A.prototype.onPacket=function(H){function L(){C.packet({type:"ack",args:I.util.toArray(arguments),ackId:H.id})}var C=this;switch(H.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(H.reason||"booted"):this.$emit("disconnect",H.reason||"");break;case"message":case"json":var y=["message",H.data];H.ack=="data"?y.push(L):H.ack&&this.packet({type:"ack",ackId:H.id}),this.$emit.apply(this,y);break;case"event":var y=[H.name].concat(H.args);H.ack=="data"&&y.push(L),this.$emit.apply(this,y);break;case"ack":this.acks[H.ackId]&&(this.acks[H.ackId].apply(this,H.args),delete this.acks[H.ackId]);break;case"error":H.advice?this.socket.onError(H):H.reason=="unauthorized"?this.$emit("connect_failed",H.reason):this.$emit("error",H.reason)}},S.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},S.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(_!==void 0?_:T.exports,_!==void 0?_:T.parent.exports),function(N,I,A){function S(L){I.Transport.apply(this,arguments)}function H(){}N.websocket=S,I.util.inherit(S,I.Transport),S.prototype.name="websocket",S.prototype.open=function(L){var C,y=I.util.query(this.socket.options.query),k=this;return this.connectErrorCallback=L,C||(C=A.MozWebSocket||A.WebSocket),this.websocket=new C(this.prepareUrl(y)),this.websocket.onopen=function(){k.onOpen(),k.socket.setBuffer(!1)},this.websocket.onmessage=function(Y){k.onData(Y.data)},this.websocket.onclose=function(){k.onClose(),k.socket.setBuffer(!0)},this.websocket.onerror=function(Y){k.onError(Y)},this},S.prototype.send=function(L){return this.websocket.send(L),this},S.prototype.payload=function(L){for(var C=0,y=L.length;C<y;C++)this.packet(L[C]);return this},S.prototype.close=function(){return this.websocket.close(),this},S.prototype.onError=function(L){this.connectErrorCallback!==void 0&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(L)},S.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},S.check=function(){return"WebSocket"in A&&!("__addTask"in WebSocket)||"MozWebSocket"in A},S.xdomainCheck=function(){return!0},S.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=H),this},I.transports.push("websocket")}(_!==void 0?_.Transport:T.exports,_!==void 0?_:T.parent.exports,v===void 0?window:v),function(N,I,A){function S(L){L&&I.Transport.apply(this,arguments)}function H(){}N.XHR=S,I.util.inherit(S,I.Transport),S.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},S.prototype.payload=function(L){for(var C=[],y=0,k=L.length;y<k;y++)C.push(I.parser.encodePacket(L[y]));this.send(I.parser.encodePayload(C))},S.prototype.send=function(L){return this.post(L),this},S.prototype.post=function(L){function C(){this.readyState==4&&(this.onreadystatechange=H,this.status==200?(clearTimeout(this.ackTimeoutTimer),k.socket.setBuffer(!1)):k.onClose())}function y(){this.onload=H,k.socket.setBuffer(!1)}var k=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),A.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=y:this.sendXHR.onreadystatechange=C,this.sendXHR.send(L),k.sendXHR.ackTimeoutTimer=setTimeout(function(){k.onClose()},k.socket.options.ackTimeoutMs)},S.prototype.close=function(){return this.onClose(),this},S.prototype.request=function(L){var C=I.util.request(this.socket.isXDomain()),y=I.util.query(this.socket.options.query,"t="+ +new Date);C.open(L||"GET",this.prepareUrl(y),!0);var k=this.socket.options.requestHeaders;if(k!==void 0&&Object.keys(k).forEach(function(Y){C.setRequestHeader(Y,k[Y])}),L=="POST")try{C.setRequestHeader?C.setRequestHeader("Content-type","text/plain;charset=UTF-8"):C.contentType="text/plain"}catch{}return C},S.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},S.check=function(L,C){try{var y=I.util.request(C),k=A.XDomainRequest&&y instanceof XDomainRequest,Y=L&&L.options&&L.options.secure?"https:":"http:",V=Y!=A.location.protocol;if(y&&(!k||!V))return!0}catch{}return!1},S.xdomainCheck=function(){return S.check(null,!0)},S.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=H),this}}(_!==void 0?_.Transport:T.exports,_!==void 0?_:T.parent.exports,v===void 0?window:v),function(N,I,A){function S(){I.Transport.XHR.apply(this,arguments)}function H(){}N["xhr-polling"]=S,I.util.inherit(S,I.Transport.XHR),I.util.merge(S,I.Transport.XHR),S.prototype.name="xhr-polling",S.prototype.open=function(L){var C=this;return C.connectErrorCallback=L,I.Transport.XHR.prototype.open.call(C),!1},S.prototype.get=function(){function L(){this.readyState==4&&(this.onreadystatechange=H,this.status==200?(k.connectErrorCallback=void 0,k.onData(this.responseText),k.get()):(k.onClose(),k.connectErrorCallback!==void 0&&(k.connectErrorCallback(),k.connectErrorCallback=void 0)))}function C(){k.connectErrorCallback=void 0,this.onload=H,this.onerror=H,k.onData(this.responseText),k.get()}function y(){k.onClose(),k.connectErrorCallback!==void 0&&(k.connectErrorCallback(),k.connectErrorCallback=void 0)}if(this.isOpened){var k=this;this.xhr=this.request(),A.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=C,this.xhr.onerror=y):this.xhr.onreadystatechange=L,this.xhr.send(null)}},S.prototype.onClose=function(){if(I.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=H;try{this.xhr.abort()}catch{}this.xhr=null}},S.prototype.ready=function(L,C){var y=this;I.util.defer(function(){C.call(y)})},S.prototype.clearEventHandlers=function(){return I.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=H),this},I.transports.push("xhr-polling")}(_!==void 0?_.Transport:T.exports,_!==void 0?_:T.parent.exports,v===void 0?window:v),x.io=_}).call(x,P(13),P(14)(F))},function(F,x){var P;P=function(){return this}();try{P=P||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(P=window)}F.exports=P},function(F,x){F.exports=function(P){return P.webpackPolyfill||(P.deprecate=function(){},P.paths=[],P.children||(P.children=[]),Object.defineProperty(P,"loaded",{enumerable:!0,get:function(){return P.l}}),Object.defineProperty(P,"id",{enumerable:!0,get:function(){return P.i}}),P.webpackPolyfill=1),P}},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.ConnectionTracker=x.Properties=x.TrackerStep=x.ClientEventName=x.ResponseData=void 0;var v=P(3),T=P(1),_=P(0),N=function(){function y(k){this.id=k,this.status=200,this.headers={},this.body=""}return y}();x.ResponseData=N;var I;(function(y){y.Connected="trouter_js_client_connected",y.Disconnected="trouter_js_client_disconnected",y.Error="trouter_js_client_error",y.Progress="trouter_js_client_progress",y.Response="trouter_js_client_response",y.Request="trouter_js_client_request",y.CheckConnection="trouter_js_client_check_connection",y.Registration="trouter_js_client_registration",y.Unregistration="trouter_js_client_unregistration"})(I||(x.ClientEventName=I={}));var A=function(){function y(k,Y,V,z,W){this.stepName=k,this.operation=Y,this.delta=V,this.ts=z,this.error=W}return y}();x.TrackerStep=A;var S=function(){function y(){}return y}();x.Properties=S;var H=function(){function y(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}return y}(),L=function(){function y(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}return y}(),C=function(){function y(k,Y,V,z,W,le,re){this.clientId=Y,this.clientInfo=V,this.getServerState=z,this.endpointId=W,this.clientCorrelationID=le,this.environment=re,this.logger=new _.Logger("ConnectionTracker",k),this.clientCorrelationID=le!==void 0?le:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new v.Timespan,this.eventLogSettings=new L,this.connectedInfo=new H}return y.prototype.enable=function(k){this.eventLogSettings.enabled=!0,this.eventLogger=k},y.prototype.disable=function(){this.eventLogSettings.enabled=!1},y.prototype.sendProgress=function(k){this.steps.length>0&&this.sendTelemetry(I.Progress,k,this.steps)},y.prototype.cancelProgressTimer=function(){this.progressTimeout!==void 0&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},y.prototype.resetProgressSendTimer=function(){var k=this;this.cancelProgressTimer(),this.eventLogSettings.sendProgressTimeoutSecs!==void 0&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){k.sendProgress({reason:"timeout",timeoutSecs:k.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},y.prototype.setConnectedInfo=function(k,Y){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=k,this.connectedInfo.transportType=Y,++this.connectedInfo.connectionNumber},y.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},y.prototype.copyProperties=function(k,Y){for(var V=0,z=Object.keys(Y);V<z.length;V++){var W=z[V];Y[W]!==void 0&&(k[W.replace(/-/g,"_")]={value:Y[W]})}},y.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},y.prototype.sendTelemetry=function(k,Y,V){try{if(this.eventLogSettings.enabled===!0&&this.eventLogSettings[k]===!0&&this.eventLogger!==void 0){var z=this.getServerState(),W={name:k,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:(0,v.toJson)(V)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:T.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:z.connectionId},connectedClientId:{value:z.connectedClientId},domId:{value:z.domId},url:{value:z.unsecureUrl},surl:{value:z.url},ttlInSecs:{value:z.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(W.properties,Y),this.eventLogger.logEvent(W)}}catch(le){this.logger.warn("error in sending event ".concat(k,": ").concat((0,v.toJson)(le)))}},y.prototype.createStep=function(k,Y,V){return new A(k,Y,this.beginTimestamp.duration,Date.now(),V)},y.prototype.addStep=function(k,Y,V){if(this.eventLogSettings.enabled!==!1&&(this.steps.length===0&&this.beginTimestamp.reset(),this.steps.push(this.createStep(k,Y,V)),++this.totalStepCount,this.eventLogSettings.numberOfStepsToMaintain!==void 0&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var z=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(I.Progress,{reason:"flush"},z)}},y.prototype.trackStart=function(k){this.addStep(k,"start")},y.prototype.trackEnd=function(k){this.addStep(k,"end")},y.prototype.trackError=function(k,Y,V,z){V===void 0&&(V=!0),k==="health"&&this.eventLogSettings.logHealthCheckError!==!0||k==="ping"&&this.eventLogSettings.logSendPingError===!1||(z===void 0&&(z="error"),V===!0&&this.addStep(k,z,Y),this.sendTelemetry(I.Error,{},[this.createStep(k,z,Y)]))},y.prototype.trackProgress=function(k,Y){this.addStep(k,Y)},y.prototype.trackConnected=function(k,Y){this.setConnectedInfo(k,Y);var V=this.steps.slice(0),z=this.totalStepCount,W=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(I.Connected,{stepCount:V.length,totalStepCount:z,connectionEstablishmentMs_Total:W},V),this.cancelProgressTimer()},y.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},y.prototype.trackDisconnected=function(k){k.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(I.Disconnected,k,[]),this.resetProgressSendTimer()},y.prototype.trackNewConnection=function(){++this.connectionAttempt},y.prototype.trackRequest=function(k,Y){var V={};Y!==void 0&&(V.hasError=!0,V.error=Y);try{if(k){V.requestID=k.id,V.httpMethod=k.method,V.url=k.url,V.bodyLength=k.body.length,V.shortUrl=k.shortUrl,V.requestTimeStamp=k.startTS,V.correlationVector=k.correlationVector;for(var z=k.headers,W=0,le=Object.keys(z);W<le.length;W++){var re=le[W];V[re]=z[re]}}}catch($){V.hasError=!0,V.error="".concat(V.error," error creating request context ").concat((0,v.toJson)($))}this.sendTelemetry(I.Request,V,[])},y.prototype.trackResponse=function(k,Y,V,z){var W={};z!==void 0&&(W.hasError=!0,W.error=z);try{if(W.responseTimestamp=V!==void 0?V.sentTS:Date.now(),k){W.requestID=k.id,W.httpMethod=k.method,W.shortUrl=k.shortUrl,W.correlationVector=k.correlationVector;for(var le=k.headers,re=0,$=Object.keys(le);re<$.length;re++){var m=$[re];W[m]=le[m]}}V&&(W.latencyMS=Y,W.responseCode=V.status,W.responseLength=V.body.length)}catch(R){W.hasError=!0,W.error="".concat(W.error," error creating response context ").concat((0,v.toJson)(R))}this.sendTelemetry(I.Response,W,[])},y.prototype.sendResponseError=function(k,Y,V){this.trackResponse(Y,void 0,V,k)},y.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},y.prototype.mergeSettings=function(k){if(k){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,k.numberOfStepsToMaintain!==void 0?k.numberOfStepsToMaintain:0));var Y=Math.min(3600,Math.max(55,k.sendProgressTimeoutSecs!==void 0?k.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=k.logHealthCheckError,this.eventLogSettings.logSendPingError=k.logSendPingError;for(var V=0,z=Object.keys(I).map(function(le){return I[le]});V<z.length;V++){var W=z[V];k[W]!==void 0&&(this.eventLogSettings[W]=k[W])}this.eventLogSettings.sendProgressTimeoutSecs!==Y&&(this.eventLogSettings.sendProgressTimeoutSecs=Y,this.resetProgressSendTimer())}},y}();x.ConnectionTracker=C},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.DisconnectReason=void 0;var v=function(){function T(_,N,I){this.reason=_,this.claims=N,this.details=I}return T.fromRawReason=function(_,N){if(_===""||_==="dup")return new T(_);try{var I=JSON.parse(_);return typeof I!="object"||I.reason===void 0?(N==null||N.error("invalid disconnect reason format"),new T("unknown",void 0,_)):new T(I.reason,I.claims,I.details)}catch{return new T("disconnect",void 0,_)}},T.fromSocketIoEventData=function(_,N){return typeof N=="string"?new T(_,void 0,N):void 0},T.prototype.toTelemetryString=function(){return this.reason==="socketerror"||this.reason==="reconnecterror"||this.reason==="disconnect"?this.details:this.reason},T}();x.DisconnectReason=v},function(F,x,P){function v(_,N,I){if(_===void 0||N===void 0)return!1;var A=Date.now()-_;return A>N*I.tolerance&&A>I.minimumWaitMs}Object.defineProperty(x,"__esModule",{value:!0}),x.ExponentialBackoff=void 0;var T=function(){function _(N,I,A){A===void 0&&(A={tolerance:2,minimumWaitMs:1e4}),this.logger=N,this.maxBackoffInMs=I,this.gapDetectionSettings=A,this.backoffId=0,this.backoffCount=0}return _.calculateNextBackoffMs=function(N,I){var A=1+.4*(Math.random()-.5),S=1e3*Math.pow(2,N)*A;return S=Math.round(S),Math.min(I,S)},_.prototype.setMaxBackoffMs=function(N){this.maxBackoffInMs=N},_.prototype.backoff=function(N,I){var A=this;if(this.timerHandle!==void 0&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.previousCompleteTime!==void 0){var S=Date.now()-this.previousCompleteTime;S>this.maxBackoffInMs*this.gapDetectionSettings.tolerance&&S>this.gapDetectionSettings.minimumWaitMs&&(this.logger.info("Back off for ".concat(N," with ID ").concat(this.backoffId," will be reset due to a lot of time having passed since the previous backoff (").concat(S," ms)")),this.backoffCount=0,this.previousCompleteTime=void 0)}var H=_.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off ".concat(N," for ").concat(H," milliseconds with ID ").concat(this.backoffId)),this.callback=function(C,y){v(C,y,A.gapDetectionSettings)&&(A.logger.info("Back off for ".concat(N," with ID ").concat(A.backoffId," will be reset due to the wait (").concat(Date.now()-(C??0)," ms) being longer than expected (").concat(y," ms)")),A.backoffCount=0),A.logger.info("Back off for ".concat(N," with ID ").concat(A.backoffId," complete, invoking handler")),A.timerHandle=void 0,A.callback=void 0,A.previousCompleteTime=Date.now(),I()};var L=Date.now();this.timerHandle=setTimeout(function(){var C;return(C=A.callback)===null||C===void 0?void 0:C.call(A,L,H)},H)},_.prototype.reset=function(){this.timerHandle!==void 0&&(this.logger.debug("Resetting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},_.prototype.expediteIfPending=function(){if(this.backoffCount=0,this.timerHandle!==void 0){this.logger.debug("Expediting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0;var N=this.callback;this.callback=void 0,N&&N()}},_}();x.ExponentialBackoff=T},function(F,x,P){var v=this&&this.__spreadArray||function(I,A,S){if(S||arguments.length===2)for(var H,L=0,C=A.length;L<C;L++)!H&&L in A||(H||(H=Array.prototype.slice.call(A,0,L)),H[L]=A[L]);return I.concat(H||Array.prototype.slice.call(A))};Object.defineProperty(x,"__esModule",{value:!0}),x.LoggingManagerConsumer=x.RegistrationEnforcer=void 0;var T=P(6),_=function(){function I(A,S,H){this.wrapped=A,this.shouldConnectionDependOnRegistration=S,this.shouldHoldBackEvents=H,this.isRegistered=!1,this.heldBackEvents=[]}return I.prototype.onDownstreamRequest=function(A,S,H){this.passIfRegisteredOrNotNeeded("onDownstreamRequest",A,S,H)},I.prototype.onConnected=function(A){this.passIfRegisteredOrNotNeeded("onConnected",A)},I.prototype.onRegistered=function(A){this.isRegistered=!0,this.wrapped.onRegistered(A),this.fireHeldBackEvents()},I.prototype.onUnregistered=function(A){this.isRegistered=!1,this.wrapped.onUnregistered(A),A.getState()===T.State.Connected&&this.shouldConnectionDependOnRegistration()&&A.forceReconnectDueToNoRegistration()},I.prototype.onReconnecting=function(A){this.wrapped.onReconnecting(A)},I.prototype.onReconnectIsRequired=function(A,S,H){this.wrapped.onReconnectIsRequired(A,S,H)},I.prototype.onDisconnected=function(A){this.isRegistered=!1,this.dropHeldBackEvents(),this.wrapped.onDisconnected(A)},I.prototype.onTerminalError=function(A){this.wrapped.onTerminalError(A)},I.prototype.onConnectionParametersUpdated=function(A){this.wrapped.onConnectionParametersUpdated(A)},I.prototype.onTrouterMessageLost=function(A){this.passIfRegisteredOrNotNeeded("onTrouterMessageLost",A)},I.prototype.onUserActivityStateAccepted=function(A){this.passIfRegisteredOrNotNeeded("onUserActivityStateAccepted",A)},I.prototype.onAudiencesSetResolved=function(A,S){this.passIfRegisteredOrNotNeeded("onAudiencesSetResolved",A,S)},I.prototype.getState=function(){return this.wrapped.getState()},I.prototype.holdBackEvent=function(A){for(var S=[],H=1;H<arguments.length;H++)S[H-1]=arguments[H];this.heldBackEvents.push({kind:A,args:S})},I.prototype.passIfRegisteredOrNotNeeded=function(A){for(var S,H=[],L=1;L<arguments.length;L++)H[L-1]=arguments[L];var C=this.shouldConnectionDependOnRegistration(),y=this.shouldHoldBackEvents();C&&y||this.fireHeldBackEvents(C?function(k){return k.kind!=="onConnected"}:void 0),this.isRegistered||!C||y===!1&&A!=="onConnected"?(S=this.wrapped)[A].apply(S,H):this.holdBackEvent.apply(this,v([A],H,!1))},I.prototype.fireHeldBackEvents=function(A){for(var S,H=0,L=this.heldBackEvents;H<L.length;H++){var C=L[H];(A===void 0||A(C))&&(S=this.wrapped)[C.kind].apply(S,C.args)}this.heldBackEvents=A===void 0?[]:this.heldBackEvents.filter(function(y){return!A(y)})},I.prototype.dropHeldBackEvents=function(){this.heldBackEvents=[]},I}();x.RegistrationEnforcer=_;var N=function(){function I(A,S,H,L){this.wrapped=A,this.prefix=S,this.logger=H,this.onEventAction=L}return I.prototype.onEvent=function(A,S){var H;this.onEventAction!==void 0?this.onEventAction(A,S):((H=this.logger)!==null&&H!==void 0?H:console).log("".concat(this.prefix," TracingEnforcer: ").concat(A,"(").concat(S,")"))},I.prototype.onDownstreamRequest=function(A,S,H){this.onEvent("onDownstreamRequest",JSON.stringify({request:S,response:H})),this.wrapped.onDownstreamRequest(A,S,H)},I.prototype.onConnected=function(A){this.onEvent("onConnected",A.getState().toString()),this.wrapped.onConnected(A)},I.prototype.onRegistered=function(A){this.onEvent("onRegistered",A.getState().toString()),this.wrapped.onRegistered(A)},I.prototype.onUnregistered=function(A){this.onEvent("onUnregistered",A.getState().toString()),this.wrapped.onUnregistered(A)},I.prototype.onReconnecting=function(A){this.onEvent("onReconnecting",A.getState().toString()),this.wrapped.onReconnecting(A)},I.prototype.onReconnectIsRequired=function(A,S,H){this.onEvent("onReconnectIsRequired",JSON.stringify({connection:A.getState().toString(),useConnectParamsFromCache:S,reason:H})),this.wrapped.onReconnectIsRequired(A,S,H)},I.prototype.onDisconnected=function(A){this.onEvent("onDisconnected",A.getState().toString()),this.wrapped.onDisconnected(A)},I.prototype.onTerminalError=function(A){this.onEvent("onTerminalError",JSON.stringify({connection:A})),this.wrapped.onTerminalError(A)},I.prototype.onConnectionParametersUpdated=function(A){this.onEvent("onConnectionParametersUpdated",JSON.stringify({connectParams:A})),this.wrapped.onConnectionParametersUpdated(A)},I.prototype.onTrouterMessageLost=function(A){this.onEvent("onTrouterMessageLost",JSON.stringify({flowTags:A})),this.wrapped.onTrouterMessageLost(A)},I.prototype.onUserActivityStateAccepted=function(A){this.onEvent("onUserActivityStateAccepted",JSON.stringify({cv:A})),this.wrapped.onUserActivityStateAccepted(A)},I.prototype.onAudiencesSetResolved=function(A,S){this.onEvent("onAudiencesSetResolved",JSON.stringify({audienceSubscriptionsResponse:A,cv:S})),this.wrapped.onAudiencesSetResolved(A,S)},I.prototype.getState=function(){return this.wrapped.getState()},I}();x.LoggingManagerConsumer=N},function(F,x,P){Object.defineProperty(x,"__esModule",{value:!0}),x.TrouterManagerFsm=void 0;var v=P(2),T=P(4),_=P(0),N=P(7),I=function(){function A(S,H){this.worker=H,this.state=T.TrouterManagerState.Unknown,this.logger=new _.Logger("ManagerFsm",S)}return A.prototype.start=function(){this.state===T.TrouterManagerState.Unknown?(this.setState(T.TrouterManagerState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):(this.logger.info("start called in state '".concat(T.TrouterManagerState[this.state],"', expediting pending backoffs, if any")),this.worker.expediteBackoffOnConnections())},A.prototype.stop=function(S){this.state!==T.TrouterManagerState.Unknown?(this.setState(T.TrouterManagerState.Unknown),this.worker.stopFirstConnection(S===!0),this.worker.stopSecondConnection(S===!0)):this.showIgnored("stop")},A.prototype.getState=function(){switch(this.state){case T.TrouterManagerState.Unknown:case T.TrouterManagerState.Connected:case T.TrouterManagerState.Disconnected:case T.TrouterManagerState.Switching:return this.state;case T.TrouterManagerState.TerminalError:return v.TrouterState.Disconnected}},A.prototype.getInternalState=function(){return this.state},A.prototype.onConnected=function(S){this.state===T.TrouterManagerState.Disconnected&&S?this.worker.doesSecondConnectionExist()?this.setState(T.TrouterManagerState.Switching):(this.setState(T.TrouterManagerState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected(".concat(S,")"))},A.prototype.onRegistered=function(S){this.state!==T.TrouterManagerState.Disconnected||S?this.state!==T.TrouterManagerState.Switching||S?this.state===T.TrouterManagerState.Disconnected&&S&&(this.setState(T.TrouterManagerState.Connected),this.worker.dispatchConnected()):(this.setState(T.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(T.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},A.prototype.onUnregistered=function(S){S&&this.worker.dispatchRegistrationState(!1)},A.prototype.onReconnecting=function(S){this.state!==T.TrouterManagerState.Connected&&this.state!==T.TrouterManagerState.Switching||!S?this.showIgnored("onReconnecting(".concat(S,")")):(this.setState(T.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected())},A.prototype.onReconnectionRequired=function(S,H,L){this.state===T.TrouterManagerState.Connected&&S?(this.setState(T.TrouterManagerState.Switching),this.worker.startSecondConnection(H)):this.state===T.TrouterManagerState.Disconnected&&S?this.worker.startSecondConnection(H):this.state===T.TrouterManagerState.Switching&&S&&L===N.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(H)):this.showIgnored("onReconnectionRequired(".concat(S,")"))},A.prototype.onDisconnected=function(S){this.state==T.TrouterManagerState.Unknown&&S?this.worker.dispatchDisconnected():this.state==T.TrouterManagerState.Switching&&S?(this.worker.switchConnections(),this.worker.stopSecondConnection(!1),this.setState(T.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected()):this.showIgnored("onDisconnected(".concat(S,")"))},A.prototype.onTerminalError=function(){this.setState(T.TrouterManagerState.TerminalError),this.worker.dispatchTerminalError()},A.prototype.showIgnored=function(S){this.logger.info("Ignoring event '".concat(S,"' in state '").concat(T.TrouterManagerState[this.state],"'"))},A.prototype.setState=function(S){if(this.logger.info("Switching from state '".concat(T.TrouterManagerState[this.state],"' to state '").concat(T.TrouterManagerState[S],"'")),this.state===S)return void this.logger.error("Attempt to switch to the current state '".concat(T.TrouterManagerState[S],"'"));this.state=S},A}();x.TrouterManagerFsm=I},function(F,x,P){function v($,m){if(!m)return $;var R=H(H({},$),{enabled:m.TelemetryEnabled});return m.ClientTelemetryEventEnabled!==void 0&&(R=H(H({},R),m.ClientTelemetryEventEnabled)),R}function T($,m,R){var Z,ie,se,ue,Te,Se,Q,O,U,ae,ce=function(fe){return $.proxyUrlRewrite?(m.info("Using rewritten URL for proxy"),$.proxyUrlRewrite(fe)):fe};return{clientInfo:{ua:$.trouterSettings.productName,v:$.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3,rewriteUrlForProxy:ce},clientCorrelationID:$.trouterSettings.sessionId,environment:$.trouterSettings.environment,telemetrySettings:v($.telemetryConfig.settings,R),eventLogger:$.telemetryConfig.eventLogger,endpointId:$.trouterSettings.registrationId,trouterUrl:(R==null?void 0:R.TrouterConnectionUrl)||$.trouterSettings.trouterServiceUrl,registration:$.trouterSettings.registrarServiceUrl?{registrarUrl:$.trouterSettings.registrarServiceUrl,registrationId:(Z=$.trouterSettings.registrationId)!==null&&Z!==void 0?Z:"",pnhAppId:(ie=$.trouterSettings.pnhAppId)!==null&&ie!==void 0?ie:"",platform:(se=$.trouterSettings.platform)!==null&&se!==void 0?se:"",pnhTemplateKey:(ue=$.trouterSettings.pnhTemplate)!==null&&ue!==void 0?ue:"",platformUIVersion:(Te=$.trouterSettings.platformUIVersion)!==null&&Te!==void 0?Te:"",productContext:$.trouterSettings.pnhProductContext||void 0,context:(Se=$.trouterSettings.pnhContext)!==null&&Se!==void 0?Se:"",registrarTtlSec:((Q=$.trouterSettings.maxRegistrationTimeInMs)!==null&&Q!==void 0?Q:0)/1e3}:void 0,connectionDependsOnRegistration:$.trouterSettings.registrarServiceUrl===void 0?function(){return!1}:(O=$.trouterSettings.connectionDependsOnRegistration)!==null&&O!==void 0?O:function(){return!1},delayEventsUntilRegistered:(U=$.trouterSettings.delayEventsUntilRegistered)!==null&&U!==void 0?U:function(){return!1},timeoutOptions:H({connectionTimeoutMs:$.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:$.trouterSettings.productName==="TeamsCDL"?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},$.trouterSettings.timeoutOptions),incallTimeoutOptions:H({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:$.trouterSettings.productName==="TeamsCDL"?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},$.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:(ae=$.trouterSettings.incallModeTimeoutMs)!==null&&ae!==void 0?ae:0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:$.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:$.connectionCache,registrationStateCallback:$.registrationStateCallbackForAcsDoNotUse,rewriteUrlForProxy:ce,retryLimitOnTokenFetch:$.trouterSettings.retryLimitOnTokenFetch,extraConnectionHeaders:$.trouterSettings.extraConnectionHeaders,expediteBackoffOnStartMinimumDelayMs:1e4,toJSON:function(){return H(H({},this),{connectionCache:this.connectionCache?{}:this.connectionCache})}}}function _($){return new re($)}function N(){return y.CLIENT_VERSION}function I($,m){var R=$.indexOf("://");if(R>=0){var Z=$.indexOf("/",R+3);if(Z>=0)return m+$.substr(Z)}return""}function A($){var m=this;return function(R){return L(m,void 0,void 0,function(){var Z;return C(this,function(ie){switch(ie.label){case 0:return Z={},[4,$(R.needFresh)];case 1:return[2,(Z.token=ie.sent(),Z.tokenType="skype",Z)]}})})}}function S($,m){var R,Z=this;return function(ie){return L(Z,void 0,void 0,function(){var se,ue,Te;return C(this,function(Se){switch(Se.label){case 0:se=new Date,ue=setInterval(function(){var Q=Math.round((Date.now()-se.getTime())/6e4);$.warn("Note: Trouter auth token request promise from ".concat(se.toISOString()," has not been resolved for ").concat(Q," minutes. The client is blocked from operating properly"))},3e5),Se.label=1;case 1:return Se.trys.push([1,,3,4]),[4,m(ie)];case 2:return Te=Se.sent(),ie.needFresh&&Te.token===R&&$.error("API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app"),R=Te.token,[2,Te];case 3:return clearInterval(ue),[7];case 4:return[2]}})})}}var H=this&&this.__assign||function(){return H=Object.assign||function($){for(var m,R=1,Z=arguments.length;R<Z;R++){m=arguments[R];for(var ie in m)Object.prototype.hasOwnProperty.call(m,ie)&&($[ie]=m[ie])}return $},H.apply(this,arguments)},L=this&&this.__awaiter||function($,m,R,Z){function ie(se){return se instanceof R?se:new R(function(ue){ue(se)})}return new(R||(R=Promise))(function(se,ue){function Te(O){try{Q(Z.next(O))}catch(U){ue(U)}}function Se(O){try{Q(Z.throw(O))}catch(U){ue(U)}}function Q(O){O.done?se(O.value):ie(O.value).then(Te,Se)}Q((Z=Z.apply($,m||[])).next())})},C=this&&this.__generator||function($,m){function R(Q){return function(O){return Z([Q,O])}}function Z(Q){if(ie)throw new TypeError("Generator is already executing.");for(;Te&&(Te=0,Q[0]&&(Se=0)),Se;)try{if(ie=1,se&&(ue=2&Q[0]?se.return:Q[0]?se.throw||((ue=se.return)&&ue.call(se),0):se.next)&&!(ue=ue.call(se,Q[1])).done)return ue;switch(se=0,ue&&(Q=[2&Q[0],ue.value]),Q[0]){case 0:case 1:ue=Q;break;case 4:return Se.label++,{value:Q[1],done:!1};case 5:Se.label++,se=Q[1],Q=[0];continue;case 7:Q=Se.ops.pop(),Se.trys.pop();continue;default:if(ue=Se.trys,!(ue=ue.length>0&&ue[ue.length-1])&&(Q[0]===6||Q[0]===2)){Se=0;continue}if(Q[0]===3&&(!ue||Q[1]>ue[0]&&Q[1]<ue[3])){Se.label=Q[1];break}if(Q[0]===6&&Se.label<ue[1]){Se.label=ue[1],ue=Q;break}if(ue&&Se.label<ue[2]){Se.label=ue[2],Se.ops.push(Q);break}ue[2]&&Se.ops.pop(),Se.trys.pop();continue}Q=m.call($,Se)}catch(O){Q=[6,O],se=0}finally{ie=ue=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}var ie,se,ue,Te,Se={label:0,sent:function(){if(1&ue[0])throw ue[1];return ue[1]},trys:[],ops:[]};return Te={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(Te[Symbol.iterator]=function(){return this}),Te};Object.defineProperty(x,"__esModule",{value:!0}),x.replaceTrouterUrlBase=x.getTrouterServiceVersion=x.createTrouterService=x.TrouterService=x.UserActivityState=x.TrouterState=void 0;var y=P(1),k=P(2);Object.defineProperty(x,"TrouterState",{enumerable:!0,get:function(){return k.TrouterState}}),Object.defineProperty(x,"UserActivityState",{enumerable:!0,get:function(){return k.UserActivityState}});var Y=P(0),V=P(8),z=P(9),W=P(10),le=P(11),re=function(){function $(m){this.logProvider=m,this.stateChangedListeners=[],this.logger=new Y.Logger("Trouter",m),this.trouterUrlPromise=new le.TrouterUrlPromise(m),this.messageHandlers=new V.MessageHandlerRegistry(m),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version ".concat(y.CLIENT_VERSION))}return $.prototype.start=function(m){var R;if(this.logger.info("Start"),!m.skypeTokenProvider&&!m.authTokenProvider)throw new Error("no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated");m.skypeTokenProvider&&!m.trouterSettings.disableInternalSkypeTokenCache&&(m.skypeTokenProvider=(0,z.addCacheAsBackupTo)(m.skypeTokenProvider)),this.trouterCfg=m;var Z=T(m,this.logger,this.ecsCfg);m.internalEnableV4cProtocol===!1&&(Z.forceV4aProtocol=!0);var ie=S(this.logger,(R=m.authTokenProvider)!==null&&R!==void 0?R:A(m.skypeTokenProvider));this.trouterServer===void 0&&(this.trouterServer=new W.TrouterManager(this.logProvider,Z,ie,m.authTokenProvider===void 0,this)),this.pendingActivityState!==void 0&&(this.trouterServer.setUserActivityState(this.pendingActivityState[0],this.pendingActivityState[1]),this.pendingActivityState=void 0),this.trouterServer.start()},$.prototype.stop=function(m){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),this.trouterServer!==void 0&&this.trouterServer.stop(m)},$.prototype.setEcsConfig=function(m){return L(this,void 0,void 0,function(){var R=this;return C(this,function(Z){return[2,new Promise(function(ie){if(R.ecsCfg=m.TrouterJScriptClient,R.logger.info("Setting ECS configuration to ".concat(JSON.stringify(R.ecsCfg))),R.trouterServer!==void 0&&R.trouterCfg!==void 0){var se=T(R.trouterCfg,R.logger,R.ecsCfg);R.trouterServer.configure(se)}ie()})]})})},$.prototype.checkConnection=function(m){this.trouterServer!==void 0&&this.trouterServer.checkConnection(m!=null&&m)},$.prototype.resendRegistration=function(){return L(this,void 0,void 0,function(){return C(this,function(m){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]})})},$.prototype.registerListener=function(m,R){return R===""||!R.startsWith("/")||R.includes("?")||R.includes("#")?(this.logger.error("Listener path '".concat(R,"' is not valid")),!1):this.listeners[R]?(this.logger.error("Another listener is already registered for path '".concat(R,"'")),!1):(this.listeners[R]=m,this.logger.debug("Listener for path '".concat(R,"' registered")),this.connectionInfo&&m.onTrouterConnected(this.connectionInfo.baseEndpointUrl+R,this.connectionInfo),!0)},$.prototype.unregisterListener=function(m){for(var R=[],Z=0,ie=Object.keys(this.listeners);Z<ie.length;Z++){var se=ie[Z];this.listeners[se]===m&&R.push(se)}if(R.length===0)return!1;for(var ue=0,Te=R;ue<Te.length;ue++){var se=Te[ue];delete this.listeners[se]}return this.logger.debug("Listener for path(s) '".concat(R.join("', '"),"' unregistered")),!0},$.prototype.onTrouterConnected=function(m,R){this.logger.debug("Trouter is now connected");for(var Z=0,ie=Object.keys(this.listeners);Z<ie.length;Z++){var se=ie[Z];try{this.listeners[se].onTrouterConnected(R.baseEndpointUrl+se,R)}catch(ue){this.logger.error("Listener '".concat(se,"' threw an exception from onTrouterConnected(): ").concat(ue))}}this.connectionInfo=R,this.trouterUrlPromise.resolveUrl(m),this.notifyStateChanged(k.TrouterState.Connected,{url:m,getRemainingTtlInSec:function(){return R.connectionTtlSec}})},$.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var m=0,R=Object.keys(this.listeners);m<R.length;m++){var Z=R[m],ie=this.listeners[Z];if(ie.onTrouterDisconnected)try{ie.onTrouterDisconnected()}catch(se){this.logger.error("Listener '".concat(Z,"' threw an exception from onTrouterDisconnected(): ").concat(se))}}this.notifyStateChanged(k.TrouterState.Disconnected)},$.prototype.onTrouterRequest=function(m,R){for(var Z="",ie=0,se=Object.keys(this.listeners);ie<se.length;ie++){var ue=se[ie];m.path.startsWith(ue)&&ue.length>Z.length&&(Z=ue)}if(Z==="")this.tryMessageHandlers(m,R)||(R.status=404,R.headers={"Trouter-Responder":"ClientLib"},R.send());else try{this.listeners[Z].onTrouterRequest(m,R)}catch(Te){this.logger.error("Listener '".concat(Z,"' threw an exception from onTrouterRequest(): ").concat(Te)),R.status=500,R.headers={"Trouter-Responder":"ClientLib"},R.send()}},$.prototype.onTrouterMessageLoss=function(m){this.logger.info("onTrouterMessageLoss called with tags [".concat(m,"]"));for(var R=!0,Z=0,ie=Object.keys(this.listeners);Z<ie.length;Z++){var se=ie[Z],ue=this.listeners[se];if(ue.onTrouterMessageLoss)try{R=ue.onTrouterMessageLoss(m)&&R,R===void 0&&(this.logger.error("Listener '".concat(se,"' did not return a boolean value from onTrouterMessageLoss()")),R=!1)}catch(Te){this.logger.error("Listener '".concat(se,"' threw an exception from onTrouterMessageLoss(): ").concat(Te)),R=!1}}return R},$.prototype.onTrouterUserActivityStateAccepted=function(m){this.logger.debug("onTrouterUserActivityStateAccepted cv: ".concat(m));for(var R=0,Z=Object.keys(this.listeners);R<Z.length;R++){var ie=Z[R],se=this.listeners[ie];if(se.onTrouterUserActivityStateAccepted)try{se.onTrouterUserActivityStateAccepted(m)}catch(ue){this.logger.error("Listener '".concat(ie,"' threw an exception from onTrouterUserActivityStateAccepted(): ").concat(ue))}}},$.prototype.onAudiencesSetResolved=function(m,R){this.logger.debug("onAudiencesSetResolved cv: ".concat(R));for(var Z=0,ie=Object.keys(this.listeners);Z<ie.length;Z++){var se=ie[Z],ue=this.listeners[se];if(ue.onAudiencesSetResolved)try{ue.onAudiencesSetResolved(m,R)}catch(Te){this.logger.error("Listener '".concat(se,"' threw an exception from onAudienceSubscribed(): ").concat(Te))}}},$.prototype.setUserActivityState=function(m,R){if(m!==k.UserActivityState.Active&&m!==k.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value ".concat(m));this.logger.info("setUserActivityState called with value ".concat(k.UserActivityState[m])),this.trouterServer&&this.state()!==k.TrouterState.Unknown?this.trouterServer.setUserActivityState(m,R):(this.pendingActivityState=[m,R],this.logger.warn("setUserActivityState called before start() or after stop()"))},$.prototype.setAudienceSubscriptions=function(m,R){if(m.audienceSubscriptions.length>1)throw new Error("Only singular audience subscription is supported");if(this.trouterServer&&this.state()!==k.TrouterState.Unknown)return this.trouterServer.setAudienceSubscriptionsAsync(m,15e3,R);throw new Error("audience subscribe called before start() or after stop()")},$.prototype.state=function(){return this.trouterServer!==void 0?this.trouterServer.getState():k.TrouterState.Unknown},$.prototype.isInTerminalState=function(){return this.trouterServer!==void 0&&this.trouterServer.isInTerminalState()},$.prototype.reportStateInfo=function(){return this.trouterServer===void 0?"":this.trouterServer.reportStateInfo()},$.prototype.getServerState=function(){if(this.trouterServer!==void 0)return this.trouterServer.getServerState()},$.prototype.getTrouterUrlAsync=function(){return this.trouterServer!==void 0?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},$.prototype.onStateChanged=function(m){if(this.logger.info("onStateChanged called"),m===void 0)this.stateChangedListeners=this.stateChangedListeners.filter(function(Z){return Z.wrappedCallback===void 0});else{this.offStateChanged(m);var R=function(Z,ie){m(Z,ie?ie.url:"")};R.wrappedCallback=m,this.stateChangedListeners.push(R)}},$.prototype.offStateChanged=function(m){this.logger.info("offStateChanged called");var R=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(Z){return Z.wrappedCallback!==m}),R>this.stateChangedListeners.length},$.prototype.addCallback=function(m){this.logger.info("addListener called"),this.stateChangedListeners.indexOf(m,0)===-1&&m!==void 0&&this.stateChangedListeners.push(m)},$.prototype.removeCallback=function(m){this.logger.info("removeListener called");var R=this.stateChangedListeners.indexOf(m,0);return R>-1&&(this.stateChangedListeners.splice(R,1),!0)},$.prototype.registerMessageHandler=function(m){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(m)},$.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},$.prototype.notifyStateChanged=function(m,R){var Z=this;this.logger.info("notifyStateChanged called, will forward to ".concat(this.stateChangedListeners.length," listeners")),this.stateChangedListeners.forEach(function(ie){try{ie(m,R)}catch(se){Z.logger.error("Error in callback ".concat(se))}})},$.prototype.tryMessageHandlers=function(m,R){if(!this.messageHandlers.active())return!1;var Z,ie=null;try{Z=JSON.parse(m.body),ie=Z&&(Z.evt||Z.eventId)||null}catch{}var se={eventId:ie,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+m.path,body:Z,rawBody:m.body,headers:m.headers},ue=this.messageHandlers.handleMessage(se);return!!ue.isHandled&&(R.status=ue.resultCode,ue.responseHeaders&&(R.headers=ue.responseHeaders),ue.responseBody&&(R.body=ue.responseBody),R.send(),!0)},$}();x.TrouterService=re,x.createTrouterService=_,x.getTrouterServiceVersion=N,x.replaceTrouterUrlBase=I},function(F,x){F.exports=q}])})});d(g);var E=f(function(X,B){Object.defineProperty(B,"__esModule",{value:!0}),B.PACKAGE_VERSION=B.CONFIG_API_VERSION=B.EudbCountries=B.CloudPrefix=B.CloudType=B.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=void 0,B.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3;var q;(function(x){x.Public="Public",x.GccHigh="GCC High",x.Dod="DoD"})(q||(B.CloudType=q={}));var F;(function(x){x.OrgId="orgid",x.Acs="acs",x.Spool="spool",x.GccHigh="gcch",x.GccHighAcs="gcch-acs",x.Dod="dod",x.DodAcs="dod-acs"})(F||(B.CloudPrefix=F={})),B.EudbCountries=["europe","france","germany","norway","switzerland","sweden"],B.CONFIG_API_VERSION="2024-09-01",B.PACKAGE_VERSION="1.0.0-beta.30"});d(E),E.PACKAGE_VERSION,E.CONFIG_API_VERSION,E.EudbCountries,E.CloudPrefix,E.CloudType,E.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES;var D=E,w=f(function(X,B){var q=u&&u.__awaiter||function(Q,O,U,ae){function ce(fe){return fe instanceof U?fe:new U(function(ve){ve(fe)})}return new(U||(U=Promise))(function(fe,ve){function Pe(Ne){try{ke(ae.next(Ne))}catch(Oe){ve(Oe)}}function Me(Ne){try{ke(ae.throw(Ne))}catch(Oe){ve(Oe)}}function ke(Ne){Ne.done?fe(Ne.value):ce(Ne.value).then(Pe,Me)}ke((ae=ae.apply(Q,O||[])).next())})};Object.defineProperty(B,"__esModule",{value:!0}),B.isEudbLocation=B.parseTokenCredential=B.base64decode=B.toTelemetrySender=B.toLogProvider=B.toMessageHandler=void 0,B.generateUuid=ue;const F=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["streamingChatMessageStarted",250],["streamingChatMessageChunkReceived",251],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]),x="8:orgid:",P="8:dod:",v="8:gcch:",T="8:teamsvisitor:",_="4:",N="8:acs:",I="8:gcch-acs:",A="8:dod-acs:",S="8:spool:",H=(Q,O,U,ae)=>{const ce=F.get(Q);return{handleMessage(fe){let ve=null;if(fe!=null&&fe.rawBody&&(ve=JSON.parse(fe.rawBody)),ve===null||ve.eventId!==ce)return;const Pe=y(Q,ve,U,ae);if(Pe!==null)return O(Pe),{isHandled:!0,resultCode:200}}}};B.toMessageHandler=H;function L(Q,O,U){let ae=re(Q.streaming);return{threadId:Q.groupId,sender:le(Q.senderId),senderDisplayName:Q.senderDisplayName,recipient:le(Q.recipientMri),id:Q.messageId,createdOn:new Date(Q.originalArrivalTime),version:Q.version,type:Q.messageType,message:Q.messageBody,metadata:re(Q.acsChatMessageMetadata)||{},attachments:R(re(Q.attachments)||[],O,U),streamingMetadata:{streamingMessageType:ae==null?void 0:ae.contentType,streamEndReason:ae==null?void 0:ae.streamEndReason,streamingSequenceNumber:Number(ae==null?void 0:ae.sequenceNumber)}}}function C(Q,O,U){return Object.assign(Object.assign({},L(Q,O,U)),{editedOn:new Date(Q.edittime),policyViolation:V(re(Q.policyViolation))})}const y=(Q,O,U,ae)=>{if(Q==="chatMessageReceived"||Q=="streamingChatMessageStarted")return L(O,U,ae);if(Q=="streamingChatMessageChunkReceived"||Q==="chatMessageEdited")return C(O,U,ae);if(Q==="chatMessageDeleted"){const ce=O;return{threadId:ce.groupId,sender:le(ce.senderId),senderDisplayName:ce.senderDisplayName,recipient:le(ce.recipientMri),id:ce.messageId,createdOn:new Date(ce.originalArrivalTime),version:ce.version,deletedOn:new Date(ce.deletetime),type:ce.messageType}}if(Q==="typingIndicatorReceived"){const ce=O;return{threadId:ce.groupId,sender:le(ce.senderId),senderDisplayName:ce.senderDisplayName,recipient:le(ce.recipientMri),version:ce.version,receivedOn:new Date(ce.originalArrivalTime)}}if(Q==="readReceiptReceived"){const ce=O,ve=JSON.parse(ce.messageBody).consumptionhorizon.split(";");return{threadId:ce.groupId,sender:le(ce.senderId),senderDisplayName:"",recipient:le(ce.recipientMri),chatMessageId:ce.messageId,readOn:new Date(+ve[1])}}if(Q==="chatThreadCreated"){const ce=O,fe=JSON.parse(unescape(ce.createdBy)),ve=JSON.parse(unescape(ce.members)),Pe=k(fe),Me=ve.map(Ne=>k(Ne));return{threadId:ce.threadId,createdOn:new Date(ce.createTime),createdBy:Pe,version:ce.version,participants:Me,properties:Y(JSON.parse(unescape(ce.properties)))}}if(Q==="chatThreadPropertiesUpdated"){const ce=O,fe=JSON.parse(unescape(ce.editedBy)),ve=k(fe);return{threadId:ce.threadId,updatedOn:new Date(ce.editTime),updatedBy:ve,version:ce.version,properties:Y(JSON.parse(unescape(ce.properties)))}}if(Q==="chatThreadDeleted"){const ce=O,fe=k(JSON.parse(unescape(ce.deletedBy)));return{threadId:ce.threadId,deletedOn:new Date(ce.deleteTime),deletedBy:fe,version:ce.version}}if(Q==="participantsAdded"){const ce=O,fe=JSON.parse(unescape(ce.addedBy)),ve=JSON.parse(unescape(ce.participantsAdded)),Pe=k(fe),Me=ve.map(Ne=>k(Ne));return{threadId:ce.threadId,addedOn:new Date(ce.time),addedBy:Pe,version:ce.version,participantsAdded:Me}}if(Q==="participantsRemoved"){const ce=O,fe=JSON.parse(unescape(ce.removedBy)),ve=JSON.parse(unescape(ce.participantsRemoved)),Pe=k(fe),Me=ve.map(Ne=>k(Ne));return{threadId:ce.threadId,removedOn:new Date(ce.time),removedBy:Pe,version:ce.version,participantsRemoved:Me}}return null},k=Q=>{var O;const U={id:le(Q.participantId),displayName:Q.displayName,metadata:re((O=Q.memberMetaData)!==null&&O!==void 0?O:"")||{}};return Q.shareHistoryTime&&(U.shareHistoryTime=new Date(Q.shareHistoryTime)),U},Y=Q=>{var O;return{topic:Q.topic,metadata:re((O=Q.acsChatThreadMetadata)!==null&&O!==void 0?O:"")||{}}},V=Q=>{if(!(!Q||(Q==null?void 0:Q.result)===void 0))return{result:Q.result}},z=Q=>({log:(...O)=>Q.info(O),warn:(...O)=>Q.warning(O),error:(...O)=>Q.error(O),debug:(...O)=>Q.verbose(O),info:(...O)=>Q.verbose(O)});B.toLogProvider=z;const W=Q=>({logEvent:O=>Q.info(O)});B.toTelemetrySender=W;const le=Q=>Q.startsWith(x)?{kind:"microsoftTeamsUser",rawId:Q,microsoftTeamsUserId:Q.substring(x.length),isAnonymous:!1,cloud:"public"}:Q.startsWith(P)?{kind:"microsoftTeamsUser",rawId:Q,microsoftTeamsUserId:Q.substring(P.length),isAnonymous:!1,cloud:"dod"}:Q.startsWith(v)?{kind:"microsoftTeamsUser",rawId:Q,microsoftTeamsUserId:Q.substring(v.length),isAnonymous:!1,cloud:"gcch"}:Q.startsWith(T)?{kind:"microsoftTeamsUser",rawId:Q,microsoftTeamsUserId:Q.substring(T.length),isAnonymous:!0}:Q.startsWith(_)?{kind:"phoneNumber",rawId:Q,phoneNumber:Q.substring(_.length)}:Q.startsWith(N)||Q.startsWith(I)||Q.startsWith(A)||Q.startsWith(S)?{kind:"communicationUser",communicationUserId:Q}:{kind:"unknown",id:Q},re=Q=>{if(!(Q==null||Q===""||Q==="null"||Q==="{}"||Q==="[]"))return JSON.parse(Q)},$=(Q,O,U)=>{let ae;try{ae=new URL(Q),(ae.protocol==="http:"||ae.protocol==="https:")&&(ae=new URL(ae.pathname,O))}catch{try{ae=new URL(Q,O)}catch{return Q}}return ae.searchParams.set("api-version",U),ae.toString()},m=Q=>{let O;try{O=new URL(Q)}catch{return!1}return O.protocol==="http:"||O.protocol==="https:"},R=(Q,O,U)=>(O==null||O===""||!m(O)||Q.filter(ae=>ae.attachmentType.toLowerCase()==="image".toLowerCase()).map(ae=>{ae.previewUrl&&(ae.previewUrl=$(ae.previewUrl,O,U)),ae.url&&(ae.url=$(ae.url,O,U))}),Q),Z=Q=>l.default.isNodeLike?Buffer.from(Q,"base64").toString():atob(Q);B.base64decode=Z;const ie=Q=>{let[,O]=Q==null?void 0:Q.split(".");if(O===void 0)throw new Error("Invalid token");return O=O.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape((0,B.base64decode)(O))))},se=Q=>q(void 0,void 0,void 0,function*(){const O=yield Q.getToken(),U=O==null?void 0:O.token,ae=ie(U),ce=ae.skypeid,fe=ae.resourceId,ve=Se(ce),Pe=ae.resourceLocation||"";return{jwtToken:U,acsResourceId:fe,identityMri:ce,cloudType:ve,resourceLocation:Pe}});B.parseTokenCredential=se;function ue(){return(0,s.default.v4)()}const Te=Q=>!!Q&&!!D.EudbCountries.find(O=>O===Q);B.isEudbLocation=Te;function Se(Q){switch(Q.substring(0,Q.indexOf(":"))){case D.CloudPrefix.OrgId:case D.CloudPrefix.Acs:case D.CloudPrefix.Spool:return D.CloudType.Public;case D.CloudPrefix.GccHigh:case D.CloudPrefix.GccHighAcs:return D.CloudType.GccHigh;case D.CloudPrefix.Dod:case D.CloudPrefix.DodAcs:return D.CloudType.Dod;default:return D.CloudType.Public}}});d(w),w.isEudbLocation,w.parseTokenCredential,w.base64decode,w.toTelemetrySender,w.toLogProvider,w.toMessageHandler,w.generateUuid;var p=f(function(X,B){var q=u&&u.__createBinding||(Object.create?function(N,I,A,S){S===void 0&&(S=A);var H=Object.getOwnPropertyDescriptor(I,A);(!H||("get"in H?!I.__esModule:H.writable||H.configurable))&&(H={enumerable:!0,get:function(){return I[A]}}),Object.defineProperty(N,S,H)}:function(N,I,A,S){S===void 0&&(S=A),N[S]=I[A]}),F=u&&u.__setModuleDefault||(Object.create?function(N,I){Object.defineProperty(N,"default",{enumerable:!0,value:I})}:function(N,I){N.default=I}),x=u&&u.__importStar||function(N){if(N&&N.__esModule)return N;var I={};if(N!=null)for(var A in N)A!=="default"&&Object.prototype.hasOwnProperty.call(N,A)&&q(I,N,A);return F(I,N),I},P=u&&u.__awaiter||function(N,I,A,S){function H(L){return L instanceof A?L:new A(function(C){C(L)})}return new(A||(A=Promise))(function(L,C){function y(V){try{Y(S.next(V))}catch(z){C(z)}}function k(V){try{Y(S.throw(V))}catch(z){C(z)}}function Y(V){V.done?L(V.value):H(V.value).then(y,k)}Y((S=S.apply(N,I||[])).next())})};Object.defineProperty(B,"__esModule",{value:!0}),B.RealTimeNotificationConfiguration=B.TrouterConfigClient=void 0;const v=x(c.default);class T extends v.ServiceClient{constructor(I,A){A||(A={});const S=`azsdk-js-communication-signaling/${D.PACKAGE_VERSION}`,H=A.userAgentOptions&&A.userAgentOptions.userAgentPrefix?`${A.userAgentOptions.userAgentPrefix} ${S}`:`${S}`,L=Object.assign(Object.assign({},A),{userAgentOptions:{userAgentPrefix:H},additionalPolicies:A.additionalPolicies});super(L),this.apiVersion=D.CONFIG_API_VERSION,this.endpoint=I,this.httpClient=(0,a.default.createDefaultHttpClient)()}fetchServiceUrls(I){return P(this,void 0,void 0,function*(){try{const A=(yield I.getToken()).token,S=(0,a.default.createPipelineRequest)({url:`${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,method:"GET",headers:(0,a.default.createHttpHeaders)({Authorization:`Bearer ${A}`})}),H=yield this.pipeline.sendRequest(this.httpClient,S);if(H.status!==200||!H.bodyAsText)throw new Error(`Failed to fetch service URLs. Status: ${H.status}, Body: ${H.bodyAsText||"No response body"}`);const L=JSON.parse(H.bodyAsText);if(!L.trouterServiceUrl||!L.registrarServiceUrl||!L.cloudType)throw new Error("One or more required fields are missing in the response data");return new _(L.trouterServiceUrl,L.registrarServiceUrl,L.cloudType)}catch(A){throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${A.message}`)}})}}B.TrouterConfigClient=T;class _{constructor(I,A,S){this.trouterServiceUrl=I,this.registrarServiceUrl=A,this.cloudType=S}}B.RealTimeNotificationConfiguration=_});d(p),p.RealTimeNotificationConfiguration,p.TrouterConfigClient;var b=w,j=p,K=f(function(X,B){var q=u&&u.__awaiter||function(P,v,T,_){function N(I){return I instanceof T?I:new T(function(A){A(I)})}return new(T||(T=Promise))(function(I,A){function S(C){try{L(_.next(C))}catch(y){A(y)}}function H(C){try{L(_.throw(C))}catch(y){A(y)}}function L(C){C.done?I(C.value):N(C.value).then(S,H)}L((_=_.apply(P,v||[])).next())})};Object.defineProperty(B,"__esModule",{value:!0}),B.defaultTelemetrySettings=B.createSettings=void 0;const F={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_2.0",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:"",registrarServiceUrl:"",registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5},x=(P,v)=>q(void 0,void 0,void 0,function*(){var T;const _=v==null?void 0:v.resourceEndpoint;if(_===void 0)throw new Error("'endpoint' cannot be null");const N=Object.assign({},F);N.registrationId=(0,b.generateUuid)(),N.sessionId=(0,b.generateUuid)();const A=yield new j.TrouterConfigClient(_,v).fetchServiceUrls(P);return N.trouterServiceUrl=`${A.trouterServiceUrl}/v4/a`,N.registrarServiceUrl=`${A.registrarServiceUrl}/v3/registrations`,A.cloudType==="int"&&(N.pnhAppId="cns-e2e-test",N.pnhTemplate="cns-e2e-test:2.0"),N.maxRegistrationTimeInMs=(T=v==null?void 0:v.registrationTimeInMs)!==null&&T!==void 0?T:F.maxRegistrationTimeInMs,N});B.createSettings=x,B.defaultTelemetrySettings={enabled:!1}});d(K),K.defaultTelemetrySettings,K.createSettings;var M=K,ne=f(function(X,B){var q=u&&u.__awaiter||function(x,P,v,T){function _(N){return N instanceof v?N:new v(function(I){I(N)})}return new(v||(v=Promise))(function(N,I){function A(L){try{H(T.next(L))}catch(C){I(C)}}function S(L){try{H(T.throw(L))}catch(C){I(C)}}function H(L){L.done?N(L.value):_(L.value).then(A,S)}H((T=T.apply(x,P||[])).next())})};Object.defineProperty(B,"__esModule",{value:!0}),B.CommunicationSignalingClient=void 0;class F{constructor(P,v,T){this.credential=P,this.logger=v,this.options=T,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=(0,g.createTrouterService)((0,b.toLogProvider)(v))}start(){return q(this,void 0,void 0,function*(){var P,v;if(this.resourceEndpoint=(P=this.options)===null||P===void 0?void 0:P.resourceEndpoint,this.resourceEndpoint===void 0)throw new Error("'endpoint' cannot be null");this.gatewayApiVersion=((v=this.options)===null||v===void 0?void 0:v.gatewayApiVersion)||"2024-03-07",this.config===void 0&&(this.config={trouterSettings:yield(0,M.createSettings)(this.credential,this.options),skypeTokenProvider:T=>q(this,void 0,void 0,function*(){if(T){if(this.tokenFetchRetries+=1,this.tokenFetchRetries>D.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)throw yield this.stop(!0),new Error(`Access token is expired and failed to fetch a valid one after ${D.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`)}else this.tokenFetchRetries=0;return Promise.resolve((yield this.credential.getToken()).token)}),telemetryConfig:{eventLogger:(0,b.toTelemetrySender)(this.logger),settings:M.defaultTelemetrySettings}}),this.trouter.start(this.config),this.trouter.setUserActivityState(g.UserActivityState.Active)})}stop(P){return q(this,void 0,void 0,function*(){this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(P??this.tokenFetchRetries>D.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)})}on(P,v){if(P==="connectionChanged"){this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=(T,_)=>v(T),this.trouter.onStateChanged(this.stateChangedListener);return}this.trouter.registerMessageHandler((0,b.toMessageHandler)(P,v,this.resourceEndpoint,this.gatewayApiVersion))}}B.CommunicationSignalingClient=F});d(ne),ne.CommunicationSignalingClient;var G=ne,oe=f(function(X,B){var q=u&&u.__createBinding||(Object.create?function(x,P,v,T){T===void 0&&(T=v);var _=Object.getOwnPropertyDescriptor(P,v);(!_||("get"in _?!P.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return P[v]}}),Object.defineProperty(x,T,_)}:function(x,P,v,T){T===void 0&&(T=v),x[T]=P[v]}),F=u&&u.__exportStar||function(x,P){for(var v in x)v!=="default"&&!Object.prototype.hasOwnProperty.call(P,v)&&q(P,x,v)};Object.defineProperty(B,"__esModule",{value:!0}),F(G,B)}),J=d(oe);t.exports=J})(b$);var Xue=b$.exports;const Yue=(t,e,n)=>{var r,i,o,s;return new Xue.CommunicationSignalingClient(t,e,{resourceEndpoint:(r=n==null?void 0:n.resourceEndpoint)!==null&&r!==void 0?r:void 0,gatewayApiVersion:(i=n==null?void 0:n.gatewayApiVersion)!==null&&i!==void 0?i:void 0,additionalPolicies:(o=n==null?void 0:n.additionalPolicies)!==null&&o!==void 0?o:void 0,userAgentOptions:(s=n==null?void 0:n.userAgentOptions)!==null&&s!==void 0?s:void 0})};class Zue{constructor(e,n,r={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new c3.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=n;const i=Object.assign(Object.assign({},r),{loggingOptions:{logger:Uh.info}});this.client=new Pw(this.endpoint,Object.assign({endpoint:this.endpoint},i));const o=I$(this.tokenCredential);this.client.pipeline.addPolicy(o),this.clientOptions=Object.assign({},r),this.clientOptions.signalingClientOptions=Object.assign(Object.assign({},this.clientOptions.signalingClientOptions),{resourceEndpoint:this.endpoint,gatewayApiVersion:this.client.apiVersion}),this.signalingClient=Yue(n,Uh,this.clientOptions.signalingClientOptions)}getChatThreadClient(e){return new Jue(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,n={}){return Et.withSpan("ChatClient-CreateChatThread",n,async r=>{var i,o;r.idempotencyToken=(i=r.idempotencyToken)!==null&&i!==void 0?i:Que();const s=Dce(r),l=await this.client.chat.createChatThread({topic:e.topic,participants:(o=n.participants)===null||o===void 0?void 0:o.map(c=>e$(c)),metadata:n.metadata,retentionPolicy:n.retentionPolicy},s);return Hce(l)})}listChatThreadsPage(e){return Ar(this,arguments,function*(r,i={}){if(!r.continuationToken){const o=yield at(this.client.chat.listChatThreads(i));r.continuationToken=o.nextLink,o.value&&(yield yield at(o.value))}for(;r.continuationToken;){const o=yield at(this.client.chat.listChatThreadsNext(r.continuationToken,i));if(r.continuationToken=o.nextLink,o.value)yield yield at(o.value);else break}})}listChatThreadsAll(e){return Ar(this,arguments,function*(){var r,i,o,s;try{for(var l=!0,c=Rr(this.listChatThreadsPage({},e)),a;a=yield at(c.next()),r=a.done,!r;l=!0)s=a.value,l=!1,yield at(yield*Oa(Rr(s)))}catch(u){i={error:u}}finally{try{!l&&!r&&(o=c.return)&&(yield at(o.call(c)))}finally{if(i)throw i.error}}})}listChatThreads(e={}){const{span:n,updatedOptions:r}=Et.startSpan("ChatClient-ListChatThreads",e);try{const i=this.listChatThreadsAll(r);return{next(){return i.next()},[Symbol.asyncIterator](){return this},byPage:(o={})=>this.listChatThreadsPage(o,r)}}catch(i){throw n.setStatus({error:i,status:"error"}),i}finally{n.end()}}async deleteChatThread(e,n={}){return Et.withSpan("ChatClient-DeleteChatThread",n,async r=>{await this.client.chat.deleteChatThread(e,r)})}async startRealtimeNotifications(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,n){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&e!=="realTimeNotificationConnected"&&e!=="realTimeNotificationDisconnected")throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,n)}off(e,n){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,n)}subscribeToSignalingEvents(){if(this.signalingClient===void 0)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",e=>{e===2?this.emitter.emit("realTimeNotificationConnected"):e===3&&this.emitter.emit("realTimeNotificationDisconnected")}),this.signalingClient.on("chatMessageReceived",e=>{this.emitter.emit("chatMessageReceived",e)}),this.signalingClient.on("chatMessageEdited",e=>{this.emitter.emit("chatMessageEdited",e)}),this.signalingClient.on("chatMessageDeleted",e=>{this.emitter.emit("chatMessageDeleted",e)}),this.signalingClient.on("typingIndicatorReceived",e=>{this.emitter.emit("typingIndicatorReceived",e)}),this.signalingClient.on("readReceiptReceived",e=>{this.emitter.emit("readReceiptReceived",e)}),this.signalingClient.on("chatThreadCreated",e=>{this.emitter.emit("chatThreadCreated",e)}),this.signalingClient.on("chatThreadDeleted",e=>{this.emitter.emit("chatThreadDeleted",e)}),this.signalingClient.on("chatThreadPropertiesUpdated",e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)}),this.signalingClient.on("participantsAdded",e=>{this.emitter.emit("participantsAdded",e)}),this.signalingClient.on("participantsRemoved",e=>{this.emitter.emit("participantsRemoved",e)}),this.signalingClient.on("streamingChatMessageStarted",e=>{this.emitter.emit("streamingChatMessageStarted",e)}),this.signalingClient.on("streamingChatMessageChunkReceived",e=>{this.emitter.emit("streamingChatMessageChunkReceived",e)})}}const nu={id:"",environmentUrl:"",token:""},ede={displayName:""},Or={errorEventSubscriberInstance:void 0,setInstance:t=>{Or.errorEventSubscriberInstance=t},notifyErrorEvent:t=>{Or.errorEventSubscriberInstance!==void 0&&Or.errorEventSubscriberInstance.notifyErrorEvent(t)}};var ui;(function(t){t.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED="EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED",t.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED="HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED",t.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED="NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED",t.MESSAGE_POLLING_FAILED="MESSAGE_POLLING_FAILED",t.INGRESS_MESSAGE_INVALID_JSON="INGRESS_MESSAGE_INVALID_JSON",t.EGRESS_ATTACHMENT_UPLOAD_FAILED="EGRESS_ATTACHMENT_UPLOAD_FAILED",t.EGRESS_SEND_MESSAGE_FAILED="EGRESS_SEND_MESSAGE_FAILED",t.ADAPTER_INIT_TOKEN_MISSING_ERROR="ADAPTER_INIT_TOKEN_MISSING_ERROR",t.ADAPTER_INIT_THREAD_ID_MISSING_ERROR="ADAPTER_INIT_THREAD_ID_MISSING_ERROR",t.ADAPTER_INIT_EXCEPTION="ADAPTER_INIT_EXCEPTION",t.ADAPTER_RECONNECT_FAILED="ADAPTER_RECONNECT_FAILED",t.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED="MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED"})(ui||(ui={}));const tde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: convert streaming message chunk",CustomProperties:t,MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},nde=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:`ACS Adapter: Received a message streaming chunk event with id ${t.id}`,MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},rde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: Skipping RTN streaming message chunk, already processed",MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},ide=(t,e,n)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED,Description:n,ACSRequesterUserId:e(ye.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},ode=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.PARTICIPANT_ADDED_RECEIVED,Description:"ACS Adapter: Received a participant added event",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:t.addedOn.toISOString(),ChatThreadId:t.threadId,UserAdded:t.participantsAdded.map(e=>e.id.communicationUserId)})},sde=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.PARTICIPANT_REMOVED_RECEIVED,Description:"ACS Adapter: Received a participant removed event",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:t.removedOn.toISOString(),ChatThreadId:t.threadId,UserRemoved:t.participantsRemoved.map(e=>e.id.communicationUserId)})},ade=()=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_THREAD_UPDATED,Description:"ACS Adapter: convert thread update"})},lde=(t,e,n)=>{Ue.logEvent(Fe.INFO,{Event:Le.CACHE_PAGED_HISTORY_MESSAGE,Description:t,TimeStamp:new Date().toISOString(),ChatThreadId:n(ye.ThreadId),ACSRequesterUserId:n(ye.UserId),ChatMessageId:e.id})},cde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert history message:",CustomProperties:t,MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id})},QS=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_POLLING_SKIPPED,Description:e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},ude=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SEND_POLLING_REQUEST,Description:"ACS Adapter: Send polling request",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},dde=(t,e)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: Polling message fetch failed.",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ExceptionDetails:e})},hde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling callback with Id "+e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},fde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_CREATE_POLLING_CALLBACK,Description:"ACS Adapter: Created polling callback with Id "+e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},pde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_POLLING_STOPPED,Description:"ACS Adapter: Polling call stopped from the client",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},gde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_POLLING_STATUSCODE,Description:"ACS Adapter: Polling status code "+e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},mde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in RTN connected callback Id "+e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)})},vde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SKIP_POLLED_MESSAGE,Description:"ACS Adapter: Skipping polled message, already processed",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:e,ACSRequesterUserId:t(ye.UserId)})},yde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_PROCESSING_POLLED_MESSAGE,Description:"ACS Adapter: Processing polled message "+e,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:e,ACSRequesterUserId:t(ye.UserId)})},Cde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.CACHE_POLLED_HISTORY_MESSAGE,Description:"ACS Adapter: Cache polled history message",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId),ChatMessageId:e})},Sde=(t,e,n)=>{const r=n.type==="text"?n.sender:n.content.initiator;Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_POST_ACTIVITY,Description:e,MessageSender:r.communicationUserId,TimeStamp:n.createdOn.toISOString(),ChatMessageId:n.id,ACSRequesterUserId:t(ye.UserId)})},Tde=()=>{Ue.logEvent(Fe.DEBUG,{Event:Le.WEBCHAT_STATUS_CONNECTED,Description:"ACS Adapter: Event Webchat connected received"})},Ede=(t,e)=>{const n=e.type==="text"?e.sender:e.content.initiator;Ue.logEvent(Fe.DEBUG,{Event:Le.PROCESS_CACHED_PAGED_HISTORY_MESSAGE,Description:`ACS Adapter: Process cached history message with id ${e.id}`,MessageSender:n.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:e.id})},wde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),UserAdded:e.participantsAdded.map(n=>n.id.communicationUserId)})},Ide=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant removed event",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),UserRemoved:e.participantsRemoved.map(n=>n.id.communicationUserId)})},bde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant added event, already processed",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),UserAdded:e.participantsAdded.map(n=>n.id.communicationUserId)})},_de=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant removed event, already processed",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),UserRemoved:e.participantsRemoved.map(n=>n.id.communicationUserId)})},Ade=t=>{Ue.logEvent(Fe.INFO,{Event:Le.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added event",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:t.addedOn.toISOString(),ChatThreadId:t.threadId,UserAdded:t.participantsAdded.map(e=>e.id.communicationUserId)})},Rde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added even",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:t.removedOn.toISOString(),ChatThreadId:t.threadId,UserRemoved:t.participantsRemoved.map(e=>e.id.communicationUserId)})},kde=(t,e)=>{const n="sender"in e?e.sender:"initiator"in e.content.initiator?e.content.initiator:void 0;Ue.logEvent(Fe.DEBUG,{Event:Le.PROCESS_CACHED_HISTORY_MESSAGE,Description:`ACS Adapter: Process polled cached history message with Id ${e.id}`,MessageSender:n&&n.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:e.id})},Pde=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.PROCESS_CACHED_NEW_MESSAGE,Description:`ACS Adapter: Process cached new message with id ${t.id}`,MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},Ode=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants added event",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:t.addedOn.toISOString(),ChatThreadId:t.threadId,UserAdded:t.participantsAdded.map(e=>e.id.communicationUserId)})},Mde=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants removed event",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:t.removedOn.toISOString(),ChatThreadId:t.threadId,UserAdded:t.participantsRemoved.map(e=>e.id.communicationUserId)})},_$=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.UNSUPPORTED_MESSAGE_TYPE,Description:`Message with ${t.id} has unsupported message type: ${t.type}`,TimeStamp:new Date().toISOString()})},Dde=(t,e,n)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSRequesterUserId:n(ye.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},Nde=(t,e,n)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSRequesterUserId:n(ye.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.deletedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},xde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SKIP_EDITED_MESSAGE,Description:"ACS Adapter: Skipping edited RTN message, already processed",TimeStamp:new Date().toISOString(),MessageSender:t.sender.communicationUserId,ChatThreadId:e(ye.ThreadId),ChatMessageId:t.id})},Lde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SKIP_DELETED_MESSAGE,Description:"ACS Adapter: Skipping deleted message RTN, already processed",TimeStamp:new Date().toISOString(),MessageSender:t.sender.communicationUserId,ChatThreadId:e(ye.ThreadId),ChatMessageId:t.id})},Ude=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.MESSAGE_EDIT_RECEIVED,Description:`ACS Adapter: Received a message edit event with id ${t.id}`,MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},Fde=t=>{Ue.logEvent(Fe.DEBUG,{Event:Le.MESSAGE_DELETED_RECEIVED,Description:`ACS Adapter: Received a message delete event with id ${t.id}`,MessageSender:t.sender.communicationUserId,TimeStamp:t.deletedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},Bde=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_EDITED_MESSAGE,Description:"ACS Adapter: convert edited message",CustomProperties:t,MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},$de=t=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_DELETED_MESSAGE,Description:"ACS Adapter: convert edited deleted message event",CustomProperties:t,MessageSender:t.sender.communicationUserId,TimeStamp:t.deletedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id})},Hde=(t,e,n)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSRequesterUserId:t.currentUserId,MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.messageId,ExceptionDetails:n})},qde=(t,e,n)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSRequesterUserId:n(ye.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id,ExceptionDetails:e})},A$=t=>{Ue.logEvent(Fe.ERROR,{Event:Le.FILEMANAGER_DOWNLOAD_FILE_FAILED,Description:"Downloading attachment for message failed.",ExceptionDetails:t})},XS=(t,e,n,r)=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_START_INIT_ERROR,ChatThreadId:t,ACSRequesterUserId:e,Description:n,ExceptionDetails:r})},jde=(t,e)=>{Ue.logEvent(Fe.INFO,{Event:Le.ACS_SDK_START_INIT,ChatThreadId:t,ACSRequesterUserId:e,Description:"ACS Adapter: ACS Adapter start init."})},Vde=()=>{Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_JOINTHREAD_ERROR,Description:"ACS Adapter: failed to join the thread."})},zde=(t,e,n,r,i,o)=>We(void 0,void 0,void 0,function*(){var s,l;const c={chatClient:void 0,chatThreadClient:void 0};try{t||(XS(n,e,"ACS Adapter: ACS Adapter start init error. Token is null."),Or.notifyErrorEvent({ErrorType:ui.ADAPTER_INIT_TOKEN_MISSING_ERROR,Timestamp:new Date().toISOString(),AcsChatDetails:{ThreadId:n,RequesterUserId:e}})),n||(XS(n,e,"ACS Adapter: ACS Adapter start init error. ThreadId is null."),Or.notifyErrorEvent({ErrorType:ui.ADAPTER_INIT_THREAD_ID_MISSING_ERROR,Timestamp:new Date().toISOString(),AcsChatDetails:{RequesterUserId:e}})),nu.id=e,nu.environmentUrl=r,nu.token=t,ede.displayName=i??"",jde(n,e);const a=new WU(t);return c.chatClient=o??new Zue(nu.environmentUrl,a),c.chatThreadClient=c.chatClient.getChatThreadClient(n),c.chatThreadClient||Vde(),yield c.chatClient.startRealtimeNotifications(),c}catch(a){XS(n,e,"ACS Adapter: ACS Adapter start init error.",a),Or.notifyErrorEvent({ErrorType:ui.ADAPTER_INIT_EXCEPTION,ErrorMessage:a.message,ErrorStack:a.stack,ErrorDetails:a==null?void 0:a.details,Timestamp:new Date().toISOString(),AcsChatDetails:{RequesterUserId:e,ThreadId:e},CorrelationVector:(l=(s=a==null?void 0:a.request)===null||s===void 0?void 0:s.headers)===null||l===void 0?void 0:l.get("ms-cv")})}});let Gde=class extends zo{constructor(e,n){super(e),this.detail=n}};class hd extends Xf{raiseCustomEvent(e,n){const r=n?{payload:n}:void 0;let i=null;try{i=new Gde(e,r)}catch{}this.dispatchEvent(i)}constructor(){super(),this.handleOnline=()=>We(this,void 0,void 0,function*(){this.raiseCustomEvent("online")}),this.handleOffline=()=>We(this,void 0,void 0,function*(){return this.raiseCustomEvent("offline")}),this.handleLeaveChat=()=>We(this,void 0,void 0,function*(){return this.raiseCustomEvent("acs-adapter-leavechat")}),this.handleAcsChatOnline=()=>We(this,void 0,void 0,function*(){return this.raiseCustomEvent("acschat-online")}),this.handleBeforeunload=()=>{this.raiseCustomEvent("beforeunload")},this.handleError=e=>We(this,void 0,void 0,function*(){this.raiseCustomEvent("error",e)}),this.handleLoadMoreHistoryMessages=()=>We(this,void 0,void 0,function*(){this.raiseCustomEvent("acs-adapter-loadnextpage")}),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("beforeunload",this.handleBeforeunload),window.addEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.addEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}end(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("beforeunload",this.handleBeforeunload),window.removeEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.removeEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}}Yf(hd.prototype,"online");Yf(hd.prototype,"offline");Yf(hd.prototype,"error");Yf(hd.prototype,"beforeunload");Yf(hd.prototype,"leavechat");var Mi;(function(t){t.Message="message",t.Typing="typing"})(Mi||(Mi={}));var Qr;(function(t){t.Bot="bot",t.Channel="channel",t.Unknown="",t.User="user"})(Qr||(Qr={}));const J_="streaminfo";function Wde(){return({getState:t})=>e=>n=>We(this,void 0,void 0,function*(){var r,i;if(n.type!==Mi.Message||!(n.attachments||[]).length)return e(n);const{attachments:o}=n,s=t(ye.FileManager),l=t(ye.EventManager);n.channelData=Object.assign(Object.assign({},n.channelData),{uploadedFiles:[]}),Ue.logEvent(Fe.ERROR,{Event:Le.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Sending upload file request",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId)});try{const c=yield s.uploadFiles(o);n.channelData.uploadedFiles=c}catch(c){Ue.logEvent(Fe.ERROR,{Event:Le.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Uploading file failed",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId),ExceptionDetails:c}),Or.notifyErrorEvent({ErrorType:ui.EGRESS_ATTACHMENT_UPLOAD_FAILED,ErrorMessage:c.message,ErrorStack:c.stack,ErrorDetails:c==null?void 0:c.details,Timestamp:n.timestamp,AcsChatDetails:{ThreadId:t(ye.ThreadId),RequesterUserId:t(ye.UserId)},AdditionalParams:{activity:n},CorrelationVector:(i=(r=c==null?void 0:c.request)===null||r===void 0?void 0:r.headers)===null||i===void 0?void 0:i.get("ms-cv")}),l.handleError(c)}e(n)})}const R$={},Kde=(t,e)=>{R$[t]=e},Jde=t=>R$[t],Qde="0.0.1-beta.5",Xde={"@azure/communication-chat":"1.6.0-beta.5"},ja={version:Qde,dependencies:Xde},Yde={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${ja.version} azsdk-js-communication-chat/${ja.dependencies["@azure/communication-chat"]}`}}};function Zde(){return({getState:t})=>e=>n=>We(this,void 0,void 0,function*(){var r,i,o,s,l,c,a,u,d,f;if(n.type!==Mi.Message)return e(n);const h=t(ye.ChatThreadClient),g=t(ye.UserDisplayName),E=t(ye.EventManager),D=t(ye.FileManager);if(!h){const P="ACS Adapter: Failed to egress message without an active chatThreadClient.";throw Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_EGRESS_FAILED,Description:P,ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid}),new Error(P)}Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_EGRESS_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid});const{text:w,value:p}=n,b=Date.now().toString();n.clientmessageid=b;let j=w||"";const K={},M=(i=(r=n.channelData)===null||r===void 0?void 0:r.uploadedFiles)===null||i===void 0?void 0:i.map(P=>P==null?void 0:P.fileId),ne=M?D.createFileIdProperty(M):void 0,G=(s=(o=n.channelData)===null||o===void 0?void 0:o.uploadedFiles)===null||s===void 0?void 0:s.map(P=>P==null?void 0:P.metadata),oe=G?D.createFileMetadataProperty(G):void 0,J=D.createBotAttachment(Object.assign(Object.assign({},ne),oe));J&&Object.keys(J).length!==0&&(K.attachments=[J]);const X=(l=n.channelData)===null||l===void 0?void 0:l.tags,B=X?{tags:X}:void 0;let q=(c=n.channelData)===null||c===void 0?void 0:c.metadata;!((a=n.channelData)===null||a===void 0)&&a.clientActivityID&&(q=Object.assign(Object.assign({},q),{clientActivityId:n.channelData.clientActivityID.toString()})),p&&(K.value=p),n.attachmentLayout&&(K.attachmentLayout=n.attachmentLayout),JSON.stringify(K)!=="{}"&&(w&&(K.text=w),j=JSON.stringify(K),q=Object.assign(Object.assign({},q),{"microsoft.azure.communication.chat.bot.contenttype":"azurebotservice.adaptivecard"}));const F=Object.assign(Object.assign({},Yde),{senderDisplayName:g||void 0});(q||X||M)&&(F.metadata=Object.assign(Object.assign(Object.assign(Object.assign({},q),B),ne),oe));const x={content:j};try{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_EGRESS_SEND_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid});const P=yield h.sendMessage(x,F);Kde(P.id,n.channelData.clientActivityID),Ue.logEvent(Fe.DEBUG,{Event:Le.ACS_ADAPTER_SEND_MESSAGE_SUCCESS,Description:`Adapter: Successfully sent a message with messageid ${P.id}.`,CustomProperties:x,ACSRequesterUserId:t(ye.UserId),TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid,ClientActivityId:n==null?void 0:n.channelData.clientActivityID})}catch(P){const v=P==null?void 0:P.request;Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:x,ACSRequesterUserId:t(ye.UserId),TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid,ClientActivityId:n==null?void 0:n.channelData.clientActivityID,ExceptionDetails:P}),Or.notifyErrorEvent({StatusCode:(u=P.response)===null||u===void 0?void 0:u.status,ErrorType:ui.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:P.message,ErrorStack:P.stack,ErrorDetails:P==null?void 0:P.details,Timestamp:new Date().toISOString(),AcsChatDetails:{ThreadId:t(ye.ThreadId),RequesterUserId:t(ye.UserId)},AdditionalParams:{activity:n,sendMessageRequest:x,sendMessageOptions:F,httpRequest:v},CorrelationVector:(f=(d=P==null?void 0:P.request)===null||d===void 0?void 0:d.headers)===null||f===void 0?void 0:f.get("ms-cv")}),E.handleError(P)}})}const DD={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${ja.version} azsdk-js-communication-chat/${ja.dependencies["@azure/communication-chat"]}`}}};function ehe(){return({getState:t})=>e=>n=>We(this,void 0,void 0,function*(){var r,i,o;if(n.type!==Mi.Typing)return e(n);const s=t(ye.ChatThreadClient),l=t(ye.AdapterOptions);if(!s){const a="ACS Adapter: Failed to egress typing activity with an undefined chatThreadClient.";throw Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_EGRESS_TYPING_FAILED,Description:a,ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId)}),new Error(a)}const c=l!=null&&l.enableSenderDisplayNameInTypingNotification?Object.assign(Object.assign({},DD),{senderDisplayName:t(ye.UserDisplayName)}):Object.assign({},DD);try{Ue.logEvent(Fe.DEBUG,{Event:Le.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST,Description:"ACS Adapter: Request sending a typing indication",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId)}),yield s.sendTypingNotification(c),Ue.logEvent(Fe.DEBUG,{Event:Le.ACS_ADAPTER_INGRESS_TYPING_SUCCESS,Description:"ACS Adapter: Successfully sent a typing indication",ACSRequesterUserId:t(ye.UserId),TimeStamp:n.timestamp,ChatThreadId:t(ye.ThreadId)})}catch(a){const u=a==null?void 0:a.request;Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:c,ACSRequesterUserId:t(ye.UserId),TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:n.messageid,ClientActivityId:n==null?void 0:n.channelData.clientActivityID,ExceptionDetails:a}),Or.notifyErrorEvent({StatusCode:(r=a.response)===null||r===void 0?void 0:r.status,ErrorType:ui.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:a.message,ErrorStack:a.stack,ErrorDetails:a==null?void 0:a.details,Timestamp:new Date().toISOString(),AcsChatDetails:{ThreadId:t(ye.ThreadId),RequesterUserId:t(ye.UserId)},AdditionalParams:{activity:n,httpRequest:u},CorrelationVector:(o=(i=a==null?void 0:a.request)===null||i===void 0?void 0:i.headers)===null||o===void 0?void 0:o.get("ms-cv")})}})}function the(t){const e=t&&t.egressMiddleware?t.egressMiddleware:[];return yJ(...e,Wde(),Zde(),ehe())}const kr={ACS_CHANNEL:"ACS_CHANNEL",API_Version:"2020-09-21-preview2",PARTICIPANT_JOINED:"joined",PARTICIPANT_LEFT:"left"};var Nu;(function(t){t.THREAD="Thread",t.ERROR="Error"})(Nu||(Nu={}));function nhe({getState:t}){const e=(n,r,i)=>{const o={message:n.message,stack:n.stack,details:n==null?void 0:n.details};return{channelId:kr.ACS_CHANNEL,conversation:{id:void 0},channelData:{type:Nu.ERROR},from:{id:void 0,name:void 0,role:Qr.Channel},id:r,timestamp:i,type:Mi.Message,messageid:void 0,text:JSON.stringify(o)}};return()=>n=>We(this,void 0,void 0,function*(){return e(n,t(ye.UserId),new Date().toISOString())})}const k$="microsoft.azure.communication.chat.bot.contenttype",P$="azurebotservice.adaptivecard";var ND;(function(t){t[t.READ=0]="READ",t[t.WRITE=1]="WRITE"})(ND||(ND={}));const O$=t=>t==="text"||t==="participantAdded"||t==="participantRemoved",M$=t=>"participantsAdded"in t,D$=t=>"participantsRemoved"in t,rhe=t=>new Promise(e=>setTimeout(e,t)),N$=(t,e,n)=>{const r=t==null?void 0:t.get(e);if(r){const i=r.content===n.content,o=!Mw(r.updatedOn,n.updatedOn),s=Mw(r.deletedOn,n.deletedOn),l=r.fileIds?new Set(r.fileIds):void 0,c=n.fileIds?new Set(n.fileIds):void 0,a=!l&&!c||l.size===c.size&&[...l].every(u=>c.has(u));return i&&!o&&a&&s}return!1},vv=(t,e,n)=>{const r=t==null?void 0:t.get(e);if(r){let i=!1;return n.addedParticipants?i=xD(n.addedParticipants,r.addedParticipants):n.removedParticipants&&(i=xD(n.removedParticipants,r.removedParticipants)),i}return!1},xD=(t,e)=>{if(t.length!==e.length)return!1;const n=new Map;for(const r of e){const i="communicationUserId"in r.id?r.id.communicationUserId:JSON.stringify(r.id);n.set(i,r)}for(const r of t){const i="communicationUserId"in r.id?r.id.communicationUserId:JSON.stringify(r.id),o=n.get(i);if(!o||r.displayName!==o.displayName||!Mw(r.shareHistoryTime,o.shareHistoryTime))return!1}return!0},Mw=(t,e)=>!t&&!e?!0:!t||!e?!1:Dw(t)===Dw(e),yv=t=>{var e,n,r;if(!(!((e=t.content)===null||e===void 0)&&e.initiator))throw new Error("Message does not contain initiator information");if(!(!((n=t.content)===null||n===void 0)&&n.participants))throw new Error("Message does not contain participants information");return Nw(((r=t.content)===null||r===void 0?void 0:r.initiator).communicationUserId,t.createdOn,t.content.participants)},x$=t=>{if(M$(t))return Nw(t.addedBy.id.communicationUserId,t.addedOn,t.participantsAdded);if(D$(t))return Nw(t.removedBy.id.communicationUserId,t.removedOn,t.participantsRemoved);throw new Error("Event does not contain participants information")},Dw=t=>t.toISOString().substring(0,19),Nw=(t,e,n)=>{const r=n.map(o=>o.id.communicationUserId).sort().join("_"),i=ihe(r);return`${Dw(e)}_${t}_${i}`},ihe=t=>{let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return Math.abs(e).toString(16)},sc=t=>{const e=ey(t);switch(e.kind){case"communicationUser":return e.communicationUserId;case"microsoftTeamsUser":return e.microsoftTeamsUserId;case"phoneNumber":return e.phoneNumber;case"unknown":return e.id}},ohe=t=>new Promise(e=>{const n=new FileReader;n.onloadend=()=>{e(n.result)},n.readAsDataURL(t)}),Q_=(t,e,n,r)=>We(void 0,void 0,void 0,function*(){try{let i;return e?i=t.map((o,s)=>({fileId:o,metadata:e[s]})):i=t.map(o=>({fileId:o})),yield n.downloadFiles(i)}catch(i){A$(i),r.handleError(i)}}),she=(t,e,n,r,i)=>We(void 0,void 0,void 0,function*(){try{if(r){i||(i=9e4);const s=new Promise((l,c)=>{setTimeout(()=>{c(new Error("Attachment download timed out."))},i)});return Promise.race([e.downloadFiles(t),s])}return yield e.downloadFiles(t)}catch(s){A$(s),n.handleError(s)}}),X_=t=>We(void 0,void 0,void 0,function*(){return Promise.all(t.map(e=>We(void 0,void 0,void 0,function*(){if(e){const n=yield ohe(e);return{contentType:e.type,contentUrl:n,name:e.name,thumbnailUrl:e.type.match("(image|video|audio).*")?n:void 0}}})))}),Y_=t=>t.map(e=>e==null?void 0:e.size),Bg=(t,e,n,r,i)=>{const o=N$(t,e.id,{content:e.message,deletedOn:e.deletedOn,updatedOn:e.editedOn,fileIds:r==null?void 0:r.getFileIds(e.metadata)});return o||(Ue.logEvent(Fe.INFO,{Event:i,Description:"ACS Adapter: Processing message",MessageSender:e.sender.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:n(ye.ThreadId),ChatMessageId:e.id}),t.set(e.id,{content:e.message,updatedOn:e.editedOn,deletedOn:e.deletedOn,fileIds:r==null?void 0:r.getFileIds(e.metadata)})),o},ahe=(t,e,n)=>{switch(t.type){case"text":return N$(e,t.id,{content:t.content.message,updatedOn:t.editedOn,deletedOn:t.deletedOn,fileIds:n==null?void 0:n.getFileIds(t.metadata)});case"participantAdded":{const r=yv(t);return vv(e,r,{addedParticipants:t.content.participants})}case"participantRemoved":{const r=yv(t);return vv(e,r,{removedParticipants:t.content.participants})}default:return _$(t),!1}},LD=(t,e,n)=>{switch(t.type){case"text":{e.set(t.id,{content:t.content.message,updatedOn:t.editedOn,deletedOn:t.deletedOn,fileIds:n==null?void 0:n.getFileIds(t.metadata)});break}case"participantAdded":{const r=yv(t);e.set(r,{addedParticipants:t.content.participants});break}case"participantRemoved":{const r=yv(t);e.set(r,{removedParticipants:t.content.participants});break}default:{_$(t);break}}},lhe=(t,e,n)=>{const r=x$(e),i=vv(t,r,{addedParticipants:e.participantsAdded});return i||(wde(n,e),t.set(r,{addedParticipants:e.participantsAdded})),i},che=(t,e,n)=>{const r=x$(e),i=vv(t,r,{removedParticipants:e.participantsRemoved});return i||(Ide(n,e),t.set(r,{removedParticipants:e.participantsRemoved})),i};var UD=typeof window<"u"?window:self,uhe=UD.crypto||UD.msCrypto,dhe=function(t){if(!t)return Math.random;var e=Math.pow(2,32),n=new Uint32Array(1);return function(){return t.getRandomValues(n)[0]/e}}(uhe);const hhe=Ov(dhe);function Vy(){return hhe().toString(36).substr(2)}function Z_(t,e,n,r=!0,i){var o,s,l,c;return We(this,void 0,void 0,function*(){const a=sc(e.sender);let u,d,f,h,g,E;if((e.metadata?e.metadata[`${k$}`]:void 0)===P$)try{const j=JSON.parse(e.content);n&&j.attachments&&(u=[],u=u.concat(j.attachments),E=j.attachmentLayout),r&&(h=j==null?void 0:j.value),g=j==null?void 0:j.suggestedActions,f=j==null?void 0:j.text}catch(j){const K="Valid JSON object is expected.";if(Hde(e,K,j),Or.notifyErrorEvent({ErrorType:ui.INGRESS_MESSAGE_INVALID_JSON,ErrorMessage:j.message,ErrorStack:j.stack,ErrorDetails:j==null?void 0:j.details,Timestamp:e.createdOn.toISOString(),AcsChatDetails:{MessageId:e.messageId,ThreadId:e.threadId,MessageSenderId:e.sender.communicationUserId,RequesterUserId:e.currentUserId},AdditionalParams:{SenderDisplayName:e.senderDisplayName,MessageText:e.content,Metadata:e.metadata}}),i){const M=new Error(K);M.details={type:"MESSAGE_PARSING_FAILED",actualMessage:e.content},t.handleError(M)}}else f=e.content;e.files&&!u&&(u=yield X_(e.files),d=Y_(e.files));let w=Jde(e.messageId);w===void 0&&(w=(o=e.metadata)===null||o===void 0?void 0:o.clientActivityId);let p;e.sequenceId&&Math.sign(parseInt(e.sequenceId))>0&&(p=parseInt(e.sequenceId));const b={attachments:u,channelId:kr.ACS_CHANNEL,channelData:{"webchat:sequence-id":p,attachmentSizes:d,fromUserId:a,clientActivityID:w,messageId:e.messageId,state:"sent",tags:(s=e.metadata)===null||s===void 0?void 0:s.tags,metadata:e.metadata,additionalMessageMetadata:{editedOn:(l=e.editedOn)===null||l===void 0?void 0:l.toISOString(),deletedOn:(c=e.deletedOn)===null||c===void 0?void 0:c.toISOString()}},conversation:{id:e.threadId},from:{id:a,name:e.senderDisplayName?e.senderDisplayName:void 0,role:a===e.currentUserId?Qr.User:Qr.Bot},id:e.messageId?e.messageId:Vy(),text:f,timestamp:new Date(e.createdOn).toISOString(),type:Mi.Message,messageid:e.messageId?e.messageId:"",value:h,suggestedActions:g,attachmentLayout:E};return e.streamingMetadata&&(b.channelData.streamType=e.streamingMetadata.streamingMessageType,b.channelData.streamId=e.messageId,b.entities=[{type:J_,streamType:e.streamingMetadata.streamingMessageType,streamId:e.messageId}]),b})}function fhe({getState:t}){return()=>({message:e,files:n})=>We(this,void 0,void 0,function*(){const r=t(ye.AdapterOptions),i=t(ye.EventManager),o=t(ye.ThreadId),s=t(ye.UserId);if(!n)return null;const l=L$(e,o,s,n);return yield Z_(i,l,r==null?void 0:r.enableAdaptiveCards,r==null?void 0:r.enableAdaptiveCardsResponses,r==null?void 0:r.enableMessageErrorHandler)})}function phe({getState:t}){return()=>e=>We(this,void 0,void 0,function*(){var n,r;const i=t(ye.ChatClient),o=t(ye.AdapterOptions),s=t(ye.FileManager),l=t(ye.EventManager),c=t(ye.ThreadId),a=t(ye.UserId);if(!i){const h="ACS Adapter: Failed to ingress history message without an active chatClient.";throw Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:h,ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatMessageId:e.id}),new Error(h)}let u,d;try{if(d=s.getFileIds(e.metadata),d)return l.raiseCustomEvent("queue-attachment-download",{chatMessage:e,options:o}),null}catch(h){if(Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to queue attachments download",ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatMessageId:e.id,ExceptionDetails:h}),Or.notifyErrorEvent({ErrorType:ui.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED,ErrorMessage:h.message,ErrorStack:h.stack,ErrorDetails:h==null?void 0:h.details,Timestamp:e.createdOn.toISOString(),AcsChatDetails:{MessageId:e.id,ThreadId:c,MessageSenderId:e.sender.communicationUserId,RequesterUserId:t(ye.UserId)},AdditionalParams:{MessageDetails:e},CorrelationVector:(r=(n=h==null?void 0:h.request)===null||n===void 0?void 0:n.headers)===null||r===void 0?void 0:r.get("ms-cv")}),o!=null&&o.enableMessageErrorHandler){const g="Failed to download attachments.",E=new Error(g);E.details={type:"QUEUE_ATTACHMENT_DOWNLOAD_FAILED",actualMessage:d},l.handleError(h)}}const f=L$(e,c,a,u);return yield Z_(l,f,o==null?void 0:o.enableAdaptiveCards,o==null?void 0:o.enableAdaptiveCardsResponses,o==null?void 0:o.enableMessageErrorHandler)})}const L$=(t,e,n,r)=>{var i,o;return{messageId:t.id,content:(i=t.content)===null||i===void 0?void 0:i.message,createdOn:t.createdOn,editedOn:t.editedOn,deletedOn:t.deletedOn,sender:t.sender,senderDisplayName:t.senderDisplayName,currentUserId:n,threadId:e,metadata:t.metadata,tags:(o=t.metadata)===null||o===void 0?void 0:o.tags,sequenceId:t.id,files:r}};function ghe({getState:t}){const e=(n,r)=>({channelId:kr.ACS_CHANNEL,conversation:{id:void 0},channelData:{type:Nu.THREAD,properties:{deleteTime:n.deletedOn.toISOString(),isDeleted:"True"}},from:{id:void 0,name:void 0,role:Qr.Channel},id:r,timestamp:n.deletedOn.toISOString(),type:Mi.Message,messageid:void 0});return()=>n=>We(this,void 0,void 0,function*(){return e(n,t(ye.UserId))})}function mhe({getState:t}){return()=>e=>We(this,void 0,void 0,function*(){if(!t(ye.ChatClient)){const l="ACS Adapter: Failed to ingress typing message without an active chatClient.";throw Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:l,ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId}),new Error(l)}const{receivedOn:r,sender:i}=e,o=sc(i);return{channelId:kr.ACS_CHANNEL,conversation:{id:t(ye.UserId)},from:{id:o,name:e.senderDisplayName,role:o===t(ye.UserId)?Qr.User:Qr.Bot},timestamp:new Date(r).toISOString(),type:Mi.Typing}})}function vhe({getState:t}){return()=>e=>We(this,void 0,void 0,function*(){var n,r,i;const o=t(ye.ChatClient),s=t(ye.AdapterOptions),l=t(ye.FileManager),c=t(ye.EventManager),a=t(ye.UserId);if(!o){const h="ACS Adapter: Failed to ingress message without an active chatClient.";throw Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_INGRESS_FAILED,Description:h,ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),new Error(h)}let u,d;if(e.metadata&&Object.keys(e.metadata).length!==0){u=e.metadata;let h;try{Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS,Description:"Preparing to download attachments",ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),h=l.getFileIds(e.metadata);const g=l.getFileMetadata(e.metadata);h&&(d=yield Q_(h,g,l,c))}catch(g){if(Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to download attachments",ACSRequesterUserId:t(ye.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id,ExceptionDetails:g}),Or.notifyErrorEvent({ErrorType:ui.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED,ErrorMessage:g.message,ErrorStack:g.stack,ErrorDetails:g==null?void 0:g.details,Timestamp:e.createdOn.toISOString(),AcsChatDetails:{MessageId:e.id,ThreadId:e.threadId,MessageSenderId:e.sender.communicationUserId,RequesterUserId:a},AdditionalParams:{SenderDisplayName:e.senderDisplayName,MessageText:e.message,Metadata:e.metadata},CorrelationVector:(r=(n=g==null?void 0:g.request)===null||n===void 0?void 0:n.headers)===null||r===void 0?void 0:r.get("ms-cv")}),s!=null&&s.enableMessageErrorHandler){const E="Failed to download attachments.",D=new Error(E);D.details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:h},c.handleError(D)}}}const f={messageId:e.id,content:e.message,createdOn:e.createdOn,sender:e.sender,senderDisplayName:e.senderDisplayName,currentUserId:a,threadId:e.threadId,metadata:u,tags:(i=e.metadata)===null||i===void 0?void 0:i.tags,sequenceId:e.id,streamingMetadata:e.streamingMetadata,files:d};return yield Z_(c,f,s==null?void 0:s.enableAdaptiveCards,s==null?void 0:s.enableAdaptiveCardsResponses,s==null?void 0:s.enableMessageErrorHandler)})}const yhe=(t,e,n)=>We(void 0,void 0,void 0,function*(){const{chatMessage:r,options:i}=t.detail.payload;let o,s;const l=n(ye.EventManager),c=n(ye.FileManager);try{s=c.getFileIds(r.metadata);const a=c.getFileMetadata(r.metadata);if(s){const u=Che(e,r.id,s,a);if((u==null?void 0:u.length)<=0)return;Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments download queued: "+u.map(d=>d.fileId).join(","),ACSRequesterUserId:n(ye.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),o=yield she(u,c,this,i==null?void 0:i.shouldFileAttachmentDownloadTimeout,i==null?void 0:i.fileAttachmentDownloadTimeout),Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments downloaded: ",ACSRequesterUserId:n(ye.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),l.raiseCustomEvent("acs-attachment-downloaded",{chatMessage:r,files:o})}}catch(a){if(Ue.logEvent(Fe.ERROR,{Event:Le.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR,Description:"ACS Adapter: Failed to download attachments",ACSRequesterUserId:n(ye.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id,ExceptionDetails:a}),i!=null&&i.enableMessageErrorHandler){const u="Failed to download attachments.",d=new Error(u);d.details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:s},l.handleError(a)}}}),Che=(t,e,n,r)=>{const i=[];if(t&&Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_PROCESSED_ATTACHMENTS,Description:`ACS Adapter: Attachments processed on this thread ${[...Object.keys(t)]}`,TimeStamp:new Date().toISOString(),ChatMessageId:e}),Object.prototype.hasOwnProperty.call(t,e))for(let o=0;o<n.length;++o)t[e].has(n[o])||(i.push({fileId:n[o],metadata:r[o]}),t[e].set(n[o],r[o]));else{t[e]=new Map,Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_ATTACHMENT_NEW,Description:`ACS Adapter: New attachment download ${n==null?void 0:n.join(",")}`,TimeStamp:new Date().toISOString(),ChatMessageId:e});for(let o=0;o<n.length;++o)i.push({fileId:n[o],metadata:r[o]}),t[e].set(n[o],r[o])}return i},She=({getState:t,isFirstChunk:e})=>()=>n=>We(void 0,void 0,void 0,function*(){var r,i,o,s;const l=t(ye.ChatClient),c=t(ye.FileManager),a=t(ye.EventManager);if(!l){const f="ACS Adapter: Failed to ingress streaming message chunk event without an active chatClient.";throw new Error(f)}const u=sc(n.sender),d={channelId:kr.ACS_CHANNEL,channelData:{"webchat:sequence-id":parseInt(n.id)},conversation:{id:t(ye.ThreadId)},from:{id:u,name:n.senderDisplayName?n.senderDisplayName:void 0,role:u===t(ye.UserId)?Qr.User:Qr.Bot},messageid:n.id,id:n.id?n.id:Vy(),text:n.message,timestamp:n.editedOn.toISOString(),type:Mi.Typing};if(n.metadata&&Object.keys(n.metadata).length!==0){let f,h,g;try{const E=c.getFileIds(n.metadata),D=c.getFileMetadata(n.metadata);E&&(f=yield Q_(E,D,c,a),h=yield X_(f),g=Y_(f))}catch(E){Ue.logEvent(Fe.ERROR,{Event:Le.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK,Description:"Failed to parse StreamingChatMessageChunk metadata",ACSRequesterUserId:t(ye.UserId),MessageSender:n.sender.communicationUserId,TimeStamp:n.editedOn.toISOString(),ChatThreadId:n.threadId,ChatMessageId:n.id,ExceptionDetails:E}),Or.notifyErrorEvent({ErrorType:ui.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:E.message,ErrorStack:E.stack,ErrorDetails:E==null?void 0:E.details,Timestamp:n.editedOn.toISOString(),AcsChatDetails:{MessageId:n.id,ThreadId:n.threadId,MessageSenderId:n.sender.communicationUserId,RequesterUserId:t(ye.UserId)},AdditionalParams:{MessageEditedEvent:n},CorrelationVector:(i=(r=E==null?void 0:E.request)===null||r===void 0?void 0:r.headers)===null||i===void 0?void 0:i.get("ms-cv")}),a.handleError(E)}d.channelData.metadata=n.metadata,h&&h.length>0&&(d.attachments=h,d.channelData.attachmentSizes=g),!((o=n.metadata)===null||o===void 0)&&o.tags&&n.metadata.tags.length>0&&(d.channelData.tags=(s=n.metadata)===null||s===void 0?void 0:s.tags)}return n.streamingMetadata&&(d.channelData.streamType=n.streamingMetadata.streamingMessageType,d.channelData.streamSequence=n.streamingMetadata.streamingSequenceNumber,d.entities=[{type:J_,streamType:n.streamingMetadata.streamingMessageType,streamSequence:n.streamingMetadata.streamingSequenceNumber}],e||(d.channelData.streamId=n.id,d.entities[0].streamId=n.id)),d}),The=(t,e,n)=>We(void 0,void 0,void 0,function*(){var r;try{const s=yield She({getState:e,isFirstChunk:!n})()(t);return tde(t),s}catch(i){ide(t,e,(r=i.message)!==null&&r!==void 0?r:"")}});function Ehe({getState:t}){const e=(n,r,i)=>({channelId:kr.ACS_CHANNEL,conversation:{id:void 0},channelData:{type:Nu.THREAD,members:[{id:n.id,displayName:n.displayName,tag:n.tag}]},from:{id:void 0,name:void 0,role:Qr.Channel},id:r,timestamp:i,type:Mi.Message,messageid:void 0,text:JSON.stringify(`${n.displayName} ${n.tag} chat`)});return()=>n=>We(this,void 0,void 0,function*(){return e(n,t(ye.UserId),new Date().toISOString())})}const ru=(t,e,n,r)=>We(void 0,void 0,void 0,function*(){for(const i of t){const o=yield xw(n,i,e);r(o)}}),xw=(t,e,n)=>We(void 0,void 0,void 0,function*(){const r=sc(e.id),i={displayName:e.displayName,tag:n,id:r},o=yield Ehe({getState:t})()(i);return ade(),o}),YS=(t,e,n,r,i,o)=>We(void 0,void 0,void 0,function*(){if(!O$(e.type))return!1;if(i(ye.WebChatStatus)!==_r.Connected)return lde(n,e,i),t.push(e),!0;if(!r)switch(e.type){case"text":{const s=yield U$(e,i);o(s);break}case"participantAdded":{e.content.participants&&ru(e.content.participants,kr.PARTICIPANT_JOINED,i,o);break}case"participantRemoved":{e.content.participants&&ru(e.content.participants,kr.PARTICIPANT_LEFT,i,o);break}}return!0}),ZS=(t,e,n,r)=>We(void 0,void 0,void 0,function*(){switch(t.type){case"text":{const i=yield U$(t,e);eT(i,t,e,n,r);break}case"participantAdded":{for(const i of t.content.participants){const o=yield xw(e,i,kr.PARTICIPANT_JOINED);eT(o,t,e,n,r)}break}case"participantRemoved":{for(const i of t.content.participants){const o=yield xw(e,i,kr.PARTICIPANT_LEFT);eT(o,t,e,n,r)}break}}}),eT=(t,e,n,r,i)=>{t&&(Sde(n,i+t.messageid,e),t.channelData||(t.channelData={}),t.channelData.fromList=!0,r(t))},U$=(t,e)=>We(void 0,void 0,void 0,function*(){const n=yield phe({getState:e})()(t);return cde(t),n});function whe({getState:t}){return()=>e=>We(this,void 0,void 0,function*(){var n,r,i,o;const s=t(ye.ChatClient),l=t(ye.FileManager),c=t(ye.EventManager);if(!s){const d="ACS Adapter: Failed to ingress edited message without an active chatClient.";throw new Error(d)}const a=sc(e.sender),u={channelId:kr.ACS_CHANNEL,channelData:{"webchat:sequence-id":parseInt(e.id),additionalMessageMetadata:{editedOn:e.editedOn.toISOString()}},conversation:{id:t(ye.UserId)},from:{id:a,name:e.senderDisplayName,role:a===t(ye.UserId)?Qr.User:Qr.Bot},messageid:e.id,id:e.id?e.id:Vy(),text:e.message,timestamp:e.createdOn.toISOString(),type:Mi.Message};if(e.metadata&&Object.keys(e.metadata).length!==0){let d,f,h;try{const g=l.getFileIds(e.metadata),E=l.getFileMetadata(e.metadata);g&&(d=yield Q_(g,E,l,c),f=yield X_(d),h=Y_(d))}catch(g){qde(e,g,t),Or.notifyErrorEvent({ErrorType:ui.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:g.message,ErrorStack:g.stack,ErrorDetails:g==null?void 0:g.details,Timestamp:e.editedOn.toISOString(),AcsChatDetails:{MessageId:e.id,ThreadId:e.threadId,MessageSenderId:e.sender.communicationUserId,RequesterUserId:t(ye.UserId)},AdditionalParams:{MessageEditedEvent:e},CorrelationVector:(r=(n=g==null?void 0:g.request)===null||n===void 0?void 0:n.headers)===null||r===void 0?void 0:r.get("ms-cv")}),c.handleError(g)}u.channelData.metadata=e.metadata,f&&(u.attachments=f,u.channelData.attachmentSizes=h),!((i=e.metadata)===null||i===void 0)&&i.tags&&(u.channelData.tags=(o=e.metadata)===null||o===void 0?void 0:o.tags)}return u})}function Ihe({getState:t}){return()=>e=>We(this,void 0,void 0,function*(){if(!t(ye.ChatClient)){const o="ACS Adapter: Failed to ingress deleted message without an active chatClient.";throw new Error(o)}const r=sc(e.sender);return{channelId:kr.ACS_CHANNEL,channelData:{"webchat:sequence-id":parseInt(e.id),additionalMessageMetadata:{deletedOn:e.deletedOn.toISOString()}},conversation:{id:t(ye.UserId)},from:{id:r,name:e.senderDisplayName,role:r===t(ye.UserId)?Qr.User:Qr.Bot},messageid:e.id,id:e.id?e.id:Vy(),text:"",timestamp:e.createdOn.toISOString(),type:Mi.Message}})}const bhe=(t,e)=>We(void 0,void 0,void 0,function*(){try{const n=yield whe({getState:e})()(t);return Bde(t),n}catch(n){Dde(t,n.message,e)}}),_he=(t,e)=>We(void 0,void 0,void 0,function*(){try{const n=yield Ihe({getState:e})()(t);return $de(t),n}catch(n){Nde(t,n.message,e)}});let FD,BD,$D;const Xd=[],$g={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${ja.version} azsdk-js-communication-chat/${ja.dependencies["@azure/communication-chat"]}`}}};function Ahe(){return SJ(({getState:t,setState:e,getReadyState:n,setReadyState:r,subscribe:i})=>{const o=D=>We(this,void 0,void 0,function*(){const w=yield vhe({getState:t})()(D);return Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_MESSAGE,Description:"ACS Adapter: convert normal message",CustomProperties:D,MessageSender:D.sender.communicationUserId,TimeStamp:D.createdOn.toISOString(),ChatThreadId:D.threadId,ChatMessageId:D.id}),w}),s=(D,w)=>We(this,void 0,void 0,function*(){const p=yield fhe({getState:t})()({message:D,files:w});return Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert attachment history message:",CustomProperties:D,MessageSender:D.sender.communicationUserId,TimeStamp:D.createdOn.toISOString(),ChatMessageId:D.id}),p}),l=D=>We(this,void 0,void 0,function*(){const w=yield nhe({getState:t})()(D);return Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: convert error message",ExceptionDetails:D.message}),w}),c=D=>We(this,void 0,void 0,function*(){const w=yield mhe({getState:t})()(D);return Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_TYPING_MESSAGE,Description:"ACS Adapter: convert typing message.",MessageSender:D.sender.communicationUserId,TimeStamp:D.receivedOn.toISOString(),ChatThreadId:D.threadId}),w}),a=D=>We(this,void 0,void 0,function*(){const w=yield ghe({getState:t})()(D);return Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_CONVERT_THREAD_DELETED,Description:"ACS Adapter: convert thread delete",ACSRequesterUserId:D.deletedBy.id.communicationUserId,TimeStamp:D.deletedOn.toISOString(),ChatThreadId:D.threadId}),w}),u=(D,w,p)=>We(this,void 0,void 0,function*(){const b=yield l(p);!D&&w(b)}),d=(D,{unsubscribed:w},p,b=void 0,j=void 0)=>We(this,void 0,void 0,function*(){if(j===void 0){const K=D.listMessages(Object.assign(Object.assign({},$g),{startTime:b}));let M=yield K.next();for(;!M.done;){const ne=M.value;YS(Xd,ne,"ACS Adapter: Cache paged history message",w,t,p),M=yield K.next()}}else{let K=BD;K===void 0&&(K=D.listMessages(Object.assign(Object.assign({},$g),{maxPageSize:j,startTime:b})).byPage());const M="ACS Adapter: Cache paged history message  (with pagesize limit)";let ne=0;for(;ne<j;){const G=FD,oe=$D;if(G)for(let X=oe>=0?oe:0;X<G.value.length;X++){const B=G.value[X];YS(Xd,B,M,w,t,p)&&ne++}const J=yield K.next();if(J.done)break;for(let X=0;X<J.value.length;X++){if(ne>=j){BD=K,$D=X,FD=J;break}const B=J.value[X];YS(Xd,B,M,w,t,p)&&ne++}}}}),f=(D,{unsubscribed:w},p,b=void 0)=>We(this,void 0,void 0,function*(){const j=t(ye.EventManager);j==null||j.addEventListener("acs-adapter-loadnextpage",()=>{d(D,{unsubscribed:w},p,void 0,b)})}),h=({unsubscribed:D},w)=>We(this,void 0,void 0,function*(){const p=t(ye.EventManager);p==null||p.addEventListener("error",b=>{var j;const K=b;u(D,w,(j=K==null?void 0:K.detail)===null||j===void 0?void 0:j.payload)})}),g=({unsubscribed:D},w)=>We(this,void 0,void 0,function*(){const p=t(ye.EventManager);p==null||p.addEventListener("acs-adapter-leavechat",()=>{const b=t(ye.UserId);!D&&w.removeParticipant({communicationUserId:b},$g)})}),E=()=>{t(ye.EventManager).addEventListener("beforeunload",()=>{const w=t(ye.Token),p=t(ye.EnvironmentUrl),b=t(ye.ThreadId),j=t(ye.UserId);fetch(`${p}/chat/threads/${b}/members/${j}?api-version=${kr.API_Version}`,{keepalive:!0,method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`}})})};return D=>(w,p)=>We(this,void 0,void 0,function*(){return(w===ye.ChatThreadClient&&p||w===ye.Reconnect&&p)&&i(new Lh(b=>{const j=t(ye.ChatClient),K=t(ye.AdapterOptions),M=t(ye.MessagePollingHandleInstance);let ne=t(ye.FileManager);const G=b.next.bind(b);let oe,J,X=!0;const B={},q={unsubscribed:!1},F=p===!0?t(ye.ChatThreadClient):p,x=new Map,P=[],v=[],T=45,_=(m,R,Z,ie,se=0)=>We(this,void 0,void 0,function*(){var ue,Te,Se,Q;const O=K&&K.serverPageSizeLimit;let U;if(n()===er.CLOSED){QS(t,"ACS Adapter: Polling skipped because of thread deletion.");return}try{if(!X){QS(t,"ACS Adapter: Polling call issued too soon: skipping");return}if(!(M!=null&&M.getIsPollingEnabled())){QS(t,"ACS Adapter: Polling call disabled from the client: skipping");return}ude(t);const ae=R.listMessages(Object.assign(Object.assign({},$g),{startTime:Z,maxPageSize:O}));let ce=yield ae.next();for(;!ce.done;){const fe=ce.value;if(O$(fe.type)&&fe.sequenceId!==ie)if(ne||(ne=t(ye.FileManager)),ahe(fe,x,ne))vde(t,fe.id);else{if(yde(t,fe.id),t(ye.WebChatStatus)!==_r.Connected){Cde(t,fe.id),v.push(fe),ce=yield ae.next();continue}LD(fe,x,ne),ZS(fe,t,G,"ACS Adapter: Post activity, messageId: ")}(!Z||parseInt(fe.sequenceId)>parseInt(ie))&&(Z=fe.createdOn,ie=fe.sequenceId),ce=yield ae.next()}}catch(ae){U=ae,dde(t,ae),Or.notifyErrorEvent({StatusCode:(ue=ae.response)===null||ue===void 0?void 0:ue.status,ErrorType:ui.MESSAGE_POLLING_FAILED,ErrorMessage:ae.message,ErrorStack:ae.stack,ErrorDetails:ae==null?void 0:ae.details,Timestamp:new Date().toISOString(),AcsChatDetails:{ThreadId:t(ye.ThreadId)},CorrelationVector:(Se=(Te=ae==null?void 0:ae.request)===null||Te===void 0?void 0:Te.headers)===null||Se===void 0?void 0:Se.get("ms-cv")})}finally{const ae=(Q=U==null?void 0:U.response)===null||Q===void 0?void 0:Q.status;X=!1,window.setTimeout(()=>X=!0,15e3),!(M!=null&&M.stopPolling())&&(!U||N(ae))?(oe&&(hde(t,oe),clearTimeout(oe)),oe=window.setTimeout(()=>We(this,void 0,void 0,function*(){se<=T&&(X=!0),yield _(m,R,Z,ie,se+1)}),se<=T?1e3:m),fde(t,oe)):(M!=null&&M.stopPolling()&&pde(t),r(er.CLOSED))}}),N=m=>(gde(t,m),!(m===401||m===403||m===404)),I=()=>We(this,void 0,void 0,function*(){oe&&(mde(t,oe),clearTimeout(oe)),yield _(t(ye.PollingInterval),F)}),A=m=>We(this,void 0,void 0,function*(){const R=t(ye.EventManager);R==null||R.addEventListener("online",()=>We(this,void 0,void 0,function*(){const Z=t(ye.DisconnectUTC);Ue.logEvent(Fe.DEBUG,{Event:Le.NETWORK_ONLINE,Description:`ACS Adapter: ACS Chat reconnected event since disconnect at ${Z}`,TimeStamp:new Date().toISOString()}),Z&&(e(ye.DisconnectUTC,void 0),oe&&(Ue.logEvent(Fe.INFO,{Event:Le.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in network connected Id "+oe,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)}),clearTimeout(oe)),X=!0,yield _(t(ye.PollingInterval),m,Z))}))}),S=()=>We(this,void 0,void 0,function*(){Ue.logEvent(Fe.DEBUG,{Event:Le.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Realtime notification connected",TimeStamp:new Date().toISOString()}),yield I()}),H=()=>We(this,void 0,void 0,function*(){J=new Date,Ue.logEvent(Fe.DEBUG,{Event:Le.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Realtime notification disconnected",TimeStamp:J.toISOString()})}),L=()=>We(this,void 0,void 0,function*(){const m=t(ye.EventManager);m==null||m.addEventListener("queue-attachment-download",R=>We(this,void 0,void 0,function*(){yield yhe(R,B,t)}))}),C=()=>We(this,void 0,void 0,function*(){const m=t(ye.EventManager);m==null||m.addEventListener("acs-attachment-downloaded",R=>We(this,void 0,void 0,function*(){const{chatMessage:Z,files:ie}=R.detail.payload;Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_ATTACHMENT_DOWNLOADED,Description:"ACS Adapter: Attachment downloaded "+(ie==null?void 0:ie.map(ue=>ue.name).join(",")),MessageSender:Z.sender.communicationUserId,TimeStamp:Z.createdOn.toISOString(),ChatMessageId:Z.id});const se=yield s(Z,ie);se&&(Ue.logEvent(Fe.INFO,{Event:Le.ACS_ADAPTER_POST_FILE_ACTIVITY,Description:"ACS Adapter: Post file attachment activity, messageId: "+se.messageid,MessageSender:Z.sender.communicationUserId,TimeStamp:Z.createdOn.toISOString(),ChatMessageId:Z.id}),G(se))}))}),y=()=>We(this,void 0,void 0,function*(){const m=t(ye.EventManager);m==null||m.addEventListener("webchat-status-connected",()=>We(this,void 0,void 0,function*(){for(Tde();Xd.length>0;){const R=Xd.pop();Ede(t,R),ZS(R,t,G,"ACS Adapter: Post activity, paged history message with Id: ")}for(;v.length>0;){const R=v.pop();kde(t,R),LD(R,x,ne);const Z="ACS Adapter: Post activity, history messageId: "+R.id;ZS(R,t,G,Z)}for(;P.length>0;){const R=P.pop();M$(R)?(Ode(R),ru(R.participantsAdded,kr.PARTICIPANT_JOINED,t,G)):D$(R)?(Mde(R),ru(R.participantsRemoved,kr.PARTICIPANT_LEFT,t,G)):"message"in R&&(Pde(R),yield k(R))}}))}),k=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){if(Ue.logEvent(Fe.DEBUG,{Event:Le.MESSAGE_RECEIVED,Description:`ACS Adapter: Received a message with id ${m.id}`,MessageSender:m.sender.communicationUserId,TimeStamp:m.createdOn.toISOString(),ChatThreadId:m.threadId,ChatMessageId:m.id}),ne||(ne=t(ye.FileManager)),t(ye.WebChatStatus)!==_r.Connected){Ue.logEvent(Fe.INFO,{Event:Le.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new message",TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId),ChatMessageId:m.id}),P.push(m);return}if(Bg(x,m,t,ne,Le.ACS_PROCESSING_NEW_MESSAGE)){Ue.logEvent(Fe.INFO,{Event:Le.ACS_SKIP_NEW_MESSAGE,Description:"ACS Adapter: Skipping RTN message, already processed",MessageSender:m.sender.communicationUserId,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ChatMessageId:m.id});return}const Z=yield o(m);Z&&G(Z)}}),Y=m=>We(this,void 0,void 0,function*(){if(sc(m.sender)!==t(ye.UserId)&&m.threadId===t(ye.ThreadId)){Ue.logEvent(Fe.DEBUG,{Event:Le.TYPING_MESSAGE_RECEIVED,Description:"ACS Adapter: Received a typing message",MessageSender:m.sender.communicationUserId,TimeStamp:m.receivedOn.toISOString(),ChatThreadId:m.threadId});const Z=yield c(m);G(Z)}}),V=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){Fde(m);const R=Object.assign(Object.assign({},m),{message:""});if(Bg(x,R,t,ne,Le.ACS_PROCESSING_DELETED_MESSAGE)){Lde(m,t);return}const ie=yield _he(m,t);ie&&G(ie)}}),z=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){if(Ude(m),ne||(ne=t(ye.FileManager)),Bg(x,m,t,ne,Le.ACS_PROCESSING_EDITED_MESSAGE)){xde(m,t);return}const Z=yield bhe(m,t);Z&&G(Z)}}),W=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){nde(m),ne||(ne=t(ye.FileManager));const R=x.has(m.id);if(Bg(x,m,t,ne,Le.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK)){rde(m);return}const ie=yield The(m,t,R);ie&&G(ie)}}),le=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){if(t(ye.WebChatStatus)!==_r.Connected){Ade(m),P.push(m);return}if(ode(m),lhe(x,m,t)){bde(t,m);return}ru(m.participantsAdded,kr.PARTICIPANT_JOINED,t,G)}}),re=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){if(t(ye.WebChatStatus)!==_r.Connected){Rde(m),P.push(m);return}if(sde(m),che(x,m,t)){_de(t,m);return}ru(m.participantsRemoved,kr.PARTICIPANT_LEFT,t,G)}}),$=m=>We(this,void 0,void 0,function*(){if(m.threadId===t(ye.ThreadId)){Ue.logEvent(Fe.DEBUG,{Event:Le.THREAD_DELETED_RECEIVED,Description:"ACS Adapter: Received a thread deleted event",ACSRequesterUserId:m.deletedBy.id.communicationUserId,TimeStamp:m.deletedOn.toISOString(),ChatThreadId:m.threadId});const R=yield a(m);G(R)}});return j.on("chatMessageReceived",k),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_NEW_MESSAGE,Description:"ACS Adapter: Registering on new message success"}),j.on("typingIndicatorReceived",Y),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_TYPING_INDICATOR,Description:"ACS Adapter: Registering on typing indicator success"}),j.on("chatMessageEdited",z),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_MESSAGE_EDIT,Description:"ACS Adapter: Registering on message edit success"}),j.on("chatMessageDeleted",V),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_MESSAGE_DELETED,Description:"ACS Adapter: Registering on message delete success"}),j.on("chatThreadDeleted",$),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_THREAD_DELETED,Description:"ACS Adapter: Registering on thread delete success"}),j.on("realTimeNotificationConnected",S),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Registering on realtime notification connected"}),j.on("realTimeNotificationDisconnected",H),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Registering on realtime notification disconnected"}),j.on("streamingChatMessageChunkReceived",W),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:"ACS Adapter: Registering on streaming chat message chunk received"}),K!=null&&K.enableThreadMemberUpdateNotification&&(j.on("participantsAdded",le),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_PARTICIPANT_ADDED,Description:"ACS Adapter: Registering on participant added success"}),j.on("participantsRemoved",re),Ue.logEvent(Fe.DEBUG,{Event:Le.REGISTER_ON_PARTICIPANT_REMOVED,Description:"ACS Adapter: Registering on participant removed success"})),K!=null&&K.enableLeaveThreadOnWindowClosed&&E(),h(q,G),L(),C(),y(),g(q,F),A(F),K.historyPageSizeLimit?(d(p,q,G,void 0,K&&K.historyPageSizeLimit),f(p,q,G,K&&K.historyPageSizeLimit)):(oe&&(Ue.logEvent(Fe.INFO,{Event:Le.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling, if any, at the start "+oe,TimeStamp:new Date().toISOString(),ChatThreadId:t(ye.ThreadId),ACSRequesterUserId:t(ye.UserId)}),clearTimeout(oe)),_(t(ye.PollingInterval),F)),()=>{q.unsubscribed=!0,j.off("chatMessageReceived",k),j.off("typingIndicatorReceived",Y),j.off("chatMessageEdited",z),j.off("chatMessageDeleted",V),j.off("participantsAdded",le),j.off("participantsRemoved",re),j.off("chatThreadDeleted",$),j.off("streamingChatMessageChunkReceived",W)}})),D(w,p)})})}function Rhe(t){const e=t&&t.ingressMiddleware?t.ingressMiddleware:[];return fy(CJ(...e),Ahe())}const khe={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${ja.version}  azsdk-js-communication-chat/${ja.dependencies["@azure/communication-chat"]}`}}};class Phe{static isACSConnected(e,n){var r,i,o,s;return We(this,void 0,void 0,function*(){let a=0;for(;a<5;)try{return!n||!e?(Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:"Trying to reconnect failed as ACS Client is in uninitialized state"}),!1):(yield n.getProperties(khe),!0)}catch(u){a++;const d=(r=u==null?void 0:u.response)===null||r===void 0?void 0:r.status;if(a>=5||d&&this.isNotRetryable(d))return Ue.logEvent(Fe.ERROR,{Event:Le.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:`Trying to reconnect failed with status ${d} after retries ${a}`,ExceptionDetails:u}),Or.notifyErrorEvent({StatusCode:(i=u==null?void 0:u.response)===null||i===void 0?void 0:i.status,ErrorType:ui.ADAPTER_RECONNECT_FAILED,ErrorMessage:u==null?void 0:u.message,ErrorStack:u==null?void 0:u.stack,ErrorDetails:u==null?void 0:u.details,Timestamp:new Date().toISOString(),CorrelationVector:(s=(o=u==null?void 0:u.request)===null||o===void 0?void 0:o.headers)===null||s===void 0?void 0:s.get("ms-cv")}),!1;yield rhe(1e3*Math.pow(2,a))}return!1})}static isNotRetryable(e){return e===401||e===403||e===404}}class Ohe{constructor(e){this.getIsPollingEnabled=()=>this.messagePoller?this.messagePoller.getIsPollingEnabled():!0,this.stopPolling=()=>this.messagePoller?this.messagePoller.stopPolling():!1,this.messagePoller=e}}function Mhe(t,e,n,r,i,o,s,l,c,a,u){return fy(d=>f=>{Ue.setInstance(a),Or.setInstance(s);const h=new Ohe(u.messagePollingHandle),g=d(f),E=new hd;return g.setState(ye.BotId,void 0),g.setState(ye.ChatClient,void 0),g.setState(ye.UserId,void 0),g.setState(ye.AuthConfig,void 0),g.setState(ye.ChatThreadClient,void 0),g.setState(ye.UserDisplayName,void 0),g.setState(ye.ConnectionStatusObserverReady,!1),g.setState(ye.DisconnectUTC,void 0),g.setState(ye.EventManager,E),g.setState(ye.AdapterOptions,u),g.setState(ye.EnvironmentUrl,void 0),g.setState(ye.ThreadId,void 0),g.setState(ye.Token,void 0),g.setState(ye.Reconnect,!1),g.setState(ye.FileManager,void 0),g.setState(ye.PollingInterval,o),g.setState(ye.MessagePollingHandleInstance,h),function(){return We(this,void 0,void 0,function*(){const D=yield zde(t,e,n,r,l,c);g.setState(ye.ThreadId,n),g.setState(ye.ChatClient,D.chatClient),g.setState(ye.ChatThreadClient,D.chatThreadClient),g.setState(ye.UserId,nu.id),g.setState(ye.UserDisplayName,l),g.setState(ye.AuthConfig,nu),g.setState(ye.EnvironmentUrl,r),g.setState(ye.Token,t),g.setState(ye.FileManager,i),g.setReadyState(er.OPEN),E.addEventListener("online",()=>We(this,void 0,void 0,function*(){if(!(yield Phe.isACSConnected(D.chatClient,D.chatThreadClient))){E.handleError(new Error("ACS Chat client could not reconnect"));return}g.setReadyState(er.OPEN),Ue.logEvent(Fe.INFO,{Event:Le.ACS_SDK_RECONNECT,Description:"ACS Adapter: Reconnect to network."})})),E.addEventListener("offline",()=>{g.setReadyState(er.CONNECTING),g.setState(ye.DisconnectUTC,new Date)})})}(),g},Rhe(u),the(u))}class Dhe{constructor(e,n,r){this.accessToken=e,this.downloadUrl=n,this.uploadUrl=r}downloadBlob(e){return We(this,void 0,void 0,function*(){const n=yield fetch(e);if(!n.ok)throw new Error("Failed to fetch file contents.");return yield n.blob()})}downloadDriveItem(e){var n;return We(this,void 0,void 0,function*(){const r=this.downloadUrl(e),i={method:"GET",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}},o=yield fetch(r,i),s=yield o.json();if(!o.ok)throw new Error(`Failed to download drive item from OneDrive: ${(n=s.error)===null||n===void 0?void 0:n.message}`);return s})}downloadDriveItemContents(e){var n;return We(this,void 0,void 0,function*(){const r=yield fetch(e);if(!r.ok){const i=yield r.json();throw new Error(`Failed to download drive item contents from OneDrive: ${(n=i.error)===null||n===void 0?void 0:n.message}`)}return yield r.blob()})}uploadFiles(e){return We(this,void 0,void 0,function*(){return Promise.all(e.map(n=>We(this,void 0,void 0,function*(){const r=yield this.downloadBlob(n.contentUrl),i=this.uploadUrl(n.name),o={method:"PUT",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":n.contentType},body:r},l=yield(yield fetch(i,o)).json();if(l.error)throw new Error(`Failed to upload file to OneDrive. ${l.error.message}`);return{fileId:l.id,metadata:{filename:n.name}}})))})}downloadFiles(e){return We(this,void 0,void 0,function*(){return Promise.all(e.map(n=>We(this,void 0,void 0,function*(){var r,i;const o=yield this.downloadDriveItem(n.fileId),s=o["@microsoft.graph.downloadUrl"],l=yield this.downloadDriveItemContents(s);return n.metadata&&console.log(`File name: ${(r=n.metadata)===null||r===void 0?void 0:r.name}`),new File([l],o.name,{type:(i=o.file)===null||i===void 0?void 0:i.mimeType,lastModified:o.lastModifiedDateTime})})))})}updatePermissions(){return We(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getFileIds(e){if(e!=null&&e.onedriveReferences)try{return JSON.parse(e==null?void 0:e.onedriveReferences)}catch{throw new Error("Failed to parse onedriveReferences in ChatMessage metadata.")}}createFileIdProperty(e){return{onedriveReferences:JSON.stringify(e)}}getFileMetadata(e){if(e!=null&&e.onedriveMetadata)try{return JSON.parse(e==null?void 0:e.onedriveMetadata)}catch{throw new Error("Failed to parse onedriveMetadata in ChatMessage metadata.")}}createFileMetadataProperty(e){return{onedriveMetadata:JSON.stringify(e)}}createBotAttachment(e){if(!e||Object.keys(e).length===0)return null;const n=this.getFileMetadata(e),r=this.getFileIds(e);let i,o;return r&&r.length>0&&(i=r[0]),n&&n.length>0&&(o=n[0]),i?{contentType:o==null?void 0:o.contentType,name:o==null?void 0:o.fileName,content:{uniqueId:i}}:null}}const Nhe=(t,e,n,r,i,o=3e4,s,l,c,a,u)=>(o=o>=5e3?o:5e3,oce(u,fy(Mce(),Mhe(t,e,n,r,i,o,s,l,c,a,u)))),xhe=Object.freeze(Object.defineProperty({__proto__:null,get ActivityType(){return Mi},BOT_ADAPTIVE_CARD_METADATA_KEY:k$,BOT_ADAPTIVE_CARD_METADATA_VALUE:P$,get ChannelDataTypes(){return Nu},DIRECT_LINE_ACTIVITY_ENTITIES_MESSAGE_STREAMING_VALUE:J_,get LogEvent(){return Le},get LogLevel(){return Fe},Logger:Ue,OneDriveFileManager:Dhe,get ReadyState(){return er},get Role(){return Qr},get StateKey(){return ye},createACSAdapter:Nhe},Symbol.toStringTag,{value:"Module"})),Lhe=Hs(xhe);var eA={},Lw=_e&&_e.__assign||function(){return Lw=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Lw.apply(this,arguments)},Uhe=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},Fhe=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(eA,"__esModule",{value:!0});var Bhe=function(){var t=function(){return function(e){return function(n){return Uhe(void 0,void 0,void 0,function(){var r,i,o,s,l,c,a;return Fhe(this,function(u){if(r=n.attachments,i=n.channelData,!r)return[2,e(n)];if(!(!((c=i==null?void 0:i.metadata)===null||c===void 0)&&c.amsreferences)&&(!((a=i==null?void 0:i.metadata)===null||a===void 0)&&a.amsReferences)&&(n.channelData.metadata.amsreferences=i.metadata.amsReferences),o=i.metadata.amsreferences,o)try{s=function(d){var f=window.chatAdapter.fileManager.fileScanner;if(!f)return e(n);var h=f.retrieveFileScanResult(d);if(h){var g=h.scan,E=h.fileMetadata,D=n.attachments.findIndex(function(w){return w.name===E.name});n.channelData.fileScan||(n.channelData.fileScan=[]),n.channelData.fileScan[D]=g}f.addNext(d,e),f.addActivity(d,Lw({},n))},l=JSON.parse(o),l.forEach(function(d){return s(d)})}catch(d){console.error(d)}return[2,e(n)]})})}}};return t};eA.default=Bhe;var tA={};Object.defineProperty(tA,"__esModule",{value:!0});var $he=function(){var t=function(){return function(e){return function(n){var r=JSON.parse(JSON.stringify(n));if(r&&r.channelData&&r.channelData.tags){var i=r.channelData.tags;if(typeof i=="string")return e(n);if(i instanceof Array)r.channelData.tags=i.toString();else if(typeof r.channelData.tags=="object")try{r.channelData.tags=JSON.stringify(i)}catch(o){console.error(o)}}return e(r)}}};return t};tA.default=$he;var nA={};Object.defineProperty(nA,"__esModule",{value:!0});var Hhe=function(){var t=function(){return function(e){return function(n){var r=JSON.parse(JSON.stringify(n));if(r&&r.channelData&&r.channelData.tags){var i=r.channelData.tags;if(typeof i=="string")try{r.channelData.tags=JSON.parse(i)}catch{r.channelData.tags=i.split(",")}}return e(r)}}};return t};nA.default=Hhe;var ep={};(function(t){var e=_e&&_e.__assign||function(){return e=Object.assign||function(J){for(var X,B=1,q=arguments.length;B<q;B++){X=arguments[B];for(var F in X)Object.prototype.hasOwnProperty.call(X,F)&&(J[F]=X[F])}return J},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.throwAuthContactIdNotFoundFailure=t.throwLiveChatTranscriptRetrievalFailure=t.throwChatAdapterInitializationFailure=t.throwMessagingClientConversationJoinFailure=t.throwMessagingClientInitializationFailure=t.throwConversationClosureFailure=t.throwConversationInitializationFailure=t.throwWidgetUseOutsideOperatingHour=t.throwPersistentChatConversationRetrievalFailure=t.throwAuthenticatedChatConversationRetrievalFailure=t.throwClosedConversation=t.throwInvalidConversation=t.throwChatTokenRetrievalFailure=t.throwUninitializedChatSDK=t.throwMessagingClientCreationFailure=t.throwUnsupportedLiveChatVersionFailure=t.throwChatConfigRetrievalFailure=t.throwOmnichannelClientInitializationFailure=t.throwFeatureDisabled=t.throwUnsupportedPlatform=t.throwScriptLoadFailure=t.throwAMSLoadFailure=t.throwChatSDKError=void 0;var n=Us,r=function(J,X,B,q,F,x){var P,v;F===void 0&&(F={});var T={response:J};if(X)if(typeof X=="object"&&X!==null&&"response"in X){var _=X,N=_.message,I=_.code,A=_.response;T.errorObject=JSON.stringify({status:A==null?void 0:A.status,headers:A==null?void 0:A.headers,data:A==null?void 0:A.data,message:N,code:I})}else T.errorObject=String(X);throw x&&(T.message=x,console.error(x)),B.failScenario(q,e(e({},F),{ExceptionDetails:JSON.stringify(T)})),new n.ChatSDKError(J,X!=null&&X.isAxiosError&&(!((P=X==null?void 0:X.response)===null||P===void 0)&&P.status)?(v=X==null?void 0:X.response)===null||v===void 0?void 0:v.status:void 0,T)};t.throwChatSDKError=r;var i=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.AttachmentClientNotLoaded,void 0,J,X,{},B)};t.throwAMSLoadFailure=i;var o=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ScriptLoadFailure,J,X,B)};t.throwScriptLoadFailure=o;var s=function(J,X,B,q){q===void 0&&(q={}),(0,t.throwChatSDKError)(n.ChatSDKErrorName.UnsupportedPlatform,void 0,J,X,q,B)};t.throwUnsupportedPlatform=s;var l=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.FeatureDisabled,void 0,J,X,{},B)};t.throwFeatureDisabled=l;var c=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.OmnichannelClientInitializationFailure,J,X,B)};t.throwOmnichannelClientInitializationFailure=c;var a=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ChatConfigRetrievalFailure,J,X,B)};t.throwChatConfigRetrievalFailure=a;var u=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.UnsupportedLiveChatVersion,J,X,B)};t.throwUnsupportedLiveChatVersionFailure=u;var d=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.MessagingClientCreationFailure,J,X,B)};t.throwMessagingClientCreationFailure=d;var f=function(J,X){(0,t.throwChatSDKError)(n.ChatSDKErrorName.UninitializedChatSDK,void 0,J,X)};t.throwUninitializedChatSDK=f;var h=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ChatTokenRetrievalFailure,J,X,B,q)};t.throwChatTokenRetrievalFailure=h;var g=function(J,X,B){var q="Conversation not found";(0,t.throwChatSDKError)(n.ChatSDKErrorName.InvalidConversation,void 0,J,X,B,q)};t.throwInvalidConversation=g;var E=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ClosedConversation,void 0,J,X,B)};t.throwClosedConversation=E;var D=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.AuthenticatedChatConversationRetrievalFailure,J,X,B,q)};t.throwAuthenticatedChatConversationRetrievalFailure=D;var w=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.PersistentChatConversationRetrievalFailure,J,X,B,q)};t.throwPersistentChatConversationRetrievalFailure=w;var p=function(J,X,B,q){var F="Widget used outside of operating hours";(0,t.throwChatSDKError)(n.ChatSDKErrorName.WidgetUseOutsideOperatingHour,J,X,B,q,F)};t.throwWidgetUseOutsideOperatingHour=p;var b=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ConversationInitializationFailure,J,X,B,q)};t.throwConversationInitializationFailure=b;var j=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ConversationClosureFailure,J,X,B,q)};t.throwConversationClosureFailure=j;var K=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.MessagingClientInitializationFailure,J,X,B,q)};t.throwMessagingClientInitializationFailure=K;var M=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.MessagingClientConversationJoinFailure,J,X,B,q)};t.throwMessagingClientConversationJoinFailure=M;var ne=function(J,X,B){(0,t.throwChatSDKError)(n.ChatSDKErrorName.ChatAdapterInitializationFailure,J,X,B)};t.throwChatAdapterInitializationFailure=ne;var G=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,J,X,B,q)};t.throwLiveChatTranscriptRetrievalFailure=G;var oe=function(J,X,B,q){(0,t.throwChatSDKError)(n.ChatSDKErrorName.AuthContactIdNotFoundFailure,J,X,B,q)};t.throwAuthContactIdNotFoundFailure=oe,t.default={throwChatSDKError:t.throwChatSDKError,throwScriptLoadFailure:t.throwScriptLoadFailure,throwUnsupportedPlatform:t.throwUnsupportedPlatform,throwFeatureDisabled:t.throwFeatureDisabled,throwOmnichannelClientInitializationFailure:t.throwOmnichannelClientInitializationFailure,throwUnsupportedLiveChatVersionFailure:t.throwUnsupportedLiveChatVersionFailure,throwChatConfigRetrievalFailure:t.throwChatConfigRetrievalFailure,throwMessagingClientCreationFailure:t.throwMessagingClientCreationFailure,throwUninitializedChatSDK:t.throwUninitializedChatSDK,throwChatTokenRetrievalFailure:t.throwChatTokenRetrievalFailure,throwInvalidConversation:t.throwInvalidConversation,throwClosedConversation:t.throwClosedConversation,throwAuthenticatedChatConversationRetrievalFailure:t.throwAuthenticatedChatConversationRetrievalFailure,throwPersistentChatConversationRetrievalFailure:t.throwPersistentChatConversationRetrievalFailure,throwWidgetUseOutsideOperatingHour:t.throwWidgetUseOutsideOperatingHour,throwConversationInitializationFailure:t.throwConversationInitializationFailure,throwConversationClosureFailure:t.throwConversationClosureFailure,throwMessagingClientInitializationFailure:t.throwMessagingClientInitializationFailure,throwMessagingClientConversationJoinFailure:t.throwMessagingClientConversationJoinFailure,throwChatAdapterInitializationFailure:t.throwChatAdapterInitializationFailure,throwLiveChatTranscriptRetrievalFailure:t.throwLiveChatTranscriptRetrievalFailure,throwAuthContactIdNotFoundFailure:t.throwAuthContactIdNotFoundFailure}})(ep);var Va={},zy={};Object.defineProperty(zy,"__esModule",{value:!0});var qhe="IC3",jhe="DirectLine",Vhe="ACS";zy.default={IC3:qhe,DirectLine:jhe,ACS:Vhe};var Mo={},fr={};Object.defineProperty(fr,"__esModule",{value:!0});fr.callingBundleVersion=fr.ariaTelemetryKey=fr.webChatDirectLineVersion=fr.webChatACSAdapterVersion=fr.webChatIC3AdapterVersion=fr.ic3ClientVersion=void 0;var zhe="2021.08.14.1";fr.ic3ClientVersion=zhe;var Ghe="0.1.0-master.2dba07b";fr.webChatIC3AdapterVersion=Ghe;var Whe="0.0.35-beta.20";fr.webChatACSAdapterVersion=Whe;var Khe="0.15.1";fr.webChatDirectLineVersion=Khe;var Jhe="1.0.20240809-2";fr.callingBundleVersion=Jhe;var Qhe="c7655518acf1403f93ff6b9f77942f0a-d01a02fd-6b50-4de3-a566-62eda11f93bc-7083";fr.ariaTelemetryKey=Qhe;Object.defineProperty(Mo,"__esModule",{value:!0});Mo.getDirectLineCDNUrl=Mo.getACSAdapterCDNUrl=Mo.getIC3AdapterCDNUrl=Mo.getIC3ClientCDNUrl=void 0;var Gy=fr,F$=function(t){t===void 0&&(t=Gy.ic3ClientVersion);var e="https://comms.omnichannelengagementhub.com/release/".concat(t,"/Scripts/SDK/SDK.min.js");return e};Mo.getIC3ClientCDNUrl=F$;var B$=function(t){t===void 0&&(t=Gy.webChatIC3AdapterVersion);var e="https://webchatic3.blob.core.windows.net/webchat-ic3adapter/".concat(t,"/botframework-webchat-adapter-ic3.production.min.js");return e};Mo.getIC3AdapterCDNUrl=B$;var $$=function(t){t===void 0&&(t=Gy.webChatACSAdapterVersion);var e="https://unpkg.com/acs_webchat-chat-adapter@".concat(t,"/dist/chat-adapter.js");return e};Mo.getACSAdapterCDNUrl=$$;var H$=function(t){t===void 0&&(t=Gy.webChatDirectLineVersion);var e="https://unpkg.com/botframework-directlinejs@".concat(t,"/dist/directline.js");return e};Mo.getDirectLineCDNUrl=H$;Mo.default={getIC3ClientCDNUrl:F$,getIC3AdapterCDNUrl:B$,getACSAdapterCDNUrl:$$,getDirectLineCDNUrl:H$};Object.defineProperty(Va,"__esModule",{value:!0});Va.resolveChatAdapterUrl=Va.resolveIC3ClientUrl=void 0;var HD=il,Rc=zy,za=Mo,q$=function(t){return t.ic3Config&&"ic3ClientCDNUrl"in t.ic3Config?t.ic3Config.ic3ClientCDNUrl:t.ic3Config&&"ic3ClientVersion"in t.ic3Config?za.default.getIC3ClientCDNUrl(t.ic3Config.ic3ClientVersion):za.default.getIC3ClientCDNUrl()};Va.resolveIC3ClientUrl=q$;var Xhe=function(t){return t.chatAdapterConfig&&"webChatDirectLineCDNUrl"in t.chatAdapterConfig?t.chatAdapterConfig.webChatDirectLineCDNUrl:t.chatAdapterConfig&&"webChatDirectLineVersion"in t.chatAdapterConfig?za.default.getDirectLineCDNUrl(t.chatAdapterConfig.webChatDirectLineVersion):za.default.getDirectLineCDNUrl()},Yhe=function(t){return t.chatAdapterConfig&&"webChatACSAdapterCDNUrl"in t.chatAdapterConfig?t.chatAdapterConfig.webChatACSAdapterCDNUrl:t.chatAdapterConfig&&"webChatACSAdapterVersion"in t.chatAdapterConfig?za.default.getACSAdapterCDNUrl(t.chatAdapterConfig.webChatACSAdapterVersion):za.default.getACSAdapterCDNUrl()},Zhe=function(t){return t.chatAdapterConfig&&"webChatIC3AdapterCDNUrl"in t.chatAdapterConfig?t.chatAdapterConfig.webChatIC3AdapterCDNUrl:t.chatAdapterConfig&&"webChatIC3AdapterVersion"in t.chatAdapterConfig?za.default.getIC3AdapterCDNUrl(t.chatAdapterConfig.webChatIC3AdapterVersion):za.default.getIC3AdapterCDNUrl()},j$=function(t,e,n){var r=[Rc.default.ACS,Rc.default.IC3,Rc.default.DirectLine];if(n&&!r.includes(n))throw new Error("ChatAdapter for protocol ".concat(n," currently not supported"));return n===Rc.default.DirectLine?Xhe(t):n===Rc.default.ACS||e===HD.default.V2?Yhe(t):n===Rc.default.IC3||e===HD.default.V1?Zhe(t):""};Va.resolveChatAdapterUrl=j$;Va.default={resolveIC3ClientUrl:q$,resolveChatAdapterUrl:j$};var Ol=_e&&_e.__assign||function(){return Ol=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ol.apply(this,arguments)},rA=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},iA=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},pl=_e&&_e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ms,"__esModule",{value:!0});Ms.createIC3Adapter=Ms.createACSAdapter=Ms.createDirectLine=void 0;var efe=Gu,tfe=Af,Do=Vs,V$=Uo,nfe=t_,rfe=Lhe,ife=eA,ofe=tA,sfe=nA,uf=ep,Uw=Va,z$=function(t,e,n,r,i,o){return rA(void 0,void 0,void 0,function(){var s,l,c,a,u;return iA(this,function(d){switch(d.label){case 0:s=t.DirectLine?t.DirectLine.options:{},l=Uw.default.resolveChatAdapterUrl(e,n,r),i==null||i.setCDNPackages({DirectLine:l}),o.startScenario(Do.default.CreateDirectLine),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,V$.default.loadScript(l)];case 2:return d.sent(),[3,4];case 3:return c=d.sent(),uf.default.throwScriptLoadFailure(c,o,Do.default.CreateDirectLine),[3,4];case 4:try{return a=window.DirectLine,u=new a.DirectLine(Ol({},s)),o.completeScenario(Do.default.CreateDirectLine),[2,u]}catch(f){uf.default.throwChatAdapterInitializationFailure(f,o,Do.default.CreateDirectLine)}return[2]}})})};Ms.createDirectLine=z$;var G$=function(t,e,n,r,i,o,s,l,c,a,u){return rA(void 0,void 0,void 0,function(){var d,f,h,g,E,D,w,p,b,j,K,M,ne;return iA(this,function(G){d=t.ACSAdapter,f=d?d.options:{},h=[(0,nfe.default)({widgetId:s.widgetId}),(0,ofe.default)()],g=[(0,sfe.default)()],((K=d==null?void 0:d.fileScan)===null||K===void 0?void 0:K.disabled)===!1&&(g=pl([(0,ife.default)()],g,!0)),E={notifyErrorEvent:function(oe){var J;u.logEvent(tfe.default.ERROR,Ol({},oe)),d!=null&&d.errorEventSubscriber&&((J=d==null?void 0:d.errorEventSubscriber)===null||J===void 0||J.notifyErrorEvent(oe))}},D=f!=null&&f.egressMiddleware?pl(pl([],f.egressMiddleware,!0),h,!0):pl([],h,!0),w=f!=null&&f.ingressMiddleware?pl(pl([],f.ingressMiddleware,!0),g,!0):pl([],g,!0),p=Ol(Ol({enableAdaptiveCards:!0,enableThreadMemberUpdateNotification:!0,enableLeaveThreadOnWindowClosed:!1,enableSenderDisplayNameInTypingNotification:!0},f),{ingressMiddleware:w,egressMiddleware:D}),o.startScenario(Do.default.CreateACSAdapter);try{return b=(0,rfe.createACSAdapter)(l.token,l.visitorId||"teamsvisitor",l.chatId,l.acsEndpoint,c,3e4,E,efe.default.Customer,a,u,p),o.completeScenario(Do.default.CreateACSAdapter),((ne=(M=t.ACSAdapter)===null||M===void 0?void 0:M.fileScan)===null||ne===void 0?void 0:ne.disabled)===!1&&(b.end&&(j=b.end,b.end=function(){b.fileManager.fileScanner.end(),j()}),window.chatAdapter=b),[2,b]}catch(oe){uf.default.throwChatAdapterInitializationFailure(oe,o,Do.default.CreateACSAdapter)}return[2]})})};Ms.createACSAdapter=G$;var W$=function(t,e,n,r,i,o,s,l,c){return rA(void 0,void 0,void 0,function(){var a,u,d,f,h;return iA(this,function(g){switch(g.label){case 0:a=t.IC3Adapter?t.IC3Adapter.options:{},u=Uw.default.resolveChatAdapterUrl(e,n,r),i==null||i.setCDNPackages({IC3Adapter:u}),o.startScenario(Do.default.CreateIC3Adapter),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,V$.default.loadScript(u)];case 2:return g.sent(),[3,4];case 3:return d=g.sent(),uf.default.throwScriptLoadFailure(d,o,Do.default.CreateACSAdapter),[3,4];case 4:f=Ol({chatToken:s,userDisplayName:"Customer",userId:s.visitorId||"teamsvisitor",sdkURL:Uw.default.resolveIC3ClientUrl(e),sdk:l},a);try{return h=new window.Microsoft.BotFramework.WebChat.IC3Adapter(f),h.logger=c,o.completeScenario(Do.default.CreateIC3Adapter),[2,h]}catch(E){uf.default.throwChatAdapterInitializationFailure(E,o,Do.default.CreateIC3Adapter)}return[2]}})})};Ms.createIC3Adapter=W$;Ms.default={createDirectLine:z$,createACSAdapter:G$,createIC3Adapter:W$};var K$={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCoreServicesOrgUrl=t.createCoreServicesOrgUrl=t.getCoreServicesGeoName=t.nonProductionDynamicsLocationCode=t.unqOrgUrlPattern=t.coreServicesOrgUrlPrefix=t.CoreServicesGeoNamesMapping=void 0,t.CoreServicesGeoNamesMapping={crm:"us",crm2:"br",crm3:"ca",crm4:"eu",crm5:"as",crm6:"au",crm7:"jp",crm8:"in",crm9:"gov",crm10:"preprod",crm11:"uk",crm12:"fr",crm14:"za",crm15:"ae",crm16:"de",crm17:"ch",crm19:"no",crm20:"sg",crm21:"kr",crm22:"se",crmtest:"test"},t.coreServicesOrgUrlPrefix="https://m-",t.unqOrgUrlPattern=/http[s]*:\/\/[\w-]*-(crmtest|crm[\d]*).[\w.]*/,t.nonProductionDynamicsLocationCode=["crm10","crmtest"];var e=function(i){var o;return(o=t.CoreServicesGeoNamesMapping[i])!==null&&o!==void 0?o:""};t.getCoreServicesGeoName=e;var n=function(i,o){var s="omnichannelengagementhub.com";return o==="gov"&&(s="omnichannelengagementhub.us"),"https://m-".concat(i,".").concat(o,".").concat(s)};t.createCoreServicesOrgUrl=n;var r=function(i){return i.startsWith(t.coreServicesOrgUrlPrefix)};t.isCoreServicesOrgUrl=r})(K$);var J$={},tp={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNative=t.isNode=t.isBrowser=void 0;var e=function(){return typeof window<"u"&&typeof window.document<"u"};t.isBrowser=e;var n=function(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null};t.isNode=n;var r=function(){return typeof navigator<"u"&&navigator.product=="ReactNative"};t.isReactNative=r,t.default={isBrowser:t.isBrowser,isNode:t.isNode,isReactNative:t.isReactNative}})(tp);const afe="0.1.11",Fw={version:afe};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveRegionBasedUrl=t.isRegionBasedUrlVersionSupported=t.isRegionBasedUrlSupported=t.shouldUseFramedMode=t.isUrlWhitelisted=t.regionBasedUrlSupportedVersions=t.regionBasedSupportedUrls=t.whitelistedUrls=void 0;var e=tp;t.whitelistedUrls=["https://oc-cdn-ppe2.azureedge.net","https://oc-cdn-public.azureedge.net","https://oc-cdn-public-sam.azureedge.net","https://oc-cdn-ocuae-uae.azureedge.net","https://oc-cdn-ocfra-fra.azureedge.net","https://oc-cdn-public-ger.azureedge.net","https://oc-cdn-public-che.azureedge.net","https://oc-cdn-public-ind.azureedge.net","https://oc-cdn-public-gbr.azureedge.net","https://oc-cdn-public-apj.azureedge.net","https://oc-cdn-public-oce.azureedge.net","https://oc-cdn-public-jpn.azureedge.net","https://oc-cdn-public-eur.azureedge.net","https://oc-cdn-ocprod.azureedge.net","https://ocprodocprodnamgs.blob.core.usgovcloudapi.net"],t.regionBasedSupportedUrls=["https://oc-cdn-ppe2.azureedge.net","https://oc-cdn-public.azureedge.net","https://oc-cdn-public-sam.azureedge.net","https://oc-cdn-ocuae-uae.azureedge.net","https://oc-cdn-ocfra-fra.azureedge.net","https://oc-cdn-public-ger.azureedge.net","https://oc-cdn-public-che.azureedge.net","https://oc-cdn-public-ind.azureedge.net","https://oc-cdn-public-gbr.azureedge.net","https://oc-cdn-public-apj.azureedge.net","https://oc-cdn-public-oce.azureedge.net","https://oc-cdn-public-jpn.azureedge.net","https://oc-cdn-public-eur.azureedge.net","https://oc-cdn-ocprod.azureedge.net","https://ocprodocprodnamgs.blob.core.usgovcloudapi.net"],t.regionBasedUrlSupportedVersions=["0.1.8","0.1.9","0.1.10"];var n=function(l){return t.whitelistedUrls.includes(l)};t.isUrlWhitelisted=n;var r=function(l){if(l===void 0&&(l=!0),(0,e.isBrowser)()&&l===!1){var c=window.location.origin||"";return!(0,t.isUrlWhitelisted)(c)}return(0,e.isBrowser)()};t.shouldUseFramedMode=r;var i=function(l){return t.regionBasedSupportedUrls.includes(l)};t.isRegionBasedUrlSupported=i;var o=function(){var l=Fw.version;return t.regionBasedUrlSupportedVersions.includes(l)};t.isRegionBasedUrlVersionSupported=o;var s=function(l){var c=(0,t.isRegionBasedUrlSupported)(l),a=(0,t.isRegionBasedUrlVersionSupported)();if((0,e.isBrowser)()&&l&&c&&a){var u="".concat(l,"/livechatwidget/v2scripts/ams");return u}return""};t.retrieveRegionBasedUrl=s})(J$);var np={};Object.defineProperty(np,"__esModule",{value:!0});np.defaultChatSDKConfig=void 0;var lfe=fr,Cv={dataMasking:{disable:!1,maskingCharacter:"#"},telemetry:{disable:!1,ariaTelemetryKey:lfe.ariaTelemetryKey},persistentChat:{disable:!0,tokenUpdateTime:216e5},chatReconnect:{disable:!0},useCreateConversation:{disable:!1}};np.defaultChatSDKConfig=Cv;var cfe=function(t){typeof t.disable!="boolean"&&(t.disable=Cv.dataMasking.disable),(typeof t.maskingCharacter!="string"||t.maskingCharacter.length!==1)&&(t.maskingCharacter=Cv.dataMasking.maskingCharacter)},ufe=function(t){(typeof t.tokenUpdateTime!="number"||!t.tokenUpdateTime)&&(t.tokenUpdateTime=Cv.persistentChat.tokenUpdateTime)},dfe=function(t){t.dataMasking&&cfe(t.dataMasking),t.persistentChat&&ufe(t.persistentChat)};np.default=dfe;var Wy={};Object.defineProperty(Wy,"__esModule",{value:!0});Wy.AMSClientLoadStates=void 0;var qD;(function(t){t.LOADING="LOADING",t.LOADED="LOADED",t.ERROR="ERROR",t.NOT_LOADED="NOT_LOADED"})(qD||(Wy.AMSClientLoadStates=qD={}));var kc={},Hg={},Q$={};(function(t){var e=_e&&_e.__awaiter||function(s,l,c,a){function u(d){return d instanceof c?d:new c(function(f){f(d)})}return new(c||(c=Promise))(function(d,f){function h(D){try{E(a.next(D))}catch(w){f(w)}}function g(D){try{E(a.throw(D))}catch(w){f(w)}}function E(D){D.done?d(D.value):u(D.value).then(h,g)}E((a=a.apply(s,l||[])).next())})},n=_e&&_e.__generator||function(s,l){var c={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},a,u,d,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=h(0),f.throw=h(1),f.return=h(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function h(E){return function(D){return g([E,D])}}function g(E){if(a)throw new TypeError("Generator is already executing.");for(;f&&(f=0,E[0]&&(c=0)),c;)try{if(a=1,u&&(d=E[0]&2?u.return:E[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,E[1])).done)return d;switch(u=0,d&&(E=[E[0]&2,d.value]),E[0]){case 0:case 1:d=E;break;case 4:return c.label++,{value:E[1],done:!1};case 5:c.label++,u=E[1],E=[0];continue;case 7:E=c.ops.pop(),c.trys.pop();continue;default:if(d=c.trys,!(d=d.length>0&&d[d.length-1])&&(E[0]===6||E[0]===2)){c=0;continue}if(E[0]===3&&(!d||E[1]>d[0]&&E[1]<d[3])){c.label=E[1];break}if(E[0]===6&&c.label<d[1]){c.label=d[1],d=E;break}if(d&&c.label<d[2]){c.label=d[2],c.ops.push(E);break}d[2]&&c.ops.pop(),c.trys.pop();continue}E=l.call(s,c)}catch(D){E=[6,D],u=0}finally{a=d=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAttachmentSizes=t.getAttachments=t.getDataURL=void 0;var r=function(s){return e(void 0,void 0,void 0,function(){return n(this,function(l){return[2,new Promise(function(c){var a=new FileReader;a.onloadend=function(){c(a.result)},a.readAsDataURL(s)})]})})};t.getDataURL=r;var i=function(s){return e(void 0,void 0,void 0,function(){return n(this,function(l){return[2,Promise.all(s.map(function(c){return e(void 0,void 0,void 0,function(){var a;return n(this,function(u){switch(u.label){case 0:return c?[4,(0,t.getDataURL)(c)]:[3,2];case 1:return a=u.sent(),[2,{contentType:c.type,contentUrl:a,name:c.name,thumbnailUrl:c.type.match("(image|video|audio).*")?a:void 0}];case 2:return[2]}})})}))]})})};t.getAttachments=i;var o=function(s){return s.map(function(l){return l.size})};t.getAttachmentSizes=o,t.default={getDataURL:t.getDataURL,getAttachments:t.getAttachments,getAttachmentSizes:t.getAttachmentSizes}})(Q$);var jD;function hfe(){if(jD)return Hg;jD=1;var t=_e&&_e.__assign||function(){return t=Object.assign||function(a){for(var u,d=1,f=arguments.length;d<f;d++){u=arguments[d];for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(a[h]=u[h])}return a},t.apply(this,arguments)},e=_e&&_e.__awaiter||function(a,u,d,f){function h(g){return g instanceof d?g:new d(function(E){E(g)})}return new(d||(d=Promise))(function(g,E){function D(b){try{p(f.next(b))}catch(j){E(j)}}function w(b){try{p(f.throw(b))}catch(j){E(j)}}function p(b){b.done?g(b.value):h(b.value).then(D,w)}p((f=f.apply(a,u||[])).next())})},n=_e&&_e.__generator||function(a,u){var d={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},f,h,g,E=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return E.next=D(0),E.throw=D(1),E.return=D(2),typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function D(p){return function(b){return w([p,b])}}function w(p){if(f)throw new TypeError("Generator is already executing.");for(;E&&(E=0,p[0]&&(d=0)),d;)try{if(f=1,h&&(g=p[0]&2?h.return:p[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,p[1])).done)return g;switch(h=0,g&&(p=[p[0]&2,g.value]),p[0]){case 0:case 1:g=p;break;case 4:return d.label++,{value:p[1],done:!1};case 5:d.label++,h=p[1],p=[0];continue;case 7:p=d.ops.pop(),d.trys.pop();continue;default:if(g=d.trys,!(g=g.length>0&&g[g.length-1])&&(p[0]===6||p[0]===2)){d=0;continue}if(p[0]===3&&(!g||p[1]>g[0]&&p[1]<g[3])){d.label=p[1];break}if(p[0]===6&&d.label<g[1]){d.label=g[1],g=p;break}if(g&&d.label<g[2]){d.label=g[2],d.ops.push(p);break}g[2]&&d.ops.pop(),d.trys.pop();continue}p=u.call(a,d)}catch(b){p=[6,b],h=0}finally{f=g=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};Object.defineProperty(Hg,"__esModule",{value:!0});var r=X$(),i=Uo,o=Q$,s=7*1e3,l=1e3,c=function(){function a(u,d){d===void 0&&(d={}),this.scanResults=null,this.amsClient=u,this.scanResults=new Map,this.shouldQueueScan=!1,this.test=!1,this.options=d,this.queueScan()}return a.prototype.queueScan=function(){return e(this,void 0,void 0,function(){var u,d,f;return n(this,function(h){switch(h.label){case 0:this.shouldQueueScan=!0,h.label=1;case 1:return h.trys.push([1,3,4,8]),[4,this.scanFiles()];case 2:return h.sent(),[3,8];case 3:return u=h.sent(),console.error(u),[3,8];case 4:return[4,i.default.sleep(((f=this.options)===null||f===void 0?void 0:f.pollingInterval)||s)];case 5:return h.sent(),d=this.shouldQueueScan&&!this.test,d?[4,this.queueScan()]:[3,7];case 6:d=h.sent(),h.label=7;case 7:return[7];case 8:return[2]}})})},a.prototype.retrieveFileScanResult=function(u){var d;return(d=this.scanResults)===null||d===void 0?void 0:d.get(u)},a.prototype.addOrUpdateFile=function(u,d,f){var h,g=this.retrieveFileScanResult(u);(h=this.scanResults)===null||h===void 0||h.set(u,t(t({},g||{}),{fileMetadata:d,scan:f}))},a.prototype.addNext=function(u,d){var f,h,g=(f=this.scanResults)===null||f===void 0?void 0:f.get(u);g&&((h=this.scanResults)===null||h===void 0||h.set(u,t(t({},g),{next:d})))},a.prototype.addActivity=function(u,d){var f,h,g=(f=this.scanResults)===null||f===void 0?void 0:f.get(u);g&&((h=this.scanResults)===null||h===void 0||h.set(u,t(t({},g),{activity:d})))},a.prototype.scanFileCallback=function(u,d){return e(this,void 0,void 0,function(){var f,h,g,E,D,w,p,b,j;return n(this,function(K){switch(K.label){case 0:if(f=u.fileMetadata,h=u.next,g=u.activity,E=u.scan,(E==null?void 0:E.status)!==r.AMSViewScanStatus.INPROGRESS)return[3,10];K.label=1;case 1:return K.trys.push([1,7,,8]),[4,this.amsClient.getViewStatus(f)];case 2:return D=K.sent(),w=D.view_location,p=D.scan,this.addOrUpdateFile(d,u.fileMetadata,p),p.status===r.AMSViewScanStatus.PASSED&&h&&g?[4,this.renderAttachmentActivity(u,w)]:[3,4];case 3:K.sent(),K.label=4;case 4:return p.status===r.AMSViewScanStatus.MALWARE&&h&&g?[4,this.renderMalwareActivity(u)]:[3,6];case 5:K.sent(),K.label=6;case 6:return[3,8];case 7:return b=K.sent(),console.error(b),[3,8];case 8:return[4,i.default.sleep(((j=this.options)===null||j===void 0?void 0:j.scanStatusRetrievalDelay)||l)];case 9:K.sent(),K.label=10;case 10:return[2]}})})},a.prototype.scanFiles=function(){var u=this;return new Promise(function(d){return e(u,void 0,void 0,function(){var f=this,h;return n(this,function(g){return(h=this.scanResults)===null||h===void 0||h.forEach(function(E,D){return e(f,void 0,void 0,function(){return n(this,function(w){switch(w.label){case 0:return[4,this.scanFileCallback(E,D)];case 1:return w.sent(),[2]}})})}),d(),[2]})})})},a.prototype.end=function(){this.shouldQueueScan=!1},a.prototype.retrieveFileBlob=function(u,d){return e(this,void 0,void 0,function(){var f,h;return n(this,function(g){switch(g.label){case 0:return g.trys.push([0,2,,3]),[4,this.amsClient.getView(u,d)];case 1:return f=g.sent(),[3,3];case 2:return h=g.sent(),console.error(h),[3,3];case 3:return[2,f]}})})},a.prototype.addAttachmentToActivity=function(u,d){return e(this,void 0,void 0,function(){var f,h,g;return n(this,function(E){switch(E.label){case 0:return[4,o.default.getAttachments([d])];case 1:return f=E.sent(),[4,o.default.getAttachmentSizes([d])];case 2:return h=E.sent(),g=u.attachments.findIndex(function(D){return D.name===d.name}),u.attachments[g]=f[0],u.channelData.attachmentSizes[g]=h[0],[2]}})})},a.prototype.renderAttachmentActivity=function(u,d){return e(this,void 0,void 0,function(){var f,h,g,E,D,w,p,b,j,K=this;return n(this,function(M){switch(M.label){case 0:return f=u.fileMetadata,h=u.next,g=u.activity,[4,this.retrieveFileBlob(f,d)];case 1:return E=M.sent(),D=new File([E],f.name,{type:f.type}),[4,this.addAttachmentToActivity(g,D)];case 2:return M.sent(),w=g.attachments.findIndex(function(ne){return ne.name===D.name}),g.channelData.fileScan[w]={status:r.AMSViewScanStatus.PASSED},p=w>0,p&&(b=g.channelData.metadata.amsreferences,j=JSON.parse(b),j.forEach(function(ne){K.addActivity(ne,g)})),h(g),[2]}})})},a.prototype.renderMalwareActivity=function(u){return e(this,void 0,void 0,function(){var d,f,h,g;return n(this,function(E){return d=u.fileMetadata,f=u.next,h=u.activity,g=h.attachments.findIndex(function(D){return D.name===d.name}),h.channelData.fileScan[g]={status:r.AMSViewScanStatus.MALWARE},f(h),[2]})})},a}();return Hg.default=c,Hg}var VD;function X$(){if(VD)return kc;VD=1;var t=_e&&_e.__assign||function(){return t=Object.assign||function(a){for(var u,d=1,f=arguments.length;d<f;d++){u=arguments[d];for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(a[h]=u[h])}return a},t.apply(this,arguments)},e=_e&&_e.__awaiter||function(a,u,d,f){function h(g){return g instanceof d?g:new d(function(E){E(g)})}return new(d||(d=Promise))(function(g,E){function D(b){try{p(f.next(b))}catch(j){E(j)}}function w(b){try{p(f.throw(b))}catch(j){E(j)}}function p(b){b.done?g(b.value):h(b.value).then(D,w)}p((f=f.apply(a,u||[])).next())})},n=_e&&_e.__generator||function(a,u){var d={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},f,h,g,E=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return E.next=D(0),E.throw=D(1),E.return=D(2),typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function D(p){return function(b){return w([p,b])}}function w(p){if(f)throw new TypeError("Generator is already executing.");for(;E&&(E=0,p[0]&&(d=0)),d;)try{if(f=1,h&&(g=p[0]&2?h.return:p[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,p[1])).done)return g;switch(h=0,g&&(p=[p[0]&2,g.value]),p[0]){case 0:case 1:g=p;break;case 4:return d.label++,{value:p[1],done:!1};case 5:d.label++,h=p[1],p=[0];continue;case 7:p=d.ops.pop(),d.trys.pop();continue;default:if(g=d.trys,!(g=g.length>0&&g[g.length-1])&&(p[0]===6||p[0]===2)){d=0;continue}if(p[0]===3&&(!g||p[1]>g[0]&&p[1]<g[3])){d.label=p[1];break}if(p[0]===6&&d.label<g[1]){d.label=g[1],g=p;break}if(g&&d.label<g[2]){d.label=g[2],d.ops.push(p);break}g[2]&&d.ops.pop(),d.trys.pop();continue}p=u.call(a,d)}catch(b){p=[6,b],h=0}finally{f=g=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};Object.defineProperty(kc,"__esModule",{value:!0}),kc.AMSViewScanStatus=void 0;var r=hfe(),i;(function(a){a[a.READ=0]="READ",a[a.WRITE=1]="WRITE"})(i||(i={}));var o;(function(a){a.AMSUpload="AMSUpload",a.AMSDownload="AMSDownload",a.GetFileIds="GetFileIds",a.CreateFileIdProperty="CreateFileIdProperty",a.GetFileMetadata="GetFileMetadata",a.CreateFileMetadataProperty="CreateFileMetadataProperty"})(o||(o={}));var s;(function(a){a.PASSED="passed",a.MALWARE="malware",a.INPROGRESS="in progress"})(s||(kc.AMSViewScanStatus=s={}));var l=["image/jpeg","image/png","image/gif","image/heic","image/webp"],c=function(){function a(u,d,f){d===void 0&&(d=null),f===void 0&&(f={});var h;if(this.supportedImagesMimeTypes=l,this.logger=d,this.amsClient=u,this.options=f,this.omnichannelChatToken=null,((h=this.options.fileScan)===null||h===void 0?void 0:h.disabled)===!1){var g=t({},this.options.fileScan);this.fileScanner=new r.default(this.amsClient,g)}}return a.prototype.uploadFiles=function(u){return e(this,void 0,void 0,function(){var d=this;return n(this,function(f){return[2,Promise.all(u.map(function(h){return e(d,void 0,void 0,function(){return n(this,function(g){return[2,this.uploadFileToAMS(h)]})})}))]})})},a.prototype.downloadFiles=function(u){return e(this,void 0,void 0,function(){var d=this;return n(this,function(f){return[2,Promise.all(u.map(function(h){return e(d,void 0,void 0,function(){return n(this,function(g){return[2,this.downloadFileFromAMS(h)]})})}))]})})},a.prototype.updatePermissions=function(){return e(this,void 0,void 0,function(){return n(this,function(u){return[2,void 0]})})},a.prototype.getFileIds=function(u){var d,f,h;if(u&&!(!u.amsReferences&&!u.amsreferences)){(d=this.logger)===null||d===void 0||d.startScenario(o.GetFileIds);try{var g=void 0;return u!=null&&u.amsReferences&&(g=JSON.parse(u==null?void 0:u.amsReferences)),u!=null&&u.amsreferences&&(g=JSON.parse(u==null?void 0:u.amsreferences)),(f=this.logger)===null||f===void 0||f.completeScenario(o.GetFileIds),g}catch(D){var E={metadata:"".concat(u),errorObject:"".concat(D)};(h=this.logger)===null||h===void 0||h.failScenario(o.GetFileIds,{ExceptionDetails:JSON.stringify(E)});return}}},a.prototype.createFileIdProperty=function(u){var d,f,h;if(u){(d=this.logger)===null||d===void 0||d.startScenario(o.CreateFileIdProperty);try{var g={amsReferences:JSON.stringify(u),amsreferences:JSON.stringify(u)};return(f=this.logger)===null||f===void 0||f.completeScenario(o.CreateFileIdProperty),g}catch(D){var E={fileIds:"".concat(u),errorObject:"".concat(D)};(h=this.logger)===null||h===void 0||h.failScenario(o.CreateFileIdProperty,{ExceptionDetails:JSON.stringify(E)});return}}},a.prototype.getFileMetadata=function(u){var d,f,h;if(!(!u||!u.amsMetadata)){(d=this.logger)===null||d===void 0||d.startScenario(o.GetFileMetadata);try{var g=JSON.parse(u==null?void 0:u.amsMetadata);return(f=this.logger)===null||f===void 0||f.completeScenario(o.GetFileMetadata),g}catch(D){var E={metadata:"".concat(u),errorObject:"".concat(D)};(h=this.logger)===null||h===void 0||h.failScenario(o.GetFileMetadata,{ExceptionDetails:JSON.stringify(E)});return}}},a.prototype.createFileMetadataProperty=function(u){var d,f,h;if(u){(d=this.logger)===null||d===void 0||d.startScenario(o.CreateFileMetadataProperty);try{var g={amsMetadata:JSON.stringify(u)};return(f=this.logger)===null||f===void 0||f.completeScenario(o.CreateFileMetadataProperty),g}catch(D){var E={metadata:"".concat(u),errorObject:"".concat(D)};(h=this.logger)===null||h===void 0||h.failScenario(o.CreateFileMetadataProperty,{ExceptionDetails:JSON.stringify(E)});return}}},a.prototype.createBotAttachment=function(u){return!u||Object.keys(u).length===0,null},a.prototype.uploadFileToAMS=function(u){return e(this,void 0,void 0,function(){var d,f,w,h,g,E,w,D,w,p,b,j,K,M;return n(this,function(ne){switch(ne.label){case 0:if((p=this.logger)===null||p===void 0||p.startScenario(o.AMSUpload),!(u.contentUrl&&u.name))return[3,12];d=void 0,ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,this.amsClient.fetchBlob(u.contentUrl)];case 2:return d=ne.sent(),[3,4];case 3:throw f=ne.sent(),w={response:"AMSFetchBlobFailure",errorObject:"".concat(f)},(b=this.logger)===null||b===void 0||b.failScenario(o.AMSUpload,{ExceptionDetails:JSON.stringify(w)}),f;case 4:h=new File([d],u.name,{type:u.contentType}),g=void 0,ne.label=5;case 5:return ne.trys.push([5,7,,8]),[4,this.amsClient.createObject(this.amsClient.chatToken.chatId,h,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 6:return g=ne.sent(),[3,8];case 7:throw E=ne.sent(),w={response:"AMSCreateObjectFailure",errorObject:"".concat(E)},(j=this.logger)===null||j===void 0||j.failScenario(o.AMSUpload,{ExceptionDetails:JSON.stringify(w)}),E;case 8:return ne.trys.push([8,10,,11]),[4,this.amsClient.uploadDocument(g.id,h,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 9:return ne.sent(),[3,11];case 10:throw D=ne.sent(),w={response:"AMSUploadDocumentFailure",errorObject:"".concat(D)},(K=this.logger)===null||K===void 0||K.failScenario(o.AMSUpload,{ExceptionDetails:JSON.stringify(w)}),D;case 11:return(M=this.logger)===null||M===void 0||M.completeScenario(o.AMSUpload),[2,{fileId:g.id,metadata:{contentType:u.contentType,fileName:u.name}}];case 12:return[2]}})})},a.prototype.downloadFileFromAMS=function(u){return e(this,void 0,void 0,function(){var d,f,h,b,g,E,D,w,b,p,b,j,K,M,ne,G,oe,J;return n(this,function(X){switch(X.label){case 0:if((K=this.logger)===null||K===void 0||K.startScenario(o.AMSDownload),!(u.fileId&&u.metadata&&u.metadata.fileName))return[3,9];d={id:u.fileId,type:u.metadata.contentType,name:u.metadata.fileName},f=void 0,X.label=1;case 1:return X.trys.push([1,3,,4]),[4,this.amsClient.getViewStatus(d,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 2:return f=X.sent(),[3,4];case 3:return h=X.sent(),b={response:"AMSGetViewStatusFailure",errorObject:"".concat(h)},(M=this.logger)===null||M===void 0||M.failScenario(o.AMSDownload,{ExceptionDetails:JSON.stringify(b)}),[2,void 0];case 4:if(g=void 0,E=f.view_location,D=f.scan,((ne=this.options.fileScan)===null||ne===void 0?void 0:ne.disabled)===!1&&D&&(D==null?void 0:D.status)!==s.PASSED)return w=new File([g],u.metadata.fileName,{type:u.metadata.contentType}),b={response:"InvalidFileScanResult"},this.fileScanner.addOrUpdateFile(d.id,d,D),(G=this.logger)===null||G===void 0||G.failScenario(o.AMSDownload,{ExceptionDetails:JSON.stringify(b)}),[2,w];X.label=5;case 5:return X.trys.push([5,7,,8]),[4,this.amsClient.getView(d,E,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 6:return g=X.sent(),[3,8];case 7:return p=X.sent(),b={response:"AMSGetViewFailure",errorObject:"".concat(p)},(oe=this.logger)===null||oe===void 0||oe.failScenario(o.AMSDownload,{ExceptionDetails:JSON.stringify(b)}),[2,void 0];case 8:return j=new File([g],u.metadata.fileName,{type:u.metadata.contentType}),(J=this.logger)===null||J===void 0||J.completeScenario(o.AMSDownload),[2,j];case 9:return[2]}})})},a}();return kc.default=c,kc}var oA={};Object.defineProperty(oA,"__esModule",{value:!0});var Bw;(function(t){t[t.NoCalling=19235e4]="NoCalling",t[t.VideoAndVoiceCalling=192350001]="VideoAndVoiceCalling",t[t.VoiceOnly=192350002]="VoiceOnly"})(Bw||(Bw={}));oA.default=Bw;var sA={};Object.defineProperty(sA,"__esModule",{value:!0});var $w;(function(t){t[t.LiveChat=19235e4]="LiveChat",t[t.PersistentChat=192350001]="PersistentChat"})($w||($w={}));sA.default=$w;var aA={};Object.defineProperty(aA,"__esModule",{value:!0});var Hw;(function(t){t.Active="Active",t.Closed="Closed",t.Open="Open",t.Waiting="Waiting",t.WrapUp="WrapUp"})(Hw||(Hw={}));aA.default=Hw;var lA={};Object.defineProperty(lA,"__esModule",{value:!0});var qw;(function(t){t[t.WidgetUseOutsideOperatingHour=705]="WidgetUseOutsideOperatingHour",t[t.WidgetNotFound=701]="WidgetNotFound"})(qw||(qw={}));lA.default=qw;var Ky={};Object.defineProperty(Ky,"__esModule",{value:!0});Ky.SurveyProvider=void 0;var zD;(function(t){t[t.CustomerVoice=60099e4]="CustomerVoice",t[t.MicrosoftCopilotStudio=600990001]="MicrosoftCopilotStudio"})(zD||(Ky.SurveyProvider=zD={}));var cA={},uA={},dA={},jw=_e&&_e.__assign||function(){return jw=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},jw.apply(this,arguments)};Object.defineProperty(dA,"__esModule",{value:!0});var ffe=function(){function t(e){this.debug=!1,this.debug=!1,this.logger=e}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.log=function(e,n,r){var i,o=jw({Event:n},r);this.debug&&console.log(o),(i=this.logger)===null||i===void 0||i.logClientSdkTelemetryEvent(e,o)},t}();dA.default=ffe;var hA={},Jy={};Jy.baseUrl="https://comms.omnichannelengagementhub.com/ams";Jy.sdkVersion="0.1.11";var fA={};Object.defineProperty(fA,"__esModule",{value:!0});var Vw;(function(t){t.Setup="FramedClientSetup",t.Initialize="FramedClientInitialize",t.LoadIframe="FramedClientLoadIframe"})(Vw||(Vw={}));fA.default=Vw;var rp={};Object.defineProperty(rp,"__esModule",{value:!0});var pfe=function(){function t(){}return t.silentError=!0,t.debug=!1,t}();rp.default=pfe;var Qy={};Object.defineProperty(Qy,"__esModule",{value:!0});var zw;(function(t){t.IframeLoaded="AMSIframeLoaded",t.SkypeTokenAuth="AMSSkypeTokenAuth",t.CreateObject="AMSCreateObject",t.UploadDocument="AMSUploadDocument",t.GetViewStatus="AMSGetViewStatus",t.GetView="AMSGetView",t.SendTelemetry="AMSSendTelemetry"})(zw||(zw={}));Qy.default=zw;var pA={};Object.defineProperty(pA,"__esModule",{value:!0});var Gw;(function(t){t.None="None",t.Success="Success",t.Failure="Failure"})(Gw||(Gw={}));pA.default=Gw;var gA={};Object.defineProperty(gA,"__esModule",{value:!0});var Ww;(function(t){t.None="None",t.Request="Request",t.Response="Response"})(Ww||(Ww={}));gA.default=Ww;var mA={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNative=t.isNode=t.isBrowser=void 0;var e=function(){return typeof window<"u"&&typeof window.document<"u"};t.isBrowser=e;var n=function(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null};t.isNode=n;var r=function(){return typeof navigator<"u"&&navigator.product=="ReactNative"};t.isReactNative=r,t.default={isBrowser:t.isBrowser,isNode:t.isNode,isReactNative:t.isReactNative}})(mA);var Xy={},vA={};Object.defineProperty(vA,"__esModule",{value:!0});var Kw;(function(t){t.INFO="INFO",t.DEBUG="DEBUG",t.WARN="WARN",t.ERROR="ERROR",t.LOG="LOG"})(Kw||(Kw={}));vA.default=Kw;var La={};Object.defineProperty(La,"__esModule",{value:!0});La.failEvent=La.completeEvent=La.startEvent=void 0;var gfe=function(t){return t+"Started"};La.startEvent=gfe;var mfe=function(t){return t+"Completed"};La.completeEvent=mfe;var vfe=function(t){return t+"Failed"};La.failEvent=vfe;var yA={};Object.defineProperty(yA,"__esModule",{value:!0});var yfe=function(){function t(){}return t.prototype.start=function(){this.timeStart=new Date().getTime()},t.prototype.stop=function(){return new Date().getTime()-this.timeStart},t}();yA.default=yfe;var Fh=_e&&_e.__assign||function(){return Fh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Fh.apply(this,arguments)};Object.defineProperty(Xy,"__esModule",{value:!0});var tT=vA,Cfe=Jy,nT=La,Sfe=yA,Tfe=function(){function t(e){this.runtimeId="",this.sdkVersion="",this.logger=e,this.sdkVersion=Cfe.sdkVersion,this.telemetryEvents=new Map}return t.prototype.setRuntimeId=function(e){this.runtimeId=e},t.prototype.startScenario=function(e,n){if(n===void 0&&(n={}),!this.telemetryEvents.has(e)){var r=new Sfe.default;r.start(),this.telemetryEvents.set(e,r)}var i=Fh({AMSClientRuntimeId:this.runtimeId,Event:nT.startEvent(e),AMSClientVersion:this.sdkVersion},n);this.logger.log(tT.default.INFO,e,i)},t.prototype.failScenario=function(e,n){if(n===void 0&&(n={}),!this.telemetryEvents.has(e)){console.warn("'"+e+"' event has not started.");return}var r=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var i=Fh({AMSClientRuntimeId:this.runtimeId,Event:nT.failEvent(e),AMSClientVersion:this.sdkVersion,ElapsedTimeInMilliseconds:r.stop()},n);this.logger.log(tT.default.ERROR,e,i)},t.prototype.completeScenario=function(e,n){if(n===void 0&&(n={}),!this.telemetryEvents.has(e)){console.warn("'"+e+"' event has not started.");return}var r=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var i=Fh({AMSClientRuntimeId:this.runtimeId,Event:nT.completeEvent(e),AMSClientVersion:this.sdkVersion,ElapsedTimeInMilliseconds:r.stop()},n);this.logger.log(tT.default.INFO,e,i)},t}();Xy.default=Tfe;var ip={};Object.defineProperty(ip,"__esModule",{value:!0});ip.uuidv4=void 0;var Efe=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})};ip.uuidv4=Efe;(function(t){var e=_e&&_e.__assign||function(){return e=Object.assign||function(w){for(var p,b=1,j=arguments.length;b<j;b++){p=arguments[b];for(var K in p)Object.prototype.hasOwnProperty.call(p,K)&&(w[K]=p[K])}return w},e.apply(this,arguments)},n=_e&&_e.__awaiter||function(w,p,b,j){function K(M){return M instanceof b?M:new b(function(ne){ne(M)})}return new(b||(b=Promise))(function(M,ne){function G(X){try{J(j.next(X))}catch(B){ne(B)}}function oe(X){try{J(j.throw(X))}catch(B){ne(B)}}function J(X){X.done?M(X.value):K(X.value).then(G,oe)}J((j=j.apply(w,p||[])).next())})},r=_e&&_e.__generator||function(w,p){var b={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},j,K,M,ne;return ne={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(ne[Symbol.iterator]=function(){return this}),ne;function G(J){return function(X){return oe([J,X])}}function oe(J){if(j)throw new TypeError("Generator is already executing.");for(;b;)try{if(j=1,K&&(M=J[0]&2?K.return:J[0]?K.throw||((M=K.return)&&M.call(K),0):K.next)&&!(M=M.call(K,J[1])).done)return M;switch(K=0,M&&(J=[J[0]&2,M.value]),J[0]){case 0:case 1:M=J;break;case 4:return b.label++,{value:J[1],done:!1};case 5:b.label++,K=J[1],J=[0];continue;case 7:J=b.ops.pop(),b.trys.pop();continue;default:if(M=b.trys,!(M=M.length>0&&M[M.length-1])&&(J[0]===6||J[0]===2)){b=0;continue}if(J[0]===3&&(!M||J[1]>M[0]&&J[1]<M[3])){b.label=J[1];break}if(J[0]===6&&b.label<M[1]){b.label=M[1],M=J;break}if(M&&b.label<M[2]){b.label=M[2],b.ops.push(J);break}M[2]&&b.ops.pop(),b.trys.pop();continue}J=p.call(w,b)}catch(X){J=[6,X],K=0}finally{j=M=0}if(J[0]&5)throw J[1];return{value:J[0]?J[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadIframeState=void 0;var i=Jy,o=fA,s=rp,l=Qy,c=pA,a=gA,u=mA,d=Xy,f=ip,h;(function(w){w[w.Loading=0]="Loading",w[w.Loaded=1]="Loaded",w[w.Failed=2]="Failed",w[w.NotLoaded=3]="NotLoaded"})(h=t.LoadIframeState||(t.LoadIframeState={}));var g=i.sdkVersion,E="Microsoft_Omnichannel_AMSClient_Iframe_Window",D=function(){function w(p,b){p===void 0&&(p=void 0),b===void 0&&(b=void 0),this.runtimeId=f.uuidv4(),this.baseUrl=i.baseUrl,this.clientId=f.uuidv4(),this.origin=window.location.origin,this.requestCallbacks={},this.debug=!1,this.loadIframeState=h.NotLoaded,this.logger=p,this.iframeId=E,this.logger&&(this.scenarioMarker=new d.default(this.logger)),b&&b.baseUrl&&(this.baseUrl=b.baseUrl),b&&b.multiClient&&(this.iframeId=this.clientId)}return w.prototype.setDebug=function(p){this.debug=p},w.prototype.setup=function(){var p,b,j;return n(this,void 0,void 0,function(){var K,M=this;return r(this,function(ne){switch(ne.label){case 0:if((p=this.scenarioMarker)===null||p===void 0||p.startScenario(o.default.Setup,{AMSClientRuntimeId:this.runtimeId}),this.debug&&console.log("[FramedClient][setup]"),this.debug&&console.time("ams:setup"),this.onMessageEvent(function(G){return M.handleEvent(G)}),!u.default.isBrowser())throw new Error("FramedMode was used in non-Web platform");return this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:ne.sent(),ne.label=2;case 2:return(b=this.scenarioMarker)===null||b===void 0||b.completeScenario(o.default.Setup,{AMSClientRuntimeId:this.runtimeId}),this.debug&&console.timeEnd("ams:setup"),this.loadIframeState===h.Failed&&(!s.default.silentError&&console.error("iframe not loaded"),K={Reason:"LoadIframeFailed",Message:"iframe not loaded"},(j=this.scenarioMarker)===null||j===void 0||j.failScenario(o.default.Setup,{AMSClientRuntimeId:this.runtimeId,ExceptionDetails:JSON.stringify(K)})),[2]}})})},w.prototype.initialize=function(p){var b,j,K,M;return n(this,void 0,void 0,function(){return r(this,function(ne){return this.chatToken=p.chatToken,(b=this.scenarioMarker)===null||b===void 0||b.startScenario(o.default.Initialize,{AMSClientRuntimeId:this.runtimeId,ChatId:(j=this.chatToken)===null||j===void 0?void 0:j.chatId}),this.debug&&console.log("[FramedClient][initialize]"),this.debug&&console.time("ams:initialize"),this.skypeTokenAuth(),this.debug&&console.timeEnd("ams:initialize"),(K=this.scenarioMarker)===null||K===void 0||K.completeScenario(o.default.Initialize,{AMSClientRuntimeId:this.runtimeId,ChatId:(M=this.chatToken)===null||M===void 0?void 0:M.chatId}),[2]})})},w.prototype.skypeTokenAuth=function(p){return p===void 0&&(p=null),n(this,void 0,void 0,function(){var b,j=this;return r(this,function(K){switch(K.label){case 0:return this.debug&&console.log("[FramedClient][skypeAuth]"),this.debug&&console.time("ams:skypeTokenAuth"),b={chatToken:p||this.chatToken},this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:K.sent(),K.label=2;case 2:return this.debug&&console.timeEnd("ams:skypeTokenAuth"),[2,new Promise(function(M,ne){j.postMessage(a.default.Request,l.default.SkypeTokenAuth,b,M,ne)})]}})})},w.prototype.createObject=function(p,b,j,K){return j===void 0&&(j=null),K===void 0&&(K=[]),n(this,void 0,void 0,function(){var M,ne=this;return r(this,function(G){switch(G.label){case 0:return this.debug&&console.log("[FramedClient][createObject]"),this.debug&&console.time("ams:createObject"),M={id:p,file:b,chatToken:j||this.chatToken,supportedImagesMimeTypes:K},this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:G.sent(),G.label=2;case 2:return this.debug&&console.timeEnd("ams:createObject"),[2,new Promise(function(oe,J){ne.postMessage(a.default.Request,l.default.CreateObject,M,oe,J)})]}})})},w.prototype.uploadDocument=function(p,b,j,K){return j===void 0&&(j=null),K===void 0&&(K=[]),n(this,void 0,void 0,function(){var M,ne=this;return r(this,function(G){switch(G.label){case 0:return this.debug&&console.log("[FramedClient][uploadDocument]"),this.debug&&console.time("ams:uploadDocument"),M={documentId:p,file:b,chatToken:j||this.chatToken,supportedImagesMimeTypes:K},this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:G.sent(),G.label=2;case 2:return this.debug&&console.timeEnd("ams:uploadDocument"),[2,new Promise(function(oe,J){ne.postMessage(a.default.Request,l.default.UploadDocument,M,oe,J)})]}})})},w.prototype.getViewStatus=function(p,b,j){return b===void 0&&(b=null),j===void 0&&(j=[]),n(this,void 0,void 0,function(){var K,M=this;return r(this,function(ne){switch(ne.label){case 0:return this.debug&&console.log("[FramedClient][getViewStatus]"),this.debug&&console.time("ams:getViewStatus"),K={fileMetadata:p,chatToken:b||this.chatToken,supportedImagesMimeTypes:j},this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:ne.sent(),ne.label=2;case 2:return this.debug&&console.timeEnd("ams:getViewStatus"),[2,new Promise(function(G,oe){M.postMessage(a.default.Request,l.default.GetViewStatus,K,G,oe)})]}})})},w.prototype.getView=function(p,b,j,K){return j===void 0&&(j=null),K===void 0&&(K=[]),n(this,void 0,void 0,function(){var M,ne=this;return r(this,function(G){switch(G.label){case 0:return this.debug&&console.log("[FramedClient][getView]"),this.debug&&console.time("ams:getView"),M={fileMetadata:p,viewLocation:b,chatToken:j||this.chatToken,supportedImagesMimeTypes:K},this.loadIframeState!==h.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:G.sent(),G.label=2;case 2:return this.debug&&console.timeEnd("ams:getView"),[2,new Promise(function(oe,J){ne.postMessage(a.default.Request,l.default.GetView,M,oe,J)})]}})})},w.prototype.fetchBlob=function(p){return n(this,void 0,void 0,function(){var b,j,K;return r(this,function(M){switch(M.label){case 0:return M.trys.push([0,3,,4]),[4,fetch(p)];case 1:return b=M.sent(),[4,b.blob()];case 2:return j=M.sent(),[2,j];case 3:throw K=M.sent(),!s.default.silentError&&console.log(K),new Error("fetchBlob");case 4:return[2]}})})},w.prototype.onMessageEvent=function(p){window.addEventListener("message",p,!0)},w.prototype.postMessage=function(p,b,j,K,M){j===void 0&&(j={}),K===void 0&&(K=function(G){return{}}),M===void 0&&(M=function(G){return{}});var ne=f.uuidv4();if(this.requestCallbacks[ne]={resolve:K,reject:M},!this.targetWindow){!s.default.silentError&&console.error("Target window not found!");return}this.targetWindow.postMessage(e({runtimeId:this.runtimeId,clientId:this.clientId,requestId:ne,eventType:p,eventName:b},j),this.baseUrl)},w.prototype.handleEvent=function(p){var b;return n(this,void 0,void 0,function(){var j;return r(this,function(K){return p.origin!==this.origin&&!this.baseUrl.includes(p.origin)?[2]:p.data.clientId!==this.clientId?[2]:(this.debug&&console.log(p),p.source&&(this.targetWindow=p.source),p.data.eventType===a.default.Response&&(this.debug&&console.log("[FramedClient][Response]"),j=p.data,p.data.eventName===l.default.SkypeTokenAuth?j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].resolve(),delete this.requestCallbacks[j.requestId]):p.data.eventName===l.default.CreateObject?j.eventStatus===c.default.Success?j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].resolve(j.response),delete this.requestCallbacks[j.requestId]):j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].reject(),delete this.requestCallbacks[j.requestId]):p.data.eventName===l.default.UploadDocument?j.eventStatus===c.default.Success?j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].resolve(j.response),delete this.requestCallbacks[j.requestId]):j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].reject(),delete this.requestCallbacks[j.requestId]):p.data.eventName===l.default.GetViewStatus?j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].resolve(j.response),delete this.requestCallbacks[j.requestId]):p.data.eventName===l.default.GetView?j.requestId in this.requestCallbacks&&(this.requestCallbacks[j.requestId].resolve(j.response),delete this.requestCallbacks[j.requestId]):p.data.eventName===l.default.SendTelemetry&&((b=this.logger)===null||b===void 0||b.log(j.logLevel,j.logData.Event,j.logData))),[2])})})},w.prototype.dispose=function(){var p;(p=document.getElementById(this.iframeId))===null||p===void 0||p.remove(),this.requestCallbacks={},this.loadIframeState=h.NotLoaded},w.prototype.loadIframe=function(){return n(this,void 0,void 0,function(){var p=this;return r(this,function(b){return[2,new Promise(function(j,K){var M,ne,G;if((M=p.scenarioMarker)===null||M===void 0||M.startScenario(o.default.LoadIframe,{AMSClientRuntimeId:p.runtimeId}),p.debug&&console.log("[FramedClient][loadIframe]"),p.debug&&console.time("ams:loadIframe"),p.loadIframeState===h.Loading||p.loadIframeState===h.Loaded){(ne=p.scenarioMarker)===null||ne===void 0||ne.completeScenario(o.default.LoadIframe,{AMSClientRuntimeId:p.runtimeId}),j();return}var oe=document.getElementById(p.iframeId);if(oe){p.loadIframeState=h.Loaded,(G=p.scenarioMarker)===null||G===void 0||G.completeScenario(o.default.LoadIframe,{AMSClientRuntimeId:p.runtimeId}),j();return}var J=document.createElement("iframe");J.id=p.iframeId,J.src=p.baseUrl+"/"+g+"/iframe.html?clientId="+p.clientId+"&debug="+p.debug+"&telemetry=true",p.loadIframeState=h.Loading,J.addEventListener("load",function(){var X;p.debug&&console.log("iframe loaded!"),p.loadIframeState=h.Loaded,(X=p.scenarioMarker)===null||X===void 0||X.completeScenario(o.default.LoadIframe,{AMSClientRuntimeId:p.runtimeId}),j()}),J.addEventListener("error",function(){var X;p.loadIframeState=h.Failed,(X=p.scenarioMarker)===null||X===void 0||X.failScenario(o.default.LoadIframe,{AMSClientRuntimeId:p.runtimeId}),K()}),document.head.append(J),p.debug&&console.timeEnd("ams:loadIframe")})]})})},w}();t.default=D})(hA);var Yy={},CA={},op={},wfe=_e&&_e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(op,"__esModule",{value:!0});op.AMSError=void 0;var Ife=function(t){wfe(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o.name="AMSError",o.requestUrl=r,o.originalError=i,o}return e}(Error);op.AMSError=Ife;var xu=_e&&_e.__assign||function(){return xu=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},xu.apply(this,arguments)},sp=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},ap=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(CA,"__esModule",{value:!0});var Bo=rp,Ai=op,Lu;(function(t){t.Create="Create",t.Upload="Upload"})(Lu||(Lu={}));var iu;(function(t){t.CreateDocumentType="sharing/file",t.UploadDocumentType="original",t.CreateImageType="pish/image",t.UploadImageType="imgpsh"})(iu||(iu={}));var ao;(function(t){t.Accept="Accept",t.AcceptEncoding="Accept-Encoding",t.BehaviorOverride="BehaviorOverride",t.Authorization="Authorization",t.ClientVersion="X-MS-Client-Version",t.ContentType="Content-Type"})(ao||(ao={}));var Uu;(function(t){t.applicationFormUrlEncoded="application/x-www-form-urlencoded",t.applicationJson="application/json"})(Uu||(Uu={}));var Sv;(function(t){t.Expired="expired",t.Failed="failed",t.InProgress="in progress",t.Malware="malware",t.Ready="ready"})(Sv||(Sv={}));var bfe=["image/jpeg","image/png","image/gif","image/heic","image/webp"],lp=function(t){t.regionGTMS||(t.regionGTMS={ams:"https://us-api.asm.skype.com"})},Zy=function(t){var e;return e={},e[ao.Authorization]="skype_token "+t,e[ao.ClientVersion]="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country=IN; clientName=swc; clientVer=912/0.106.0.34//swc",e},SA=function(t){return t&&t.length>0?t:bfe},Y$=function(t,e,n){var r=SA(n);return r.includes(t.toLowerCase())?e===Lu.Create?iu.CreateImageType:iu.UploadImageType:e===Lu.Create?iu.CreateDocumentType:iu.UploadDocumentType},_fe=function(t){return sp(void 0,void 0,void 0,function(){var e,n,r,i,o,s,l;return ap(this,function(c){switch(c.label){case 0:Bo.default.debug&&console.log("[API][skypeTokenAuth]"),lp(t),e=(t.amsEndpoint||((l=t.regionGTMS)===null||l===void 0?void 0:l.ams))+"/v1/skypetokenauth",n=(s={},s[ao.Authorization]="skype_token "+t.token,s[ao.Accept]=Uu.applicationJson,s[ao.BehaviorOverride]="redirectAs404",s[ao.ContentType]=Uu.applicationFormUrlEncoded,s),r={headers:n,method:"POST",body:"skypetoken="+t.token},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,fetch(e,r)];case 2:if(i=c.sent(),!i.ok)throw new Ai.AMSError("AMSAuth: "+i.status+" "+i.statusText,e);return[2,i];case 3:throw o=c.sent(),!Bo.default.silentError&&console.log(o),o instanceof Ai.AMSError?o:new Ai.AMSError(o.message||"AMSAuth",e,o);case 4:return[2]}})})},Afe=function(t,e,n,r){return sp(void 0,void 0,void 0,function(){var i,o,s,l,c,a,u,d,f,h,g,E;return ap(this,function(D){switch(D.label){case 0:Bo.default.debug&&console.log("[API][createObject]"),i=(h={},h[t]=["read"],h),o=Y$(e.type,Lu.Create,r),s={filename:e.name,permissions:i,type:o},lp(n),l=(n.amsEndpoint||((E=n==null?void 0:n.regionGTMS)===null||E===void 0?void 0:E.ams))+"/v1/objects",c=xu(xu({},Zy(n.token)),(g={},g[ao.ContentType]=Uu.applicationJson,g)),a={headers:c,method:"POST",body:JSON.stringify(s),credentials:"include"},D.label=1;case 1:return D.trys.push([1,4,,5]),[4,fetch(l,a)];case 2:if(u=D.sent(),!u.ok)throw new Ai.AMSError("AMSCreateObjectFailed: "+u.status+" "+u.statusText,l);return[4,u.json()];case 3:return d=D.sent(),[2,d];case 4:throw f=D.sent(),!Bo.default.silentError&&console.log(f),f instanceof Ai.AMSError?f:new Ai.AMSError(f.message||"AMSCreateObjectFailed",l,f);case 5:return[2]}})})},Rfe=function(t,e,n,r){return sp(void 0,void 0,void 0,function(){var i,o,s,l,c,a,u,d,f;return ap(this,function(h){switch(h.label){case 0:Bo.default.debug&&console.log("[API][uploadDocument]"),lp(n),i=Y$(e.type,Lu.Upload,r),o=(n.amsEndpoint||((f=n==null?void 0:n.regionGTMS)===null||f===void 0?void 0:f.ams))+"/v1/objects/"+t+"/content/"+i,s=xu(xu({},Zy(n.token)),(d={},d[ao.ContentType]=Uu.applicationFormUrlEncoded,d)),l={headers:s,method:"PUT",body:e.data?e.data:e},h.label=1;case 1:return h.trys.push([1,3,,4]),[4,fetch(o,l)];case 2:if(c=h.sent(),!c.ok)throw new Ai.AMSError("AMSUploadDocumentFailed: "+c.status+" "+c.statusText,o);return a={name:e.name,size:e.size,type:e.type,id:t,url:o,fileSharingProtocolType:0},[2,a];case 3:throw u=h.sent(),!Bo.default.silentError&&console.log(u),u instanceof Ai.AMSError?u:new Ai.AMSError(u.message||"AMSUploadDocumentFailed",o,u);case 4:return[2]}})})},kfe=function(t,e,n){return sp(void 0,void 0,void 0,function(){var r,i,o,s,l,c,a,u,d,f;return ap(this,function(h){switch(h.label){case 0:Bo.default.debug&&console.log("[API][getViewStatus]"),lp(e),r=(e.amsEndpoint||((f=e==null?void 0:e.regionGTMS)===null||f===void 0?void 0:f.ams))+"/v1/objects/"+t.id+"/views/"+(SA(n).includes(t.type)?"imgpsh_fullsize_anim":"original")+"/status",i=Zy(e.token),o={headers:i,method:"GET"},h.label=1;case 1:return h.trys.push([1,4,,5]),[4,fetch(r,o)];case 2:return s=h.sent(),[4,s.json()];case 3:if(l=h.sent(),c=l.content_state,a=l.view_state,u=l.view_location,!u)throw new Ai.AMSError("view_location is empty",r);if(a&&a!==Sv.Ready.toString()&&!Bo.default.silentError&&console.error("view_state is not ready"),c===Sv.Expired.toString())throw new Ai.AMSError("content_state is expired",r);return[2,l];case 4:throw d=h.sent(),!Bo.default.silentError&&console.log(d),d instanceof Ai.AMSError?d:new Ai.AMSError(d.message||"AMSGetViewStatusFailed",r,d);case 5:return[2]}})})},Pfe=function(t,e,n,r){return sp(void 0,void 0,void 0,function(){var i,o,s,l,c,a;return ap(this,function(u){switch(u.label){case 0:Bo.default.debug&&console.log("[API][getView]"),lp(n),i=e,o=Zy(n.token),SA(r).includes(t.type)&&(o[ao.Accept]="image/webp,image/ *,*/*;q=0.8",o[ao.AcceptEncoding]="gzip, deflate, sdch, br"),s={headers:o,method:"GET"},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(i,s)];case 2:return l=u.sent(),[4,l.blob()];case 3:return c=u.sent(),[2,c];case 4:throw a=u.sent(),!Bo.default.silentError&&console.log(a),new Ai.AMSError(a.message||"AMSGetViewFailed",i,a);case 5:return[2]}})})};CA.default={skypeTokenAuth:_fe,createObject:Afe,uploadDocument:Rfe,getViewStatus:kfe,getView:Pfe};var TA={};Object.defineProperty(TA,"__esModule",{value:!0});var Ofe=function(t){if(!t)return"";var e=t.split(".");if(e.length>2)return"."+e[e.length-1];if(e.length==2){var n=e[0],r=e[1];return!n&&r?"":n&&!r?".":"."+e[e.length-1]}return""};TA.default=Ofe;var oa=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},sa=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(Yy,"__esModule",{value:!0});var Yd=CA,Zd=op,Gr=Qy,Mfe=mA,Dfe=Xy,Nfe=ip,Yi=TA,xfe=function(){function t(e){e===void 0&&(e=void 0),this.runtimeId=Nfe.uuidv4(),this.debug=!1,this.logger=e,Mfe.default.isBrowser()&&console.error("FramedMode should be used on Web platform"),e&&(this.scenarioMarker=new Dfe.default(e),this.scenarioMarker.setRuntimeId(this.runtimeId))}return t.prototype.setDebug=function(e){this.debug=e},t.prototype.setup=function(){return oa(this,void 0,void 0,function(){return sa(this,function(e){return[2,Promise.resolve()]})})},t.prototype.initialize=function(e){return oa(this,void 0,void 0,function(){return sa(this,function(n){switch(n.label){case 0:return this.debug&&console.log("[FramedlessClient][initialize]"),this.chatToken=e.chatToken,[4,this.skypeTokenAuth()];case 1:return n.sent(),[2]}})})},t.prototype.skypeTokenAuth=function(e){var n,r,i,o,s,l,c,a;return e===void 0&&(e=null),oa(this,void 0,void 0,function(){var u,d;return sa(this,function(f){switch(f.label){case 0:(n=this.scenarioMarker)===null||n===void 0||n.startScenario(Gr.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:(r=this.chatToken)===null||r===void 0?void 0:r.chatId}),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Yd.default.skypeTokenAuth(e||this.chatToken)];case 2:return u=f.sent(),u.ok||(i=this.scenarioMarker)===null||i===void 0||i.failScenario(Gr.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:(o=this.chatToken)===null||o===void 0?void 0:o.chatId,ExceptionDetails:{status:u.status}}),(s=this.scenarioMarker)===null||s===void 0||s.completeScenario(Gr.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:(l=this.chatToken)===null||l===void 0?void 0:l.chatId}),[2,u];case 3:throw d=f.sent(),(c=this.scenarioMarker)===null||c===void 0||c.failScenario(Gr.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:(a=this.chatToken)===null||a===void 0?void 0:a.chatId,RequestPath:d instanceof Zd.AMSError?d.requestUrl:"",ExceptionDetails:d instanceof Error?d.message:String(d)}),new Error("skypeTokenAuth");case 4:return[2]}})})},t.prototype.createObject=function(e,n,r,i){var o,s,l,c,a,u;return r===void 0&&(r=null),i===void 0&&(i=[]),oa(this,void 0,void 0,function(){var d,f;return sa(this,function(h){switch(h.label){case 0:(o=this.scenarioMarker)===null||o===void 0||o.startScenario(Gr.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(s=this.chatToken)===null||s===void 0?void 0:s.chatId,MimeType:n.type,FileExtension:Yi.default(n.name)}),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Yd.default.createObject(e,n,r||this.chatToken,i)];case 2:return d=h.sent(),(l=this.scenarioMarker)===null||l===void 0||l.completeScenario(Gr.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(c=this.chatToken)===null||c===void 0?void 0:c.chatId,DocumentId:d==null?void 0:d.id,MimeType:n.type,FileExtension:Yi.default(n.name)}),[2,d];case 3:throw f=h.sent(),(a=this.scenarioMarker)===null||a===void 0||a.failScenario(Gr.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(u=this.chatToken)===null||u===void 0?void 0:u.chatId,RequestPath:f instanceof Zd.AMSError?f.requestUrl:"",MimeType:n.type,FileExtension:Yi.default(n.name),ExceptionDetails:f instanceof Error?f.message:String(f)}),new Error("createObject");case 4:return[2]}})})},t.prototype.uploadDocument=function(e,n,r,i){var o,s,l,c,a,u;return r===void 0&&(r=null),i===void 0&&(i=[]),oa(this,void 0,void 0,function(){var d,f;return sa(this,function(h){switch(h.label){case 0:(o=this.scenarioMarker)===null||o===void 0||o.startScenario(Gr.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(s=this.chatToken)===null||s===void 0?void 0:s.chatId,DocumentId:e,MimeType:n.type,FileExtension:Yi.default(n.name)}),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Yd.default.uploadDocument(e,n,r||this.chatToken,i)];case 2:return d=h.sent(),(l=this.scenarioMarker)===null||l===void 0||l.completeScenario(Gr.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(c=this.chatToken)===null||c===void 0?void 0:c.chatId,DocumentId:e,MimeType:n.type,FileExtension:Yi.default(n.name)}),[2,d];case 3:throw f=h.sent(),(a=this.scenarioMarker)===null||a===void 0||a.failScenario(Gr.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(u=this.chatToken)===null||u===void 0?void 0:u.chatId,RequestPath:f instanceof Zd.AMSError?f.requestUrl:"",DocumentId:e,MimeType:n.type,FileExtension:Yi.default(n.name),ExceptionDetails:f instanceof Error?f.message:String(f)}),new Error("uploadDocument");case 4:return[2]}})})},t.prototype.getViewStatus=function(e,n,r){var i,o,s,l,c,a;return n===void 0&&(n=null),r===void 0&&(r=[]),oa(this,void 0,void 0,function(){var u,d;return sa(this,function(f){switch(f.label){case 0:(i=this.scenarioMarker)===null||i===void 0||i.startScenario(Gr.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:(o=this.chatToken)===null||o===void 0?void 0:o.chatId,DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||"")}),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Yd.default.getViewStatus(e,n||this.chatToken,r)];case 2:return u=f.sent(),(s=this.scenarioMarker)===null||s===void 0||s.completeScenario(Gr.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:(l=this.chatToken)===null||l===void 0?void 0:l.chatId,DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||"")}),[2,u];case 3:throw d=f.sent(),(c=this.scenarioMarker)===null||c===void 0||c.failScenario(Gr.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:(a=this.chatToken)===null||a===void 0?void 0:a.chatId,RequestPath:d instanceof Zd.AMSError?d.requestUrl:"",DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||""),ExceptionDetails:d instanceof Error?d.message:String(d)}),new Error("getViewStatus");case 4:return[2]}})})},t.prototype.getView=function(e,n,r,i){var o,s,l,c,a,u;return r===void 0&&(r=null),i===void 0&&(i=[]),oa(this,void 0,void 0,function(){var d,f;return sa(this,function(h){switch(h.label){case 0:(o=this.scenarioMarker)===null||o===void 0||o.startScenario(Gr.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(s=this.chatToken)===null||s===void 0?void 0:s.chatId,DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||"")}),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Yd.default.getView(e,n,r||this.chatToken,i)];case 2:return d=h.sent(),(l=this.scenarioMarker)===null||l===void 0||l.completeScenario(Gr.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(c=this.chatToken)===null||c===void 0?void 0:c.chatId,DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||"")}),[2,d];case 3:throw f=h.sent(),(a=this.scenarioMarker)===null||a===void 0||a.failScenario(Gr.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:r?r.chatId:(u=this.chatToken)===null||u===void 0?void 0:u.chatId,RequestPath:f instanceof Zd.AMSError?f.requestUrl:"",DocumentId:e==null?void 0:e.id,MimeType:e==null?void 0:e.type,FileExtension:Yi.default((e==null?void 0:e.name)||""),ExceptionDetails:f instanceof Error?f.message:String(f)}),new Error("getView");case 4:return[2]}})})},t.prototype.fetchBlob=function(e){return oa(this,void 0,void 0,function(){var n,r,i;return sa(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch(e)];case 1:return n=o.sent(),[4,n.blob()];case 2:return r=o.sent(),[2,r];case 3:throw i=o.sent(),console.log(i),new Error("fetchBlob");case 4:return[2]}})})},t}();Yy.default=xfe;var Lfe=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},Ufe=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(uA,"__esModule",{value:!0});var Ffe=dA,Bfe=hA,$fe=Yy,GD=rp,Hfe=function(t){return Lfe(void 0,void 0,void 0,function(){var e,n,r;return Ufe(this,function(i){switch(i.label){case 0:return t.debug&&console.log("[createAMSClient] "+(t.framedMode?"FramedClient":"FramedlessClient")),t.debug&&console.time("createAMSClient"),e=new Ffe.default(t.logger),n={multiClient:t.multiClient||!1,baseUrl:t.baseUrl||""},r=t.framedMode?new Bfe.default(e,n):new $fe.default(e),[4,r.setup()];case 1:return i.sent(),t.debug&&r.setDebug(t.debug||!1),GD.default.debug=t.debug||!1,GD.default.silentError=t.silentError||!0,t.debug&&console.timeEnd("createAMSClient"),[2,r]}})})};uA.default=Hfe;Object.defineProperty(cA,"__esModule",{value:!0});var Z$=uA,qfe=Yy,jfe=hA;cA.default=Z$.default;(function(){if(typeof window===void 0)throw new Error("window object not found");"Microsoft"in window||(window.Microsoft={}),"CRM"in window.Microsoft||(window.Microsoft.CRM={}),"Omnichannel"in window.Microsoft.CRM||(window.Microsoft.CRM.Omnichannel={}),"AMSClient"in window.Microsoft.CRM.Omnichannel||(window.Microsoft.CRM.Omnichannel.AMS={SDK:{createAMSClient:Z$.default,FramedClient:jfe.default,FramedlessClient:qfe.default}})})();var EA={},wA={};Object.defineProperty(wA,"__esModule",{value:!0});var Vfe={getChatTokenRetryCount:5,getChatTokenTimeBetweenRetriesOnFailure:2e3,getChatTokenRetryOn429:!0,useUnauthReconnectIdSigQueryParam:!1};wA.default=Vfe;var Jw=_e&&_e.__assign||function(){return Jw=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Jw.apply(this,arguments)};Object.defineProperty(EA,"__esModule",{value:!0});var zfe=wA,Gfe=function(t){var e=Jw({},zfe.default);return t&&(e.useUnauthReconnectIdSigQueryParam=!0),e};EA.default=Gfe;var IA={},bA={},on={},Ni={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unspecified=0]="Unspecified",e[e.String=1]="String",e[e.Int64=2]="Int64",e[e.Double=3]="Double",e[e.Boolean=4]="Boolean",e[e.Date=5]="Date"}(t.AWTPropertyType||(t.AWTPropertyType={})),function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.AWTPiiKind||(t.AWTPiiKind={})),function(e){e[e.NotSet=0]="NotSet",e[e.GenericContent=1]="GenericContent"}(t.AWTCustomerContentKind||(t.AWTCustomerContentKind={})),function(e){e[e.Low=1]="Low",e[e.Normal=2]="Normal",e[e.High=3]="High",e[e.Immediate_sync=5]="Immediate_sync"}(t.AWTEventPriority||(t.AWTEventPriority={})),function(e){e[e.NonRetryableStatus=1]="NonRetryableStatus",e[e.QueueFull=3]="QueueFull",e[e.MaxRetryLimit=4]="MaxRetryLimit"}(t.AWTEventsDroppedReason||(t.AWTEventsDroppedReason={})),function(e){e[e.InvalidEvent=1]="InvalidEvent",e[e.SizeLimitExceeded=2]="SizeLimitExceeded",e[e.KillSwitch=3]="KillSwitch"}(t.AWTEventsRejectedReason||(t.AWTEventsRejectedReason={}))})(Ni);var cp={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.MSACID=1]="MSACID",e[e.MSAPUID=2]="MSAPUID",e[e.ANID=3]="ANID",e[e.OrgIdCID=4]="OrgIdCID",e[e.OrgIdPUID=5]="OrgIdPUID",e[e.UserObjectId=6]="UserObjectId",e[e.Skype=7]="Skype",e[e.Yammer=8]="Yammer",e[e.EmailAddress=9]="EmailAddress",e[e.PhoneNumber=10]="PhoneNumber",e[e.SipAddress=11]="SipAddress",e[e.MUID=12]="MUID"}(t.AWTUserIdType||(t.AWTUserIdType={})),function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended"}(t.AWTSessionState||(t.AWTSessionState={}))})(cp);var fd={};Object.defineProperty(fd,"__esModule",{value:!0});fd.AWT_REAL_TIME="REAL_TIME";fd.AWT_NEAR_REAL_TIME="NEAR_REAL_TIME";fd.AWT_BEST_EFFORT="BEST_EFFORT";var pd={},Js={},sl={};Object.defineProperty(sl,"__esModule",{value:!0});var Wfe=function(){function t(e){this.low=0,this.high=0,this.low=parseInt(e,10),this.low<0&&(this.high=-1)}return t.prototype._Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();sl.Int64=Wfe;var Kfe=function(){function t(e){this.low=0,this.high=0,this.low=parseInt(e,10)}return t.prototype._Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();sl.UInt64=Kfe;var Jfe=function(){function t(){}return t._ToByte=function(e){return this._ToUInt8(e)},t._ToUInt8=function(e){return e&255},t._ToInt32=function(e){var n=e&2147483648;return e&2147483647|n},t._ToUInt32=function(e){return e&4294967295},t}();sl.Number=Jfe;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=sl,n=Ni,r=/[xy]/g,i=621355968e5,o=1e4,s=null;t.EventNameAndTypeRegex=/^[a-zA-Z]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t.EventNameDotRegex=/\./g,t.PropertyNameRegex=/^[a-zA-Z](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,t.StatsApiKey="a387cfcf60114a43a7699f9fbb49289e-9bceb9fe-1c06-460f-96c5-6a0b247358bc-7238";var l=s,c=s,a=s;function u(N){var I=new e.Int64("0");return I.low=N&4294967295,I.high=Math.floor(N/4294967296),I}t.numberToBondInt64=u;function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,function(N){var I=Math.random()*16|0,A=N==="x"?I:I&3|8;return A.toString(16)})}t.newGuid=d;function f(N){return typeof N=="string"}t.isString=f;function h(N){return typeof N=="number"}t.isNumber=h;function g(N){return typeof N=="boolean"}t.isBoolean=g;function E(N){return N instanceof Date}t.isDate=E;function D(N){return(N+i)*o}t.msToTicks=D;function w(N){var I=N.indexOf("-");return I>-1?N.substring(0,I):""}t.getTenantId=w;function p(){return l===s&&(l=typeof navigator<"u"&&!!navigator.sendBeacon),l}t.isBeaconsSupported=p;function b(){return c===s&&(c=typeof Uint8Array<"u"&&!T()&&!oe()),c}t.isUint8ArrayAvailable=b;function j(N){return!!(h(N)&&(N>=1&&N<=3||N===5))}t.isPriority=j;function K(N,I){return!t.PropertyNameRegex.test(N)||_(I)||(_(I.value)&&(I={value:I,type:n.AWTPropertyType.Unspecified}),I.type=q(I.value,I.type),!I.type)||(E(I.value)&&(I.value=D(I.value.getTime())),I.pii>0&&I.cc>0)?s:I.pii?x(I.pii)?I:s:I.cc?P(I.cc)?I:s:I}t.sanitizeProperty=K;function M(N){return N.getUTCFullYear()+"-"+X(N.getUTCMonth()+1)+"-"+X(N.getUTCDate())+"T"+X(N.getUTCHours())+":"+X(N.getUTCMinutes())+":"+X(N.getUTCSeconds())+"."+B(N.getUTCMilliseconds())+"Z"}t.getISOString=M;function ne(){if(a===s){var N=new XMLHttpRequest;typeof N.withCredentials>"u"&&typeof XDomainRequest<"u"?a=!0:a=!1}return a}t.useXDomainRequest=ne;function G(){return oe()||J()}t.useFetchRequest=G;function oe(){return typeof navigator<"u"&&navigator.product?navigator.product==="ReactNative":!1}t.isReactNative=oe;function J(){return typeof self=="object"?self.constructor.name==="ServiceWorkerGlobalScope":!1}t.isServiceWorkerGlobalScope=J;function X(N){return N<10?"0"+N:N.toString()}function B(N){return N<10?"00"+N:N<100?"0"+N:N.toString()}function q(N,I){switch(I=v(I)?I:n.AWTPropertyType.Unspecified,I){case n.AWTPropertyType.Unspecified:return F(N);case n.AWTPropertyType.String:return f(N)?I:s;case n.AWTPropertyType.Boolean:return g(N)?I:s;case n.AWTPropertyType.Date:return E(N)&&N.getTime()!==NaN?I:s;case n.AWTPropertyType.Int64:return h(N)&&N%1===0?I:s;case n.AWTPropertyType.Double:return h(N)?I:s}return s}function F(N){switch(typeof N){case"string":return n.AWTPropertyType.String;case"boolean":return n.AWTPropertyType.Boolean;case"number":return n.AWTPropertyType.Double;case"object":return E(N)?n.AWTPropertyType.Date:s}return s}function x(N){return!!(h(N)&&N>=0&&N<=13)}function P(N){return!!(h(N)&&N>=0&&N<=1)}function v(N){return!!(h(N)&&N>=0&&N<=4)}function T(){if(typeof navigator<"u"&&navigator.userAgent){var N=navigator.userAgent.toLowerCase();if((N.indexOf("safari")>=0||N.indexOf("firefox")>=0)&&N.indexOf("chrome")<0)return!0}return!1}function _(N){return N===void 0||N===s||N===""}})(Js);Object.defineProperty(pd,"__esModule",{value:!0});var rT=Js,gl=Ni,Qfe=function(){function t(e){this._event={name:"",properties:{}},e&&this.setName(e)}return t.prototype.setName=function(e){this._event.name=e},t.prototype.getName=function(){return this._event.name},t.prototype.setType=function(e){this._event.type=e},t.prototype.getType=function(){return this._event.type},t.prototype.setTimestamp=function(e){this._event.timestamp=e},t.prototype.getTimestamp=function(){return this._event.timestamp},t.prototype.setEventPriority=function(e){this._event.priority=e},t.prototype.getEventPriority=function(){return this._event.priority},t.prototype.setProperty=function(e,n,r){r===void 0&&(r=gl.AWTPropertyType.Unspecified);var i={value:n,type:r,pii:gl.AWTPiiKind.NotSet,cc:gl.AWTCustomerContentKind.NotSet};if(i=rT.sanitizeProperty(e,i),i===null){delete this._event.properties[e];return}this._event.properties[e]=i},t.prototype.setPropertyWithPii=function(e,n,r,i){i===void 0&&(i=gl.AWTPropertyType.Unspecified);var o={value:n,type:i,pii:r,cc:gl.AWTCustomerContentKind.NotSet};if(o=rT.sanitizeProperty(e,o),o===null){delete this._event.properties[e];return}this._event.properties[e]=o},t.prototype.setPropertyWithCustomerContent=function(e,n,r,i){i===void 0&&(i=gl.AWTPropertyType.Unspecified);var o={value:n,type:i,pii:gl.AWTPiiKind.NotSet,cc:r};if(o=rT.sanitizeProperty(e,o),o===null){delete this._event.properties[e];return}this._event.properties[e]=o},t.prototype.getPropertyMap=function(){return this._event.properties},t.prototype.getEvent=function(){return this._event},t}();pd.default=Qfe;var qg={},eC={},al={};Object.defineProperty(al,"__esModule",{value:!0});var Xfe=function(){function t(){}return t.addNotificationListener=function(e){this.listeners.push(e)},t.removeNotificationListener=function(e){for(var n=this.listeners.indexOf(e);n>-1;)this.listeners.splice(n,1),n=this.listeners.indexOf(e)},t.eventsSent=function(e){for(var n=this,r=function(s){i.listeners[s].eventsSent&&setTimeout(function(){return n.listeners[s].eventsSent(e)},0)},i=this,o=0;o<this.listeners.length;++o)r(o)},t.eventsDropped=function(e,n){for(var r=this,i=function(l){o.listeners[l].eventsDropped&&setTimeout(function(){return r.listeners[l].eventsDropped(e,n)},0)},o=this,s=0;s<this.listeners.length;++s)i(s)},t.eventsRetrying=function(e){for(var n=this,r=function(s){i.listeners[s].eventsRetrying&&setTimeout(function(){return n.listeners[s].eventsRetrying(e)},0)},i=this,o=0;o<this.listeners.length;++o)r(o)},t.eventsRejected=function(e,n){for(var r=this,i=function(l){o.listeners[l].eventsRejected&&setTimeout(function(){return r.listeners[l].eventsRejected(e,n)},0)},o=this,s=0;s<this.listeners.length;++s)i(s)},t.listeners=[],t}();al.default=Xfe;Object.defineProperty(eC,"__esModule",{value:!0});var WD=Js,Yfe=al,Pc=Ni,KD=6e4,Zfe=function(){function t(){}return t.initialize=function(e){var n=this;this._sendStats=e,this._isInitalized=!0,Yfe.default.addNotificationListener({eventsSent:function(r){n._addStat("records_sent_count",r.length,r[0].apiKey)},eventsDropped:function(r,i){switch(i){case Pc.AWTEventsDroppedReason.NonRetryableStatus:n._addStat("d_send_fail",r.length,r[0].apiKey),n._addStat("records_dropped_count",r.length,r[0].apiKey);break;case Pc.AWTEventsDroppedReason.MaxRetryLimit:n._addStat("d_retry_limit",r.length,r[0].apiKey),n._addStat("records_dropped_count",r.length,r[0].apiKey);break;case Pc.AWTEventsDroppedReason.QueueFull:n._addStat("d_queue_full",r.length,r[0].apiKey);break}},eventsRejected:function(r,i){switch(i){case Pc.AWTEventsRejectedReason.InvalidEvent:n._addStat("r_inv",r.length,r[0].apiKey);break;case Pc.AWTEventsRejectedReason.KillSwitch:n._addStat("r_kl",r.length,r[0].apiKey);break;case Pc.AWTEventsRejectedReason.SizeLimitExceeded:n._addStat("r_size",r.length,r[0].apiKey);break}n._addStat("r_count",r.length,r[0].apiKey)},eventsRetrying:null}),setTimeout(function(){return n.flush()},KD)},t.teardown=function(){this._isInitalized&&(this.flush(),this._isInitalized=!1)},t.eventReceived=function(e){t._addStat("records_received_count",1,e)},t.flush=function(){var e=this;if(this._isInitalized){for(var n in this._stats)this._stats.hasOwnProperty(n)&&this._sendStats(this._stats[n],n);this._stats={},setTimeout(function(){return e.flush()},KD)}},t._addStat=function(e,n,r){if(this._isInitalized&&r!==WD.StatsApiKey){var i=WD.getTenantId(r);this._stats[i]||(this._stats[i]={}),this._stats[i][e]?this._stats[i][e]=this._stats[i][e]+n:this._stats[i][e]=n}},t._isInitalized=!1,t._stats={},t}();eC.default=Zfe;var jg={},Vg={},zg={},tC={},Qs={},eH={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e._BT_STOP=0]="_BT_STOP",e[e._BT_STOP_BASE=1]="_BT_STOP_BASE",e[e._BT_BOOL=2]="_BT_BOOL",e[e._BT_DOUBLE=8]="_BT_DOUBLE",e[e._BT_STRING=9]="_BT_STRING",e[e._BT_STRUCT=10]="_BT_STRUCT",e[e._BT_LIST=11]="_BT_LIST",e[e._BT_MAP=13]="_BT_MAP",e[e._BT_INT32=16]="_BT_INT32",e[e._BT_INT64=17]="_BT_INT64"}(t._BondDataType||(t._BondDataType={}))})(eH);var Xs={},_A={};Object.defineProperty(_A,"__esModule",{value:!0});var epe=function(){function t(){}return t._ConvertNumberToArray=function(e,n){if(!e)return n?this._doubleZero:this._floatZero;var r=n?11:8,i=n?52:23,o=(1<<r-1)-1,s=1-o,l=o,c=e<0?1:0;e=Math.abs(e);for(var a=Math.floor(e),u=e-a,d=2*(o+2)+i,f=new Array(d),h=0;h<d;)f[h++]=0;for(h=o+2;h&&a;)f[--h]=a%2,a=Math.floor(a/2);for(h=o+1;h<d-1&&u>0;)u*=2,u>=1?(f[++h]=1,--u):f[++h]=0;for(var g=0;g<d&&!f[g];)g++;var E=o+1-g,D=g+i;if(f[D+1]){for(h=D;h>g&&(f[h]=1-f[h],!f);--h);h===g&&++E}if(E>l||a)return c?n?this._doubleNegInifinity:this._floatNegInifinity:n?this._doubleInifinity:this._floatInifinity;if(E<s)return n?this._doubleZero:this._floatZero;if(n){var w=0;for(h=0;h<20;++h)w=w<<1|f[++g];for(var p=0;h<52;++h)p=p<<1|f[++g];w|=E+o<<20,w=c<<31|w&2147483647;var b=[p&255,p>>8&255,p>>16&255,p>>>24,w&255,w>>8&255,w>>16&255,w>>>24];return b}else{var j=0;for(h=0;h<23;++h)j=j<<1|f[++g];j|=E+o<<23,j=c<<31|j&2147483647;var b=[j&255,j>>8&255,j>>16&255,j>>>24];return b}},t._floatZero=[0,0,0,0],t._doubleZero=[0,0,0,0,0,0,0,0],t._floatInifinity=[0,0,128,127],t._floatNegInifinity=[0,0,128,255],t._doubleInifinity=[0,0,0,0,0,0,240,127],t._doubleNegInifinity=[0,0,0,0,0,0,240,255],t}();_A.FloatUtils=epe;var AA={};Object.defineProperty(AA,"__esModule",{value:!0});var tpe=function(){function t(){}return t._IsDataViewSupport=function(){return typeof ArrayBuffer<"u"&&typeof DataView<"u"},t}();AA.BrowserChecker=tpe;Object.defineProperty(Xs,"__esModule",{value:!0});var tH=sl,npe=_A,rpe=AA;function ipe(t){for(var e=[],n=0;n<t.length;++n){var r=t.charCodeAt(n);r<128?e.push(r):r<2048?e.push(192|r>>6,128|r&63):r<55296||r>=57344?e.push(224|r>>12,128|r>>6&63,128|r&63):(r=65536+((r&1023)<<10|t.charCodeAt(++n)&1023),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63))}return e}Xs._Utf8_GetBytes=ipe;function ope(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],r=t.length%3,i=function(a){return[e.charAt(a>>18&63),e.charAt(a>>12&63),e.charAt(a>>6&63),e.charAt(a&63)].join("")},o=0,s=t.length-r;o<s;o+=3){var l=(t[o]<<16)+(t[o+1]<<8)+t[o+2];n.push(i(l))}switch(r){case 1:var l=t[t.length-1];n.push(e.charAt(l>>2)),n.push(e.charAt(l<<4&63)),n.push("==");break;case 2:var c=(t[t.length-2]<<8)+t[t.length-1];n.push(e.charAt(c>>10)),n.push(e.charAt(c>>4&63)),n.push(e.charAt(c<<2&63)),n.push("=");break}return n.join("")}Xs._Base64_GetString=ope;function spe(t){for(var e=[];t&4294967168;)e.push(t&127|128),t>>>=7;return e.push(t&127),e}Xs._Varint_GetBytes=spe;function ape(t){for(var e=t.low,n=t.high,r=[];n||4294967168&e;)r.push(e&127|128),e=(n&127)<<25|e>>>7,n>>>=7;return r.push(e&127),r}Xs._Varint64_GetBytes=ape;function lpe(t){if(rpe.BrowserChecker._IsDataViewSupport()){var e=new DataView(new ArrayBuffer(8));e.setFloat64(0,t,!0);for(var n=[],r=0;r<8;++r)n.push(e.getUint8(r));return n}else return npe.FloatUtils._ConvertNumberToArray(t,!0)}Xs._Double_GetBytes=lpe;function cpe(t){return t=tH.Number._ToInt32(t),t<<1^t>>4*8-1}Xs._Zigzag_EncodeZigzag32=cpe;function upe(t){var e=t.low,n=t.high,r=n<<1|e>>>31,i=e<<1;n&2147483648&&(r=~r,i=~i);var o=new tH.UInt64("0");return o.low=i,o.high=r,o}Xs._Zigzag_EncodeZigzag64=upe;var RA={};Object.defineProperty(RA,"__esModule",{value:!0});var dpe=sl,hpe=function(){function t(){this._buffer=[]}return t.prototype._WriteByte=function(e){this._buffer.push(dpe.Number._ToByte(e))},t.prototype._Write=function(e,n,r){for(;r--;)this._WriteByte(e[n++])},t.prototype._GetBuffer=function(){return this._buffer},t}();RA.MemoryStream=hpe;Object.defineProperty(Qs,"__esModule",{value:!0});var Qw=eH;Qs._BondDataType=Qw._BondDataType;var Sl=Xs;Qs._Encoding=Sl;var fpe=RA;Qs.IO=fpe;var df=sl;Qs.Int64=df.Int64;Qs.UInt64=df.UInt64;Qs.Number=df.Number;var ppe=function(){function t(e){this._stream=e}return t.prototype._WriteBlob=function(e){this._stream._Write(e,0,e.length)},t.prototype._WriteBool=function(e){this._stream._WriteByte(e?1:0)},t.prototype._WriteContainerBegin=function(e,n){this._WriteUInt8(n),this._WriteUInt32(e)},t.prototype._WriteMapContainerBegin=function(e,n,r){this._WriteUInt8(n),this._WriteUInt8(r),this._WriteUInt32(e)},t.prototype._WriteDouble=function(e){var n=Sl._Double_GetBytes(e);this._stream._Write(n,0,n.length)},t.prototype._WriteFieldBegin=function(e,n,r){n<=5?this._stream._WriteByte(e|n<<5):n<=255?(this._stream._WriteByte(e|192),this._stream._WriteByte(n)):(this._stream._WriteByte(e|224),this._stream._WriteByte(n),this._stream._WriteByte(n>>8))},t.prototype._WriteInt32=function(e){e=Sl._Zigzag_EncodeZigzag32(e),this._WriteUInt32(e)},t.prototype._WriteInt64=function(e){this._WriteUInt64(Sl._Zigzag_EncodeZigzag64(e))},t.prototype._WriteString=function(e){if(e==="")this._WriteUInt32(0);else{var n=Sl._Utf8_GetBytes(e);this._WriteUInt32(n.length),this._stream._Write(n,0,n.length)}},t.prototype._WriteStructEnd=function(e){this._WriteUInt8(e?Qw._BondDataType._BT_STOP_BASE:Qw._BondDataType._BT_STOP)},t.prototype._WriteUInt32=function(e){var n=Sl._Varint_GetBytes(df.Number._ToUInt32(e));this._stream._Write(n,0,n.length)},t.prototype._WriteUInt64=function(e){var n=Sl._Varint64_GetBytes(e);this._stream._Write(n,0,n.length)},t.prototype._WriteUInt8=function(e){this._stream._WriteByte(df.Number._ToUInt8(e))},t}();Qs.CompactBinaryProtocolWriter=ppe;Object.defineProperty(tC,"__esModule",{value:!0});var St=Qs,Oc=Ni,gpe=al,eh=Js,JD=2936012,mpe=function(){function t(){}return t.getPayloadBlob=function(e,n){var r=!1,i,o=new St.IO.MemoryStream,s=new St.CompactBinaryProtocolWriter(o);s._WriteFieldBegin(St._BondDataType._BT_MAP,3,null),s._WriteMapContainerBegin(n,St._BondDataType._BT_STRING,St._BondDataType._BT_LIST);for(var l in e)if(r)i||(i={}),i[l]=e[l],delete e[l];else if(e.hasOwnProperty(l)){s._WriteString(l);var c=e[l];s._WriteContainerBegin(1,St._BondDataType._BT_STRUCT),s._WriteFieldBegin(St._BondDataType._BT_STRING,2,null),s._WriteString("act_default_source"),s._WriteFieldBegin(St._BondDataType._BT_STRING,5,null),s._WriteString(eh.newGuid()),s._WriteFieldBegin(St._BondDataType._BT_INT64,6,null),s._WriteInt64(eh.numberToBondInt64(Date.now())),s._WriteFieldBegin(St._BondDataType._BT_LIST,8,null);var a=o._GetBuffer().length+1;s._WriteContainerBegin(e[l].length,St._BondDataType._BT_STRUCT);for(var u=o._GetBuffer().length-a,d=0;d<c.length;++d){var f=o._GetBuffer().length;if(this.writeEvent(c[d],s),o._GetBuffer().length-f>JD){gpe.default.eventsRejected([c[d]],Oc.AWTEventsRejectedReason.SizeLimitExceeded),c.splice(d--,1),o._GetBuffer().splice(f),this._addNewDataPackageSize(c.length,o,u,a);continue}if(o._GetBuffer().length>JD){o._GetBuffer().splice(f),i||(i={}),e[l]=c.splice(0,d),i[l]=c,this._addNewDataPackageSize(e[l].length,o,u,a),r=!0;break}}s._WriteStructEnd(!1)}return s._WriteStructEnd(!1),{payloadBlob:o._GetBuffer(),remainingRequest:i}},t._addNewDataPackageSize=function(e,n,r,i){for(var o=St._Encoding._Varint_GetBytes(St.Number._ToUInt32(e)),s=0;s<r;++s)if(s<o.length)n._GetBuffer()[i+s]=o[s];else{n._GetBuffer().slice(i+s,r-s);break}},t.writeEvent=function(e,n){n._WriteFieldBegin(St._BondDataType._BT_STRING,1,null),n._WriteString(e.id),n._WriteFieldBegin(St._BondDataType._BT_INT64,3,null),n._WriteInt64(eh.numberToBondInt64(e.timestamp)),n._WriteFieldBegin(St._BondDataType._BT_STRING,5,null),n._WriteString(e.type),n._WriteFieldBegin(St._BondDataType._BT_STRING,6,null),n._WriteString(e.name);var r={},i=0,o={},s=0,l={},c=0,a={},u=0,d={},f=0,h={},g=0,E={},D=0;for(var w in e.properties)if(e.properties.hasOwnProperty(w)){var p=e.properties[w];if(p.cc>0)E[w]=p,D++;else if(p.pii>0)h[w]=p,g++;else switch(p.type){case Oc.AWTPropertyType.String:r[w]=p.value,i++;break;case Oc.AWTPropertyType.Int64:o[w]=p.value,s++;break;case Oc.AWTPropertyType.Double:l[w]=p.value,c++;break;case Oc.AWTPropertyType.Boolean:a[w]=p.value,u++;break;case Oc.AWTPropertyType.Date:d[w]=p.value,f++;break}}if(i){n._WriteFieldBegin(St._BondDataType._BT_MAP,13,null),n._WriteMapContainerBegin(i,St._BondDataType._BT_STRING,St._BondDataType._BT_STRING);for(var w in r)if(r.hasOwnProperty(w)){var b=r[w];n._WriteString(w),n._WriteString(b.toString())}}if(g){n._WriteFieldBegin(St._BondDataType._BT_MAP,30,null),n._WriteMapContainerBegin(g,St._BondDataType._BT_STRING,St._BondDataType._BT_STRUCT);for(var w in h)if(h.hasOwnProperty(w)){var p=h[w];n._WriteString(w),n._WriteFieldBegin(St._BondDataType._BT_INT32,1,null),n._WriteInt32(1),n._WriteFieldBegin(St._BondDataType._BT_INT32,2,null),n._WriteInt32(p.pii),n._WriteFieldBegin(St._BondDataType._BT_STRING,3,null),n._WriteString(p.value.toString()),n._WriteStructEnd(!1)}}if(u){n._WriteFieldBegin(St._BondDataType._BT_MAP,31,null),n._WriteMapContainerBegin(u,St._BondDataType._BT_STRING,St._BondDataType._BT_BOOL);for(var w in a)if(a.hasOwnProperty(w)){var b=a[w];n._WriteString(w),n._WriteBool(b)}}if(f){n._WriteFieldBegin(St._BondDataType._BT_MAP,32,null),n._WriteMapContainerBegin(f,St._BondDataType._BT_STRING,St._BondDataType._BT_INT64);for(var w in d)if(d.hasOwnProperty(w)){var b=d[w];n._WriteString(w),n._WriteInt64(eh.numberToBondInt64(b))}}if(s){n._WriteFieldBegin(St._BondDataType._BT_MAP,33,null),n._WriteMapContainerBegin(s,St._BondDataType._BT_STRING,St._BondDataType._BT_INT64);for(var w in o)if(o.hasOwnProperty(w)){var b=o[w];n._WriteString(w),n._WriteInt64(eh.numberToBondInt64(b))}}if(c){n._WriteFieldBegin(St._BondDataType._BT_MAP,34,null),n._WriteMapContainerBegin(c,St._BondDataType._BT_STRING,St._BondDataType._BT_DOUBLE);for(var w in l)if(l.hasOwnProperty(w)){var b=l[w];n._WriteString(w),n._WriteDouble(b)}}if(D){n._WriteFieldBegin(St._BondDataType._BT_MAP,36,null),n._WriteMapContainerBegin(D,St._BondDataType._BT_STRING,St._BondDataType._BT_STRUCT);for(var w in E)if(E.hasOwnProperty(w)){var p=E[w];n._WriteString(w),n._WriteFieldBegin(St._BondDataType._BT_INT32,1,null),n._WriteInt32(p.cc),n._WriteFieldBegin(St._BondDataType._BT_STRING,2,null),n._WriteString(p.value.toString()),n._WriteStructEnd(!1)}}n._WriteStructEnd(!1)},t.base64Encode=function(e){return St._Encoding._Base64_GetString(e)},t}();tC.default=mpe;var kA={};Object.defineProperty(kA,"__esModule",{value:!0});var vpe=.8,ype=1.2,QD=3e3,Cpe=12e4,Spe=function(){function t(){}return t.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&e!==408||e===501||e===505)},t.getMillisToBackoffForRetry=function(e){var n=0,r=QD*vpe,i=QD*ype,o=Math.floor(Math.random()*(i-r))+r;return n=Math.pow(4,e)*o,Math.min(n,Cpe)},t}();kA.default=Spe;var PA={};Object.defineProperty(PA,"__esModule",{value:!0});var Tpe=1e3,Epe=function(){function t(){this._killedTokenDictionary={}}return t.prototype.setKillSwitchTenants=function(e,n){if(e&&n)try{var r=e.split(",");if(n==="this-request-only")return r;for(var i=parseInt(n,10)*Tpe,o=0;o<r.length;++o)this._killedTokenDictionary[r[o]]=Date.now()+i}catch{return[]}return[]},t.prototype.isTenantKilled=function(e){return this._killedTokenDictionary[e]!==void 0&&this._killedTokenDictionary[e]>Date.now()?!0:(delete this._killedTokenDictionary[e],!1)},t}();PA.default=Epe;var OA={};Object.defineProperty(OA,"__esModule",{value:!0});var wpe=function(){function t(e){this.clockSkewRefreshDurationInMins=e,this._reset()}return t.prototype.allowRequestSending=function(){return this._isFirstRequest&&!this._clockSkewSet?(this._isFirstRequest=!1,this._allowRequestSending=!1,!0):this._allowRequestSending},t.prototype.shouldAddClockSkewHeaders=function(){return this._shouldAddClockSkewHeaders},t.prototype.getClockSkewHeaderValue=function(){return this._clockSkewHeaderValue},t.prototype.setClockSkew=function(e){this._clockSkewSet||(e?this._clockSkewHeaderValue=e:this._shouldAddClockSkewHeaders=!1,this._clockSkewSet=!0,this._allowRequestSending=!0)},t.prototype._reset=function(){var e=this;this._isFirstRequest=!0,this._clockSkewSet=!1,this._allowRequestSending=!0,this._shouldAddClockSkewHeaders=!0,this._clockSkewHeaderValue="use-collector-delta",this.clockSkewRefreshDurationInMins>0&&setTimeout(function(){return e._reset()},this.clockSkewRefreshDurationInMins*6e4)},t}();OA.default=wpe;var MA={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Version="1.8.7",t.FullVersionString="AWT-Web-JS-"+t.Version})(MA);var XD;function Ipe(){if(XD)return zg;XD=1,Object.defineProperty(zg,"__esModule",{value:!0});var t=Ni,e=tC,n=kA,r=PA,i=OA,o=MA,s=Js,l=al,c=hp(),a=2,u=1,d="POST",f=function(){function h(g,E,D,w,p){var b=this;this._requestQueue=g,this._queueManager=D,this._httpInterface=w,this._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+o.FullVersionString,this._killSwitch=new r.default,this._paused=!1,this._useBeacons=!1,this._activeConnections=0,this._clockSkewManager=new i.default(p),s.isUint8ArrayAvailable()||(this._urlString+="&content-encoding=base64"),this._urlString=E+this._urlString,this._httpInterface||(this._useBeacons=!s.isReactNative(),this._httpInterface={sendPOST:function(j,K,M,ne,G,oe){try{if(s.useFetchRequest())fetch(j,{body:K,method:d}).then(function(B){var q={};B.headers&&B.headers.forEach(function(F,x){q[x]=F}),G(B.status,q)}).catch(function(B){ne(0,{})});else if(s.useXDomainRequest()){var J=new XDomainRequest;J.open(d,j),J.onload=function(){G(200,null)},J.onerror=function(){ne(400,null)},J.ontimeout=function(){M(500,null)},J.send(K)}else{var X=new XMLHttpRequest;X.open(d,j,!oe),X.onload=function(){G(X.status,b._convertAllHeadersToMap(X.getAllResponseHeaders()))},X.onerror=function(){ne(X.status,b._convertAllHeadersToMap(X.getAllResponseHeaders()))},X.ontimeout=function(){M(X.status,b._convertAllHeadersToMap(X.getAllResponseHeaders()))},X.send(K)}}catch{ne(400,null)}}})}return h.prototype.hasIdleConnection=function(){return this._activeConnections<a},h.prototype.sendQueuedRequests=function(){for(;this.hasIdleConnection()&&!this._paused&&this._requestQueue.length>0&&this._clockSkewManager.allowRequestSending();)this._activeConnections++,this._sendRequest(this._requestQueue.shift(),0,!1);this.hasIdleConnection()&&c.default.scheduleTimer()},h.prototype.isCompletelyIdle=function(){return this._activeConnections===0},h.prototype.teardown=function(){for(;this._requestQueue.length>0;)this._sendRequest(this._requestQueue.shift(),0,!0)},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){this._paused=!1,this.sendQueuedRequests()},h.prototype.removeQueuedRequests=function(){this._requestQueue.length=0},h.prototype.sendSynchronousRequest=function(g,E){this._paused&&(g[E][0].priority=t.AWTEventPriority.High),this._activeConnections++,this._sendRequest(g,0,!1,!0)},h.prototype._sendRequest=function(g,E,D,w){var p=this;w===void 0&&(w=!1);try{if(this._paused){this._activeConnections--,this._queueManager.addBackRequest(g);return}var b=0,j="";for(var K in g)g.hasOwnProperty(K)&&(this._killSwitch.isTenantKilled(K)?(l.default.eventsRejected(g[K],t.AWTEventsRejectedReason.KillSwitch),delete g[K]):(j.length>0&&(j+=","),j+=K,b++));if(b>0){var M=e.default.getPayloadBlob(g,b);M.remainingRequest&&this._requestQueue.push(M.remainingRequest);var ne=this._urlString+"&x-apikey="+j+"&client-time-epoch-millis="+Date.now().toString();this._clockSkewManager.shouldAddClockSkewHeaders()&&(ne=ne+"&time-delta-to-apply-millis="+this._clockSkewManager.getClockSkewHeaderValue());var G=void 0;s.isUint8ArrayAvailable()?G=new Uint8Array(M.payloadBlob):G=e.default.base64Encode(M.payloadBlob);for(var K in g)if(g.hasOwnProperty(K))for(var oe=0;oe<g[K].length;++oe)g[K][oe].sendAttempt>0?g[K][oe].sendAttempt++:g[K][oe].sendAttempt=1;if(this._useBeacons&&D&&s.isBeaconsSupported()&&navigator.sendBeacon(ne,G))return;this._httpInterface.sendPOST(ne,G,function(J,X){p._retryRequestIfNeeded(J,X,g,b,j,E,D,w)},function(J,X){p._retryRequestIfNeeded(J,X,g,b,j,E,D,w)},function(J,X){p._retryRequestIfNeeded(J,X,g,b,j,E,D,w)},D||w)}else D||this._handleRequestFinished(!1,{},D,w)}catch{this._handleRequestFinished(!1,{},D,w)}},h.prototype._retryRequestIfNeeded=function(g,E,D,w,p,b,j,K){var M=this,ne=!0;if(typeof g<"u"){if(E){var G=this._killSwitch.setKillSwitchTenants(E["kill-tokens"],E["kill-duration-seconds"]);this._clockSkewManager.setClockSkew(E["time-delta-millis"]);for(var oe=0;oe<G.length;++oe)l.default.eventsRejected(D[G[oe]],t.AWTEventsRejectedReason.KillSwitch),delete D[G[oe]],w--}else this._clockSkewManager.setClockSkew(null);if(g===200){this._handleRequestFinished(!0,D,j,K);return}(!n.default.shouldRetryForStatus(g)||w<=0)&&(ne=!1)}if(ne)if(K)this._activeConnections--,D[p][0].priority=t.AWTEventPriority.High,this._queueManager.addBackRequest(D);else if(b<u){for(var J in D)D.hasOwnProperty(J)&&l.default.eventsRetrying(D[J]);setTimeout(function(){return M._sendRequest(D,b+1,!1)},n.default.getMillisToBackoffForRetry(b))}else this._activeConnections--,c.default.backOffTransmission(),this._queueManager.addBackRequest(D);else this._handleRequestFinished(!1,D,j,K)},h.prototype._handleRequestFinished=function(g,E,D,w){g&&c.default.clearBackOff();for(var p in E)E.hasOwnProperty(p)&&(g?l.default.eventsSent(E[p]):l.default.eventsDropped(E[p],t.AWTEventsDroppedReason.NonRetryableStatus));this._activeConnections--,!w&&!D&&this.sendQueuedRequests()},h.prototype._convertAllHeadersToMap=function(g){var E={};if(g)for(var D=g.split(`
`),w=0;w<D.length;++w){var p=D[w].split(": ");E[p[0]]=p[1]}return E},h}();return zg.default=f,zg}var DA={};Object.defineProperty(DA,"__esModule",{value:!0});var bpe=Ni,_pe=function(){function t(e,n){this._outboundQueue=e,this._maxNumberOfEvents=n,this._currentBatch={},this._currentNumEventsInBatch=0}return t.prototype.addEventToBatch=function(e){if(e.priority===bpe.AWTEventPriority.Immediate_sync){var n={};return n[e.apiKey]=[e],n}else this._currentNumEventsInBatch>=this._maxNumberOfEvents&&this.flushBatch(),this._currentBatch[e.apiKey]===void 0&&(this._currentBatch[e.apiKey]=[]),this._currentBatch[e.apiKey].push(e),this._currentNumEventsInBatch++;return null},t.prototype.flushBatch=function(){this._currentNumEventsInBatch>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentNumEventsInBatch=0)},t.prototype.hasBatch=function(){return this._currentNumEventsInBatch>0},t}();DA.default=_pe;var YD;function Ape(){if(YD)return Vg;YD=1,Object.defineProperty(Vg,"__esModule",{value:!0});var t=Ni,e=Ipe(),n=hp(),r=DA,i=al,o=Js,s=250,l=500,c=6,a=function(){function u(d,f,h,g){this._queueSizeLimit=f,this._isCurrentlyUploadingNow=!1,this._uploadNowQueue=[],this._shouldDropEventsOnPause=!1,this._paused=!1,this._queueSize=0,this._outboundQueue=[],this._inboundQueues={},this._inboundQueues[t.AWTEventPriority.High]=[],this._inboundQueues[t.AWTEventPriority.Normal]=[],this._inboundQueues[t.AWTEventPriority.Low]=[],this._addEmptyQueues(),this._batcher=new r.default(this._outboundQueue,l),this._httpManager=new e.default(this._outboundQueue,d,this,h,g)}return u.prototype.addEvent=function(d){o.isPriority(d.priority)||(d.priority=t.AWTEventPriority.Normal),d.priority===t.AWTEventPriority.Immediate_sync?this._httpManager.sendSynchronousRequest(this._batcher.addEventToBatch(d),d.apiKey):this._queueSize<this._queueSizeLimit?this._addEventToProperQueue(d):this._dropEventWithPriorityOrLess(d.priority)?this._addEventToProperQueue(d):i.default.eventsDropped([d],t.AWTEventsDroppedReason.QueueFull)},u.prototype.sendEventsForPriorityAndAbove=function(d){this._batchEvents(d),this._httpManager.sendQueuedRequests()},u.prototype.hasEvents=function(){return(this._inboundQueues[t.AWTEventPriority.High][0].length>0||this._inboundQueues[t.AWTEventPriority.Normal][0].length>0||this._inboundQueues[t.AWTEventPriority.Low][0].length>0||this._batcher.hasBatch())&&this._httpManager.hasIdleConnection()},u.prototype.addBackRequest=function(d){if(!this._paused||!this._shouldDropEventsOnPause){for(var f in d)if(d.hasOwnProperty(f))for(var h=0;h<d[f].length;++h)d[f][h].sendAttempt<c?this.addEvent(d[f][h]):i.default.eventsDropped([d[f][h]],t.AWTEventsDroppedReason.MaxRetryLimit);n.default.scheduleTimer()}},u.prototype.teardown=function(){this._paused||(this._batchEvents(t.AWTEventPriority.Low),this._httpManager.teardown())},u.prototype.uploadNow=function(d){var f=this;this._addEmptyQueues(),this._isCurrentlyUploadingNow?this._uploadNowQueue.push(d):(this._isCurrentlyUploadingNow=!0,setTimeout(function(){return f._uploadNow(d)},0))},u.prototype.pauseTransmission=function(){this._paused=!0,this._httpManager.pause(),this._shouldDropEventsOnPause&&(this._queueSize-=this._inboundQueues[t.AWTEventPriority.High][0].length+this._inboundQueues[t.AWTEventPriority.Normal][0].length+this._inboundQueues[t.AWTEventPriority.Low][0].length,this._inboundQueues[t.AWTEventPriority.High][0]=[],this._inboundQueues[t.AWTEventPriority.Normal][0]=[],this._inboundQueues[t.AWTEventPriority.Low][0]=[],this._httpManager.removeQueuedRequests())},u.prototype.resumeTransmission=function(){this._paused=!1,this._httpManager.resume()},u.prototype.shouldDropEventsOnPause=function(d){this._shouldDropEventsOnPause=d},u.prototype._removeFirstQueues=function(){this._inboundQueues[t.AWTEventPriority.High].shift(),this._inboundQueues[t.AWTEventPriority.Normal].shift(),this._inboundQueues[t.AWTEventPriority.Low].shift()},u.prototype._addEmptyQueues=function(){this._inboundQueues[t.AWTEventPriority.High].push([]),this._inboundQueues[t.AWTEventPriority.Normal].push([]),this._inboundQueues[t.AWTEventPriority.Low].push([])},u.prototype._addEventToProperQueue=function(d){(!this._paused||!this._shouldDropEventsOnPause)&&(this._queueSize++,this._inboundQueues[d.priority][this._inboundQueues[d.priority].length-1].push(d))},u.prototype._dropEventWithPriorityOrLess=function(d){for(var f=t.AWTEventPriority.Low;f<=d;){if(this._inboundQueues[f][this._inboundQueues[f].length-1].length>0)return i.default.eventsDropped([this._inboundQueues[f][this._inboundQueues[f].length-1].shift()],t.AWTEventsDroppedReason.QueueFull),!0;f++}return!1},u.prototype._batchEvents=function(d){for(var f=t.AWTEventPriority.High;f>=d;){for(;this._inboundQueues[f][0].length>0;){var h=this._inboundQueues[f][0].pop();this._queueSize--,this._batcher.addEventToBatch(h)}f--}this._batcher.flushBatch()},u.prototype._uploadNow=function(d){var f=this;this.hasEvents()&&this.sendEventsForPriorityAndAbove(t.AWTEventPriority.Low),this._checkOutboundQueueEmptyAndSent(function(){f._removeFirstQueues(),d!=null&&d(),f._uploadNowQueue.length>0?setTimeout(function(){return f._uploadNow(f._uploadNowQueue.shift())},0):(f._isCurrentlyUploadingNow=!1,f.hasEvents()&&n.default.scheduleTimer())})},u.prototype._checkOutboundQueueEmptyAndSent=function(d){var f=this;this._httpManager.isCompletelyIdle()?d():setTimeout(function(){return f._checkOutboundQueueEmptyAndSent(d)},s)},u}();return Vg.default=a,Vg}var Gg={},nC={},up={},dp={};Object.defineProperty(dp,"__esModule",{value:!0});var iT=Js,Wg="MicrosoftApplicationsTelemetryDeviceId",oT="MicrosoftApplicationsTelemetryFirstLaunchTime",Fn={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",OPERA:"Opera"},Zi={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",CROS:"Chrome OS"},aa={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},ZD={"5.1":"XP","6.0":"Vista","6.1":"7","6.2":"8","6.3":"8.1","10.0":"10"},Kg="([\\d,.]+)",Rpe="([\\d,_,.]+)",ml="Unknown",th="undefined",kpe=function(){function t(){}return t.addPropertyStorageOverride=function(e){return e?(this._propertyStorage=e,!0):!1},t.autoCollect=function(e,n,r){if(this._semanticContext=e,this._disableCookies=n,this._autoCollect(),!r&&typeof navigator!==th&&(r=navigator.userAgent||""),this._autoCollectFromUserAgent(r),this._disableCookies&&!this._propertyStorage){this._deleteCookie(Wg),this._deleteCookie(oT);return}(this._propertyStorage||this._areCookiesAvailable&&!this._disableCookies)&&this._autoCollectDeviceId()},t.checkAndSaveDeviceId=function(e){if(e){var n=this._getData(Wg),r=this._getData(oT);n!==e&&(r=iT.getISOString(new Date)),this._saveData(Wg,e),this._saveData(oT,r),this._setFirstLaunchTime(r)}},t._autoCollectDeviceId=function(){var e=this._getData(Wg);e||(e=iT.newGuid()),this._semanticContext.setDeviceId(e)},t._autoCollect=function(){typeof document!==th&&document.documentElement&&this._semanticContext.setAppLanguage(document.documentElement.lang),typeof navigator!==th&&this._semanticContext.setUserLanguage(navigator.userLanguage||navigator.language);var e=new Date().getTimezoneOffset(),n=e%60,r=(e-n)/60,i="+";r>0&&(i="-"),r=Math.abs(r),n=Math.abs(n),this._semanticContext.setUserTimeZone(i+(r<10?"0"+r:r.toString())+":"+(n<10?"0"+n:n.toString()))},t._autoCollectFromUserAgent=function(e){if(e){var n=this._getBrowserName(e);this._semanticContext.setDeviceBrowserName(n),this._semanticContext.setDeviceBrowserVersion(this._getBrowserVersion(e,n));var r=this._getOsName(e);this._semanticContext.setDeviceOsName(r),this._semanticContext.setDeviceOsVersion(this._getOsVersion(e,r))}},t._getBrowserName=function(e){return this._userAgentContainsString("OPR/",e)?Fn.OPERA:this._userAgentContainsString(Fn.PHANTOMJS,e)?Fn.PHANTOMJS:this._userAgentContainsString(Fn.EDGE,e)||this._userAgentContainsString("Edg",e)?Fn.EDGE:this._userAgentContainsString(Fn.ELECTRON,e)?Fn.ELECTRON:this._userAgentContainsString(Fn.CHROME,e)?Fn.CHROME:this._userAgentContainsString("Trident",e)?Fn.MSIE:this._userAgentContainsString(Fn.FIREFOX,e)?Fn.FIREFOX:this._userAgentContainsString(Fn.SAFARI,e)?Fn.SAFARI:this._userAgentContainsString(Fn.SKYPE_SHELL,e)?Fn.SKYPE_SHELL:ml},t._setFirstLaunchTime=function(e){if(!isNaN(e)){var n=new Date;n.setTime(parseInt(e,10)),e=iT.getISOString(n)}this.firstLaunchTime=e},t._userAgentContainsString=function(e,n){return n.indexOf(e)>-1},t._getBrowserVersion=function(e,n){if(n===Fn.MSIE)return this._getIeVersion(e);if(n===Fn.EDGE){var r=this._getOtherVersion(n,e);return r===ml?this._getOtherVersion("Edg",e):r}else return this._getOtherVersion(n,e)},t._getIeVersion=function(e){var n=e.match(new RegExp(Fn.MSIE+" "+Kg));if(n)return n[1];var r=e.match(new RegExp("rv:"+Kg));if(r)return r[1]},t._getOtherVersion=function(e,n){e===Fn.SAFARI&&(e="Version");var r=n.match(new RegExp(e+"/"+Kg));return r?r[1]:ml},t._getOsName=function(e){return e.match(aa.WINPHONE)?Zi.WINDOWS_PHONE:e.match(aa.WINRT)?Zi.WINDOWS_RT:e.match(aa.IOS)?Zi.IOS:e.match(aa.ANDROID)?Zi.ANDROID:e.match(aa.LINUX)?Zi.LINUX:e.match(aa.OSX)?Zi.MACOSX:e.match(aa.WIN)?Zi.WINDOWS:e.match(aa.CROS)?Zi.CROS:ml},t._getOsVersion=function(e,n){return n===Zi.WINDOWS?this._getGenericOsVersion(e,"Windows NT"):n===Zi.ANDROID?this._getGenericOsVersion(e,n):n===Zi.MACOSX?this._getMacOsxVersion(e):ml},t._getGenericOsVersion=function(e,n){var r=e.match(new RegExp(n+" "+Kg));return r?ZD[r[1]]?ZD[r[1]]:r[1]:ml},t._getMacOsxVersion=function(e){var n=e.match(new RegExp(Zi.MACOSX+" "+Rpe));if(n){var r=n[1].replace(/_/g,".");if(r){var i=this._getDelimiter(r);if(i){var o=r.split(i);return o[0]}else return r}}return ml},t._getDelimiter=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null},t._saveData=function(e,n){if(this._propertyStorage)this._propertyStorage.setProperty(e,n);else if(this._areCookiesAvailable){var r=new Date;r.setTime(r.getTime()+31536e6);var i="expires="+r.toUTCString();document.cookie=e+"="+n+"; "+i}},t._getData=function(e){if(this._propertyStorage)return this._propertyStorage.getProperty(e)||"";if(this._areCookiesAvailable){e=e+"=";for(var n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r],o=0;i.charAt(o)===" ";)o++;if(i=i.substring(o),i.indexOf(e)===0)return i.substring(e.length,i.length)}}return""},t._deleteCookie=function(e){this._areCookiesAvailable&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},t._disableCookies=!1,t._areCookiesAvailable=typeof document!==th&&typeof document.cookie!==th,t}();dp.default=kpe;Object.defineProperty(up,"__esModule",{value:!0});var Ppe=dp,vs=Ni,la=cp,eN="UserInfo.IdType",Ope=function(){function t(e,n){this._allowDeviceFields=e,this._properties=n}return t.prototype.setAppId=function(e){this._addContext("AppInfo.Id",e)},t.prototype.setAppVersion=function(e){this._addContext("AppInfo.Version",e)},t.prototype.setAppLanguage=function(e){this._addContext("AppInfo.Language",e)},t.prototype.setDeviceId=function(e){this._allowDeviceFields&&(Ppe.default.checkAndSaveDeviceId(e),this._addContext("DeviceInfo.Id",e))},t.prototype.setDeviceOsName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsName",e)},t.prototype.setDeviceOsVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsVersion",e)},t.prototype.setDeviceBrowserName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserName",e)},t.prototype.setDeviceBrowserVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserVersion",e)},t.prototype.setDeviceMake=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Make",e)},t.prototype.setDeviceModel=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Model",e)},t.prototype.setUserId=function(e,n,r){if(!isNaN(r)&&r!==null&&r>=0&&r<=12)this._addContext(eN,r.toString());else{var i=void 0;switch(n){case vs.AWTPiiKind.SipAddress:i=la.AWTUserIdType.SipAddress;break;case vs.AWTPiiKind.PhoneNumber:i=la.AWTUserIdType.PhoneNumber;break;case vs.AWTPiiKind.SmtpAddress:i=la.AWTUserIdType.EmailAddress;break;default:i=la.AWTUserIdType.Unknown;break}this._addContext(eN,i.toString())}if(isNaN(n)||n===null||n===vs.AWTPiiKind.NotSet||n>13)switch(r){case la.AWTUserIdType.Skype:n=vs.AWTPiiKind.Identity;break;case la.AWTUserIdType.EmailAddress:n=vs.AWTPiiKind.SmtpAddress;break;case la.AWTUserIdType.PhoneNumber:n=vs.AWTPiiKind.PhoneNumber;break;case la.AWTUserIdType.SipAddress:n=vs.AWTPiiKind.SipAddress;break;default:n=vs.AWTPiiKind.NotSet;break}this._addContextWithPii("UserInfo.Id",e,n)},t.prototype.setUserAdvertisingId=function(e){this._addContext("UserInfo.AdvertisingId",e)},t.prototype.setUserTimeZone=function(e){this._addContext("UserInfo.TimeZone",e)},t.prototype.setUserLanguage=function(e){this._addContext("UserInfo.Language",e)},t.prototype._addContext=function(e,n){typeof n=="string"&&this._properties.setProperty(e,n)},t.prototype._addContextWithPii=function(e,n,r){typeof n=="string"&&this._properties.setPropertyWithPii(e,n,r)},t}();up.default=Ope;Object.defineProperty(nC,"__esModule",{value:!0});var Mpe=pd,Dpe=up,Npe=function(){function t(){}return t.logManagerContext=new Mpe.default,t.sessionEnabled=!0,t.loggingEnabled=!1,t.defaultTenantToken="",t.semanticContext=new Dpe.default(!0,t.logManagerContext),t}();nC.default=Npe;var tN;function nH(){if(tN)return Gg;tN=1,Object.defineProperty(Gg,"__esModule",{value:!0});var t=Ni,e=cp,n=nC,r=rH(),i=hp(),o=al,s=dp,l=function(){function c(){}return c.initialize=function(a,u){if(u===void 0&&(u={}),!this._isInitialized)return this._isInitialized=!0,n.default.defaultTenantToken=a,this._overrideValuesFromConfig(u),this._config.disableCookiesUsage&&!this._config.propertyStorageOverride&&(n.default.sessionEnabled=!1),s.default.addPropertyStorageOverride(this._config.propertyStorageOverride),s.default.autoCollect(n.default.semanticContext,this._config.disableCookiesUsage,this._config.userAgent),i.default.initialize(this._config),n.default.loggingEnabled=!0,this._config.enableAutoUserSession&&(this.getLogger().logSession(e.AWTSessionState.Started),window.addEventListener("beforeunload",this.flushAndTeardown)),this.getLogger()},c.getSemanticContext=function(){return n.default.semanticContext},c.flush=function(a){this._isInitialized&&!this._isDestroyed&&i.default.flush(a)},c.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._config.enableAutoUserSession&&this.getLogger().logSession(e.AWTSessionState.Ended),i.default.flushAndTeardown(),n.default.loggingEnabled=!1,this._isDestroyed=!0)},c.pauseTransmission=function(){this._isInitialized&&!this._isDestroyed&&i.default.pauseTransmission()},c.resumeTransmision=function(){this._isInitialized&&!this._isDestroyed&&i.default.resumeTransmision()},c.setTransmitProfile=function(a){this._isInitialized&&!this._isDestroyed&&i.default.setTransmitProfile(a)},c.loadTransmitProfiles=function(a){this._isInitialized&&!this._isDestroyed&&i.default.loadTransmitProfiles(a)},c.setContext=function(a,u,d){d===void 0&&(d=t.AWTPropertyType.Unspecified),n.default.logManagerContext.setProperty(a,u,d)},c.setContextWithPii=function(a,u,d,f){f===void 0&&(f=t.AWTPropertyType.Unspecified),n.default.logManagerContext.setPropertyWithPii(a,u,d,f)},c.setContextWithCustomerContent=function(a,u,d,f){f===void 0&&(f=t.AWTPropertyType.Unspecified),n.default.logManagerContext.setPropertyWithCustomerContent(a,u,d,f)},c.getLogger=function(a){var u=a;return(!u||u===n.default.defaultTenantToken)&&(u=""),this._loggers[u]||(this._loggers[u]=new r.default(u)),this._loggers[u]},c.addNotificationListener=function(a){o.default.addNotificationListener(a)},c.removeNotificationListener=function(a){o.default.removeNotificationListener(a)},c._overrideValuesFromConfig=function(a){a.collectorUri&&(this._config.collectorUri=a.collectorUri),a.cacheMemorySizeLimitInNumberOfEvents>0&&(this._config.cacheMemorySizeLimitInNumberOfEvents=a.cacheMemorySizeLimitInNumberOfEvents),a.httpXHROverride&&a.httpXHROverride.sendPOST&&(this._config.httpXHROverride=a.httpXHROverride),a.propertyStorageOverride&&a.propertyStorageOverride.getProperty&&a.propertyStorageOverride.setProperty&&(this._config.propertyStorageOverride=a.propertyStorageOverride),a.userAgent&&(this._config.userAgent=a.userAgent),a.disableCookiesUsage&&(this._config.disableCookiesUsage=a.disableCookiesUsage),a.canSendStatEvent&&(this._config.canSendStatEvent=a.canSendStatEvent),a.enableAutoUserSession&&typeof window<"u"&&window.addEventListener&&(this._config.enableAutoUserSession=a.enableAutoUserSession),a.clockSkewRefreshDurationInMins>0&&(this._config.clockSkewRefreshDurationInMins=a.clockSkewRefreshDurationInMins)},c._loggers={},c._isInitialized=!1,c._isDestroyed=!1,c._config={collectorUri:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",cacheMemorySizeLimitInNumberOfEvents:1e4,disableCookiesUsage:!1,canSendStatEvent:function(a){return!0},clockSkewRefreshDurationInMins:0},c}();return Gg.default=l,Gg}var nN;function hp(){if(nN)return jg;nN=1,Object.defineProperty(jg,"__esModule",{value:!0});var t=fd,e=Ni,n=Ape(),r=eC,i=pd,o=nH(),s=Js,l=4,c=3e4,a="awt_stats",u=function(){function d(){}return d.setEventsHandler=function(f){this._eventHandler=f},d.getEventsHandler=function(){return this._eventHandler},d.scheduleTimer=function(){var f=this,h=this._profiles[this._currentProfile][2];this._timeout<0&&h>=0&&!this._paused&&(this._eventHandler.hasEvents()?(h===0&&this._currentBackoffCount>0&&(h=1),this._timeout=setTimeout(function(){return f._batchAndSendEvents()},h*(1<<this._currentBackoffCount)*1e3)):this._timerCount=0)},d.initialize=function(f){var h=this;this._newEventsAllowed=!0,this._config=f,this._eventHandler=new n.default(f.collectorUri,f.cacheMemorySizeLimitInNumberOfEvents,f.httpXHROverride,f.clockSkewRefreshDurationInMins),this._initializeProfiles(),r.default.initialize(function(g,E){if(h._config.canSendStatEvent(a)){var D=new i.default(a);D.setEventPriority(e.AWTEventPriority.High),D.setProperty("TenantId",E);for(var w in g)g.hasOwnProperty(w)&&D.setProperty(w,g[w].toString());o.default.getLogger(s.StatsApiKey).logEvent(D)}})},d.setTransmitProfile=function(f){this._currentProfile!==f&&this._profiles[f]!==void 0&&(this.clearTimeout(),this._currentProfile=f,this.scheduleTimer())},d.loadTransmitProfiles=function(f){this._resetTransmitProfiles();for(var h in f)if(f.hasOwnProperty(h)){if(f[h].length!==3)continue;for(var g=2;g>=0;--g)if(f[h][g]<0){for(var E=g;E>=0;--E)f[h][E]=-1;break}for(var g=2;g>0;--g)if(f[h][g]>0&&f[h][g-1]>0){var D=f[h][g-1]/f[h][g];f[h][g-1]=Math.ceil(D)*f[h][g]}this._profiles[h]=f[h]}},d.sendEvent=function(f){this._newEventsAllowed&&(this._currentBackoffCount>0&&f.priority===e.AWTEventPriority.Immediate_sync&&(f.priority=e.AWTEventPriority.High),this._eventHandler.addEvent(f),this.scheduleTimer())},d.flush=function(f){var h=new Date().getTime();!this._paused&&this._lastUploadNowCall+c<h&&(this._lastUploadNowCall=h,this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._eventHandler.uploadNow(f))},d.pauseTransmission=function(){this._paused||(this.clearTimeout(),this._eventHandler.pauseTransmission(),this._paused=!0)},d.resumeTransmision=function(){this._paused&&(this._paused=!1,this._eventHandler.resumeTransmission(),this.scheduleTimer())},d.flushAndTeardown=function(){r.default.teardown(),this._newEventsAllowed=!1,this.clearTimeout(),this._eventHandler.teardown()},d.backOffTransmission=function(){this._currentBackoffCount<l&&(this._currentBackoffCount++,this.clearTimeout(),this.scheduleTimer())},d.clearBackOff=function(){this._currentBackoffCount>0&&(this._currentBackoffCount=0,this.clearTimeout(),this.scheduleTimer())},d._resetTransmitProfiles=function(){this.clearTimeout(),this._initializeProfiles(),this._currentProfile=t.AWT_REAL_TIME,this.scheduleTimer()},d.clearTimeout=function(){this._timeout>0&&(clearTimeout(this._timeout),this._timeout=-1,this._timerCount=0)},d._batchAndSendEvents=function(){var f=e.AWTEventPriority.High;this._timerCount++,this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][0]?(f=e.AWTEventPriority.Low,this._timerCount=0):this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][1]&&(f=e.AWTEventPriority.Normal),this._eventHandler.sendEventsForPriorityAndAbove(f),this._timeout=-1,this.scheduleTimer()},d._initializeProfiles=function(){this._profiles={},this._profiles[t.AWT_REAL_TIME]=[4,2,1],this._profiles[t.AWT_NEAR_REAL_TIME]=[12,6,3],this._profiles[t.AWT_BEST_EFFORT]=[36,18,9]},d._newEventsAllowed=!1,d._currentProfile=t.AWT_REAL_TIME,d._timeout=-1,d._currentBackoffCount=0,d._paused=!1,d._timerCount=0,d._lastUploadNowCall=0,d}();return jg.default=u,jg}var rN;function rH(){if(rN)return qg;rN=1,Object.defineProperty(qg,"__esModule",{value:!0});var t=Ni,e=cp,n=pd,r=Js,i=eC,o=al,s=hp(),l=nC,c=MA,a=up,u=dp,d=function(){function f(h){this._apiKey=h,this._contextProperties=new n.default,this._semanticContext=new a.default(!1,this._contextProperties),this._sessionStartTime=0,this._createInitId()}return f.prototype.setContext=function(h,g,E){E===void 0&&(E=t.AWTPropertyType.Unspecified),this._contextProperties.setProperty(h,g,E)},f.prototype.setContextWithPii=function(h,g,E,D){D===void 0&&(D=t.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithPii(h,g,E,D)},f.prototype.setContextWithCustomerContent=function(h,g,E,D){D===void 0&&(D=t.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithCustomerContent(h,g,E,D)},f.prototype.getSemanticContext=function(){return this._semanticContext},f.prototype.logEvent=function(h){if(l.default.loggingEnabled){this._apiKey||(this._apiKey=l.default.defaultTenantToken,this._createInitId());var g=!0;r.isString(h)?h={name:h}:h instanceof n.default&&(h=h.getEvent(),g=!1),i.default.eventReceived(this._apiKey),f._logEvent(f._getInternalEvent(h,this._apiKey,g),this._contextProperties)}},f.prototype.logSession=function(h,g){if(l.default.sessionEnabled){var E={name:"session",type:"session",properties:{}};if(f._addPropertiesToEvent(E,g),E.priority=t.AWTEventPriority.High,h===e.AWTSessionState.Started){if(this._sessionStartTime>0)return;this._sessionStartTime=new Date().getTime(),this._sessionId=r.newGuid(),this.setContext("Session.Id",this._sessionId),E.properties["Session.State"]="Started"}else if(h===e.AWTSessionState.Ended){if(this._sessionStartTime===0)return;var D=Math.floor((new Date().getTime()-this._sessionStartTime)/1e3);E.properties["Session.Id"]=this._sessionId,E.properties["Session.State"]="Ended",E.properties["Session.Duration"]=D.toString(),E.properties["Session.DurationBucket"]=f._getSessionDurationFromTime(D),this._sessionStartTime=0,this.setContext("Session.Id",null),this._sessionId=void 0}else return;E.properties["Session.FirstLaunchTime"]=u.default.firstLaunchTime,this.logEvent(E)}},f.prototype.getSessionId=function(){return this._sessionId},f.prototype.logFailure=function(h,g,E,D,w){if(!(!h||!g)){var p={name:"failure",type:"failure",properties:{}};f._addPropertiesToEvent(p,w),p.properties["Failure.Signature"]=h,p.properties["Failure.Detail"]=g,E&&(p.properties["Failure.Category"]=E),D&&(p.properties["Failure.Id"]=D),p.priority=t.AWTEventPriority.High,this.logEvent(p)}},f.prototype.logPageView=function(h,g,E,D,w,p){if(!(!h||!g)){var b={name:"pageview",type:"pageview",properties:{}};f._addPropertiesToEvent(b,p),b.properties["PageView.Id"]=h,b.properties["PageView.Name"]=g,E&&(b.properties["PageView.Category"]=E),D&&(b.properties["PageView.Uri"]=D),w&&(b.properties["PageView.ReferrerUri"]=w),this.logEvent(b)}},f.prototype._createInitId=function(){!f._initIdMap[this._apiKey]&&this._apiKey&&(f._initIdMap[this._apiKey]=r.newGuid())},f._addPropertiesToEvent=function(h,g){if(g){g instanceof n.default&&(g=g.getEvent()),g.name&&(h.name=g.name),g.priority&&(h.priority=g.priority);for(var E in g.properties)g.properties.hasOwnProperty(E)&&(h.properties[E]=g.properties[E])}},f._getSessionDurationFromTime=function(h){return h<0?"Undefined":h<=3?"UpTo3Sec":h<=10?"UpTo10Sec":h<=30?"UpTo30Sec":h<=60?"UpTo60Sec":h<=180?"UpTo3Min":h<=600?"UpTo10Min":h<=1800?"UpTo30Min":"Above30Min"},f._logEvent=function(h,g){if(!h.name||!r.isString(h.name)){o.default.eventsRejected([h],t.AWTEventsRejectedReason.InvalidEvent);return}if(h.name=h.name.toLowerCase(),h.name=h.name.replace(r.EventNameDotRegex,"_"),!h.type||!r.isString(h.type)?h.type="custom":h.type=h.type.toLowerCase(),!r.EventNameAndTypeRegex.test(h.name)||!r.EventNameAndTypeRegex.test(h.type)){o.default.eventsRejected([h],t.AWTEventsRejectedReason.InvalidEvent);return}(!r.isNumber(h.timestamp)||h.timestamp<0)&&(h.timestamp=new Date().getTime()),h.properties||(h.properties={}),this._addContextIfAbsent(h,g.getPropertyMap()),this._addContextIfAbsent(h,l.default.logManagerContext.getPropertyMap()),this._setDefaultProperty(h,"EventInfo.InitId",this._getInitId(h.apiKey)),this._setDefaultProperty(h,"EventInfo.Sequence",this._getSequenceId(h.apiKey)),this._setDefaultProperty(h,"EventInfo.SdkVersion",c.FullVersionString),this._setDefaultProperty(h,"EventInfo.Name",h.name),this._setDefaultProperty(h,"EventInfo.Time",new Date(h.timestamp).toISOString()),r.isPriority(h.priority)||(h.priority=t.AWTEventPriority.Normal),this._sendEvent(h)},f._addContextIfAbsent=function(h,g){if(g)for(var E in g)g.hasOwnProperty(E)&&(h.properties[E]||(h.properties[E]=g[E]))},f._setDefaultProperty=function(h,g,E){h.properties[g]={value:E,pii:t.AWTPiiKind.NotSet,type:t.AWTPropertyType.String}},f._sendEvent=function(h){s.default.sendEvent(h)},f._getInternalEvent=function(h,g,E){if(h.properties=h.properties||{},E)for(var D in h.properties)h.properties.hasOwnProperty(D)&&(h.properties[D]=r.sanitizeProperty(D,h.properties[D]),h.properties[D]===null&&delete h.properties[D]);var w=h;return w.id=r.newGuid(),w.apiKey=g,w},f._getInitId=function(h){return f._initIdMap[h]},f._getSequenceId=function(h){return f._sequenceIdMap[h]===void 0&&(f._sequenceIdMap[h]=0),(++f._sequenceIdMap[h]).toString()},f._sequenceIdMap={},f._initIdMap={},f}();return qg.default=d,qg}var NA={};Object.defineProperty(NA,"__esModule",{value:!0});var sT=hp(),xpe=function(){function t(){}return t.setEventsHandler=function(e){sT.default.setEventsHandler(e)},t.getEventsHandler=function(){return sT.default.getEventsHandler()},t.scheduleTimer=function(){sT.default.scheduleTimer()},t}();NA.default=xpe;Object.defineProperty(on,"__esModule",{value:!0});var gd=Ni;on.AWTPropertyType=gd.AWTPropertyType;on.AWTPiiKind=gd.AWTPiiKind;on.AWTEventPriority=gd.AWTEventPriority;on.AWTEventsDroppedReason=gd.AWTEventsDroppedReason;on.AWTEventsRejectedReason=gd.AWTEventsRejectedReason;on.AWTCustomerContentKind=gd.AWTCustomerContentKind;var iH=cp;on.AWTUserIdType=iH.AWTUserIdType;on.AWTSessionState=iH.AWTSessionState;var xA=fd;on.AWT_BEST_EFFORT=xA.AWT_BEST_EFFORT;on.AWT_NEAR_REAL_TIME=xA.AWT_NEAR_REAL_TIME;on.AWT_REAL_TIME=xA.AWT_REAL_TIME;var Lpe=pd;on.AWTEventProperties=Lpe.default;var Upe=rH();on.AWTLogger=Upe.default;var Fpe=nH();on.AWTLogManager=Fpe.default;var Bpe=NA;on.AWTTransmissionManager=Bpe.default;var $pe=tC;on.AWTSerializer=$pe.default;var Hpe=up;on.AWTSemanticContext=Hpe.default;on.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/";on.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/";on.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/";on.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/";on.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/";on.AWT_COLLECTOR_URL_USGOV_DOD="https://pf.pipe.aria.microsoft.com/Collector/3.0";on.AWT_COLLECTOR_URL_USGOV_DOJ="https://tb.pipe.aria.microsoft.com/Collector/3.0";const qpe="0.0.1-beta.5",jpe={version:qpe},Vpe="0.1.5",zpe={version:Vpe},Gpe="1.5.4",iN={version:Gpe},Wpe="2.3.1",Kpe={version:Wpe},Jpe="1.11.6",oH={version:Jpe},sH={OS:"web",Version:"0"},Qpe={Platform:sH},Xpe=Object.freeze(Object.defineProperty({__proto__:null,Platform:sH,default:Qpe},Symbol.toStringTag,{value:"Module"})),Ype=Hs(Xpe);var De=_e&&_e.__assign||function(){return De=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},De.apply(this,arguments)};Object.defineProperty(bA,"__esModule",{value:!0});var oN=on,Zpe=fr,sN=tp,Mt=Ni,Dt=Af,Ze=Rf,aN=fr,ege=jpe,Xw;(function(t){t.ReactNative="ReactNative"})(Xw||(Xw={}));var Jg={collectorUri:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",cacheMemorySizeLimitInNumberOfEvents:1e4,disableCookiesUsage:!1,canSendStatEvent:function(t){return!0},clockSkewRefreshDurationInMins:0},tge=function(){function t(){}return t.initialize=function(e,n){n===void 0&&(n=Jg),this._debug&&console.log("[AriaTelemetry][logger][initialize][custom]"),t._key=e,t._configuration=De(De(De({},Jg),n),{collectorUri:t._collectorUri}),t._logger=oN.AWTLogManager.initialize(e,t._configuration)},t.setDebug=function(e){t._debug=e},t.disable=function(){this._debug&&console.log("[AriaTelemetry][disable]"),t._disable=!0},t.setCollectorUri=function(e){t._collectorUri=e,t._configuration=De(De(De({},Jg),t._configuration),{collectorUri:t._collectorUri})},t.setCDNPackages=function(e){t._CDNPackagesInfo=De(De({},t._CDNPackagesInfo),e)},t.info=function(e,n){var r;n===void 0&&(n=Ze.default.EVENTS);var i={name:Ze.default.EVENTS,properties:De(De(De(De(De({},t.populateBaseProperties()),t.fillWebPlatformData()),t.fillMobilePlatformData()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High};n==Ze.default.IC3CLIENT&&(i={name:Ze.default.IC3CLIENT,properties:De(De(De({},t.populateIC3ClientBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),n==Ze.default.OCSDK&&(i={name:Ze.default.OCSDK,properties:De(De(De({},t.populateOCSDKBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSCLIENT&&(i={name:Ze.default.ACSCLIENT,properties:De(De(De({},t.populateACSClientBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSADAPTER&&(i={name:Ze.default.ACSADAPTER,properties:De(De(De({},t.populateACSAdapterBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),n==Ze.default.CALLINGSDK&&(i={name:Ze.default.CALLINGSDK,properties:De(De(De({},t.populateCallingSDKBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),n==Ze.default.AMSCLIENT&&(i={name:Ze.default.AMSCLIENT,properties:De(De(De({},t.populateAMSClientBaseProperties()),e),{LogLevel:Dt.default.INFO}),priority:Mt.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][info] ".concat(n)),this._debug&&console.log(i),this._debug&&console.log(i.properties.Event),!t._disable&&((r=t.logger)===null||r===void 0||r.logEvent(i))},t.debug=function(e,n){var r;n===void 0&&(n=Ze.default.EVENTS);var i={name:Ze.default.EVENTS,properties:De(De(De(De(De({},t.populateBaseProperties()),t.fillWebPlatformData()),t.fillMobilePlatformData()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High};n==Ze.default.IC3CLIENT&&(i={name:Ze.default.IC3CLIENT,properties:De(De(De({},t.populateIC3ClientBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.OCSDK&&(i={name:Ze.default.OCSDK,properties:De(De(De({},t.populateOCSDKBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSCLIENT&&(i={name:Ze.default.ACSCLIENT,properties:De(De(De({},t.populateACSClientBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSADAPTER&&(i={name:Ze.default.ACSADAPTER,properties:De(De(De({},t.populateACSAdapterBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.CALLINGSDK&&(i={name:Ze.default.CALLINGSDK,properties:De(De(De({},t.populateCallingSDKBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.AMSCLIENT&&(i={name:Ze.default.AMSCLIENT,properties:De(De(De({},t.populateAMSClientBaseProperties()),e),{LogLevel:Dt.default.DEBUG}),priority:Mt.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][debug] ".concat(n)),this._debug&&console.log(i),this._debug&&console.log(i.properties.Event),!t._disable&&((r=t.logger)===null||r===void 0||r.logEvent(i))},t.warn=function(e,n){var r;n===void 0&&(n=Ze.default.EVENTS);var i={name:Ze.default.EVENTS,properties:De(De(De(De(De({},t.populateBaseProperties()),t.fillWebPlatformData()),t.fillMobilePlatformData()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High};n==Ze.default.IC3CLIENT&&(i={name:Ze.default.IC3CLIENT,properties:De(De(De({},t.populateIC3ClientBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),n==Ze.default.OCSDK&&(i={name:Ze.default.OCSDK,properties:De(De(De({},t.populateOCSDKBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSCLIENT&&(i={name:Ze.default.ACSCLIENT,properties:De(De(De({},t.populateACSClientBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSADAPTER&&(i={name:Ze.default.ACSADAPTER,properties:De(De(De({},t.populateACSAdapterBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),n==Ze.default.CALLINGSDK&&(i={name:Ze.default.CALLINGSDK,properties:De(De(De({},t.populateCallingSDKBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),n==Ze.default.AMSCLIENT&&(i={name:Ze.default.AMSCLIENT,properties:De(De(De({},t.populateAMSClientBaseProperties()),e),{LogLevel:Dt.default.WARN}),priority:Mt.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][warn] ".concat(n)),this._debug&&console.log(i),this._debug&&console.log(i.properties.Event),!t._disable&&((r=t.logger)===null||r===void 0||r.logEvent(i))},t.error=function(e,n){var r;n===void 0&&(n=Ze.default.EVENTS);var i={name:Ze.default.EVENTS,properties:De(De(De(De(De({},t.populateBaseProperties()),t.fillWebPlatformData()),t.fillMobilePlatformData()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High};n==Ze.default.IC3CLIENT&&(i={name:Ze.default.IC3CLIENT,properties:De(De(De({},t.populateIC3ClientBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),n==Ze.default.OCSDK&&(i={name:Ze.default.OCSDK,properties:De(De(De({},t.populateOCSDKBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSCLIENT&&(i={name:Ze.default.ACSCLIENT,properties:De(De(De({},t.populateACSClientBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSADAPTER&&(i={name:Ze.default.ACSADAPTER,properties:De(De(De({},t.populateACSAdapterBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),n==Ze.default.CALLINGSDK&&(i={name:Ze.default.CALLINGSDK,properties:De(De(De({},t.populateCallingSDKBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),n==Ze.default.AMSCLIENT&&(i={name:Ze.default.AMSCLIENT,properties:De(De(De({},t.populateAMSClientBaseProperties()),e),{LogLevel:Dt.default.ERROR}),priority:Mt.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][error] ".concat(n)),this._debug&&console.log(i),this._debug&&console.log(i.properties.Event),!t._disable&&((r=t.logger)===null||r===void 0||r.logEvent(i))},t.log=function(e,n){var r;n===void 0&&(n=Ze.default.EVENTS);var i={name:Ze.default.EVENTS,properties:De(De(De(De(De({},t.populateBaseProperties()),t.fillWebPlatformData()),t.fillMobilePlatformData()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High};n==Ze.default.IC3CLIENT&&(i={name:Ze.default.IC3CLIENT,properties:De(De(De({},t.populateIC3ClientBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.OCSDK&&(i={name:Ze.default.OCSDK,properties:De(De(De({},t.populateOCSDKBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSCLIENT&&(i={name:Ze.default.ACSCLIENT,properties:De(De(De({},t.populateACSClientBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.ACSADAPTER&&(i={name:Ze.default.ACSADAPTER,properties:De(De(De({},t.populateACSAdapterBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.CALLINGSDK&&(i={name:Ze.default.CALLINGSDK,properties:De(De(De({},t.populateCallingSDKBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),n==Ze.default.AMSCLIENT&&(i={name:Ze.default.AMSCLIENT,properties:De(De(De({},t.populateAMSClientBaseProperties()),e),{LogLevel:Dt.default.LOG}),priority:Mt.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][log]"),this._debug&&console.log(i),this._debug&&console.log(i.properties.Event),!t._disable&&((r=t.logger)===null||r===void 0||r.logEvent(i))},Object.defineProperty(t,"logger",{get:function(){return t._logger||(this._debug&&console.log("[AriaTelemetry][logger][initialize]"),t._logger=oN.AWTLogManager.initialize(aN.ariaTelemetryKey,t._configuration)),t._logger},enumerable:!1,configurable:!0}),t.populateBaseProperties=function(){var e={OCSDK:_E.version,IC3Core:zpe.version,ACSChat:iN.version,ACSCommon:Kpe.version,AMSClient:Fw.version};return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",CallId:"",Domain:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ChatSDKVersion:oH.version,NPMPackagesInfo:JSON.stringify(e),CDNPackagesInfo:JSON.stringify(t._CDNPackagesInfo),PlatformDetails:""}},t.fillMobilePlatformData=function(){var e={},n={};if(!(0,sN.isReactNative)())return e;try{var r=Ype,i=r.Platform;n.Renderer=Xw.ReactNative,e.DeviceInfo_OsVersion=i.Version,n.DeviceInfo_OsVersion=i.Version,i.OS.toLowerCase()==="android"?(e.DeviceInfo_OsName="Android",n.DeviceInfo_OsName="Android"):i.OS.toLowerCase()==="ios"?(e.DeviceInfo_OsName="iOS",n.DeviceInfo_OsName="iOS"):(e.DeviceInfo_OsName="".concat(i.OS),n.DeviceInfo_OsName="".concat(i.OS)),this._debug&&console.log("[AriaTelemetry][fillMobilePlatformData][".concat(e.DeviceInfo_OsName,"]"))}catch{this._debug&&console.log("[AriaTelemetry][fillMobilePlatformData][Web]")}return e.PlatformDetails=JSON.stringify(n),e},t.fillWebPlatformData=function(){var e={};if(!(0,sN.isBrowser)())return e;try{e.Domain=window.location.origin||"",this._debug&&console.log("[AriaTelemetry][fillWebPlatformData]")}catch{this._debug&&console.log("[AriaTelemetry][fillWebPlatformData][Error]")}return e},t.populateIC3ClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",Description:"",SubscriptionId:"",EndpointId:"",EndpointUrl:"",ErrorCode:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",IC3ClientVersion:Zpe.ic3ClientVersion}},t.populateOCSDKBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",TransactionId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",HttpRequestResponseTime:"",RequestHeaders:"",RequestPayload:"",RequestPath:"",RequestMethod:"",ResponseStatusCode:"",OCSDKVersion:_E.version}},t.populateACSClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ACSChatVersion:iN.version}},t.populateACSAdapterBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ACSAdapterVersion:ege.version}},t.populateCallingSDKBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",CallId:"",Event:"",Description:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:""}},t.populateAMSClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",AMSClientVersion:Fw.version}},t._debug=!1,t._disable=!1,t._key=aN.ariaTelemetryKey,t._collectorUri=Jg.collectorUri,t._configuration={},t}();bA.default=tge;Object.defineProperty(IA,"__esModule",{value:!0});var lN=bA,nge=function(t){return t===void 0&&(t=!1),lN.default.setDebug(t),lN.default};IA.default=nge;var fp={},Ss=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},Ts=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},rge=_e&&_e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(fp,"__esModule",{value:!0});fp.VoiceVideoCallingProxy=void 0;var An=Vs,El;(function(t){t[t.Voice=19237e4]="Voice",t[t.Video=19238e4]="Video",t[t.Cobrowse=19239e4]="Cobrowse"})(El||(El={}));var Bh;(function(t){t.Accept="accept",t.Reject="reject",t.Connect="connect",t.End="end"})(Bh||(Bh={}));var bs;(function(t){t.CallAdded="callAdded",t.LocalVideoStreamAdded="localVideoStreamAdded",t.LocalVideoStreamRemoved="localVideoStreamRemoved",t.RemoteVideoStreamAdded="remoteVideoStreamAdded",t.RemoteVideoStreamRemoved="remoteVideoStreamRemoved",t.CallDisconnected="callDisconnected",t.ParticipantDisconnected="participantDisconnected",t.IncomingCallEnded="incomingCallEnded"})(bs||(bs={}));var aH=function(){function t(){this.debug=!1,this.callClientName="ElevateToVoiceVideo",this.proxy=window["Microsoft.Omnichannel.Calling.SDK"].VoiceVideoCalling,this.proxyInstance=this.proxy.getInstance()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setDebug=function(e){this.debug=e},t.prototype.useScenarioMarker=function(e){this.scenarioMarker=e},t.prototype.load=function(){return Ss(this,arguments,void 0,function(e){return e===void 0&&(e={}),Ts(this,function(n){return e.logger&&(this.logger=e.logger),this.proxyInstance.load(e),[2]})})},t.prototype.isInitialized=function(){return this.proxyInstance.isInitialized()},t.prototype.initialize=function(e){return Ss(this,void 0,void 0,function(){var n,r,i,o,s,l,c,a,u;return Ts(this,function(d){switch(d.label){case 0:return this.debug&&console.debug("[VoiceVideoCallingProxy] VoiceVideoCallingParams: ".concat(JSON.stringify(e))),this.callingParams=e,(r=this.scenarioMarker)===null||r===void 0||r.startScenario(An.default.InitializeVoiceVideoCallingSDK),this.debug&&console.debug("[VoiceVideoCallingProxy][initialize] _isLoaded: ".concat(this.proxyInstance._isLoaded)),this.proxyInstance._isLoaded?[3,2]:[4,this.proxyInstance.load({logger:this.logger||void 0})];case 1:d.sent(),d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this.proxyInstance.initialize({callClientName:this.callClientName,accesstoken:((o=(i=this.callingParams)===null||i===void 0?void 0:i.chatToken.voiceVideoCallToken)===null||o===void 0?void 0:o.Token)||((s=this.callingParams)===null||s===void 0?void 0:s.chatToken.token),selfVideoHTMLElementId:(l=this.callingParams)===null||l===void 0?void 0:l.selfVideoHTMLElementId,remoteVideoHTMLElementId:(c=this.callingParams)===null||c===void 0?void 0:c.remoteVideoHTMLElementId})];case 3:return d.sent(),(a=this.scenarioMarker)===null||a===void 0||a.completeScenario(An.default.InitializeVoiceVideoCallingSDK),[3,5];case 4:return n=d.sent(),console.log(n),(u=this.scenarioMarker)===null||u===void 0||u.failScenario(An.default.InitializeVoiceVideoCallingSDK),[3,5];case 5:return[2]}})})},t.prototype.addEventListener=function(e,n){var r=this;this.proxyInstance.registerEvent(e,function(i){var o=i.callId;e===bs.CallAdded&&(r.callId=o),r.debug&&console.debug("[VoiceVideoCallingProxy][".concat(e,"] callId: ").concat(o)),o===r.callId&&n(i)})},t.prototype.isMicrophoneMuted=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.isMicrophoneMuted({callClientName:n,callId:r})},t.prototype.acceptCall=function(){return Ss(this,arguments,void 0,function(e){var n,r,i,s,o,s,l,c,a,u,d,f;return e===void 0&&(e={}),Ts(this,function(h){switch(h.label){case 0:n=this,r=n.callClientName,i=n.callId,(l=this.scenarioMarker)===null||l===void 0||l.startScenario(e.withVideo?An.default.AcceptVideoCall:An.default.AcceptVoiceCall,{CallId:i||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][acceptCall] callId: ".concat(i)),this.debug&&console.debug(e),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.proxyInstance.acceptCall({callClientName:r,callId:i,withVideo:e.withVideo||!1})];case 2:return h.sent(),[3,4];case 3:return h.sent(),s={response:e.withVideo?"AcceptVideoCallFailed":"AcceptVoiceCallFailed"},(c=this.scenarioMarker)===null||c===void 0||c.failScenario(e.withVideo?An.default.AcceptVideoCall:An.default.AcceptVoiceCall,{CallId:i||"",ExceptionDetails:JSON.stringify(s)}),[3,4];case 4:o={SecondaryChannelType:e.withVideo?El.Video:El.Voice,SecondaryChannelEventType:Bh.Accept};try{(a=this.callingParams)===null||a===void 0||a.OCClient.makeSecondaryChannelEventRequest((u=this.callingParams)===null||u===void 0?void 0:u.chatToken.requestId,o),(d=this.scenarioMarker)===null||d===void 0||d.completeScenario(e.withVideo?An.default.AcceptVideoCall:An.default.AcceptVoiceCall,{CallId:i||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][acceptCall][makeSecondaryChannelEventRequest]")}catch(g){s={response:"OCClientMakeSecondaryChannelEventRequestFailed"},(f=this.scenarioMarker)===null||f===void 0||f.failScenario(e.withVideo?An.default.AcceptVideoCall:An.default.AcceptVoiceCall,{CallId:i||"",ExceptionDetails:JSON.stringify(s)}),console.error("[VoiceVideoCallingProxy][acceptCall][makeSecondaryChannelEventRequest] Failure ".concat(g))}return[2]}})})},t.prototype.rejectCall=function(){return Ss(this,void 0,void 0,function(){var e,n,r,o,i,o,s,l,c,a,u,d;return Ts(this,function(f){switch(f.label){case 0:e=this,n=e.callClientName,r=e.callId,(s=this.scenarioMarker)===null||s===void 0||s.startScenario(An.default.RejectCall,{CallId:r||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][rejectCall] callId: ".concat(r)),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.proxyInstance.rejectCall({callClientName:n,callId:r})];case 2:return f.sent(),(l=this.scenarioMarker)===null||l===void 0||l.completeScenario(An.default.RejectCall,{CallId:r||""}),[3,4];case 3:return f.sent(),o={response:"RejectCallFailed"},(c=this.scenarioMarker)===null||c===void 0||c.failScenario(An.default.RejectCall,{CallId:r||"",ExceptionDetails:JSON.stringify(o)}),[3,4];case 4:i={SecondaryChannelType:this.isRemoteVideoEnabled()?El.Video:El.Voice,SecondaryChannelEventType:Bh.Reject};try{(a=this.callingParams)===null||a===void 0||a.OCClient.makeSecondaryChannelEventRequest((u=this.callingParams)===null||u===void 0?void 0:u.chatToken.requestId,i),this.debug&&console.debug("[VoiceVideoCallingProxy][rejectCall][makeSecondaryChannelEventRequest]")}catch(h){o={response:"OCClientMakeSecondaryChannelEventRequestFailed"},(d=this.scenarioMarker)===null||d===void 0||d.failScenario(An.default.RejectCall,{CallId:r||"",ExceptionDetails:JSON.stringify(o)}),console.error("[VoiceVideoCallingProxy][rejectCall][makeSecondaryChannelEventRequest] Failure ".concat(h))}return[2]}})})},t.prototype.stopCall=function(){return Ss(this,void 0,void 0,function(){var e,n,r,i,o,s,l,c,a;return Ts(this,function(u){switch(u.label){case 0:e=this,n=e.callClientName,r=e.callId,(o=this.scenarioMarker)===null||o===void 0||o.startScenario(An.default.StopCall,{CallId:r||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][stopCall] callId: ".concat(r)),i=!!(!((l=(s=this.callingParams)===null||s===void 0?void 0:s.chatToken.voiceVideoCallToken)===null||l===void 0)&&l.Token),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.proxyInstance.stopCall({callClientName:n,callId:r,forEveryone:i})];case 2:return u.sent(),(c=this.scenarioMarker)===null||c===void 0||c.completeScenario(An.default.StopCall,{CallId:r||""}),[3,4];case 3:return u.sent(),(a=this.scenarioMarker)===null||a===void 0||a.failScenario(An.default.StopCall,{CallId:r||""}),[3,4];case 4:return[2]}})})},t.prototype.toggleMute=function(){return Ss(this,void 0,void 0,function(){var e,n,r;return Ts(this,function(i){return e=this,n=e.callClientName,r=e.callId,[2,this.proxyInstance.toggleMute({callClientName:n,callId:r})]})})},t.prototype.isRemoteVideoEnabled=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.isRemoteVideoEnabled({callClientName:n,callId:r})},t.prototype.isLocalVideoEnabled=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.isLocalVideoEnabled({callClientName:n,callId:r})},t.prototype.toggleLocalVideo=function(){return Ss(this,void 0,void 0,function(){var e,n,r;return Ts(this,function(i){return e=this,n=e.callClientName,r=e.callId,[2,this.proxyInstance.toggleLocalVideo({callClientName:n,callId:r})]})})},t.prototype.isInACall=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.isInACall({callClientName:n,callId:r})},t.prototype.renderVideoStreams=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.renderVideoStreams({callClientName:n,callId:r})},t.prototype.disposeVideoRenderers=function(){var e=this,n=e.callClientName,r=e.callId;return this.proxyInstance.disposeVideoRenderers({callClientName:n,callId:r})},t.prototype.close=function(){this.debug&&console.debug("[VoiceVideoCallingProxy][close]"),this.proxyInstance.dispose(),this.callingParams=void 0,this.callId=void 0},t.prototype.onCallAdded=function(e){var n=bs.CallAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,e)},t.prototype.onLocalVideoStreamAdded=function(e){var n=bs.LocalVideoStreamAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,e)},t.prototype.onLocalVideoStreamRemoved=function(e){var n=bs.LocalVideoStreamRemoved;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,e)},t.prototype.onRemoteVideoStreamAdded=function(e){var n=bs.RemoteVideoStreamAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,e)},t.prototype.onRemoteVideoStreamRemoved=function(e){var n=bs.RemoteVideoStreamRemoved;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,e)},t.prototype.onCallDisconnected=function(e){var n=this,r=bs.CallDisconnected;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(r,"]")),this.addEventListener(r,function(i){return Ss(n,void 0,void 0,function(){var o,s,l,c,a,u,d;return Ts(this,function(f){o={SecondaryChannelType:El.Voice,SecondaryChannelEventType:Bh.End},(l=this.scenarioMarker)===null||l===void 0||l.startScenario(An.default.OnCallDisconnected,{CallId:this.callId||""});try{(c=this.callingParams)===null||c===void 0||c.OCClient.makeSecondaryChannelEventRequest((a=this.callingParams)===null||a===void 0?void 0:a.chatToken.requestId,o),this.debug&&console.debug("[VoiceVideoCallingProxy][onCallDisconnected][makeSecondaryChannelEventRequest]"),(u=this.scenarioMarker)===null||u===void 0||u.completeScenario(An.default.OnCallDisconnected,{CallId:this.callId||""})}catch(h){console.error("[VoiceVideoCallingProxy][onCallDisconnected][makeSecondaryChannelEventRequest] Failure ".concat(h)),s={response:"OCClientMakeSecondaryChannelEventRequestFailed"},(d=this.scenarioMarker)===null||d===void 0||d.failScenario(An.default.OnCallDisconnected,{CallId:this.callId||"",ExceptionDetails:JSON.stringify(s)})}return this.clearRemoteVideoElementChildren(),e(i),[2]})})})},t.prototype.clearRemoteVideoElementChildren=function(){var e,n;if(!((e=this.callingParams)===null||e===void 0)&&e.remoteVideoHTMLElementId)for(var r=document.getElementById((n=this.callingParams)===null||n===void 0?void 0:n.remoteVideoHTMLElementId);r!=null&&r.firstChild;)this.debug&&console.debug("[VoiceVideoCallingProxy][clearRemoteVideoElement]"),r.firstChild.remove()},t}();fp.VoiceVideoCallingProxy=aH;var ige=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ss(void 0,rge([],t,!0),void 0,function(n){var r;return n===void 0&&(n={}),Ts(this,function(i){switch(i.label){case 0:return r=aH.getInstance(),[4,r.load({logger:n.logger||void 0})];case 1:return i.sent(),[2,Promise.resolve(r)]}})})};fp.default=ige;var lH={};(function(t){var e=_e&&_e.__assign||function(){return e=Object.assign||function(o){for(var s,l=1,c=arguments.length;l<c;l++){s=arguments[l];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a])}return o},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.suppressConversationDetailsRetrievalFailure=t.suppressChatSDKError=void 0;var n=Us,r=function(o,s,l,c,a,u){a===void 0&&(a={}),u===void 0&&(u="");var d={response:o};s&&(d.errorObject="".concat(s)),l.failScenario(c,e(e({},a),{ExceptionDetails:JSON.stringify(d)})),u&&(d.message=u,console.error(u))};t.suppressChatSDKError=r;var i=function(o,s,l,c){c===void 0&&(c={}),(0,t.suppressChatSDKError)(n.ChatSDKErrorName.ConversationDetailsRetrievalFailure,o,s,l,c)};t.suppressConversationDetailsRetrievalFailure=i,t.default={suppressChatSDKError:t.suppressChatSDKError,suppressConversationDetailsRetrievalFailure:t.suppressConversationDetailsRetrievalFailure}})(lH);var rC={},oge=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},sge=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(rC,"__esModule",{value:!0});rC.getLocationInfo=void 0;var aT=Vs,cN=tp,age=function(t,e,n){return oge(void 0,void 0,void 0,function(){var r;return sge(this,function(i){return r=function(o,s){console.error(o,s);var l;try{l=JSON.stringify({Response:o,ExceptionalDetails:s})}catch{l=JSON.stringify({Response:o})}t.failScenario(aT.default.GetGeolocation,{RequestId:n,ChatId:e,ExceptionDetails:l})},[2,new Promise(function(o,s){t.startScenario(aT.default.GetGeolocation,{RequestId:n});var l={latitude:"",longitude:""};(cN.default.isNode()||cN.default.isReactNative()||!navigator.geolocation)&&(r("Unsupported"),o(l));var c=function(u){try{l.latitude=u.coords.latitude.toString(),l.longitude=u.coords.longitude.toString(),t.completeScenario(aT.default.GetGeolocation,{RequestId:n,ChatId:e}),o(l)}catch(d){r("GetGeolocationFailed",d),o(l)}},a=function(u){r("GetGeolocationFailed",u),o(l)};navigator.geolocation.getCurrentPosition(c,a)})]})})};rC.getLocationInfo=age;var iC={},LA={};Object.defineProperty(LA,"__esModule",{value:!0});var Yw;(function(t){t.ERR_NETWORK="ERR_NETWORK"})(Yw||(Yw={}));LA.default=Yw;Object.defineProperty(iC,"__esModule",{value:!0});iC.isCoreServicesOrgUrlDNSError=void 0;var lge=LA,cge=function(t,e,n){var r=t.isAxiosError&&t.code==lge.default.ERR_NETWORK;return!!(r&&e&&n)};iC.isCoreServicesOrgUrlDNSError=cge;var pp={};Object.defineProperty(pp,"__esModule",{value:!0});pp.parseLowerCaseString=void 0;var cH=function(t){return String(t).toLowerCase()};pp.parseLowerCaseString=cH;pp.default={parseLowerCaseString:cH};var UA={},FA={};Object.defineProperty(FA,"__esModule",{value:!0});var uge=["crm4.omnichannelengagementhub.com","crm12.omnichannelengagementhub.com","crm16.omnichannelengagementhub.com","crm17.omnichannelengagementhub.com","crm19.omnichannelengagementhub.com","crm11.omnichannelengagementhub.com","eu.omnichannelengagementhub.com","fr.omnichannelengagementhub.com","de.omnichannelengagementhub.com","ch.omnichannelengagementhub.com","uk.omnichannelengagementhub.com"];FA.default=uge;var BA={};Object.defineProperty(BA,"__esModule",{value:!0});var dge=["gov.omnichannelengagementhub.us","-crm9"];BA.default=dge;Object.defineProperty(UA,"__esModule",{value:!0});var uN=FA,dN=BA,hge=function(t){var e="https://browser.pipe.aria.microsoft.com/Collector/3.0/",n="https://eu-mobile.events.data.microsoft.com/Collector/3.0/",r="https://tb.pipe.aria.microsoft.com/Collector/3.0/",i=t;t.endsWith("/")&&(i=t.replace("/",""));for(var o=0;o<uN.default.length;o++)if(i.endsWith(uN.default[o]))return n;for(var o=0;o<dN.default.length;o++)if(i.includes(dN.default[o]))return r;return e};UA.default=hge;var $A={},lT=_e&&_e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty($A,"__esModule",{value:!0});var fge=function(t,e){var n=oH.version,r="omnichannel-chat-sdk/".concat(n);t.ocUserAgent||(t.ocUserAgent=[]),t.ocUserAgent=lT([r],t.ocUserAgent,!0),e&&(t.ocUserAgent=lT(lT([],e,!0),t.ocUserAgent,!0))};$A.default=fge;var HA={},pge=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},gge=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(HA,"__esModule",{value:!0});var mge=il,Qg=Vs,vge=ep,yge=function(t,e,n,r,i,o){return pge(void 0,void 0,void 0,function(){var s,l;return gge(this,function(c){switch(c.label){case 0:if(t||vge.default.throwUninitializedChatSDK(e,Qg.default.StartPolling),n!==mge.default.V2)return[3,4];e.startScenario(Qg.default.StartPolling),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o==null?void 0:o.startPolling()];case 2:return c.sent(),e.completeScenario(Qg.default.StartPolling),[3,4];case 3:return s=c.sent(),l={errorObject:"".concat(s)},e.failScenario(Qg.default.StartPolling,{RequestId:r,ChatId:i,ExceptionDetails:JSON.stringify(l)}),[3,4];case 4:return[2]}})})};HA.default=yge;var qA={},Cge=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},Sge=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(qA,"__esModule",{value:!0});var Tge=il,Xg=Vs,Ege=ep,wge=function(t,e,n,r,i,o){return Cge(void 0,void 0,void 0,function(){var s,l;return Sge(this,function(c){switch(c.label){case 0:if(t||Ege.default.throwUninitializedChatSDK(e,Xg.default.StopPolling),n!==Tge.default.V2)return[3,4];e.startScenario(Xg.default.StopPolling),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o==null?void 0:o.stopPolling()];case 2:return c.sent(),e.completeScenario(Xg.default.StopPolling),[3,4];case 3:return s=c.sent(),l={errorObject:"".concat(s)},e.failScenario(Xg.default.StopPolling,{RequestId:r,ChatId:i,ExceptionDetails:JSON.stringify(l)}),[3,4];case 4:return[2]}})})};qA.default=wge;var jA={};Object.defineProperty(jA,"__esModule",{value:!0});var Ige=["orgUrl","orgId","widgetId"],bge=function(t){if(!t)throw new Error("OmnichannelConfiguration not found");for(var e=0,n=Ige;e<n.length;e++){var r=n[e],i=Reflect.has(t,r);if(!i)throw new Error("Missing '".concat(r,"' in OmnichannelConfiguration"));var o=Reflect.get(t,r);if(!o||typeof o=="string"&&o.trim().length===0||o.length===0)throw new Error("Empty '".concat(r,"' in OmnichannelConfiguration"))}};jA.default=bge;var Ir=_e&&_e.__assign||function(){return Ir=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ir.apply(this,arguments)},nt=_e&&_e.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},rt=_e&&_e.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return c([a,u])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},cT=_e&&_e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(_b,"__esModule",{value:!0});var Mc=tn,hN=kf,Yn=Us,fN=ql,eo=Kv,uT=Ms,Dc=K$,Nc=ab,ht=ep,nh=tl,Yg=Uo,Zg=J$,dT=np,_ge=Gu,Ei=Wy,Age=X$(),hT=oA,ys=zy,Rge=sA,fT=Ku,pN=If,pT=Yl,gN=Tf,sn=il,em=aA,gT=Xu,mN=Lf,tm=Wu,mT=lA,vT=bf,yT=_f,kge=Xv,CT=Ky,be=Vs,Pge=fr,vN=cA,ST=EA,Oge=dy,Mge=IA,Dge=fp,TT=hy,Nge=lH,xge=rC,Lge=iC,Cs=Ab,rh=pp,wi=tp,Uge=UA,yN=$A,Fge=HA,Bge=qA,CN=Va,$ge=jA,Hge=function(){function t(e,n){n===void 0&&(n=dT.defaultChatSDKConfig);var r=this,i,o,s,l,c,a,u;this.ACSClient=null,this.AMSClient=null,this.sessionId=null,this.chatOperationInProgress=!1,this.pendingOperations=[],this.unqServicesOrgUrl=null,this.coreServicesOrgUrl=null,this.dynamicsLocationCode=null,this.widgetSnippetBaseUrl="",this.dataMaskingRules={rules:[]},this.authSettings=null,this.authenticatedUserToken=null,this.conversation=null,this.callingOption=hT.default.NoCalling,this.telemetry=null,this.ic3ClientLogger=null,this.ocSdkLogger=null,this.acsClientLogger=null,this.acsAdapterLogger=null,this.callingSdkLogger=null,this.amsClientLogger=null,this.isPersistentChat=!1,this.isChatReconnect=!1,this.reconnectId=null,this.refreshTokenTimer=null,this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.NOT_LOADED,this.isMaskingDisabled=!1,this.maskingCharacter="#",this.botCSPId=null,this.isAMSClientAllowed=!1,this.debugSDK=!1,this.debugAMS=!1,this.debugACS=!1,this.detailedDebugEnabled=!1,this.populateInitChatOptionalParam=function(f,h,g){if(f.initContext.locale=(0,Nc.getLocaleStringFromId)(r.localeId),h!=null&&h.customContext){var E=h==null?void 0:h.customContext;if(typeof E=="object")for(var D in E)(E[D].value===null||E[D].value===void 0||E[D].value==="")&&delete E[D];f.initContext.customContextData=h==null?void 0:h.customContext}if(h.browser&&(f.initContext.browser=h.browser),h.os&&(f.initContext.os=h.os),h.locale&&(f.initContext.locale=h.locale),h.device&&(f.initContext.device=h.device),h.preChatResponse&&(f.initContext.preChatResponse=h.preChatResponse),h.portalContactId&&(f.initContext.portalcontactid=h.portalContactId),h.sendDefaultInitContext){if(wi.default.isNode()||wi.default.isReactNative()){var w="sendDefaultInitContext is only supported on browser",p={RequestId:r.requestId,ChatId:r.chatToken.chatId};ht.default.throwUnsupportedPlatform(r.scenarioMarker,g,w,p)}f.getContext=!0}return h.initContext&&(f.initContext=h.initContext),r.authenticatedUserToken&&(f.authenticatedUserToken=r.authenticatedUserToken),r.chatToken.chatId&&(f.initContext.chatId=r.chatToken.chatId),f},this.debug=!1,this.debugSDK=!1,this.debugAMS=!1,this.debugACS=!1,this.detailedDebugEnabled=!1,this.runtimeId=(0,nh.getRuntimeId)((o=(i=n==null?void 0:n.telemetry)===null||i===void 0?void 0:i.runtimeId)!==null&&o!==void 0?o:null),this.omnichannelConfig=e,this.chatSDKConfig=Ir(Ir({},dT.defaultChatSDKConfig),n),this.isInitialized=!1,this.liveChatVersion=sn.default.V2,this.localeId=Nc.defaultLocaleId,this.requestId=(0,eo.uuidv4)(),this.chatToken={},this.liveChatConfig={},this.authSettings=null,this.preChatSurvey=null,this.telemetry=(0,Mge.default)(this.debug),this.scenarioMarker=new kge.default(this.omnichannelConfig),this.ic3ClientLogger=(0,Mc.createIC3ClientLogger)(this.omnichannelConfig),this.ocSdkLogger=(0,Mc.createOCSDKLogger)(this.omnichannelConfig),this.acsClientLogger=(0,Mc.createACSClientLogger)(this.omnichannelConfig),this.acsAdapterLogger=(0,Mc.createACSAdapterLogger)(this.omnichannelConfig),this.callingSdkLogger=(0,Mc.createCallingSDKLogger)(this.omnichannelConfig),this.amsClientLogger=(0,Mc.createAMSClientLogger)(this.omnichannelConfig),this.scenarioMarker.useTelemetry(this.telemetry),Cs.default.useTelemetry(this.telemetry,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),this.scenarioMarker.setRuntimeId(this.runtimeId),Cs.default.setRuntimeId(this.runtimeId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),(0,$ge.default)(e),(0,dT.default)(n),!((s=this.chatSDKConfig.telemetry)===null||s===void 0)&&s.disable&&((l=this.telemetry)===null||l===void 0||l.disable());var d=(0,Uge.default)(this.omnichannelConfig.orgUrl);!((c=this.chatSDKConfig.telemetry)===null||c===void 0)&&c.ariaCollectorUri?this.telemetry.setCollectorUri((a=this.chatSDKConfig.telemetry)===null||a===void 0?void 0:a.ariaCollectorUri):this.telemetry.setCollectorUri(d),!((u=this.chatSDKConfig.telemetry)===null||u===void 0)&&u.ariaTelemetryKey&&this.telemetry.initialize(this.chatSDKConfig.telemetry.ariaTelemetryKey),this.chatSDKConfig.dataMasking&&(this.isMaskingDisabled=this.chatSDKConfig.dataMasking.disable,this.maskingCharacter=this.chatSDKConfig.dataMasking.maskingCharacter),e.cpsBotId&&(this.botCSPId=e.cpsBotId),Cs.default.setRequestId(this.requestId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)}return t.prototype.executeWithLock=function(e){return nt(this,void 0,void 0,function(){var n=this;return rt(this,function(r){return[2,new Promise(function(i,o){var s=function(){return nt(n,void 0,void 0,function(){var l,c;return rt(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),[4,e()];case 1:return l=a.sent(),i(l),[3,4];case 2:return c=a.sent(),o(c),[3,4];case 3:return this.chatOperationInProgress=!1,this.processNextOperation(),[7];case 4:return[2]}})})};n.chatOperationInProgress?n.pendingOperations.push(s):(n.chatOperationInProgress=!0,s())})]})})},t.prototype.processNextOperation=function(){if(this.pendingOperations.length>0){this.chatOperationInProgress=!0;var e=this.pendingOperations.shift();e()}},t.prototype.setDebug=function(e){var n;this.detailedDebugEnabled=!1,this.debug=e,(n=this.telemetry)===null||n===void 0||n.setDebug(e),this.scenarioMarker.setDebug(e),this.AMSClient&&this.AMSClient.setDebug(e),Cs.default.setDebug(e,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)},t.prototype.setDebugDetailed=function(e){var n;this.detailedDebugEnabled=!0,this.debug=(e==null?void 0:e.flagSDK)===!0,this.debugACS=(e==null?void 0:e.flagACS)===!0,this.debugAMS=(e==null?void 0:e.flagAttachment)===!0,(n=this.telemetry)===null||n===void 0||n.setDebug(this.debug),this.scenarioMarker.setDebug(this.debug),this.AMSClient&&this.AMSClient.setDebug(this.debugAMS),Cs.default.setDebugDetailed(this.debug,this.debugACS,this.debugAMS,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger)},t.prototype.retryLoadAMSClient=function(){return nt(this,void 0,void 0,function(){var e,n,r;return rt(this,function(i){switch(i.label){case 0:e=1e3,n=30,r=0,i.label=1;case 1:return r<n?this.AMSClient?[2,this.AMSClient]:[4,(0,Yg.sleep)(e)]:[3,3];case 2:return i.sent(),r++,[3,1];case 3:return[2,null]}})})},t.prototype.getAMSClient=function(){return nt(this,void 0,void 0,function(){var e;return rt(this,function(n){switch(n.label){case 0:if(this.isAMSClientAllowed===!1)return[2,null];if(this.AMSClientLoadCurrentState===Ei.AMSClientLoadStates.NOT_LOADED&&this.liveChatVersion===sn.default.V1)return[2,null];switch(e=this.AMSClientLoadCurrentState,e){case Ei.AMSClientLoadStates.LOADED:return[3,1];case Ei.AMSClientLoadStates.LOADING:return[3,2];case Ei.AMSClientLoadStates.ERROR:return[3,4];case Ei.AMSClientLoadStates.NOT_LOADED:return[3,4]}return[3,6];case 1:return this.debug&&console.log("Attachment handler is already loaded"),[2,this.AMSClient];case 2:return this.debug&&console.log("Attachment handler is loading, waiting for it to be ready"),[4,this.retryLoadAMSClient()];case 3:return[2,n.sent()];case 4:return this.debug&&console.log("Attachment handler is not loaded, loading now"),[4,this.loadAmsClient()];case 5:return n.sent(),[2,this.AMSClient];case 6:return[2,null]}})})},t.prototype.loadInitComponents=function(){return nt(this,void 0,void 0,function(){var e,n;return rt(this,function(r){switch(r.label){case 0:return this.scenarioMarker.startScenario(be.default.InitializeComponents),e=[sn.default.V1,sn.default.V2],e.includes(this.liveChatVersion)||ht.default.throwUnsupportedLiveChatVersionFailure(new Error(Yn.ChatSDKErrorName.UnsupportedLiveChatVersion),this.scenarioMarker,be.default.InitializeComponents),this.liveChatVersion!==sn.default.V2?[3,1]:(this.ACSClient=new hN.default(this.acsClientLogger),[3,3]);case 1:return n=this,[4,this.getIC3Client()];case 2:n.IC3Client=r.sent(),r.label=3;case 3:return this.scenarioMarker.completeScenario(be.default.InitializeComponents),[2]}})})},t.prototype.evaluateAMSAvailability=function(){var e,n,r,i;return(((n=(e=this.liveChatConfig)===null||e===void 0?void 0:e.LiveWSAndLiveChatEngJoin)===null||n===void 0?void 0:n.msdyn_enablefileattachmentsforcustomers)==="true"||((i=(r=this.liveChatConfig)===null||r===void 0?void 0:r.LiveWSAndLiveChatEngJoin)===null||i===void 0?void 0:i.msdyn_enablefileattachmentsforagents)==="true")&&this.liveChatVersion===sn.default.V2?(this.isAMSClientAllowed=!0,this.isAMSClientAllowed):this.isAMSClientAllowed},t.prototype.loadAmsClient=function(){return nt(this,void 0,void 0,function(){var e,n,r,i,o,s,l,c,a;return rt(this,function(u){switch(u.label){case 0:this.scenarioMarker.startScenario(be.default.InitializeMessagingClient),u.label=1;case 1:return u.trys.push([1,4,,5]),this.isAMSClientAllowed?this.AMSClientLoadCurrentState!==Ei.AMSClientLoadStates.NOT_LOADED?[3,3]:(this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.LOADING,this.debug&&console.time("ams_creation"),e=((l=(s=this.chatSDKConfig)===null||s===void 0?void 0:s.internalConfig)===null||l===void 0?void 0:l.disableAMSWhitelistedUrls)!==!1,n=((a=(c=this.chatSDKConfig)===null||c===void 0?void 0:c.internalConfig)===null||a===void 0?void 0:a.disableAMSRegionBasedUrl)===!0,r=(0,Zg.shouldUseFramedMode)(e),i=this,[4,(0,vN.default)({framedMode:r,multiClient:!0,debug:this.detailedDebugEnabled?this.debugAMS:this.debug,logger:this.amsClientLogger,baseUrl:r&&!n?(0,Zg.retrieveRegionBasedUrl)(this.widgetSnippetBaseUrl):""})]):[3,3];case 2:i.AMSClient=u.sent(),this.debug&&console.timeEnd("ams_creation"),this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.LOADED,u.label=3;case 3:return this.scenarioMarker.completeScenario(be.default.InitializeMessagingClient),[3,5];case 4:return o=u.sent(),this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.ERROR,ht.default.throwMessagingClientCreationFailure(o,this.scenarioMarker,be.default.InitializeMessagingClient),[3,5];case 5:return[2]}})})},t.prototype.parallelInitialization=function(){return nt(this,arguments,void 0,function(e){var n,r;return e===void 0&&(e={}),rt(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.scenarioMarker.startScenario(be.default.InitializeChatSDKParallel),this.isInitialized?(this.scenarioMarker.completeScenario(be.default.InitializeChatSDKParallel),[2,this.liveChatConfig]):(this.useCoreServicesOrgUrlIfNotSet(),[4,Promise.all([this.loadInitComponents(),this.loadChatConfig(e)])]);case 1:return i.sent(),this.loadAmsClient(),this.isInitialized=!0,this.scenarioMarker.completeScenario(be.default.InitializeChatSDKParallel),[3,3];case 2:throw n=i.sent(),r={RequestId:this.requestId,ExceptionDetails:n instanceof Yn.ChatSDKError?JSON.stringify(n.exceptionDetails):"".concat(n)},this.scenarioMarker.failScenario(be.default.InitializeChatSDKParallel,r),n;case 3:return[2,this.liveChatConfig]}})})},t.prototype.sequentialInitialization=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,l,c,a,u,d,f,h,g,E,D,w,p;return e===void 0&&(e={}),rt(this,function(b){switch(b.label){case 0:if(this.scenarioMarker.startScenario(be.default.InitializeChatSDK),this.isInitialized)return this.scenarioMarker.completeScenario(be.default.InitializeChatSDK),[2,this.liveChatConfig];this.useCoreServicesOrgUrlIfNotSet(),n=(0,Dc.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl),b.label=1;case 1:return b.trys.push([1,3,,4]),this.OCSDKProvider=eo.SDKProvider,r=this,[4,eo.SDKProvider.getSDK(this.omnichannelConfig,(0,ST.default)(n),this.ocSdkLogger)];case 2:return r.OCClient=b.sent(),(0,yN.default)(this.OCClient,(g=this.chatSDKConfig)===null||g===void 0?void 0:g.ocUserAgent),[3,4];case 3:return i=b.sent(),ht.default.throwOmnichannelClientInitializationFailure(i,this.scenarioMarker,be.default.InitializeChatSDK),[3,4];case 4:return b.trys.push([4,6,,7]),o=e.getLiveChatConfigOptionalParams,[4,this.getChatConfig(o||{})];case 5:return b.sent(),[3,7];case 6:return s=b.sent(),ht.default.throwChatConfigRetrievalFailure(s,this.scenarioMarker,be.default.InitializeChatSDK),[3,7];case 7:l=[sn.default.V1,sn.default.V2],l.includes(this.liveChatVersion)||ht.default.throwUnsupportedLiveChatVersionFailure(new Error(Yn.ChatSDKErrorName.UnsupportedLiveChatVersion),this.scenarioMarker,be.default.InitializeChatSDK),b.label=8;case 8:return b.trys.push([8,14,,15]),this.liveChatVersion!==sn.default.V2?[3,11]:(this.ACSClient=new hN.default(this.acsClientLogger),this.isAMSClientAllowed&&this.AMSClientLoadCurrentState===Ei.AMSClientLoadStates.NOT_LOADED?(this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.LOADING,this.debug&&console.time("ams_seq_creation"),c=((D=(E=this.chatSDKConfig)===null||E===void 0?void 0:E.internalConfig)===null||D===void 0?void 0:D.disableAMSWhitelistedUrls)!==!1,a=((p=(w=this.chatSDKConfig)===null||w===void 0?void 0:w.internalConfig)===null||p===void 0?void 0:p.disableAMSRegionBasedUrl)===!0,u=(0,Zg.shouldUseFramedMode)(c),d=this,[4,(0,vN.default)({framedMode:u,multiClient:!0,debug:this.detailedDebugEnabled?this.debugAMS:this.debug,logger:this.amsClientLogger,baseUrl:u&&!a?(0,Zg.retrieveRegionBasedUrl)(this.widgetSnippetBaseUrl):""})]):[3,10]);case 9:d.AMSClient=b.sent(),this.debug&&console.timeEnd("ams_seq_creation"),this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.LOADED,b.label=10;case 10:return[3,13];case 11:return this.liveChatVersion!==sn.default.V1?[3,13]:(f=this,[4,this.getIC3Client()]);case 12:f.IC3Client=b.sent(),b.label=13;case 13:return this.isInitialized=!0,this.scenarioMarker.completeScenario(be.default.InitializeChatSDK),[3,15];case 14:return h=b.sent(),this.AMSClientLoadCurrentState=Ei.AMSClientLoadStates.ERROR,ht.default.throwMessagingClientCreationFailure(h,this.scenarioMarker,be.default.InitializeChatSDK),[3,15];case 15:return[2,this.liveChatConfig]}})})},t.prototype.initialize=function(){return nt(this,arguments,void 0,function(e){var n;return e===void 0&&(e={}),rt(this,function(r){switch(r.label){case 0:return n=e.useParallelLoad,n!==!0?[3,2]:[4,this.parallelInitialization(e)];case 1:return[2,r.sent()];case 2:return[4,this.sequentialInitialization(e)];case 3:return[2,r.sent()]}})})},t.prototype.loadChatConfig=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o;return e===void 0&&(e={}),rt(this,function(s){switch(s.label){case 0:this.scenarioMarker.startScenario(be.default.InitializeLoadChatConfig),n=(0,Dc.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl);try{this.OCSDKProvider=eo.SDKProvider,this.OCClient=eo.SDKProvider.getSDK(this.omnichannelConfig,(0,ST.default)(n),this.ocSdkLogger),(0,yN.default)(this.OCClient,(o=this.chatSDKConfig)===null||o===void 0?void 0:o.ocUserAgent)}catch(l){ht.default.throwOmnichannelClientInitializationFailure(l,this.scenarioMarker,be.default.InitializeLoadChatConfig)}s.label=1;case 1:return s.trys.push([1,3,,4]),r=e.getLiveChatConfigOptionalParams,[4,this.getChatConfig(r||{})];case 2:return s.sent(),[3,4];case 3:return i=s.sent(),ht.default.throwChatConfigRetrievalFailure(i,this.scenarioMarker,be.default.InitializeLoadChatConfig),[3,4];case 4:return this.scenarioMarker.completeScenario(be.default.InitializeLoadChatConfig),[2]}})})},t.prototype.getChatReconnectContextWithAuthToken=function(){return nt(this,void 0,void 0,function(){var e,n,r,i,o,s;return rt(this,function(l){switch(l.label){case 0:this.scenarioMarker.startScenario(be.default.GetChatReconnectContextWithAuthToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),e={reconnectId:null,redirectURL:null},l.label=1;case 1:return l.trys.push([1,3,,4]),n={authenticatedUserToken:this.authenticatedUserToken,requestId:this.requestId},[4,this.OCClient.getReconnectableChats(n)];case 2:return r=l.sent(),r&&r.reconnectid&&(e.reconnectId=r.reconnectid),this.scenarioMarker.completeScenario(be.default.GetChatReconnectContextWithAuthToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return i=l.sent(),o={response:"OCClientGetReconnectableChatsFailed"},s={RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(o)},(0,nh.isClientIdNotFoundErrorMessage)(i)&&ht.default.throwAuthContactIdNotFoundFailure(i,this.scenarioMarker,be.default.GetChatReconnectContextWithAuthToken,s),this.scenarioMarker.failScenario(be.default.GetChatReconnectContextWithAuthToken,s),console.error("OmnichannelChatSDK/GetChatReconnectContextWithAuthToken/error ".concat(i)),[3,4];case 4:return[2,e]}})})},t.prototype.getChatReconnectContextWithReconnectId=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o;return e===void 0&&(e={}),rt(this,function(s){switch(s.label){case 0:if(this.scenarioMarker.startScenario(be.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),n={reconnectId:null,redirectURL:null},!e.reconnectId)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.OCClient.getReconnectAvailability(e.reconnectId,{requestId:this.requestId})];case 2:return r=s.sent(),r&&!r.isReconnectAvailable?r.reconnectRedirectionURL&&(n.redirectURL=r.reconnectRedirectionURL):n.reconnectId=e.reconnectId,this.scenarioMarker.completeScenario(be.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return i=s.sent(),o={response:"OCClientGetReconnectAvailabilityFailed"},this.scenarioMarker.failScenario(be.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(o)}),console.error("OmnichannelChatSDK/GetChatReconnectContextWithReconnectId/error ".concat(i)),[3,4];case 4:return[2,n]}})})},t.prototype.getChatReconnectContext=function(){return nt(this,arguments,void 0,function(e){var n;return e===void 0&&(e={}),rt(this,function(r){switch(r.label){case 0:return this.scenarioMarker.startScenario(be.default.GetChatReconnectContext,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetChatReconnectContext),this.requestId||(this.requestId=(0,eo.uuidv4)()),n={reconnectId:null,redirectURL:null},[4,this.getChatReconnectContextWithReconnectId(e)];case 1:return n=r.sent(),n.redirectURL&&n.redirectURL.length>0?[2,n]:this.authenticatedUserToken?[4,this.getChatReconnectContextWithAuthToken()]:[3,3];case 2:n=r.sent(),r.label=3;case 3:return this.scenarioMarker.completeScenario(be.default.GetChatReconnectContext,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,n]}})})},t.prototype.startChat=function(){return nt(this,arguments,void 0,function(e){var n=this;return e===void 0&&(e={}),rt(this,function(r){return[2,this.executeWithLock(function(){return n.internalStartChat(e)})]})})},t.prototype.internalStartChat=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,a,l,a,a,c,a,u,d,f,h,g,E,D,w=this,p,b,j,K,M,ne,G,oe,J,X,B;return e===void 0&&(e={}),rt(this,function(q){switch(q.label){case 0:return this.scenarioMarker.startScenario(be.default.StartChat,{RequestId:this.requestId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.StartChat),this.requestId||(this.requestId=(0,eo.uuidv4)()),n=!wi.default.isNode()&&!wi.default.isReactNative()&&!this.IC3Client&&this.liveChatVersion===sn.default.V1,n?(r=this,[4,this.getIC3Client()]):[3,2];case 1:r.IC3Client=q.sent(),q.label=2;case 2:if(this.isChatReconnect&&!(!((p=this.chatSDKConfig.chatReconnect)===null||p===void 0)&&p.disable)&&!this.isPersistentChat&&e.reconnectId&&(this.reconnectId=e.reconnectId),!(this.isPersistentChat&&!(!((b=this.chatSDKConfig.persistentChat)===null||b===void 0)&&b.disable)))return[3,6];q.label=3;case 3:return q.trys.push([3,5,,6]),i={authenticatedUserToken:this.authenticatedUserToken,requestId:this.requestId},[4,this.OCClient.getReconnectableChats(i)];case 4:return o=q.sent(),o&&o.reconnectid&&(this.reconnectId=o.reconnectid),[3,6];case 5:return s=q.sent(),a={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwPersistentChatConversationRetrievalFailure(s,this.scenarioMarker,be.default.StartChat,a),[3,6];case 6:return e.liveChatContext&&Object.keys(e.liveChatContext).length>0&&!this.reconnectId?(this.chatToken=e.liveChatContext.chatToken||{},this.requestId=e.liveChatContext.requestId||(0,eo.uuidv4)(),this.sessionId=e.liveChatContext.sessionId||null,[4,this.getConversationDetails()]):[3,8];case 7:l=q.sent(),Object.keys(l).length===0&&(a={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwInvalidConversation(this.scenarioMarker,be.default.StartChat,a)),(l.state===em.default.WrapUp||l.state===em.default.Closed)&&(console.error("Unable to join conversation that's in '".concat(l.state,"' state")),a={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwClosedConversation(this.scenarioMarker,be.default.StartChat,a)),q.label=8;case 8:return this.authSettings?this.authenticatedUserToken?[3,10]:[4,this.setAuthTokenProvider(this.chatSDKConfig.getAuthToken,{throwError:!0})]:[3,14];case 9:q.sent(),q.label=10;case 10:if(!(e.liveChatContext&&Object.keys(e.liveChatContext).length>0))return[3,14];this.chatToken=e.liveChatContext.chatToken||{},this.requestId=e.liveChatContext.requestId||(0,eo.uuidv4)(),q.label=11;case 11:return q.trys.push([11,13,,14]),[4,this.OCClient.validateAuthChatRecord(this.requestId,{authenticatedUserToken:this.authenticatedUserToken,chatId:this.chatToken.chatId})];case 12:return q.sent(),[3,14];case 13:return c=q.sent(),a={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwAuthenticatedChatConversationRetrievalFailure(c,this.scenarioMarker,be.default.StartChat,a),[3,14];case 14:return!((j=this.chatSDKConfig.useCreateConversation)===null||j===void 0)&&j.disable&&this.chatToken&&Object.keys(this.chatToken).length===0?[4,this.getChatToken(!1)]:[3,16];case 15:q.sent(),q.label=16;case 16:return!((K=this.chatToken)===null||K===void 0)&&K.chatId&&Cs.default.setChatId(this.chatToken.chatId||"",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),u={initContext:{}},u=this.populateInitChatOptionalParam(u,e,be.default.StartChat),u.initContext.isProactiveChat=!!e.isProactiveChat,e.platform&&(u.initContext.platform=e.platform),e.handle&&(u.initContext.handle=e.handle),this.isPersistentChat&&!(!((M=this.chatSDKConfig.persistentChat)===null||M===void 0)&&M.disable)?u.reconnectId=this.reconnectId:this.isChatReconnect&&!(!((ne=this.chatSDKConfig.chatReconnect)===null||ne===void 0)&&ne.disable)&&!this.isPersistentChat&&(u.reconnectId=this.reconnectId),(0,rh.parseLowerCaseString)((oe=(G=this.liveChatConfig)===null||G===void 0?void 0:G.LiveWSAndLiveChatEngJoin)===null||oe===void 0?void 0:oe.msdyn_requestvisitorlocation)!=="true"?[3,18]:[4,(0,xge.getLocationInfo)(this.scenarioMarker,this.chatToken.chatId,this.requestId)];case 17:d=q.sent(),u.initContext.latitude=d.latitude,u.initContext.longitude=d.longitude,q.label=18;case 18:return f=function(){return nt(w,void 0,void 0,function(){var F,x,P,v,T;return rt(this,function(_){switch(_.label){case 0:if(e.liveChatContext)return[3,4];_.label=1;case 1:return _.trys.push([1,3,,4]),[4,this.OCClient.sessionInit(this.requestId,u)];case 2:return _.sent(),[3,4];case 3:return F=_.sent(),x={RequestId:this.requestId,ChatId:this.chatToken.chatId},F!=null&&F.isAxiosError&&((T=(v=(P=F.response)===null||P===void 0?void 0:P.headers)===null||v===void 0?void 0:v.errorcode)===null||T===void 0?void 0:T.toString())===mT.default.WidgetUseOutsideOperatingHour.toString()&&ht.default.throwWidgetUseOutsideOperatingHour(F,this.scenarioMarker,be.default.StartChat,x),ht.default.throwConversationInitializationFailure(F,this.scenarioMarker,be.default.StartChat,x),[3,4];case 4:return[2]}})})},h=function(){return nt(w,void 0,void 0,function(){var F,x,P,v,T,_;return rt(this,function(N){switch(N.label){case 0:if(e.liveChatContext)return[3,4];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,this.OCClient.createConversation(this.requestId,u)];case 2:return F=N.sent(),F&&(this.setChatToken(F),Cs.default.setChatId(this.chatToken.chatId||"",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)),[3,4];case 3:return x=N.sent(),P={RequestId:this.requestId,ChatId:this.chatToken.chatId},x!=null&&x.isAxiosError&&((_=(T=(v=x.response)===null||v===void 0?void 0:v.headers)===null||T===void 0?void 0:T.errorcode)===null||_===void 0?void 0:_.toString())===mT.default.WidgetUseOutsideOperatingHour.toString()&&ht.default.throwWidgetUseOutsideOperatingHour(x,this.scenarioMarker,be.default.StartChat,P),ht.default.throwConversationInitializationFailure(x,this.scenarioMarker,be.default.StartChat,P),[3,4];case 4:return[2]}})})},g=function(){return nt(w,void 0,void 0,function(){var F,x,I,P,v,I,T,I,_,N,I,A,S;return rt(this,function(H){switch(H.label){case 0:if(this.liveChatVersion!==sn.default.V2)return[3,8];F={token:this.chatToken.token,id:this.chatToken.visitorId||"teamsvisitor",threadId:this.chatToken.chatId,environmentUrl:this.chatToken.acsEndpoint,pollingInterval:3e4},H.label=1;case 1:return H.trys.push([1,3,,4]),[4,(A=this.ACSClient)===null||A===void 0?void 0:A.initialize({token:F.token,environmentUrl:F.environmentUrl})];case 2:return H.sent(),[3,4];case 3:return x=H.sent(),I={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwMessagingClientInitializationFailure(x,this.scenarioMarker,be.default.StartChat,I),[3,4];case 4:return H.trys.push([4,6,,7]),P=this,[4,(S=this.ACSClient)===null||S===void 0?void 0:S.joinConversation({id:F.id,threadId:F.threadId,pollingInterval:F.pollingInterval})];case 5:return P.conversation=H.sent(),this.scenarioMarker.completeScenario(be.default.StartChat,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,7];case 6:return v=H.sent(),I={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwMessagingClientConversationJoinFailure(v,this.scenarioMarker,be.default.StartChat,I),[3,7];case 7:return[3,14];case 8:return H.trys.push([8,10,,11]),[4,this.IC3Client.initialize({token:this.chatToken.token,regionGtms:this.chatToken.regionGTMS,visitor:!0})];case 9:return H.sent(),[3,11];case 10:return T=H.sent(),I={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwMessagingClientInitializationFailure(T,this.scenarioMarker,be.default.StartChat,I),[3,11];case 11:return H.trys.push([11,13,,14]),_=this,[4,this.IC3Client.joinConversation(this.chatToken.chatId)];case 12:return _.conversation=H.sent(),this.scenarioMarker.completeScenario(be.default.StartChat,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,14];case 13:return N=H.sent(),I={RequestId:this.requestId,ChatId:this.chatToken.chatId},ht.default.throwMessagingClientConversationJoinFailure(N,this.scenarioMarker,be.default.StartChat,I),[3,14];case 14:return[2]}})})},E=function(){return nt(w,void 0,void 0,function(){var F,x;return rt(this,function(P){switch(P.label){case 0:return P.trys.push([0,4,,5]),this.liveChatVersion!==sn.default.V2?[3,3]:this.isAMSClientAllowed?(this.debug&&console.time("ams_promise_initialization"),[4,this.getAMSClient()]):[2];case 1:return F=P.sent(),[4,F==null?void 0:F.initialize({chatToken:this.chatToken})];case 2:P.sent(),this.debug&&console.timeEnd("ams_promise_initialization"),P.label=3;case 3:return[3,5];case 4:return P.sent(),x={RequestId:this.requestId,ChatId:this.chatToken.chatId},this.scenarioMarker.singleRecord("AMSLoadError",Ir({},x)),[3,5];case 5:return[2]}})})},!((J=this.chatSDKConfig.useCreateConversation)===null||J===void 0)&&J.disable?[3,20]:[4,h()];case 19:return q.sent(),[3,22];case 20:return[4,f()];case 21:q.sent(),q.label=22;case 22:return q.trys.push([22,24,,26]),[4,Promise.all([g(),E()])];case 23:return q.sent(),[3,26];case 24:return D=q.sent(),[4,this.handleConversationJoinFailure(D,e)];case 25:throw q.sent(),D;case 26:return this.isPersistentChat&&!(!((X=this.chatSDKConfig.persistentChat)===null||X===void 0)&&X.disable)&&(this.refreshTokenTimer=setInterval(function(){return nt(w,void 0,void 0,function(){return rt(this,function(F){switch(F.label){case 0:return[4,this.getChatToken(!1)];case 1:return F.sent(),this.updateChatToken(this.chatToken.token,this.chatToken.regionGTMS),[2]}})})},(B=this.chatSDKConfig.persistentChat)===null||B===void 0?void 0:B.tokenUpdateTime)),[2]}})})},t.prototype.closeChat=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o,s,l,c;return rt(this,function(a){switch(a.label){case 0:if(n={RequestId:this.requestId,ChatId:this.chatToken.chatId,isSessionEnded:!(e!=null&&e.isSessionEnded)},this.scenarioMarker.startScenario(be.default.CloseChatSession,n),e!=null&&e.isSessionEnded)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),r={},this.isPersistentChat&&!(!((l=this.chatSDKConfig.persistentChat)===null||l===void 0)&&l.disable)&&(i=this.reconnectId!==null,r.isPersistentChat=this.isPersistentChat,r.isReconnectChat=i),this.isChatReconnect&&!(!((c=this.chatSDKConfig.chatReconnect)===null||c===void 0)&&c.disable)&&!this.isPersistentChat&&(o=this.reconnectId!==null,this.requestId=o?this.reconnectId:this.requestId,r.isReconnectChat=o),this.authenticatedUserToken&&(r.authenticatedUserToken=this.authenticatedUserToken),[4,this.OCClient.sessionClose(this.requestId,r)];case 2:return a.sent(),[3,4];case 3:return s=a.sent(),ht.default.throwConversationClosureFailure(s,this.scenarioMarker,be.default.CloseChatSession,Ir(Ir({},n),{isSessionEnded:String(!(e!=null&&e.isSessionEnded))})),[3,4];case 4:this.scenarioMarker.completeScenario(be.default.CloseChatSession,n),a.label=5;case 5:return[2]}})})},t.prototype.endChat=function(){return nt(this,arguments,void 0,function(e){var n=this;return e===void 0&&(e={}),rt(this,function(r){return[2,this.executeWithLock(function(){return n.internalEndChat(e)})]})})},t.prototype.internalEndChat=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o;return e===void 0&&(e={}),rt(this,function(s){switch(s.label){case 0:n={RequestId:this.requestId,ChatId:this.chatToken.chatId},this.scenarioMarker.startScenario(be.default.EndChat,n),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.EndChat),s.label=1;case 1:s.trys.push([1,6,,7]),s.label=2;case 2:return s.trys.push([2,,4,5]),[4,this.closeChat(e)];case 3:return s.sent(),[3,5];case 4:return(o=this.conversation)===null||o===void 0||o.disconnect(),this.conversation=null,this.requestId=(0,eo.uuidv4)(),this.chatToken={},this.reconnectId=null,this.IC3Client&&(this.IC3Client.dispose(),!wi.default.isNode()&&!wi.default.isReactNative()&&(0,Yg.removeElementById)(this.IC3Client.id),this.IC3Client=null),this.OCClient.sessionId&&(this.OCClient.sessionId=null,this.sessionId=null),Cs.default.setRequestId(this.requestId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),Cs.default.setChatId("",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),this.refreshTokenTimer!==null&&(clearInterval(this.refreshTokenTimer),this.refreshTokenTimer=null),[7];case 5:return this.scenarioMarker.completeScenario(be.default.EndChat,n),[3,7];case 6:return r=s.sent(),i={RequestId:this.requestId,ChatId:this.chatToken.chatId},r instanceof Yn.ChatSDKError&&ht.default.throwConversationClosureFailure(new Error(JSON.stringify(r.exceptionDetails)),this.scenarioMarker,be.default.EndChat,i),ht.default.throwConversationClosureFailure(r,this.scenarioMarker,be.default.EndChat,i),[3,7];case 7:return[2]}})})},t.prototype.getCurrentLiveChatContext=function(){return nt(this,void 0,void 0,function(){var e,n,r;return rt(this,function(i){switch(i.label){case 0:return[4,this.getChatToken()];case 1:return e=i.sent(),n=this.requestId,this.scenarioMarker.startScenario(be.default.GetCurrentLiveChatContext,{RequestId:n,ChatId:e.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetCurrentLiveChatContext),r={chatToken:e,requestId:n},Object.keys(r.chatToken).length===0?[2,{}]:(this.reconnectId&&(r.reconnectId=this.reconnectId),this.sessionId&&(r.sessionId=this.sessionId),this.scenarioMarker.completeScenario(be.default.GetCurrentLiveChatContext,{RequestId:n,ChatId:e.chatId}),[2,r])}})})},t.prototype.getConversationDetails=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,l,c,a,u,d,f,h,g,E,D,w,p,b,j;return e===void 0&&(e={}),rt(this,function(K){switch(K.label){case 0:n=this.requestId,r=this.chatToken,i=r.chatId,o=this.reconnectId,s=this.sessionId,this.requestId||(this.requestId=(0,eo.uuidv4)(),n=this.requestId),e.liveChatContext&&(n=e.liveChatContext.requestId,r=e.liveChatContext.chatToken,i=r.chatId),!((w=e.liveChatContext)===null||w===void 0)&&w.reconnectId&&(o=e.liveChatContext.reconnectId),!((p=e.liveChatContext)===null||p===void 0)&&p.sessionId&&(s=e.liveChatContext.sessionId,this.OCClient.sessionId=s),this.scenarioMarker.startScenario(be.default.GetConversationDetails,{RequestId:n,ChatId:i||""}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetConversationDetails),l={},this.isPersistentChat&&!(!((b=this.chatSDKConfig.persistentChat)===null||b===void 0)&&b.disable)&&o&&(l.reconnectId=o),this.isChatReconnect&&!(!((j=this.chatSDKConfig.chatReconnect)===null||j===void 0)&&j.disable)&&!this.isPersistentChat&&o&&(l.reconnectId=o),this.authenticatedUserToken&&(l.authenticatedUserToken=this.authenticatedUserToken),K.label=1;case 1:return K.trys.push([1,3,,4]),[4,this.OCClient.getLWIDetails(n,l)];case 2:return c=K.sent(),a=c.State,u=c.ConversationId,d=c.AgentAcceptedOn,f=c.CanRenderPostChat,h=c.ParticipantType,g={state:a,conversationId:u},d&&(g.agentAcceptedOn=d),f&&(g.canRenderPostChat=f),h&&(g.participantType=h),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(be.default.GetConversationDetails,{RequestId:n,ChatId:i||""}),[2,g];case 3:return E=K.sent(),D={RequestId:n,ChatId:i},(0,nh.isClientIdNotFoundErrorMessage)(E)&&ht.default.throwAuthContactIdNotFoundFailure(E,this.scenarioMarker,be.default.GetConversationDetails,D),Nge.default.suppressConversationDetailsRetrievalFailure(E,this.scenarioMarker,be.default.GetConversationDetails,D),[3,4];case 4:return[2,{}]}})})},t.prototype.getPreChatSurvey=function(){return nt(this,arguments,void 0,function(e){var n;return e===void 0&&(e=!0),rt(this,function(r){this.scenarioMarker.startScenario(be.default.GetPreChatSurvey);try{return n=e?JSON.parse(this.preChatSurvey):this.preChatSurvey,this.scenarioMarker.completeScenario(be.default.GetPreChatSurvey),[2,n]}catch{this.scenarioMarker.failScenario(be.default.GetPreChatSurvey)}return[2]})})},t.prototype.getLiveChatConfig=function(e){return nt(this,void 0,void 0,function(){return rt(this,function(n){return!e||e.useRuntimeCache===!0?[2,this.liveChatConfig]:[2,this.getChatConfig({sendCacheHeaders:(e==null?void 0:e.sendCacheHeaders)||!1})]})})},t.prototype.getChatToken=function(){return nt(this,arguments,void 0,function(e,n){var r,i,o,s,l,c,a;return e===void 0&&(e=!0),rt(this,function(u){switch(u.label){case 0:if(this.scenarioMarker.startScenario(be.default.GetChatToken,{RequestId:this.requestId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetChatToken),e)return[3,5];u.label=1;case 1:return u.trys.push([1,3,,4]),r={},this.authenticatedUserToken&&(r.authenticatedUserToken=this.authenticatedUserToken),this.isPersistentChat&&!(!((l=this.chatSDKConfig.persistentChat)===null||l===void 0)&&l.disable)&&(r.reconnectId=this.reconnectId),this.isChatReconnect&&!(!((c=this.chatSDKConfig.chatReconnect)===null||c===void 0)&&c.disable)&&!this.isPersistentChat&&(r.reconnectId=this.reconnectId),(n==null?void 0:n.refreshToken)===!0&&(r.refreshToken=n==null?void 0:n.refreshToken),this.botCSPId&&(r.MsOcBotApplicationId=this.botCSPId),[4,this.OCClient.getChatToken(this.requestId,r)];case 2:return i=u.sent(),this.setChatToken(i),this.scenarioMarker.completeScenario(be.default.GetChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return o=u.sent(),s={RequestId:this.requestId,ChatId:(a=this.chatToken)===null||a===void 0?void 0:a.chatId},(0,nh.isClientIdNotFoundErrorMessage)(o)?ht.default.throwAuthContactIdNotFoundFailure(o,this.scenarioMarker,be.default.GetChatToken,s):ht.default.throwChatTokenRetrievalFailure(o,this.scenarioMarker,be.default.GetChatToken,s),[3,4];case 4:return[3,6];case 5:this.scenarioMarker.completeScenario(be.default.GetChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),u.label=6;case 6:return[2,this.chatToken]}})})},t.prototype.setChatToken=function(e){var n=e.ChatId,r=e.Token,i=e.RegionGtms,o=e.ExpiresIn,s=e.VisitorId,l=e.VoiceVideoCallToken,c=e.ACSEndpoint,a=e.AttachmentConfiguration;this.chatToken={chatId:n,regionGTMS:JSON.parse(i),requestId:this.requestId,token:r,expiresIn:o,visitorId:s,voiceVideoCallToken:l,acsEndpoint:c},a&&a.AttachmentServiceEndpoint&&(this.chatToken.amsEndpoint=a.AttachmentServiceEndpoint),this.OCClient.sessionId&&(this.sessionId=this.OCClient.sessionId)},t.prototype.getCallingToken=function(){return nt(this,void 0,void 0,function(){return rt(this,function(e){return this.chatToken&&Object.keys(this.chatToken).length===0?[2,""]:this.chatToken.voiceVideoCallToken?(this.debug&&console.log("calling:acs"),[2,this.chatToken.voiceVideoCallToken.Token]):(this.debug&&console.log("calling:skype"),[2,this.chatToken.token])})})},t.prototype.recordMessages=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o;return rt(this,function(s){if(n={RequestId:this.requestId,ChatId:this.chatToken.chatId},!e||(e==null?void 0:e.length)===0)return(i=this.scenarioMarker)===null||i===void 0||i.singleRecord(be.default.MessageReceived,Ir(Ir({},n),{CustomProperties:"No messages received",Source:mN.MessageSource.GetRestCall})),[2];try{r=e.map(function(l){return fN.MessagePrinterFactory.printifyMessage(l,fN.PrinterType.Omnichannel)}),(o=this.scenarioMarker)===null||o===void 0||o.singleRecord(be.default.MessageReceived,Ir(Ir({},n),{CustomProperties:JSON.stringify(r),Source:mN.MessageSource.GetRestCall}))}catch(l){console.warn("Error while recording messages: ".concat(l))}return[2]})})},t.prototype.getMessages=function(){return nt(this,void 0,void 0,function(){var e,n;return rt(this,function(r){switch(r.label){case 0:this.scenarioMarker.startScenario(be.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetMessages),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(n=this.conversation)===null||n===void 0?void 0:n.getMessages()];case 2:return e=r.sent(),this.recordMessages(e),this.scenarioMarker.completeScenario(be.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,e];case 3:return r.sent(),this.scenarioMarker.failScenario(be.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 4:return[2]}})})},t.prototype.getDataMaskingRules=function(){return nt(this,void 0,void 0,function(){return rt(this,function(e){return[2,this.dataMaskingRules]})})},t.prototype.transformMessage=function(e){if(this.isMaskingDisabled)return e;for(var n=e.content,r,i=0,o=this.dataMaskingRules.rules;i<o.length;i++){for(var s=o[i],l=new RegExp(s.regex,"g");(r=l.exec(n))!==null;){var c=r[0].replace(/./g,this.maskingCharacter);n=n.replace(r[0],c)}r=null}return e.content=n,e},t.prototype.sendMessage=function(e){return nt(this,void 0,void 0,function(){var n,r,i,l,o,s,l,c;return rt(this,function(a){switch(a.label){case 0:if(this.scenarioMarker.startScenario(be.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.SendMessages),this.transformMessage(e),this.liveChatVersion!==sn.default.V2)return[3,5];n={content:e.content},n.metadata={widgetId:this.omnichannelConfig.widgetId,clientMessageId:Date.now().toString()},e.metadata&&(n.metadata=Ir(Ir({},n.metadata),e.metadata)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(c=this.conversation)===null||c===void 0?void 0:c.sendMessage(n)];case 2:return r=a.sent(),this.scenarioMarker.completeScenario(be.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,r];case 3:throw i=a.sent(),l={response:Yn.ChatSDKErrorName.ChatSDKSendMessageFailed,errorObject:"".concat(i)},this.scenarioMarker.failScenario(be.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(l)}),new Yn.ChatSDKError(Yn.ChatSDKErrorName.ChatSDKSendMessageFailed,void 0,{response:Yn.ChatSDKErrorName.ChatSDKSendMessageFailed,errorObject:"".concat(i)});case 4:return[3,9];case 5:o={content:e.content,timestamp:new Date,contentType:gT.default.Text,deliveryMode:fT.default.Bridged,messageType:tm.default.UserMessage,properties:void 0,tags:cT([],TT.defaultMessageTags,!0),sender:{displayName:"Customer",id:"customer",type:vT.default.User}},e.tags&&(o.tags=e.tags),e.timestamp&&(o.timestamp=e.timestamp),a.label=6;case 6:return a.trys.push([6,8,,9]),[4,this.conversation.sendMessage(o)];case 7:return a.sent(),this.scenarioMarker.completeScenario(be.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,9];case 8:throw s=a.sent(),l={response:Yn.ChatSDKErrorName.ChatSDKSendMessageFailed,errorObject:"".concat(s)},this.scenarioMarker.failScenario(be.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(l)}),new Error(Yn.ChatSDKErrorName.ChatSDKSendMessageFailed);case 9:return[2]}})})},t.prototype.onNewMessage=function(e){return nt(this,arguments,void 0,function(n,r){var i,o,s,l,c,a,u,d=this,f;return r===void 0&&(r={}),rt(this,function(h){switch(h.label){case 0:return this.scenarioMarker.startScenario(be.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.OnNewMessage),this.liveChatVersion!==sn.default.V2?[3,3]:(i=new Set,r!=null&&r.rehydrate?(this.debug&&console.log("[OmnichannelChatSDK][onNewMessage] rehydrate"),[4,this.getMessages()]):[3,2]);case 1:for(o=h.sent(),s=0,l=o.reverse();s<l.length;s++)c=l[s],a=c.id,!i.has(a)&&(i.add(a),n(c));h.label=2;case 2:try{u={disablePolling:!1},r!=null&&r.pollingInterval&&(u.pollingInterval=r==null?void 0:r.pollingInterval),(r==null?void 0:r.disablePolling)===!0&&(u.disablePolling=r==null?void 0:r.disablePolling),(f=this.conversation)===null||f===void 0||f.registerOnNewMessage(function(g){var E=g.id,D=(0,Oge.default)(g,{liveChatVersion:d.liveChatVersion,debug:d.detailedDebugEnabled?d.debugACS:d.debug});i.has(E)||(n(D),i.add(E))},u),this.scenarioMarker.completeScenario(be.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch{this.scenarioMarker.failScenario(be.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}h.label=3;case 3:return[2]}})})},t.prototype.sendTypingEvent=function(){return nt(this,void 0,void 0,function(){return rt(this,function(e){switch(e.label){case 0:if(this.scenarioMarker.startScenario(be.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.SendTypingEvent),this.liveChatVersion!==sn.default.V2)return[3,5];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.OCClient.sendTypingIndicator(this.requestId,sn.default.V2,{customerDisplayName:_ge.default.Customer})];case 2:return e.sent(),[4,this.conversation.sendTyping()];case 3:return e.sent(),this.scenarioMarker.completeScenario(be.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,5];case 4:throw e.sent(),this.scenarioMarker.failScenario(be.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("SendTypingFailure");case 5:return[2]}})})},t.prototype.onTypingEvent=function(e){return nt(this,void 0,void 0,function(){var n;return rt(this,function(r){if(this.scenarioMarker.startScenario(be.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.OnTypingEvent),this.liveChatVersion===sn.default.V2)try{this.conversation.onTypingEvent(e),this.scenarioMarker.completeScenario(be.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch{this.scenarioMarker.failScenario(be.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}else try{(n=this.conversation)===null||n===void 0||n.registerOnNewMessage(function(i){var o=i.messageType;(0,nh.isCustomerMessage)(i)||o===tm.default.Typing&&e(i)}),this.scenarioMarker.completeScenario(be.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch{this.scenarioMarker.failScenario(be.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}return[2]})})},t.prototype.onAgentEndSession=function(e){return nt(this,void 0,void 0,function(){var n=this,r;return rt(this,function(i){if(this.scenarioMarker.startScenario(be.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.OnAgentEndSession),this.liveChatVersion===sn.default.V2)try{this.conversation.registerOnThreadUpdate(function(o){return nt(n,void 0,void 0,function(){var s;return rt(this,function(l){switch(l.label){case 0:return[4,this.getConversationDetails()];case 1:return s=l.sent(),(Object.keys(s).length===0||s.state==em.default.WrapUp||s.state==em.default.Closed)&&(e(o),this.stopPolling()),[2]}})})}),this.scenarioMarker.completeScenario(be.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch{this.scenarioMarker.failScenario(be.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}else try{(r=this.conversation)===null||r===void 0||r.registerOnThreadUpdate(function(o){var s=o.members;s.length===1&&(e(o),n.refreshTokenTimer!==null&&(clearInterval(n.refreshTokenTimer),n.refreshTokenTimer=null))}),this.scenarioMarker.completeScenario(be.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch{this.scenarioMarker.failScenario(be.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}return[2]})})},t.prototype.uploadFileAttachment=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o,s,l,c,u,a,u,d,f,h;return rt(this,function(g){switch(g.label){case 0:return this.scenarioMarker.startScenario(be.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.UploadFileAttachment),this.liveChatVersion!==sn.default.V2?[3,8]:(this.isAMSClientAllowed===!1&&ht.default.throwFeatureDisabled(this.scenarioMarker,be.default.UploadFileAttachment,"Enable support for attachment upload and receive in the widget configuration."),[4,this.getAMSClient()]);case 1:return n=g.sent(),n==null&&(0,ht.throwAMSLoadFailure)(this.scenarioMarker,be.default.UploadFileAttachment,"Attachment handler client is null, no action can be performed"),[4,n==null?void 0:n.createObject((f=this.chatToken)===null||f===void 0?void 0:f.chatId,e)];case 2:return r=g.sent(),i=r.id,[4,n==null?void 0:n.uploadDocument(i,e)];case 3:o=g.sent(),s={amsReferences:JSON.stringify([i]),amsreferences:JSON.stringify([i])},l={amsMetadata:JSON.stringify([{contentType:e.type,fileName:e.name}])},c={content:"",metadata:Ir(Ir({widgetId:this.omnichannelConfig.widgetId,clientMessageId:Date.now().toString()},s),l)},u={content:"",timestamp:new Date,contentType:gT.default.Text,deliveryMode:fT.default.Bridged,messageType:tm.default.UserMessage,tags:cT([],TT.defaultMessageTags,!0),sender:{displayName:"Customer",id:"customer",type:vT.default.User},fileMetadata:o},g.label=4;case 4:return g.trys.push([4,6,,7]),[4,(h=this.conversation)===null||h===void 0?void 0:h.sendMessage(c)];case 5:return g.sent(),this.scenarioMarker.completeScenario(be.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,u];case 6:return g.sent(),console.error("OmnichannelChatSDK/uploadFileAttachment/sendMessage/error"),this.scenarioMarker.failScenario(be.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,7];case 7:return[2,{}];case 8:return a=void 0,wi.default.isReactNative()||wi.default.isNode()?[4,this.conversation.sendFileData(e,pN.default.AmsBasedFileSharing)]:[3,10];case 9:return a=g.sent(),[3,12];case 10:return[4,this.conversation.uploadFile(e,pN.default.AmsBasedFileSharing)];case 11:a=g.sent(),g.label=12;case 12:u={content:"",timestamp:new Date,contentType:gT.default.Text,deliveryMode:fT.default.Bridged,messageType:tm.default.UserMessage,tags:cT([],TT.defaultMessageTags,!0),sender:{displayName:"Customer",id:"customer",type:vT.default.User},fileMetadata:a},g.label=13;case 13:return g.trys.push([13,15,,16]),[4,this.conversation.sendFileMessage(a,u)];case 14:return g.sent(),this.scenarioMarker.completeScenario(be.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,u];case 15:return d=g.sent(),console.error("OmnichannelChatSDK/uploadFileAttachment/error: ".concat(d)),this.scenarioMarker.failScenario(be.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,16];case 16:return[2,{}]}})})},t.prototype.downloadFileAttachment=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o,s,l;return rt(this,function(c){switch(c.label){case 0:if(this.scenarioMarker.startScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.DownloadFileAttachment),this.liveChatVersion!==sn.default.V2)return[3,7];c.label=1;case 1:return c.trys.push([1,5,,6]),this.isAMSClientAllowed===!1&&(this.scenarioMarker.failScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:"AMSClient is disabled"}),ht.default.throwFeatureDisabled(this.scenarioMarker,be.default.DownloadFileAttachment,"Enable support for attachment upload and receive in the widget configuration.")),[4,this.getAMSClient()];case 2:return n=c.sent(),n==null&&(0,ht.throwAMSLoadFailure)(this.scenarioMarker,be.default.DownloadFileAttachment,"Attachment handler is null, no action can be performed"),[4,n==null?void 0:n.getViewStatus(e)];case 3:return r=c.sent(),i=r.view_location,[4,n==null?void 0:n.getView(e,i)];case 4:return o=c.sent(),this.scenarioMarker.completeScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,o];case 5:throw c.sent(),this.scenarioMarker.failScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("DownloadFileAttachmentFailed");case 6:return[3,10];case 7:return c.trys.push([7,9,,10]),[4,this.conversation.downloadFile(e)];case 8:return s=c.sent(),this.scenarioMarker.completeScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,s];case 9:throw l=c.sent(),console.error("OmnichannelChatSDK/downloadFileAttachment/error: ".concat(l)),this.scenarioMarker.failScenario(be.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("DownloadFileAttachmentFailed");case 10:return[2]}})})},t.prototype.emailLiveChatTranscript=function(e){return nt(this,arguments,void 0,function(n,r){var i,o,s,l,c,a,u,d;return r===void 0&&(r={}),rt(this,function(f){switch(f.label){case 0:i={},o=this.requestId,s=this.chatToken,l=s.chatId,c=this.sessionId,r.liveChatContext&&(o=r.liveChatContext.requestId,s=r.liveChatContext.chatToken,l=s.chatId),!((d=r.liveChatContext)===null||d===void 0)&&d.sessionId&&(c=r.liveChatContext.sessionId,this.OCClient.sessionId=c),this.scenarioMarker.startScenario(be.default.EmailLiveChatTranscript,{RequestId:o,ChatId:l}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.EmailLiveChatTranscript),f.label=1;case 1:return f.trys.push([1,3,,4]),this.authenticatedUserToken&&(i.authenticatedUserToken=this.authenticatedUserToken),a={ChatId:l,EmailAddress:n.emailAddress,DefaultAttachmentMessage:n.attachmentMessage,CustomerLocale:n.locale||(0,Nc.getLocaleStringFromId)(this.localeId)},[4,this.OCClient.emailTranscript(o,s.token,a,i)];case 2:return f.sent(),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(be.default.EmailLiveChatTranscript,{RequestId:o,ChatId:l}),[3,4];case 3:return u=f.sent(),console.error("OmnichannelChatSDK/emailLiveChatTranscript/error: ".concat(u)),this.scenarioMarker.failScenario(be.default.EmailLiveChatTranscript,{RequestId:o,ChatId:l}),[3,4];case 4:return[2]}})})},t.prototype.getLiveChatTranscript=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,l,c,a,u,d;return e===void 0&&(e={}),rt(this,function(f){switch(f.label){case 0:if(n={},r=this.requestId,i=this.chatToken,o=i.chatId,s=this.sessionId,e.liveChatContext&&(this.isPersistentChat&&!(!((u=this.chatSDKConfig.persistentChat)===null||u===void 0)&&u.disable)?(r=this.requestId||e.liveChatContext.requestId,i=this.chatToken&&Object.keys(this.chatToken).length>0?this.chatToken:e.liveChatContext.chatToken):(r=e.liveChatContext.requestId,i=e.liveChatContext.chatToken),o=i.chatId),!((d=e.liveChatContext)===null||d===void 0)&&d.sessionId&&(s=e.liveChatContext.sessionId,this.OCClient.sessionId=s),!o)throw new Yn.ChatSDKError(Yn.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,void 0,{response:Yn.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,errorObject:"ChatId is not defined"});this.scenarioMarker.startScenario(be.default.GetLiveChatTranscript,{RequestId:r,ChatId:o}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetLiveChatTranscript),f.label=1;case 1:return f.trys.push([1,3,,4]),this.authenticatedUserToken&&(n.authenticatedUserToken=this.authenticatedUserToken),[4,this.OCClient.getChatTranscripts(r,i.chatId,i.token,n)];case 2:return l=f.sent(),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(be.default.GetLiveChatTranscript,{RequestId:r,ChatId:o}),[2,l];case 3:return c=f.sent(),a={RequestId:r,ChatId:o},ht.default.throwLiveChatTranscriptRetrievalFailure(c,this.scenarioMarker,be.default.GetLiveChatTranscript,a),[3,4];case 4:return[2]}})})},t.prototype.createChatAdapter=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,l;return e===void 0&&(e={}),rt(this,function(c){return wi.default.isNode()||wi.default.isReactNative()?[2,Promise.reject("ChatAdapter is only supported on browser")]:(n=e.protocol,r=[ys.default.ACS,ys.default.IC3,ys.default.DirectLine],n&&!r.includes(n)?[2,Promise.reject("ChatAdapter for protocol ".concat(n," currently not supported"))]:n===ys.default.DirectLine?[2,(0,uT.createDirectLine)(e,this.chatSDKConfig,this.liveChatVersion,ys.default.DirectLine,this.telemetry,this.scenarioMarker)]:n===ys.default.ACS||this.liveChatVersion===sn.default.V2?(i={fileScan:(s=e.ACSAdapter)===null||s===void 0?void 0:s.fileScan},o=new Age.default(this.AMSClient,this.acsAdapterLogger,i),[2,(0,uT.createACSAdapter)(e,this.chatSDKConfig,this.liveChatVersion,ys.default.ACS,this.telemetry,this.scenarioMarker,this.omnichannelConfig,this.chatToken,o,(l=this.ACSClient)===null||l===void 0?void 0:l.getChatClient(),this.acsAdapterLogger)]):n===ys.default.IC3||this.liveChatVersion===sn.default.V1?[2,(0,uT.createIC3Adapter)(e,this.chatSDKConfig,this.liveChatVersion,ys.default.IC3,this.telemetry,this.scenarioMarker,this.chatToken,this.IC3Client,this.ic3ClientLogger)]:[2,Promise.reject("ChatAdapter for protocol ".concat(n," currently not supported"))])})})},t.prototype.isVoiceVideoCallingEnabled=function(){return this.callingOption.toString()!==hT.default.NoCalling.toString()},t.prototype.getVoiceVideoCalling=function(){return nt(this,arguments,void 0,function(e){var n,n,r=this;return e===void 0&&(e={}),rt(this,function(i){return this.scenarioMarker.startScenario(be.default.GetVoiceVideoCalling),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetVoiceVideoCalling),(wi.default.isNode()||wi.default.isReactNative())&&(n="VoiceVideoCalling is only supported on browser",ht.default.throwUnsupportedPlatform(this.scenarioMarker,be.default.GetVoiceVideoCalling,n)),this.isVoiceVideoCallingEnabled()||(n="Voice and video call is not enabled",ht.default.throwFeatureDisabled(this.scenarioMarker,be.default.GetVoiceVideoCalling,n)),this.widgetSnippetBaseUrl&&this.widgetSnippetBaseUrl.length?[2,new Promise(function(o){return nt(r,void 0,void 0,function(){var s,l,c=this,a;return rt(this,function(u){switch(u.label){case 0:return s="".concat(this.widgetSnippetBaseUrl,"/livechatwidget/v2scripts/callingsdk/").concat(Pge.callingBundleVersion,"/CallingBundle.js"),(a=this.telemetry)===null||a===void 0||a.setCDNPackages({VoiceVideoCalling:s}),l={logger:this.callingSdkLogger},[4,(0,Yg.loadScript)(s,function(){return nt(c,void 0,void 0,function(){var d;return rt(this,function(f){switch(f.label){case 0:return this.debug&&console.debug("".concat(s," loaded!")),[4,(0,Dge.default)(Ir(Ir({},e),l))];case 1:return d=f.sent(),this.scenarioMarker.completeScenario(be.default.GetVoiceVideoCalling),d.useScenarioMarker(this.scenarioMarker),o(d),[2]}})})},function(){return nt(c,void 0,void 0,function(){var d;return rt(this,function(f){throw d={response:"VoiceVideoCallingLoadFailed",message:"Failed to load VoiceVideoCalling"},this.scenarioMarker.failScenario(be.default.GetVoiceVideoCalling,{ExceptionDetails:JSON.stringify(d)}),new Error(d.response)})})})];case 1:return u.sent(),[2]}})})})]:[2]})})},t.prototype.getPostChatSurveyContext=function(){return nt(this,void 0,void 0,function(){var e,n,r,i,o,s,l,c,a,u,d,f,h,g,E,D,w,p,b,j,K,M,ne,G,oe,J,X,B,q,F,x,P,v,T,_,N;return rt(this,function(I){switch(I.label){case 0:this.scenarioMarker.startScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(J=this.chatToken)===null||J===void 0?void 0:J.chatId}),this.isInitialized||ht.default.throwUninitializedChatSDK(this.scenarioMarker,be.default.GetPostChatSurveyContext),I.label=1;case 1:return I.trys.push([1,8,,9]),n=this.liveChatConfig,r=n.LiveWSAndLiveChatEngJoin,i=r.msdyn_postconversationsurveyenable,o=r.msfp_sourcesurveyidentifier,s=r.msfp_botsourcesurveyidentifier,l=r.postConversationSurveyOwnerId,c=r.postConversationBotSurveyOwnerId,a=r.msdyn_surveyprovider,u=parseInt(a),u===CT.SurveyProvider.CustomerVoice&&!o?(this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(B=(X=this.chatToken)===null||X===void 0?void 0:X.chatId)!==null&&B!==void 0?B:"",ExceptionDetails:"GetPostChatSurveyContext : msfp_sourcesurveyidentifier is mandatory for survey provider ".concat(CT.SurveyProvider.CustomerVoice,".")}),[2,Promise.reject("GetPostChatSurveyContext : msfp_sourcesurveyidentifier is mandatory for survey provider ".concat(CT.SurveyProvider.CustomerVoice,"."))]):(0,rh.parseLowerCaseString)(i)!=="true"?[3,6]:[4,this.getConversationDetails()];case 2:return d=I.sent(),Object.keys(d).length===0?(this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(q=this.chatToken)===null||q===void 0?void 0:q.chatId,ExceptionDetails:"GetPostChatSurveyContext : LiveWorkItemDetails is null."}),[2,Promise.reject("GetPostChatSurveyContext : LiveWorkItemDetails is null.")]):(f=(0,rh.parseLowerCaseString)(d==null?void 0:d.canRenderPostChat)==="true",h=d==null?void 0:d.participantType,e=d==null?void 0:d.conversationId,e?(g={SurveyProvider:a,WidgetId:this.omnichannelConfig.widgetId,FormId:o,ConversationId:e,OCLocaleCode:(0,Nc.getLocaleStringFromId)(this.localeId)},E={SurveyProvider:a,WidgetId:this.omnichannelConfig.widgetId,FormId:s,ConversationId:e,OCLocaleCode:(0,Nc.getLocaleStringFromId)(this.localeId)},D={requestId:this.requestId},this.authenticatedUserToken&&(D.authenticatedUserToken=this.authenticatedUserToken),[4,this.OCClient.getSurveyInviteLink(l,g,D)]):(this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(x=(F=this.chatToken)===null||F===void 0?void 0:F.chatId)!==null&&x!==void 0?x:"",ExceptionDetails:"GetPostChatSurveyContext : Conversation ID is mandatory."}),[2,Promise.reject("GetPostChatSurveyContext : Conversation ID is mandatory.")]));case 3:return w=I.sent(),b=c&&s,b?[4,this.OCClient.getSurveyInviteLink(c,E,D)]:[3,5];case 4:b=I.sent(),I.label=5;case 5:if(p=b,j=void 0,K=void 0,M=void 0,ne=void 0,w!=null){if(w.inviteList!=null&&w.inviteList.length==1)j=w.inviteList[0].invitationLink;else return this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{ConversationId:e,RequestId:this.requestId,ChatId:(P=this.chatToken)===null||P===void 0?void 0:P.chatId,ExceptionDetails:"Survey Invite link failed to send response."}),[2,Promise.reject("Survey Invite link failed to send response.")];return w.formsProLocaleCode!=null&&(K=w.formsProLocaleCode),p!=null&&(p.inviteList!=null&&p.inviteList.length==1&&(M=p.inviteList[0].invitationLink),p.formsProLocaleCode!=null&&(ne=p.formsProLocaleCode)),G={participantJoined:f,participantType:h,surveyInviteLink:j,botSurveyInviteLink:M,formsProLocale:K,botFormsProLocale:ne},this.scenarioMarker.completeScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(v=this.chatToken)===null||v===void 0?void 0:v.chatId}),[2,Promise.resolve(G)]}else return this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{ConversationId:e,RequestId:this.requestId,ChatId:(T=this.chatToken)===null||T===void 0?void 0:T.chatId,ExceptionDetails:"surveyInviteLinkResponse is null."}),[2,Promise.reject("surveyInviteLinkResponse is null.")];case 6:return this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:(_=this.chatToken)===null||_===void 0?void 0:_.chatId,ExceptionDetails:"Post Chat Survey is disabled. Please check the Omnichannel Administration Portal."}),[2,Promise.reject("Post Chat is disabled from admin side, or chat doesnt have a survey as part of their configuration.")];case 7:return[3,9];case 8:return oe=I.sent(),this.scenarioMarker.failScenario(be.default.GetPostChatSurveyContext,{ConversationId:e??"",RequestId:this.requestId,ChatId:(N=this.chatToken)===null||N===void 0?void 0:N.chatId,ExceptionDetails:JSON.stringify(oe)}),[2,Promise.reject("Retrieving post chat context failed "+JSON.stringify(oe))];case 9:return[2]}})})},t.prototype.getAgentAvailability=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s=this;return e===void 0&&(e={}),rt(this,function(l){switch(l.label){case 0:n=function(c,a,u){u===void 0&&(u="");var d={response:c,message:a};throw s.scenarioMarker.failScenario(be.default.GetAgentAvailability,{RequestId:s.requestId,ExceptionDetails:JSON.stringify(d),ChatId:u}),new Error(d.message)},this.scenarioMarker.startScenario(be.default.GetAgentAvailability,{RequestId:this.requestId}),this.isInitialized||n("UninitializedChatSDK","Chat SDK is not initialized."),this.conversation&&n("InvalidOperation","GetAgentAvailability can only be called before a chat has started.",this.chatToken.chatId),r={initContext:{}},r=this.populateInitChatOptionalParam(r,e,be.default.GetAgentAvailability),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.OCClient.getAgentAvailability(this.requestId,r)];case 2:return i=l.sent(),this.scenarioMarker.completeScenario(be.default.GetAgentAvailability,{RequestId:this.requestId}),[2,i];case 3:return o=l.sent(),n("GetAgentAvailabilityFailed",o.message),[3,4];case 4:return[2]}})})},t.prototype.startPolling=function(){return nt(this,void 0,void 0,function(){return rt(this,function(e){return[2,(0,Fge.default)(this.isInitialized,this.scenarioMarker,this.liveChatVersion,this.requestId,this.chatToken.chatId,this.conversation)]})})},t.prototype.stopPolling=function(){return nt(this,void 0,void 0,function(){return rt(this,function(e){return[2,(0,Bge.default)(this.isInitialized,this.scenarioMarker,this.liveChatVersion,this.requestId,this.chatToken.chatId,this.conversation)]})})},t.prototype.getIC3Client=function(){return nt(this,void 0,void 0,function(){var e,n=this;return rt(this,function(r){switch(r.label){case 0:return wi.default.isNode()||wi.default.isReactNative()?(this.debug&&console.debug("IC3Core"),this.scenarioMarker.startScenario(be.default.GetIC3Client),this.IC3SDKProvider=gN.SDKProvider,[4,gN.SDKProvider.getSDK({hostType:pT.default.Page,protocolType:yT.default.IC3V1SDK})]):[3,2];case 1:return e=r.sent(),e.setDebug(this.debug),this.scenarioMarker.completeScenario(be.default.GetIC3Client),[2,e];case 2:return this.debug&&console.debug("IC3Client"),[2,new Promise(function(i,o){return nt(n,void 0,void 0,function(){var s,l,c=this,a;return rt(this,function(u){switch(u.label){case 0:return s=this.resolveIC3ClientUrl(),(a=this.telemetry)===null||a===void 0||a.setCDNPackages({IC3Client:s}),this.scenarioMarker.startScenario(be.default.GetIC3Client),this.IC3SDKProvider?[4,this.IC3SDKProvider.getSDK({hostType:pT.default.IFrame,protocolType:yT.default.IC3V1SDK,logger:this.ic3ClientLogger})]:[3,2];case 1:return l=u.sent(),[2,i(l)];case 2:return window.addEventListener("ic3:sdk:load",function(){return nt(c,void 0,void 0,function(){var d,f,h;return rt(this,function(g){switch(g.label){case 0:return this.debug&&console.debug("ic3:sdk:load"),d=window.Microsoft.CRM.Omnichannel.IC3Client.SDK,f=d.SDKProvider,this.IC3SDKProvider=f,[4,f.getSDK({hostType:pT.default.IFrame,protocolType:yT.default.IC3V1SDK,logger:this.ic3ClientLogger})];case 1:return h=g.sent(),this.scenarioMarker.completeScenario(be.default.GetIC3Client),i(h),[2]}})})}),[4,(0,Yg.loadScript)(s,function(){c.debug&&console.debug("IC3Client loaded!")},function(){var d={response:"IC3ClientLoadFailed"};c.scenarioMarker.failScenario(be.default.GetIC3Client,{ExceptionDetails:JSON.stringify(d)}),o("Failed to load IC3Client")})];case 3:return u.sent(),[2]}})})})]}})})},t.prototype.setPrechatConfigurations=function(e){return nt(this,void 0,void 0,function(){var n;return rt(this,function(r){return n=(0,rh.parseLowerCaseString)(e.msdyn_prechatenabled)==="true",n&&e.PreChatSurvey&&e.PreChatSurvey.trim().length>0&&(this.preChatSurvey=e.PreChatSurvey,this.debug&&console.log("Prechat Survey!")),[2]})})},t.prototype.setDataMaskingConfiguration=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o,s;return rt(this,function(l){if(e.setting.msdyn_maskforcustomer&&e.dataMaskingRules)for(n=0,r=Object.entries(e.dataMaskingRules);n<r.length;n++)i=r[n],o=i[0],s=i[1],this.dataMaskingRules.rules.push({id:o,regex:s});return[2]})})},t.prototype.setAuthSettingConfig=function(e){return nt(this,void 0,void 0,function(){return rt(this,function(n){switch(n.label){case 0:return e&&(this.authSettings=e),this.authSettings&&this.chatSDKConfig.getAuthToken?[4,this.setAuthTokenProvider(this.chatSDKConfig.getAuthToken,{throwError:!1})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.prototype.setPersistentChatConfiguration=function(e){return nt(this,void 0,void 0,function(){var n,r;return rt(this,function(i){return n=(0,rh.parseLowerCaseString)(e.msdyn_enablechatreconnect)==="true",((r=e.msdyn_conversationmode)===null||r===void 0?void 0:r.toString())===Rge.default.PersistentChat.toString()&&(this.isPersistentChat=!0),n&&!this.isPersistentChat&&(this.isChatReconnect=!0),[2]})})},t.prototype.setLocaleIdConfiguration=function(e){return nt(this,void 0,void 0,function(){return rt(this,function(n){return this.localeId=e.msdyn_localeid||Nc.defaultLocaleId,[2]})})},t.prototype.setCallingOptionConfiguration=function(e){return nt(this,void 0,void 0,function(){var n;return rt(this,function(r){return n=e.msdyn_callingoptions,this.callingOption=(n==null?void 0:n.trim().length)>0?Number(n):hT.default.NoCalling,[2]})})},t.prototype.setLiveChatVersionConfiguration=function(e){return nt(this,void 0,void 0,function(){return rt(this,function(n){return this.liveChatVersion=e||sn.default.V2,[2]})})},t.prototype.setWidgetSnippetBaseUrl=function(e){return nt(this,void 0,void 0,function(){var n,r,i;return rt(this,function(o){return n=new RegExp('src="(https:\\/\\/[\\w-.]+)[\\w-.\\/]+"'),r=e.msdyn_widgetsnippet,r&&(i=r.match(n),i&&i.length&&(this.widgetSnippetBaseUrl=i[1])),[2]})})},t.prototype.getChatConfig=function(){return nt(this,arguments,void 0,function(e){var n,r,i,o,s,l,c;return e===void 0&&(e={}),rt(this,function(a){switch(a.label){case 0:n=e.sendCacheHeaders,r=n===!0,a.label=1;case 1:return a.trys.push([1,3,,8]),[4,this.OCClient.getChatConfig(this.requestId,r)];case 2:return i=a.sent(),this.liveChatConfig=i,this.evaluateAMSAvailability(),this.buildConfigurations(i),this.debug&&console.log("[OmnichannelChatSDK][getChatConfig][liveChatVersion] ".concat(this.liveChatVersion)),[2,this.liveChatConfig];case 3:return o=a.sent(),(0,Lge.isCoreServicesOrgUrlDNSError)(o,this.coreServicesOrgUrl,this.dynamicsLocationCode)?(this.omnichannelConfig.orgUrl=this.unqServicesOrgUrl,s=this,[4,eo.SDKProvider.getSDK(this.omnichannelConfig,(0,ST.default)(!1),this.ocSdkLogger)]):[3,6];case 4:return s.OCClient=a.sent(),[4,this.OCClient.getChatConfig(this.requestId,r)];case 5:return i=a.sent(),[3,7];case 6:throw!((c=(l=o.response)===null||l===void 0?void 0:l.headers)===null||c===void 0)&&c.errorcode&&parseInt(o.response.headers.errorcode)===mT.default.WidgetNotFound&&console.warn("No widget with the given app id is present in the system."),o;case 7:return[3,8];case 8:return[2,this.liveChatConfig]}})})},t.prototype.buildConfigurations=function(e){return nt(this,void 0,void 0,function(){var n,r,i,o,s;return rt(this,function(l){return n=e.DataMaskingInfo,r=e.LiveChatConfigAuthSettings,i=e.LiveWSAndLiveChatEngJoin,o=e.LiveChatVersion,s=e.ChatWidgetLanguage,Promise.all([this.setDataMaskingConfiguration(n),this.setPrechatConfigurations(i),this.setAuthSettingConfig(r),this.setPersistentChatConfiguration(i),this.setCallingOptionConfiguration(i),this.setLocaleIdConfiguration(s),this.setLiveChatVersionConfiguration(o),this.setWidgetSnippetBaseUrl(i)]),[2]})})},t.prototype.resolveIC3ClientUrl=function(){return CN.default.resolveIC3ClientUrl(this.chatSDKConfig)},t.prototype.resolveChatAdapterUrl=function(e){return CN.default.resolveChatAdapterUrl(this.chatSDKConfig,this.liveChatVersion,e)},t.prototype.updateChatToken=function(e,n){return nt(this,void 0,void 0,function(){var r,i;return rt(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(be.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),o.label=1;case 1:return o.trys.push([1,4,,5]),this.liveChatVersion!==sn.default.V1?[3,3]:(r={token:e,regionGtms:n,visitor:!0},[4,this.IC3Client.initialize(r)]);case 2:o.sent(),o.label=3;case 3:return this.scenarioMarker.completeScenario(be.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,5];case 4:return o.sent(),i={response:"UpdateChatTokenFailed"},this.scenarioMarker.failScenario(be.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(i)}),[3,5];case 5:return[2]}})})},t.prototype.setAuthTokenProvider=function(e){return nt(this,arguments,void 0,function(n,r){var i,s,o,s,s;return r===void 0&&(r={}),rt(this,function(l){switch(l.label){case 0:if(this.scenarioMarker.startScenario(be.default.GetAuthToken),this.chatSDKConfig.getAuthToken=n,!this.chatSDKConfig.getAuthToken)return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.chatSDKConfig.getAuthToken()];case 2:if(i=l.sent(),i)this.authenticatedUserToken=i,this.scenarioMarker.completeScenario(be.default.GetAuthToken);else{if(s={response:Yn.ChatSDKErrorName.UndefinedAuthToken},r!=null&&r.throwError)throw Error(s.response);this.scenarioMarker.failScenario(be.default.GetAuthToken,{ExceptionDetails:JSON.stringify(s)})}return[3,4];case 3:if(o=l.sent(),s={response:Yn.ChatSDKErrorName.GetAuthTokenFailed},o.message==Yn.ChatSDKErrorName.UndefinedAuthToken&&(s.response=o.message),this.scenarioMarker.failScenario(be.default.GetAuthToken,{ExceptionDetails:JSON.stringify(s)}),r!=null&&r.throwError)throw Error(s.response);return[3,4];case 4:return[3,6];case 5:if(s={response:Yn.ChatSDKErrorName.GetAuthTokenNotFound},this.scenarioMarker.failScenario(be.default.GetAuthToken,{ExceptionDetails:JSON.stringify(s)}),r!=null&&r.throwError)throw Error(s.response);l.label=6;case 6:return[2]}})})},t.prototype.useCoreServicesOrgUrlIfNotSet=function(){var e;if(!(0,Dc.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl)&&((e=this.chatSDKConfig.internalConfig)===null||e===void 0?void 0:e.createCoreServicesOrgUrlAtRuntime)!==!1){var n=Dc.unqOrgUrlPattern.exec(this.omnichannelConfig.orgUrl);if(n){this.dynamicsLocationCode=n[1];var r=(0,Dc.getCoreServicesGeoName)(this.dynamicsLocationCode);r&&(this.unqServicesOrgUrl=this.omnichannelConfig.orgUrl,this.coreServicesOrgUrl=(0,Dc.createCoreServicesOrgUrl)(this.omnichannelConfig.orgId,r),this.omnichannelConfig.orgUrl=this.coreServicesOrgUrl)}}},t.prototype.handleConversationJoinFailure=function(e,n){return nt(this,void 0,void 0,function(){var r,i,o;return rt(this,function(s){switch(s.label){case 0:if(r=e instanceof Yn.ChatSDKError&&(e==null?void 0:e.message)===Yn.ChatSDKErrorName.MessagingClientConversationJoinFailure&&!(!((o=this.chatSDKConfig.useCreateConversation)===null||o===void 0)&&o.disable)&&!(n.liveChatContext&&Object.keys(n.liveChatContext).length>0)&&!this.reconnectId,!r)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.internalEndChat()];case 2:return s.sent(),[3,4];case 3:return i=s.sent(),this.debug&&console.error("Failed to cleanup conversation after join failure:",i),[3,4];case 4:return[2]}})})},t}();_b.default=Hge;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLocaleString=t.defaultLocaleId=t.getLocaleIdFromString=t.getLocaleStringFromId=t.isCustomerMessage=t.isSystemMessage=t.PersonType=t.MessageType=t.DeliveryMode=t.MessageContentType=t.ChatSDKError=t.ChatSDKErrorName=t.uuidv4=t.OCSDKProvider=t.IC3SDKProvider=t.OmnichannelChatSDK=void 0;var e=Us;Object.defineProperty(t,"ChatSDKError",{enumerable:!0,get:function(){return e.ChatSDKError}}),Object.defineProperty(t,"ChatSDKErrorName",{enumerable:!0,get:function(){return e.ChatSDKErrorName}});var n=Kv;Object.defineProperty(t,"OCSDKProvider",{enumerable:!0,get:function(){return n.SDKProvider}}),Object.defineProperty(t,"uuidv4",{enumerable:!0,get:function(){return n.uuidv4}});var r=ab;Object.defineProperty(t,"defaultLocaleId",{enumerable:!0,get:function(){return r.defaultLocaleId}}),Object.defineProperty(t,"defaultLocaleString",{enumerable:!0,get:function(){return r.defaultLocaleString}}),Object.defineProperty(t,"getLocaleIdFromString",{enumerable:!0,get:function(){return r.getLocaleIdFromString}}),Object.defineProperty(t,"getLocaleStringFromId",{enumerable:!0,get:function(){return r.getLocaleStringFromId}});var i=tl;Object.defineProperty(t,"isCustomerMessage",{enumerable:!0,get:function(){return i.isCustomerMessage}}),Object.defineProperty(t,"isSystemMessage",{enumerable:!0,get:function(){return i.isSystemMessage}});var o=Ku;t.DeliveryMode=o.default;var s=Tf;Object.defineProperty(t,"IC3SDKProvider",{enumerable:!0,get:function(){return s.SDKProvider}});var l=Xu;t.MessageContentType=l.default;var c=Wu;t.MessageType=c.default;var a=_b;t.OmnichannelChatSDK=a.default;var u=bf;t.PersonType=u.default,t.default={OmnichannelChatSDK:a.default,ic3sdk:{IC3SDKProvider:s.SDKProvider},ocsdk:{OCSDKProvider:n.SDKProvider,uuidv4:n.uuidv4}}})(IU);const uH=()=>{const t=new URLSearchParams(window.location.search),e=t.get("orgId"),n=t.get("orgUrl"),r=t.get("widgetId"),i=t.get("channelId")||"lcw",o=t.get("company"),s=t.get("headerIcon"),l=t.get("pauUrl")||"https://2c8892ce49f8e83d9c89509978a953.08.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/40079a7d266b48e49717e6564b34a6a4/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=-bnPrYsDCuoNePu8_Ohpa1aQ9sfg2hdiisHUoKWyQCM",c=t.get("agentsUrl"),a=nm(t.get("primaryColor")),u=nm(t.get("secondaryColor")),d=nm(t.get("lightColor")),f=nm(t.get("darkColor")),h=a?{primary:a,secondary:u||a,light:d||zge(a,40),dark:f||Gge(a,20)}:null;return{orgId:e,orgUrl:n,widgetId:r,channelId:i,company:o,headerIcon:s,pauUrl:l,agentsUrl:c,customColors:h,isValid:!!(e&&n&&r)}},qge={"nab.com.au":{primary:"#E10A0A",secondary:"#C00808",light:"#FFE5E5",dark:"#A00606"},"cba.com.au":{primary:"#FFCC00",secondary:"#000000",light:"#FFF9E0",dark:"#CCA300"},"anz.com":{primary:"#007DBB",secondary:"#005A87",light:"#E0F2FA",dark:"#004A6D"},"westpac.com.au":{primary:"#DA1710",secondary:"#A51108",light:"#FFE8E6",dark:"#7D0D06"}},jge=t=>{if(!t)return"/src/assets/ai.png";let e=t.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/")[0].split("?")[0].replace(/\/$/,"");return!e.includes(".")||e.length<4?"/src/assets/ai.png":`https://img.logo.dev/${e}?token=pk_FHMIzRCfRay8ZQ_zji0RoA&fallback_url=placeholder`},Vge=t=>{if(!t)return null;let e=t.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/")[0].split("?")[0].replace(/\/$/,"");return qge[e]||null},nm=t=>{if(!t)return null;const n=t.trim().match(/^#?([0-9a-fA-F]{6})$/);return n?`#${n[1]}`:null},zge=(t,e)=>{const n=parseInt(t.replace("#",""),16),r=Math.round(2.55*e),i=(n>>16)+r,o=(n>>8&255)+r,s=(n&255)+r;return"#"+(16777216+(i<255?i<1?0:i:255)*65536+(o<255?o<1?0:o:255)*256+(s<255?s<1?0:s:255)).toString(16).slice(1)},Gge=(t,e)=>{const n=parseInt(t.replace("#",""),16),r=Math.round(2.55*e),i=(n>>16)-r,o=(n>>8&255)-r,s=(n&255)-r;return"#"+(16777216+(i>0?i:0)*65536+(o>0?o:0)*256+(s>0?s:0)).toString(16).slice(1)},Wge=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`;class Kge{constructor(){Ye(this,"sdk",null);Ye(this,"chatConfig",null)}async ensureSdk(){if(!this.sdk){const e=uH();if(!e.isValid)throw new Error("Invalid Omnichannel configuration");this.sdk=new IU.OmnichannelChatSDK({orgId:e.orgId,orgUrl:e.orgUrl,widgetId:e.widgetId}),await this.sdk.initialize(),this.chatConfig=await this.sdk.getLiveChatConfig()}return this.sdk}async startChat(){const e=await this.ensureSdk();return await e.startChat(),e}async endChat(){if(!this.sdk){console.log("SDK not initialized, cannot end chat");return}console.log("Calling SDK.endChat()");try{await this.sdk.endChat(),console.log("SDK.endChat() completed")}finally{this.sdk=null,console.log("SDK instance cleared")}}async sendMessage(e){await(await this.ensureSdk()).sendMessage({content:e})}async uploadFileAttachment(e){await(await this.ensureSdk()).uploadFileAttachment(e)}async downloadFileAttachment(e){if(!this.sdk)return console.error("SDK not initialized"),null;const n=console.warn;try{console.warn=()=>{},console.log("Calling SDK downloadFileAttachment with metadata:",e);const r=await this.sdk.downloadFileAttachment(e);console.log("Download result:",r);const i=(r==null?void 0:r.data)||r;return i&&i instanceof Blob?(console.log("Returning blob with size:",i.size),i):(console.log("No valid blob in result, returning null"),null)}catch(r){return console.error("Error downloading file attachment:",r),null}finally{console.warn=n}}onNewMessage(e){if(!this.sdk)return()=>{};const n=this.sdk.onNewMessage(r=>{var i,o,s,l,c,a,u,d,f,h,g,E,D;try{console.log("Received message payload:",r);const w=((o=(i=r==null?void 0:r.sender)==null?void 0:i.role)==null?void 0:o.toLowerCase())==="user"?"user":"agent";let p=(r==null?void 0:r.content)||((s=r==null?void 0:r.message)==null?void 0:s.content)||(r==null?void 0:r.text)||((l=r==null?void 0:r.messagePayload)==null?void 0:l.text)||"",b,j,K;if(p&&typeof p=="string"&&p.startsWith("{"))try{const F=JSON.parse(p);if((c=F.suggestedActions)!=null&&c.actions&&Array.isArray(F.suggestedActions.actions)&&(b=F.suggestedActions.actions.map(x=>({type:x.type||"imBack",title:x.title||x.text||x.value,value:x.value||x.text})),p=F.text||"",console.log(" Parsed suggested actions:",b)),F.attachments&&Array.isArray(F.attachments)&&F.attachments.length>0){const x=F.attachments[0];x.contentType==="application/vnd.microsoft.card.adaptive"&&(j=x.content,p=F.text||((d=(u=(a=x.content)==null?void 0:a.body)==null?void 0:u[0])==null?void 0:d.text)||"")}}catch{console.log("Not structured JSON, treating as plain text")}if(r!=null&&r.fileMetadata){console.log("Found fileMetadata in payload:",JSON.stringify(r.fileMetadata,null,2));const F=r.fileMetadata;K={name:F.name||F.fileName||"file",type:F.type||F.contentType||"application/octet-stream",size:F.size||0,url:F.url||"",id:F.id},console.log("Created fileMetadata:",K)}else if(r!=null&&r.attachments&&Array.isArray(r.attachments)&&r.attachments.length>0){const F=r.attachments[0];console.log("Processing attachment:",JSON.stringify(F,null,2)),F.contentType!=="application/vnd.microsoft.card.adaptive"&&(K={name:F.name||F.fileName||"file",type:F.contentType||F.type||"application/octet-stream",size:F.size||0,url:F.contentUrl||F.url},console.log("Created fileMetadata:",K))}if(!p&&!K&&((f=r==null?void 0:r.messageType)==null?void 0:f.toLowerCase())==="system"){console.log("Skipping empty system message");return}const M=((h=r==null?void 0:r.sender)==null?void 0:h.displayName)||((g=r==null?void 0:r.sender)==null?void 0:g.name)||(r==null?void 0:r.agentName)||(Array.isArray(r==null?void 0:r.tags)?(E=r.tags.find(F=>F.startsWith("agentName:")))==null?void 0:E.split(":")[1]:null),ne=typeof((D=r==null?void 0:r.sender)==null?void 0:D.type)=="string"?r.sender.type.toLowerCase():"",G=typeof(r==null?void 0:r.messageType)=="string"?r.messageType.toLowerCase():"",oe=Array.isArray(r==null?void 0:r.tags)&&r.tags.includes("bot"),X=ne==="bot"||G==="bot"||oe||!M?"bot":"human";console.log("Parsed message - from:",w,"text:",p,"agent:",M,"type:",X,"file:",K);const B=(r==null?void 0:r.messageId)||(r==null?void 0:r.id)||Wge(),q=K&&!K.url&&(r==null?void 0:r.fileMetadata);if(e({id:B,from:w,text:p,timestamp:Date.now(),agentName:M,agentType:X,downloading:q||void 0,fileMetadata:K,suggestedActions:b,adaptiveCard:j}),q&&K){console.log("Starting file download in background");const F=r.fileMetadata,x=K.name,P=K.type,v=K.id;this.downloadFileAttachment(F).then(T=>{if(T){const _=URL.createObjectURL(T);console.log("Downloaded file and created blob URL:",_,"Size:",T.size),console.log("Updating message with ID:",B,"downloading: false"),e({id:B,from:w,text:p,timestamp:Date.now(),agentName:M,agentType:X,downloading:!1,fileMetadata:{name:x,type:T.type||P,size:T.size,url:_,id:v},suggestedActions:b,adaptiveCard:j})}}).catch(T=>{console.error("Failed to download file:",T)})}}catch(w){console.error("Error processing message payload:",w,r)}});return()=>{var r;return(r=n==null?void 0:n.unsubscribe)==null?void 0:r.call(n)}}onTyping(e){if(!this.sdk)return()=>{};const n=this.sdk.onTypingEvent(e);return()=>{var r;return(r=n==null?void 0:n.unsubscribe)==null?void 0:r.call(n)}}async emailTranscript(e,n){const r=await this.ensureSdk(),i={emailAddress:e};n&&(i.attachmentMessage=n),await r.emailLiveChatTranscript(i)}}const wo=new Kge,Jge=(t,e)=>new Promise(n=>{const r=()=>n(Yge(e)),i=new Image;i.crossOrigin="anonymous",i.onerror=()=>{console.warn("CORS error loading image, using fallback colors"),r()},i.onload=()=>{try{const o=document.createElement("canvas"),s=o.getContext("2d",{willReadFrequently:!0});if(!s){r();return}const l=100;o.width=l,o.height=l,s.drawImage(i,0,0,l,l);let c;try{c=s.getImageData(0,0,o.width,o.height)}catch(P){console.warn("Cannot read image data (CORS), using fallback colors",P),r();return}const a=c.data,u=12,d=6,f=new Map,h=new Map,g=(P,v,T,_,N,I,A)=>{const S=P.get(v)||{count:0,r:0,g:0,b:0,s:0,l:0};S.count+=1,S.r+=T,S.g+=_,S.b+=N,S.s+=I,S.l+=A,P.set(v,S)};for(let P=0;P<l;P++)for(let v=0;v<l;v++){const T=(P*l+v)*4,_=a[T],N=a[T+1],I=a[T+2];if(a[T+3]<120)continue;const S=$h(_,N,I);if(S.l>.97||S.l<.03||S.s<.05)continue;const H=`${Math.round(_/u)*u},${Math.round(N/u)*u},${Math.round(I/u)*u}`;g(f,H,_,N,I,S.s,S.l),(v<d||v>=l-d||P<d||P>=l-d)&&g(h,H,_,N,I,S.s,S.l)}const E=P=>Array.from(P.entries()).map(([v,T])=>{const _=T.count||1,N=Math.round(T.r/_),I=Math.round(T.g/_),A=Math.round(T.b/_),S=$h(N,I,A);return{key:v,r:N,g:I,b:A,h:S.h,s:Math.max(0,Math.min(1,T.s/_)),l:Math.max(0,Math.min(1,T.l/_)),count:_}}),D=E(f),w=E(h);if(!D.length){r();return}const p=w.filter(P=>P.l>.65||P.s<.18).sort((P,v)=>v.count-P.count)[0],b=D.filter(P=>!(P.count<3&&P.s<.2||P.l>.93||P.l<.08||P.s<.12||p&&EN(P,p)<26)),j=D.filter(P=>P.s>.45&&P.l>.18&&P.l<.82&&(!p||EN(P,p)>20)),K=new Map;[...b,...j].forEach(P=>{K.has(P.key)||K.set(P.key,P)});const M=Array.from(K.values());if(!M.length){r();return}const ne=M.map(P=>{const v=Math.pow(P.count,.92),T=Math.pow(Math.max(.12,P.s),1.7),_=1-Math.abs(P.l-.52),N=v*(.6+T*1.6)*(.6+_)*(P.s>.5?1.2:1);return{...P,score:N}}).sort((P,v)=>v.score-P.score),oe=ne.filter(P=>P.s>.55&&P.l>.2&&P.l<.8).sort((P,v)=>v.s-P.s||v.count-P.count)[0]||ne[0];if(!oe){r();return}let J=TN(oe);const X=$h(oe.r,oe.g,oe.b);let B=ne.find(P=>{const v=Math.abs(P.h-X.h),T=Math.abs(P.l-X.l),_=Math.abs(P.s-X.s);return P.key!==oe.key&&(v>.12&&v<.88||T>.12||_>.22)})||oe,q=TN(B);Zw(J,q)<1.35&&(q=X.l>.5?SN(q,25):Tv(q,25),q=rm(q,.18,.82)),J=rm(J,.2,.82);const F=rm(Tv(J,40),.15,.95),x=rm(SN(J,22),.08,.6);n({primary:J,secondary:q,light:F,dark:x})}catch(o){console.error("Color extraction failed, using fallback palette",o),r()}},i.src=t}),Qge=(t,e,n)=>"#"+[t,e,n].map(r=>{const i=r.toString(16);return i.length===1?"0"+i:i}).join(""),ou=(t,e,n)=>{const r=(l,c,a)=>(a<0&&(a+=1),a>1&&(a-=1),a<.16666666666666666?l+(c-l)*6*a:a<.5?c:a<.6666666666666666?l+(c-l)*(.6666666666666666-a)*6:l);let i,o,s;if(e===0)i=o=s=n;else{const l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;i=r(c,l,t+1/3),o=r(c,l,t),s=r(c,l,t-1/3)}return Qge(Math.round(i*255),Math.round(o*255),Math.round(s*255))},Tv=(t,e)=>{const n=parseInt(t.replace("#",""),16),r=Math.round(2.55*e),i=(n>>16)+r,o=(n>>8&255)+r,s=(n&255)+r;return"#"+(16777216+(i<255?i<1?0:i:255)*65536+(o<255?o<1?0:o:255)*256+(s<255?s<1?0:s:255)).toString(16).slice(1)},SN=(t,e)=>{const n=parseInt(t.replace("#",""),16),r=Math.round(2.55*e),i=(n>>16)-r,o=(n>>8&255)-r,s=(n&255)-r;return"#"+(16777216+(i>0?i:0)*65536+(o>0?o:0)*256+(s>0?s:0)).toString(16).slice(1)},Xge=t=>{const e=t.replace("#",""),n=parseInt(e,16);return{r:n>>16&255,g:n>>8&255,b:n&255}},rm=(t,e,n)=>{const{r,g:i,b:o}=Xge(t),{h:s,s:l,l:c}=$h(r,i,o),a=Math.min(n,Math.max(e,c));return ou(s,l,a)},TN=t=>{const{h:e,s:n,l:r}=$h(t.r,t.g,t.b);let i=Math.max(n,.38),o=r;return o>.78&&(o=.58),o<.2&&(o=.26),ou(e,i,o)},EN=(t,e)=>{const n=t.r-e.r,r=t.g-e.g,i=t.b-e.b;return Math.sqrt(n*n+r*r+i*i)},$h=(t,e,n)=>{t/=255,e/=255,n/=255;const r=Math.max(t,e,n),i=Math.min(t,e,n);let o=0,s=0;const l=(r+i)/2,c=r-i;if(c!==0){switch(s=l>.5?c/(2-r-i):c/(r+i),r){case t:o=(e-n)/c+(e<n?6:0);break;case e:o=(n-t)/c+2;break;case n:o=(t-e)/c+4;break}o/=6}return{h:o,s,l}},Yge=t=>{if(!t)return{primary:"#3b82f6",secondary:"#0ea5e9",light:"#e0f2ff",dark:"#1d4ed8"};const e=Zge(t);return{primary:ou(e,.65,.52),secondary:ou(e,.55,.44),light:ou(e,.45,.9),dark:ou(e,.75,.32)}},Zge=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return(e%360+360)%360/360},wN=t=>{const e=parseInt(t.replace("#",""),16),n=e>>16&255,r=e>>8&255,i=e>>0&255,[o,s,l]=[n,r,i].map(c=>(c=c/255,c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)));return .2126*o+.7152*s+.0722*l},Zw=(t,e)=>{const n=wN(t),r=wN(e),i=Math.max(n,r),o=Math.min(n,r);return(i+.05)/(o+.05)},eme=t=>{const e=Zw(t,"#ffffff"),n=Zw(t,"#1e293b");return n>=4.5?"#1e293b":e>=4.5?"#ffffff":n>e?"#1e293b":"#ffffff"},im=t=>{const e=document.documentElement,n=eme(t.primary),r=s=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return l?`${parseInt(l[1],16)}, ${parseInt(l[2],16)}, ${parseInt(l[3],16)}`:"99, 102, 241"};e.style.setProperty("--accent",t.primary),e.style.setProperty("--accent-rgb",r(t.primary)),e.style.setProperty("--accent-strong",t.dark),e.style.setProperty("--accent-light",t.light),e.style.setProperty("--bubble-user",t.primary),e.style.setProperty("--bubble-user-text",n);const i=Tv(t.primary,45),o=Tv(t.secondary,45);e.style.setProperty("--bg",`linear-gradient(135deg, ${i} 0%, ${o} 50%, #dbeafe 100%)`),document.body.style.background=`linear-gradient(135deg, ${i} 0%, ${o} 50%, #dbeafe 100%)`},tme="/assets/copilot-icon-BIiqtf5g.png",ca="/assets/ai-BWG1keWz.png",nme="/assets/volume-CsScuSUa.png";class tt{}tt.errors={unknownElementType:t=>`Unknown element type "${t}". Fallback will be used if present.`,unknownActionType:t=>`Unknown action type "${t}". Fallback will be used if present.`,elementTypeNotAllowed:t=>`Element type "${t}" is not allowed in this context.`,actionTypeNotAllowed:t=>`Action type "${t}" is not allowed in this context.`,invalidPropertyValue:(t,e)=>`Invalid value "${t}" for property "${e}".`,showCardMustHaveCard:()=>'"An Action.ShowCard must have its "card" property set to a valid AdaptiveCard object.',invalidColumnWidth:t=>`Invalid column width "${t}" - defaulting to "auto".`,invalidCardVersion:t=>`Invalid card version. Defaulting to "${t}".`,invalidVersionString:t=>`Invalid version string "${t}".`,propertyValueNotSupported:(t,e,n,r)=>`Value "${t}" for property "${e}" is supported in version ${n}, but you are using version ${r}.`,propertyNotSupported:(t,e,n)=>`Property "${t}" is supported in version ${e}, but you are using version ${n}.`,indexOutOfRange:t=>`Index out of range (${t}).`,elementCannotBeUsedAsInline:()=>"RichTextBlock.addInline: the specified card element cannot be used as a RichTextBlock inline.",inlineAlreadyParented:()=>"RichTextBlock.addInline: the specified inline already belongs to another RichTextBlock.",interactivityNotAllowed:()=>"Interactivity is not allowed.",inputsMustHaveUniqueId:()=>"All inputs must have a unique Id.",choiceSetMustHaveAtLeastOneChoice:()=>"An Input.ChoiceSet must have at least one choice defined.",choiceSetChoicesMustHaveTitleAndValue:()=>"All choices in an Input.ChoiceSet must have their title and value properties set.",propertyMustBeSet:t=>`Property "${t}" must be set.`,actionHttpHeadersMustHaveNameAndValue:()=>"All headers of an Action.Http must have their name and value properties set.",tooManyActions:t=>`Maximum number of actions exceeded (${t}).`,tooLittleTimeDelay:t=>`Autoplay Delay is too short (${t}).`,tooManyCarouselPages:t=>`Maximum number of Carousel pages exceeded (${t}).`,invalidInitialPageIndex:t=>`InitialPage for carousel is invalid (${t}).`,columnAlreadyBelongsToAnotherSet:()=>"This column already belongs to another ColumnSet.",invalidCardType:()=>`Invalid or missing card type. Make sure the card's type property is set to "AdaptiveCard".`,unsupportedCardVersion:(t,e)=>`The specified card version (${t}) is not supported or still in preview. The latest released card version is ${e}.`,duplicateId:t=>`Duplicate Id "${t}".`,markdownProcessingNotEnabled:()=>"Markdown processing isn't enabled. Please see https://www.npmjs.com/package/adaptivecards#supporting-markdown",processMarkdownEventRemoved:()=>"The processMarkdown event has been removed. Please update your code and set onProcessMarkdown instead.",elementAlreadyParented:()=>"The element already belongs to another container.",actionAlreadyParented:()=>"The action already belongs to another element.",elementTypeNotStandalone:t=>`Elements of type ${t} cannot be used as standalone elements.`,invalidInputLabelWidth:()=>"Invalid input label width. Defaulting to label width from host config."};tt.magicCodeInputCard={tryAgain:()=>"That didn't work... let's try again.",pleaseLogin:()=>'Please login in the popup. You will obtain a magic code. Paste that code below and select "Submit"',enterMagicCode:()=>"Enter magic code",pleaseEnterMagicCodeYouReceived:()=>"Please enter the magic code you received.",submit:()=>"Submit",cancel:()=>"Cancel",somethingWentWrong:()=>"Something went wrong. This action can't be handled.",authenticationFailed:()=>"Authentication failed."};tt.runtime={automaticRefreshPaused:()=>"Automatic refresh paused.",clckToRestartAutomaticRefresh:()=>"Click to restart.",refreshThisCard:()=>"Refresh this card"};tt.hints={dontUseWeightedAndStrecthedColumnsInSameSet:()=>"It is not recommended to use weighted and stretched columns in the same ColumnSet, because in such a situation stretched columns will always get the minimum amount of space."};tt.defaults={inlineActionTitle:()=>"Inline Action",overflowButtonText:()=>"...",overflowButtonTooltip:()=>"More options",emptyElementText:t=>`Empty ${t}`,mediaPlayerAriaLabel:()=>"Media content",mediaPlayerPlayMedia:()=>"Play media",youTubeVideoPlayer:()=>"YouTube video player",vimeoVideoPlayer:()=>"Vimeo video player",dailymotionVideoPlayer:()=>"Dailymotion video player",carouselNavigationPreviousTooltip:()=>"Previous carousel page",carouselNavigationNextTooltip:()=>"Next carousel page"};class _t{}_t.Default="default";_t.Emphasis="emphasis";_t.Accent="accent";_t.Good="good";_t.Attention="attention";_t.Warning="warning";class Li{}Li.Default="default";Li.Positive="positive";Li.Destructive="destructive";class Ml{}Ml.Primary="primary";Ml.Secondary="secondary";var Kr;(function(t){t[t.Auto=0]="Auto",t[t.Stretch=1]="Stretch",t[t.Small=2]="Small",t[t.Medium=3]="Medium",t[t.Large=4]="Large"})(Kr||(Kr={}));var Dl;(function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"})(Dl||(Dl={}));var Nl;(function(t){t[t.Default=0]="Default",t[t.Stacked=1]="Stacked",t[t.Grid=2]="Grid"})(Nl||(Nl={}));var Mr;(function(t){t[t.Weight=0]="Weight",t[t.Pixel=1]="Pixel"})(Mr||(Mr={}));var Hn;(function(t){t[t.Small=0]="Small",t[t.Default=1]="Default",t[t.Medium=2]="Medium",t[t.Large=3]="Large",t[t.ExtraLarge=4]="ExtraLarge"})(Hn||(Hn={}));var No;(function(t){t[t.RevealOnHover=0]="RevealOnHover",t[t.Default=1]="Default"})(No||(No={}));var mr;(function(t){t[t.Lighter=0]="Lighter",t[t.Default=1]="Default",t[t.Bolder=2]="Bolder"})(mr||(mr={}));var Ga;(function(t){t[t.Default=0]="Default",t[t.Monospace=1]="Monospace"})(Ga||(Ga={}));var vt;(function(t){t[t.None=0]="None",t[t.Small=1]="Small",t[t.Default=2]="Default",t[t.Medium=3]="Medium",t[t.Large=4]="Large",t[t.ExtraLarge=5]="ExtraLarge",t[t.Padding=6]="Padding"})(vt||(vt={}));var qn;(function(t){t[t.Default=0]="Default",t[t.Dark=1]="Dark",t[t.Light=2]="Light",t[t.Accent=3]="Accent",t[t.Good=4]="Good",t[t.Warning=5]="Warning",t[t.Attention=6]="Attention"})(qn||(qn={}));var Mn;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Mn||(Mn={}));var $o;(function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom"})($o||($o={}));var ai;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Stretch=3]="Stretch"})(ai||(ai={}));var Fu;(function(t){t[t.Default=0]="Default",t[t.Person=1]="Person"})(Fu||(Fu={}));var ks;(function(t){t[t.Inline=0]="Inline",t[t.Popup=1]="Popup"})(ks||(ks={}));var Dn;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"})(Dn||(Dn={}));var Ta;(function(t){t[t.Cover=0]="Cover",t[t.RepeatHorizontally=1]="RepeatHorizontally",t[t.RepeatVertically=2]="RepeatVertically",t[t.Repeat=3]="Repeat"})(Ta||(Ta={}));var xl;(function(t){t[t.LeftOfTitle=0]="LeftOfTitle",t[t.AboveTitle=1]="AboveTitle"})(xl||(xl={}));var no;(function(t){t[t.Text=0]="Text",t[t.Tel=1]="Tel",t[t.Url=2]="Url",t[t.Email=3]="Email",t[t.Password=4]="Password"})(no||(no={}));var Ps;(function(t){t[t.Inline=0]="Inline",t[t.Above=1]="Above"})(Ps||(Ps={}));var Bu;(function(t){t[t.Parse=0]="Parse",t[t.ToJSON=1]="ToJSON",t[t.Validation=2]="Validation"})(Bu||(Bu={}));var Ct;(function(t){t[t.Hint=0]="Hint",t[t.ActionTypeNotAllowed=1]="ActionTypeNotAllowed",t[t.CollectionCantBeEmpty=2]="CollectionCantBeEmpty",t[t.Deprecated=3]="Deprecated",t[t.ElementTypeNotAllowed=4]="ElementTypeNotAllowed",t[t.InteractivityNotAllowed=5]="InteractivityNotAllowed",t[t.InvalidPropertyValue=6]="InvalidPropertyValue",t[t.MissingCardType=7]="MissingCardType",t[t.PropertyCantBeNull=8]="PropertyCantBeNull",t[t.TooManyActions=9]="TooManyActions",t[t.UnknownActionType=10]="UnknownActionType",t[t.UnknownElementType=11]="UnknownElementType",t[t.UnsupportedCardVersion=12]="UnsupportedCardVersion",t[t.DuplicateId=13]="DuplicateId",t[t.UnsupportedProperty=14]="UnsupportedProperty",t[t.RequiredInputsShouldHaveLabel=15]="RequiredInputsShouldHaveLabel",t[t.RequiredInputsShouldHaveErrorMessage=16]="RequiredInputsShouldHaveErrorMessage",t[t.Other=17]="Other"})(Ct||(Ct={}));var Ua;(function(t){t[t.FullyInContainer=0]="FullyInContainer",t[t.Overflowing=1]="Overflowing",t[t.FullyOutOfContainer=2]="FullyOutOfContainer"})(Ua||(Ua={}));var su;(function(t){t[t.UnknownType=0]="UnknownType",t[t.ForbiddenType=1]="ForbiddenType"})(su||(su={}));var eI;(function(t){t[t.Disabled=0]="Disabled",t[t.Manual=1]="Manual",t[t.Automatic=2]="Automatic"})(eI||(eI={}));var tI;(function(t){t[t.Info=0]="Info",t[t.Warning=1]="Warning",t[t.Error=2]="Error"})(tI||(tI={}));var IN;(function(t){t[t.NavigationNext=0]="NavigationNext",t[t.NavigationPrevious=1]="NavigationPrevious",t[t.Pagination=2]="Pagination",t[t.Autoplay=3]="Autoplay"})(IN||(IN={}));var ma;(function(t){t[t.Button=0]="Button",t[t.Link=1]="Link",t[t.Tab=2]="Tab",t[t.Menu=3]="Menu",t[t.MenuItem=4]="MenuItem"})(ma||(ma={}));class yt{}yt.useAdvancedTextBlockTruncation=!0;yt.useAdvancedCardBottomTruncation=!1;yt.useMarkdownInRadioButtonAndCheckbox=!0;yt.allowMarkForTextHighlighting=!1;yt.alwaysBleedSeparators=!1;yt.enableFullJsonRoundTrip=!1;yt.displayInputValidationErrors=!0;yt.allowPreProcessingPropertyValues=!1;yt.setTabIndexAtCardRoot=!0;yt.enableFallback=!0;yt.useWebkitLineClamp=!0;yt.allowMoreThanMaxActionsInOverflowMenu=!1;yt.removePaddingFromContainersWithBackgroundImage=!1;yt.resetInputsDirtyStateAfterActionExecution=!0;yt.applets={logEnabled:!0,logLevel:tI.Error,maximumRetryAttempts:3,defaultTimeBetweenRetryAttempts:3e3,authPromptWidth:400,authPromptHeight:600,refresh:{mode:eI.Manual,timeBetweenAutomaticRefreshes:3e3,maximumConsecutiveAutomaticRefreshes:3,allowManualRefreshesAfterAutomaticRefreshes:!0}};const hf={applicationJson:"application/json",applicationXWwwFormUrlencoded:"application/x-www-form-urlencoded"};class bN{constructor(){this._isProcessed=!1}getReferencedInputs(e,n){if(!n)throw new Error("The referencedInputs parameter cannot be null.");if(this._original)for(const r of e)new RegExp("\\{{2}("+r.id+").value\\}{2}","gi").exec(this._original)!=null&&r.id&&(n[r.id]=r)}substituteInputValues(e,n){if(this._processed=this._original,this._original){const r=/\{{2}([a-z0-9_$@]+).value\}{2}/gi;let i;for(;(i=r.exec(this._original))!==null&&this._processed;)for(const o of Object.keys(e))if(o.toLowerCase()===i[1].toLowerCase()){const s=e[o];let l="";s.value&&(l=s.value),n===hf.applicationJson?(l=JSON.stringify(l),l=l.slice(1,-1)):n===hf.applicationXWwwFormUrlencoded&&(l=encodeURIComponent(l)),this._processed=this._processed.replace(i[0],l);break}}this._isProcessed=!0}getOriginal(){return this._original}get(){return this._isProcessed?this._processed:this._original}set(e){this._original=e,this._isProcessed=!1}}class VA{constructor(e=0,n=0,r=0,i=0){this.left=0,this.top=0,this.right=0,this.bottom=0,this.top=e,this.right=n,this.bottom=r,this.left=i}}class Vl{constructor(e=vt.None,n=vt.None,r=vt.None,i=vt.None){this.top=vt.None,this.right=vt.None,this.bottom=vt.None,this.left=vt.None,this.top=e,this.right=n,this.bottom=r,this.left=i}}class Oi{static parse(e,n=!1){const r=new Oi(0,Mr.Weight);if(typeof e=="number")return r.physicalSize=e,r;if(typeof e=="string"){const o=/^([0-9]+)(px|\*)?$/g.exec(e),s=n?3:2;if(o&&o.length>=s)return r.physicalSize=parseInt(o[1]),o.length===3&&o[2]==="px"&&(r.unit=Mr.Pixel),r}throw new Error("Invalid size: "+e)}constructor(e,n){this.physicalSize=e,this.unit=n}}/**
 * Fast UUID generator, RFC4122 version 4 compliant.
 * @author Jeff Ward (jcward.com).
 * @license MIT license
 * @link http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
 **/class kn{static generate(){const e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return kn.lut[e&255]+kn.lut[e>>8&255]+kn.lut[e>>16&255]+kn.lut[e>>24&255]+"-"+kn.lut[n&255]+kn.lut[n>>8&255]+"-"+kn.lut[n>>16&15|64]+kn.lut[n>>24&255]+"-"+kn.lut[r&63|128]+kn.lut[r>>8&255]+"-"+kn.lut[r>>16&255]+kn.lut[r>>24&255]+kn.lut[i&255]+kn.lut[i>>8&255]+kn.lut[i>>16&255]+kn.lut[i>>24&255]}static initialize(){for(let e=0;e<256;e++)kn.lut[e]=(e<16?"0":"")+e.toString(16)}}kn.lut=[];kn.initialize();var ET;function rme(){return window.document.documentMode!==void 0}function ime(){const t=window.navigator.userAgent;return!!t.match(/Android/i)||!!t.match(/iPad/i)||!!t.match(/iPhone/i)}function Fa(){return"__ac-"+kn.generate()}function Ht(t,e){e&&t.appendChild(e)}function zA(t,e){return typeof t=="string"?t:e}function GA(t,e){return typeof t=="number"?t:e}function WA(t,e){if(typeof t=="boolean")return t;if(typeof t=="string")switch(t.toLowerCase()){case"true":return!0;case"false":return!1;default:return e}return e}function dH(t,e){for(const n in t){const r=parseInt(n,10);if(r>=0){const i=t[n];if(i&&typeof i=="string"&&i.toLowerCase()===e.toLowerCase())return r}}}function ome(t,e,n){if(!e)return n;const r=dH(t,e);return r!==void 0?r:n}function ac(t){if(t){const n=/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?/gi.exec(t);if(n&&n[4]){const r=parseInt(n[1],16)/255,i=parseInt(n[2],16),o=parseInt(n[3],16),s=parseInt(n[4],16);return"rgba("+i+","+o+","+s+","+r+")"}}return t}function sme(t,e,n,r,i){const o=()=>e-t.scrollHeight>=-1;if(o())return;const s=lme(n);let l=0,c=s.length,a=0;for(;l<c;){const u=Math.floor((l+c)/2);r(n,s[u]),o()?(a=s[u],l=u+1):c=u}if(r(n,a),i&&e-t.scrollHeight>=i-1){let u=Ev(n,a);for(;u<n.length&&(r(n,u),o());)a=u,u=Ev(n,u);r(n,a)}}function ame(t,e,n){sme(t,e,t.innerText,(r,i)=>{t.innerText=r.substring(0,i)+"..."},n)}typeof window>"u"||(ET=window.trustedTypes)===null||ET===void 0||ET.createPolicy("adaptivecards#deprecatedExportedFunctionPolicy",{createHTML:t=>t});function lme(t){const e=[];let n=Ev(t,-1);for(;n<t.length;)t[n]===" "&&e.push(n),n=Ev(t,n);return e}function Ev(t,e){for(e+=1;e<t.length&&t[e]==="<";)for(;e<t.length&&t[e++]!==">";);return e}function cme(t,e){const n=t.offsetTop;return n+t.clientHeight<=e?Ua.FullyInContainer:n<e?Ua.Overflowing:Ua.FullyOutOfContainer}function xc(){return window.pageXOffset}function om(){return window.pageYOffset}function ume(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function dme(t,e){let n;function r(...i){n&&clearTimeout(n),n=setTimeout(()=>{t(...i)},e)}return r}class vo{constructor(e=1,n=1,r){this._isValid=!0,this._major=e,this._minor=n,this._label=r}static parse(e,n){if(!e)return;const r=new vo;r._versionString=e;const o=/(\d+).(\d+)/gi.exec(e);return o!=null&&o.length===3?(r._major=parseInt(o[1]),r._minor=parseInt(o[2])):r._isValid=!1,r._isValid||n.logParseEvent(void 0,Ct.InvalidPropertyValue,tt.errors.invalidVersionString(r._versionString)),r}toString(){return this._isValid?this._major+"."+this._minor:this._versionString}toJSON(){return this.toString()}compareTo(e){if(!this.isValid||!e.isValid)throw new Error("Cannot compare invalid version.");return this.major>e.major?1:this.major<e.major?-1:this.minor>e.minor?1:this.minor<e.minor?-1:0}get label(){return this._label?this._label:this.toString()}get major(){return this._major}get minor(){return this._minor}get isValid(){return this._isValid}}class Ee{static getAllDeclaredVersions(){const e=Ee,n=[];for(const r in e)if(r.match(/^v[0-9_]*$/))try{const i=e[r];i instanceof vo&&n.push(i)}catch{}return n.sort((r,i)=>r.compareTo(i))}}Ee.v1_0=new vo(1,0);Ee.v1_1=new vo(1,1);Ee.v1_2=new vo(1,2);Ee.v1_3=new vo(1,3);Ee.v1_4=new vo(1,4);Ee.v1_5=new vo(1,5);Ee.v1_6=new vo(1,6);Ee.latest=Ee.v1_6;class KA{constructor(e=Ee.latest){this._validationEvents=[],this.targetVersion=e}isTemplateString(e){return typeof e=="string"?e.startsWith("${"):!1}tryDeleteValue(e,n){yt.enableFullJsonRoundTrip||delete e[n]}tryDeleteDefaultValue(e,n){(!yt.enableFullJsonRoundTrip||!this.isTemplateString(e[n]))&&delete e[n]}serializeValue(e,n,r,i=void 0,o=!1){r==null?(!yt.enableFullJsonRoundTrip||o)&&delete e[n]:r===i?(!yt.enableFullJsonRoundTrip||o||!this.isTemplateString(e[n]))&&delete e[n]:e[n]=r}serializeString(e,n,r,i){r==null?this.tryDeleteValue(e,n):r===i?this.tryDeleteDefaultValue(e,n):e[n]=r}serializeBool(e,n,r,i){r==null?this.tryDeleteValue(e,n):r===i?this.tryDeleteDefaultValue(e,n):e[n]=r}serializeNumber(e,n,r,i){r==null||isNaN(r)?this.tryDeleteValue(e,n):r===i?this.tryDeleteDefaultValue(e,n):e[n]=r}serializeEnum(e,n,r,i,o=void 0){i==null?this.tryDeleteValue(n,r):i===o?this.tryDeleteDefaultValue(n,r):n[r]=e[i]}serializeArray(e,n,r){const i=[];if(r)for(const o of r){let s;o instanceof On?s=o.toJSON(this):o.toJSON?s=o.toJSON():s=o,s!==void 0&&i.push(s)}i.length===0?e.hasOwnProperty(n)&&Array.isArray(e[n])&&delete e[n]:this.serializeValue(e,n,i)}clearEvents(){this._validationEvents=[]}logEvent(e,n,r,i){this._validationEvents.push({source:e,phase:n,event:r,message:i})}logParseEvent(e,n,r){this.logEvent(e,Bu.Parse,n,r)}getEventAt(e){return this._validationEvents[e]}get eventCount(){return this._validationEvents.length}}class _N extends KA{}class Vn{getInternalName(){return this.name}parse(e,n,r){return n[this.name]}toJSON(e,n,r,i){i.serializeValue(n,this.name,r,this.defaultValue)}constructor(e,n,r,i){this.targetVersion=e,this.name=n,this.defaultValue=r,this.onGetInitialValue=i,this.isSerializationEnabled=!0,this.sequentialNumber=Vn._sequentialNumber,Vn._sequentialNumber++}}Vn._sequentialNumber=0;class ut extends Vn{parse(e,n,r){const i=zA(n[this.name],this.defaultValue);if(!(i===void 0||i===""&&this.treatEmptyAsUndefined)&&this.regEx!==void 0&&!this.regEx.exec(i)){r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(i,this.name));return}return i}toJSON(e,n,r,i){i.serializeString(n,this.name,r===""&&this.treatEmptyAsUndefined?void 0:r,this.defaultValue)}constructor(e,n,r=!0,i,o,s){super(e,n,o,s),this.targetVersion=e,this.name=n,this.treatEmptyAsUndefined=r,this.regEx=i,this.defaultValue=o,this.onGetInitialValue=s}}class or extends Vn{parse(e,n,r){return WA(n[this.name],this.defaultValue)}toJSON(e,n,r,i){i.serializeBool(n,this.name,r,this.defaultValue)}constructor(e,n,r,i){super(e,n,r,i),this.targetVersion=e,this.name=n,this.defaultValue=r,this.onGetInitialValue=i}}class fs extends Vn{parse(e,n,r){return GA(n[this.name],this.defaultValue)}toJSON(e,n,r,i){i.serializeNumber(n,this.name,r,this.defaultValue)}constructor(e,n,r,i){super(e,n,r,i),this.targetVersion=e,this.name=n,this.defaultValue=r,this.onGetInitialValue=i}}class hme extends Vn{parse(e,n,r){let i;const o=n[this.name];if(typeof o=="string"){let s=!1;try{const l=Oi.parse(o,!0);l.unit===Mr.Pixel&&(i=l.physicalSize,s=!0)}catch{}s||r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(n[this.name],this.name))}return i}toJSON(e,n,r,i){i.serializeValue(n,this.name,typeof r=="number"&&!isNaN(r)?r+"px":void 0)}}class fme extends Vn{parse(e,n,r){const i=n[this.name];if(i===void 0||!Array.isArray(i))return this.defaultValue;const o=[];for(const s of i)typeof s=="string"?o.push(s):r.logParseEvent(e,Ct.InvalidPropertyValue,`Invalid array value "${JSON.stringify(s)}" of type "${typeof s}" ignored for "${this.name}".`);return o}toJSON(e,n,r,i){i.serializeArray(n,this.name,r)}constructor(e,n,r,i){super(e,n,r,i),this.targetVersion=e,this.name=n,this.defaultValue=r,this.onGetInitialValue=i}}class md extends Vn{isValidValue(e,n){for(const r of this.values)if(e.toLowerCase()===r.value.toLowerCase())return(r.targetVersion?r.targetVersion:this.targetVersion).compareTo(n.targetVersion)<=0;return!1}parse(e,n,r){const i=n[this.name];if(i===void 0)return this.defaultValue;if(typeof i=="string"){for(const o of this.values)if(i.toLowerCase()===o.value.toLowerCase()){const s=o.targetVersion?o.targetVersion:this.targetVersion;return s.compareTo(r.targetVersion)<=0?o.value:(r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.propertyValueNotSupported(i,this.name,s.toString(),r.targetVersion.toString())),this.defaultValue)}}return r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(i,this.name)),this.defaultValue}toJSON(e,n,r,i){let o=!1;if(r!==void 0){o=!0;for(const s of this.values)if(s.value===r){const l=s.targetVersion?s.targetVersion:this.targetVersion;if(l.compareTo(i.targetVersion)<=0){o=!1;break}else i.logEvent(e,Bu.ToJSON,Ct.InvalidPropertyValue,tt.errors.propertyValueNotSupported(r,this.name,l.toString(),i.targetVersion.toString()))}}o||i.serializeValue(n,this.name,r,this.defaultValue,!0)}constructor(e,n,r,i,o){super(e,n,i,o),this.targetVersion=e,this.name=n,this.values=r,this.defaultValue=i,this.onGetInitialValue=o}}class sr extends Vn{parse(e,n,r){const i=n[this.name];if(typeof i!="string")return this.defaultValue;const o=dH(this.enumType,i);if(o!==void 0){for(const s of this.values)if(s.value===o){const l=s.targetVersion?s.targetVersion:this.targetVersion;return l.compareTo(r.targetVersion)<=0?o:(r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.propertyValueNotSupported(i,this.name,l.toString(),r.targetVersion.toString())),this.defaultValue)}}return r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(i,this.name)),this.defaultValue}toJSON(e,n,r,i){let o=!1;if(r!==void 0){o=!0;for(const s of this.values)if(s.value===r)if((s.targetVersion?s.targetVersion:this.targetVersion).compareTo(i.targetVersion)<=0){o=!1;break}else i.logEvent(e,Bu.ToJSON,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(r,this.name))}o||i.serializeEnum(this.enumType,n,this.name,r,this.defaultValue)}constructor(e,n,r,i,o,s){if(super(e,n,i,s),this.targetVersion=e,this.name=n,this.enumType=r,this.defaultValue=i,this.onGetInitialValue=s,this._values=[],o)this._values=o;else for(const l in r){const c=parseInt(l,10);c>=0&&this._values.push({value:c})}}get values(){return this._values}}class vd extends Vn{parse(e,n,r){const i=n[this.name];if(i===void 0)return this.onGetInitialValue?this.onGetInitialValue(e):this.defaultValue;const o=new this.objectType;return o.parse(i,r),o}toJSON(e,n,r,i){let o;r!==void 0&&!r.hasAllDefaultValues()&&(o=r.toJSON(i)),typeof o=="object"&&Object.keys(o).length===0&&(o=void 0),i.serializeValue(n,this.name,o,this.defaultValue,!0)}constructor(e,n,r,i=!1,o){super(e,n,o,s=>this.nullable?void 0:new this.objectType),this.targetVersion=e,this.name=n,this.objectType=r,this.nullable=i}}class lc extends Vn{parse(e,n,r){const i=[],o=n[this.name];if(Array.isArray(o))for(const s of o){const l=new this.objectType;l.parse(s,r),i.push(l),this.onItemAdded&&this.onItemAdded(e,l)}return i.length>0?i:this.onGetInitialValue?this.onGetInitialValue(e):void 0}toJSON(e,n,r,i){i.serializeArray(n,this.name,r)}constructor(e,n,r,i){super(e,n,void 0,o=>[]),this.targetVersion=e,this.name=n,this.objectType=r,this.onItemAdded=i}}class cc extends Vn{parse(e,n,r){return this.onParse(e,this,n,r)}toJSON(e,n,r,i){this.onToJSON(e,this,n,r,i)}constructor(e,n,r,i,o,s){if(super(e,n,o,s),this.targetVersion=e,this.name=n,this.onParse=r,this.onToJSON=i,this.defaultValue=o,this.onGetInitialValue=s,!this.onParse)throw new Error("CustomPropertyDefinition instances must have an onParse handler.");if(!this.onToJSON)throw new Error("CustomPropertyDefinition instances must have an onToJSON handler.")}}class pme{constructor(){this._properties=[]}indexOf(e){for(let n=0;n<this._properties.length;n++)if(this._properties[n]===e)return n;return-1}add(...e){for(const n of e)this.indexOf(n)===-1&&this._properties.push(n)}remove(...e){for(const n of e)for(;;){const r=this.indexOf(n);if(r>=0)this._properties.splice(r,1);else break}}getItemAt(e){return this._properties[e]}getCount(){return this._properties.length}}function Ae(t){return function(e,n){const r=Object.getOwnPropertyDescriptor(e,n)||{};!r.get&&!r.set&&(r.get=function(){return this.getValue(t)},r.set=function(i){this.setValue(t,i)},Object.defineProperty(e,n,r))}}class On{getDefaultSerializationContext(){return new _N}populateSchema(e){const n=this.constructor,r=[];for(const i in n)try{const o=n[i];o instanceof Vn&&r.push(o)}catch{}if(r.length>0){const i=r.sort((o,s)=>o.sequentialNumber>s.sequentialNumber?1:o.sequentialNumber<s.sequentialNumber?-1:0);e.add(...i)}On.onRegisterCustomProperties&&On.onRegisterCustomProperties(this,e)}getValue(e){return this._propertyBag.hasOwnProperty(e.getInternalName())?this._propertyBag[e.getInternalName()]:e.defaultValue}setValue(e,n){n==null?delete this._propertyBag[e.getInternalName()]:this._propertyBag[e.getInternalName()]=n}internalParse(e,n){if(this._propertyBag={},this._rawProperties=yt.enableFullJsonRoundTrip?e||{}:{},e){const r=this.getSchema();for(let i=0;i<r.getCount();i++){const o=r.getItemAt(i);if(o.isSerializationEnabled){let s=o.onGetInitialValue?o.onGetInitialValue(this):void 0;e.hasOwnProperty(o.name)&&(o.targetVersion.compareTo(n.targetVersion)<=0?s=o.parse(this,e,n):n.logParseEvent(this,Ct.UnsupportedProperty,tt.errors.propertyNotSupported(o.name,o.targetVersion.toString(),n.targetVersion.toString()))),this.setValue(o,s)}}}else this.resetDefaultValues()}internalToJSON(e,n){const r=this.getSchema(),i=[];for(let o=0;o<r.getCount();o++){const s=r.getItemAt(o);s.isSerializationEnabled&&s.targetVersion.compareTo(n.targetVersion)<=0&&i.indexOf(s.name)===-1&&(s.toJSON(this,e,this.getValue(s),n),i.push(s.name))}}shouldSerialize(e){return!0}constructor(){this._propertyBag={},this._rawProperties={},this.maxVersion=On.defaultMaxVersion;const e=this.getSchema();for(let n=0;n<e.getCount();n++){const r=e.getItemAt(n);r.onGetInitialValue&&this.setValue(r,r.onGetInitialValue(this))}}parse(e,n){this.internalParse(e,n||new _N)}toJSON(e){let n;if(e&&e instanceof KA?n=e:(n=this.getDefaultSerializationContext(),n.toJSONOriginalParam=e),this.shouldSerialize(n)){let r;return yt.enableFullJsonRoundTrip&&this._rawProperties&&typeof this._rawProperties=="object"?r=this._rawProperties:r={},this.internalToJSON(r,n),r}else return}hasDefaultValue(e){return this.getValue(e)===e.defaultValue}hasAllDefaultValues(){const e=this.getSchema();for(let n=0;n<e.getCount();n++){const r=e.getItemAt(n);if(!this.hasDefaultValue(r))return!1}return!0}resetDefaultValues(){const e=this.getSchema();for(let n=0;n<e.getCount();n++){const r=e.getItemAt(n);this.setValue(r,r.defaultValue)}}setCustomProperty(e,n){typeof n=="string"&&!n||n===void 0||n===null?delete this._rawProperties[e]:this._rawProperties[e]=n}getCustomProperty(e){return this._rawProperties[e]}getSchema(){let e=On._schemaCache[this.getSchemaKey()];return e||(e=new pme,this.populateSchema(e),On._schemaCache[this.getSchemaKey()]=e),e}}On.defaultMaxVersion=Ee.latest;On._schemaCache={};class nI extends On{constructor(){super(...arguments),this._capabilities={}}getSchemaKey(){return"HostCapabilities"}internalParse(e,n){if(super.internalParse(e,n),e)for(const r in e){const i=e[r];if(typeof i=="string")if(i==="*")this.addCapability(r,"*");else{const o=vo.parse(i,n);o!=null&&o.isValid&&this.addCapability(r,o)}}}internalToJSON(e,n){super.internalToJSON(e,n);for(const r in this._capabilities)e[r]=this._capabilities[r]}addCapability(e,n){this._capabilities[e]=n}removeCapability(e){delete this._capabilities[e]}clear(){this._capabilities={}}hasCapability(e,n){return this._capabilities.hasOwnProperty(e)?n==="*"||this._capabilities[e]==="*"?!0:n.compareTo(this._capabilities[e])<=0:!1}areAllMet(e){for(const n in this._capabilities)if(!e.hasCapability(n,this._capabilities[n]))return!1;return!0}}function lo(t,e,n){if(typeof e=="string"){const r=ome(t,e,n);return r!==void 0?r:n}else return typeof e=="number"?e:n}class AN{constructor(e,n){this.default="#000000",this.subtle="#666666",e&&(this.default=e),n&&(this.subtle=n)}parse(e){e&&(this.default=e.default||this.default,this.subtle=e.subtle||this.subtle)}}class vl extends AN{constructor(){super(...arguments),this.highlightColors=new AN("#22000000","#11000000")}parse(e){super.parse(e),e&&this.highlightColors.parse(e.highlightColors)}}class RN{constructor(e){this.allowCustomStyle=!1,e&&(this.allowCustomStyle=e.allowCustomStyle||this.allowCustomStyle)}}class kN{constructor(e){this.imageSize=Kr.Medium,this.maxImageHeight=100,e&&(this.imageSize=e.imageSize!=null?e.imageSize:this.imageSize,this.maxImageHeight=GA(e.maxImageHeight,100))}toJSON(){return{imageSize:Kr[this.imageSize],maxImageHeight:this.maxImageHeight}}}class gme{constructor(e){this.allowInlinePlayback=!0,e&&(this.defaultPoster=e.defaultPoster,this.allowInlinePlayback=e.allowInlinePlayback||this.allowInlinePlayback)}toJSON(){return{defaultPoster:this.defaultPoster,allowInlinePlayback:this.allowInlinePlayback}}}class mme{constructor(e){this.cellSpacing=8,e&&(this.cellSpacing=e.cellSpacing&&typeof e.cellSpacing=="number"?e.cellSpacing:this.cellSpacing)}toJSON(){return{cellSpacing:this.cellSpacing}}}class zl{constructor(e){this.size=Hn.Default,this.color=qn.Default,this.isSubtle=!1,this.weight=mr.Default,this.parse(e)}parse(e){e&&(this.size=lo(Hn,e.size,this.size),this.color=lo(qn,e.color,this.color),this.isSubtle=e.isSubtle!==void 0&&typeof e.isSubtle=="boolean"?e.isSubtle:this.isSubtle,this.weight=lo(mr,e.weight,this.getDefaultWeight()))}getDefaultWeight(){return mr.Default}toJSON(){return{size:Hn[this.size],color:qn[this.color],isSubtle:this.isSubtle,weight:mr[this.weight]}}}class wT extends zl{constructor(){super(...arguments),this.fontType=Ga.Default}parse(e){super.parse(e),e&&(this.fontType=lo(Ga,e.fontType,this.fontType))}}class PN{constructor(e){this.default=new wT,this.heading=new wT({size:"Large",weight:"Bolder"}),this.columnHeader=new wT({weight:"Bolder"}),e&&(this.heading.parse(e.heading),this.columnHeader.parse(e.columnHeader))}getStyleByName(e){switch(e.toLowerCase()){case"heading":return this.heading;case"columnHeader":return this.columnHeader;default:return this.default}}}class ON{constructor(e){e&&(this.headingLevel=GA(e.headingLevel))}}class MN extends zl{constructor(){super(...arguments),this.suffix=" *",this.suffixColor=qn.Attention}parse(e){super.parse(e),e&&(this.suffix=e.suffix||this.suffix,this.suffixColor=lo(qn,e.suffixColor,this.suffixColor))}toJSON(){const e=super.toJSON();return e.suffix=this.suffix,e.suffixColor=qn[this.suffixColor],e}}class DN{constructor(e){this.inputSpacing=vt.Small,this.width=30,this.requiredInputs=new MN,this.optionalInputs=new zl,e&&(this.inputSpacing=lo(vt,e.inputSpacing,this.inputSpacing),this.requiredInputs=new MN(e.requiredInputs),this.optionalInputs=new zl(e.optionalInputs),this.width=e.width!=null?e.width:this.width)}}class NN{constructor(e){this.label=new DN,this.errorMessage=new zl({color:qn.Attention}),this.debounceTimeInMilliSeconds=0,this.allowDynamicallyFilteredChoiceSet=!0,this.allowRevealOnHoverStyle=!1,e&&(this.label=new DN(e.label),this.errorMessage=new zl(e.errorMessage),this.allowRevealOnHoverStyle=e.allowRevealOnHoverStyle||this.allowRevealOnHoverStyle,this.allowDynamicallyFilteredChoiceSet=e.allowDynamicallyFilteredChoiceSet||this.allowDynamicallyFilteredChoiceSet,this.debounceTimeInMilliSeconds=e.debounceTimeInMilliSeconds||this.debounceTimeInMilliSeconds)}}class rI extends zl{constructor(){super(...arguments),this.wrap=!0}parse(e){super.parse(e),e&&(this.wrap=e.wrap!=null?e.wrap:this.wrap)}toJSON(){const e=super.toJSON();return e.wrap=this.wrap,e}}class xN extends rI{constructor(e){super(e),this.maxWidth=150,this.weight=mr.Bolder,e&&(this.maxWidth=e.maxWidth!=null?e.maxWidth:this.maxWidth,this.weight=lo(mr,e.weight,mr.Bolder))}getDefaultWeight(){return mr.Bolder}}class LN{constructor(e){this.title=new xN,this.value=new rI,this.spacing=10,e&&(this.title=new xN(e.title),this.value=new rI(e.value),this.spacing=e.spacing&&e.spacing!=null?e.spacing&&e.spacing:this.spacing)}}class UN{constructor(e){this.actionMode=ks.Inline,this.inlineTopMargin=16,this.style=_t.Emphasis,e&&(this.actionMode=lo(ks,e.actionMode,ks.Inline),this.inlineTopMargin=e.inlineTopMargin!=null?e.inlineTopMargin:this.inlineTopMargin,this.style=e.style&&typeof e.style=="string"?e.style:_t.Emphasis)}toJSON(){return{actionMode:ks[this.actionMode],inlineTopMargin:this.inlineTopMargin,style:this.style}}}class FN{constructor(e){var n;if(this.maxActions=5,this.spacing=vt.Default,this.buttonSpacing=20,this.showCard=new UN,this.preExpandSingleShowCardAction=!1,this.actionsOrientation=Dn.Horizontal,this.actionAlignment=ai.Left,this.iconPlacement=xl.LeftOfTitle,this.allowTitleToWrap=!1,this.showIconInOverflow=!1,this.iconSize=16,e){this.maxActions=e.maxActions!=null?e.maxActions:this.maxActions,this.spacing=lo(vt,e.spacing&&e.spacing,vt.Default),this.buttonSpacing=e.buttonSpacing!=null?e.buttonSpacing:this.buttonSpacing,this.showCard=new UN(e.showCard),this.preExpandSingleShowCardAction=WA(e.preExpandSingleShowCardAction,!1),this.actionsOrientation=lo(Dn,e.actionsOrientation,Dn.Horizontal),this.actionAlignment=lo(ai,e.actionAlignment,ai.Left),this.iconPlacement=lo(xl,e.iconPlacement,xl.LeftOfTitle),this.allowTitleToWrap=e.allowTitleToWrap!=null?e.allowTitleToWrap:this.allowTitleToWrap,this.showIconInOverflow=(n=e.showIconInOverflow)!==null&&n!==void 0?n:this.showIconInOverflow;try{const r=Oi.parse(e.iconSize);r.unit===Mr.Pixel&&(this.iconSize=r.physicalSize)}catch{}}}toJSON(){return{maxActions:this.maxActions,spacing:vt[this.spacing],buttonSpacing:this.buttonSpacing,showCard:this.showCard,preExpandSingleShowCardAction:this.preExpandSingleShowCardAction,actionsOrientation:Dn[this.actionsOrientation],actionAlignment:ai[this.actionAlignment]}}}class vme{parseSingleColor(e,n){e&&this[n].parse(e[n])}constructor(e){this.default=new vl,this.dark=new vl,this.light=new vl,this.accent=new vl,this.good=new vl,this.warning=new vl,this.attention=new vl,this.parse(e)}parse(e){e&&(this.parseSingleColor(e,"default"),this.parseSingleColor(e,"dark"),this.parseSingleColor(e,"light"),this.parseSingleColor(e,"accent"),this.parseSingleColor(e,"good"),this.parseSingleColor(e,"warning"),this.parseSingleColor(e,"attention"))}}class hH{parse(e){e&&(this.backgroundColor=e.backgroundColor,this.foregroundColors.parse(e.foregroundColors),this.highlightBackgroundColor=e.highlightBackgroundColor,this.highlightForegroundColor=e.highlightForegroundColor,this.borderColor=e.borderColor)}constructor(e){this.foregroundColors=new vme({default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#E69500",subtle:"#DDE69500"},attention:{default:"#CC3300",subtle:"#DDCC3300"}}),this.parse(e)}get isBuiltIn(){return!1}}class Lc extends hH{get isBuiltIn(){return!0}}class BN{constructor(e){if(this._allStyles={},this._allStyles[_t.Default]=new Lc,this._allStyles[_t.Emphasis]=new Lc,this._allStyles[_t.Accent]=new Lc,this._allStyles[_t.Good]=new Lc,this._allStyles[_t.Attention]=new Lc,this._allStyles[_t.Warning]=new Lc,e){this._allStyles[_t.Default].parse(e[_t.Default]),this._allStyles[_t.Emphasis].parse(e[_t.Emphasis]),this._allStyles[_t.Accent].parse(e[_t.Accent]),this._allStyles[_t.Good].parse(e[_t.Good]),this._allStyles[_t.Attention].parse(e[_t.Attention]),this._allStyles[_t.Warning].parse(e[_t.Warning]);const n=e.customStyles;if(n&&Array.isArray(n)){for(const r of n)if(r){const i=r.name;i&&typeof i=="string"&&(this._allStyles.hasOwnProperty(i)?this._allStyles[i].parse(r.style):this._allStyles[i]=new hH(r.style))}}}}toJSON(){const e=[];Object.keys(this._allStyles).forEach(r=>{this._allStyles[r].isBuiltIn||e.push({name:r,style:this._allStyles[r]})});const n={default:this.default,emphasis:this.emphasis};return e.length>0&&(n.customStyles=e),n}getStyleByName(e,n){return e&&this._allStyles.hasOwnProperty(e)?this._allStyles[e]:n||this._allStyles[_t.Default]}get default(){return this._allStyles[_t.Default]}get emphasis(){return this._allStyles[_t.Emphasis]}}class $u{constructor(e){this.fontFamily="Segoe UI,Segoe,Segoe WP,Helvetica Neue,Helvetica,sans-serif",this.fontSizes={small:12,default:14,medium:17,large:21,extraLarge:26},this.fontWeights={lighter:200,default:400,bolder:600},e&&(this.fontFamily=e)}parse(e){this.fontFamily=e.fontFamily||this.fontFamily,this.fontSizes={small:e.fontSizes&&e.fontSizes.small||this.fontSizes.small,default:e.fontSizes&&e.fontSizes.default||this.fontSizes.default,medium:e.fontSizes&&e.fontSizes.medium||this.fontSizes.medium,large:e.fontSizes&&e.fontSizes.large||this.fontSizes.large,extraLarge:e.fontSizes&&e.fontSizes.extraLarge||this.fontSizes.extraLarge},this.fontWeights={lighter:e.fontWeights&&e.fontWeights.lighter||this.fontWeights.lighter,default:e.fontWeights&&e.fontWeights.default||this.fontWeights.default,bolder:e.fontWeights&&e.fontWeights.bolder||this.fontWeights.bolder}}}$u.monospace=new $u("'Courier New', Courier, monospace");class yme{constructor(e){this.default=new $u,this.monospace=new $u("'Courier New', Courier, monospace"),e&&(this.default.parse(e.default),this.monospace.parse(e.monospace))}getStyleDefinition(e){switch(e){case Ga.Monospace:return this.monospace;case Ga.Default:default:return this.default}}}class $N{constructor(e){this.maxCarouselPages=10,this.minAutoplayDelay=5e3,e&&(this.maxCarouselPages=e.maxCarouselPages!=null?e.maxCarouselPages:this.maxCarouselPages,this.minAutoplayDelay=e.minAutoplayDelay!=null?e.minAutoplayDelay:this.minAutoplayDelay)}toJSON(){return{maxCarouselPages:this.maxCarouselPages,minAutoplayDelay:this.minAutoplayDelay}}}class fH{constructor(e){this.hostCapabilities=new nI,this.choiceSetInputValueSeparator=",",this.supportsInteractivity=!0,this.spacing={small:3,default:8,medium:20,large:30,extraLarge:40,padding:15},this.separator={lineThickness:1,lineColor:"#EEEEEE"},this.imageSizes={small:40,medium:80,large:160},this.containerStyles=new BN,this.inputs=new NN,this.actions=new FN,this.adaptiveCard=new RN,this.imageSet=new kN,this.media=new gme,this.factSet=new LN,this.table=new mme,this.textStyles=new PN,this.textBlock=new ON,this.carousel=new $N,this.alwaysAllowBleed=!1,e&&((typeof e=="string"||e instanceof String)&&(e=JSON.parse(e)),this.choiceSetInputValueSeparator=e&&typeof e.choiceSetInputValueSeparator=="string"?e.choiceSetInputValueSeparator:this.choiceSetInputValueSeparator,this.supportsInteractivity=e&&typeof e.supportsInteractivity=="boolean"?e.supportsInteractivity:this.supportsInteractivity,this._legacyFontType=new $u,this._legacyFontType.parse(e),e.fontTypes&&(this.fontTypes=new yme(e.fontTypes)),e.lineHeights&&(this.lineHeights={small:e.lineHeights.small,default:e.lineHeights.default,medium:e.lineHeights.medium,large:e.lineHeights.large,extraLarge:e.lineHeights.extraLarge}),this.imageSizes={small:e.imageSizes&&e.imageSizes.small||this.imageSizes.small,medium:e.imageSizes&&e.imageSizes.medium||this.imageSizes.medium,large:e.imageSizes&&e.imageSizes.large||this.imageSizes.large},this.containerStyles=new BN(e.containerStyles),this.spacing={small:e.spacing&&e.spacing.small||this.spacing.small,default:e.spacing&&e.spacing.default||this.spacing.default,medium:e.spacing&&e.spacing.medium||this.spacing.medium,large:e.spacing&&e.spacing.large||this.spacing.large,extraLarge:e.spacing&&e.spacing.extraLarge||this.spacing.extraLarge,padding:e.spacing&&e.spacing.padding||this.spacing.padding},this.separator={lineThickness:e.separator&&e.separator.lineThickness||this.separator.lineThickness,lineColor:e.separator&&e.separator.lineColor||this.separator.lineColor},this.inputs=new NN(e.inputs||this.inputs),this.actions=new FN(e.actions||this.actions),this.adaptiveCard=new RN(e.adaptiveCard||this.adaptiveCard),this.imageSet=new kN(e.imageSet),this.factSet=new LN(e.factSet),this.textStyles=new PN(e.textStyles),this.textBlock=new ON(e.textBlock),this.carousel=new $N(e.carousel))}getFontTypeDefinition(e){return this.fontTypes?this.fontTypes.getStyleDefinition(e):e===Ga.Monospace?$u.monospace:this._legacyFontType}getEffectiveImageSize(e){switch(e){case Kr.Small:return this.imageSizes.small;case Kr.Large:return this.imageSizes.large;case Kr.Medium:default:return this.imageSizes.medium}}getEffectiveSpacing(e){switch(e){case vt.Small:return this.spacing.small;case vt.Default:return this.spacing.default;case vt.Medium:return this.spacing.medium;case vt.Large:return this.spacing.large;case vt.ExtraLarge:return this.spacing.extraLarge;case vt.Padding:return this.spacing.padding;default:return 0}}paddingDefinitionToSpacingDefinition(e){return new VA(this.getEffectiveSpacing(e.top),this.getEffectiveSpacing(e.right),this.getEffectiveSpacing(e.bottom),this.getEffectiveSpacing(e.left))}makeCssClassNames(...e){const n=[];for(const r of e)n.push((this.cssClassNamePrefix?this.cssClassNamePrefix+"-":"")+r);return n}makeCssClassName(...e){const n=this.makeCssClassNames(...e).join(" ");return n||""}get fontFamily(){return this._legacyFontType.fontFamily}set fontFamily(e){this._legacyFontType.fontFamily=e}get fontSizes(){return this._legacyFontType.fontSizes}get fontWeights(){return this._legacyFontType.fontWeights}}const yd=new fH({supportsInteractivity:!0,spacing:{small:10,default:20,medium:30,large:40,extraLarge:50,padding:20},separator:{lineThickness:1,lineColor:"#EEEEEE"},fontTypes:{default:{fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",fontSizes:{small:12,default:14,medium:17,large:21,extraLarge:26},fontWeights:{lighter:200,default:400,bolder:600}},monospace:{fontFamily:"'Courier New', Courier, monospace",fontSizes:{small:12,default:14,medium:17,large:21,extraLarge:26},fontWeights:{lighter:200,default:400,bolder:600}}},imageSizes:{small:40,medium:80,large:160},containerStyles:{default:{backgroundColor:"#FFFFFF",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},emphasis:{backgroundColor:"#08000000",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},accent:{backgroundColor:"#C7DEF9",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},good:{backgroundColor:"#CCFFCC",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},attention:{backgroundColor:"#FFC5B2",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},warning:{backgroundColor:"#FFE2B2",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}}},inputs:{label:{requiredInputs:{weight:mr.Bolder,suffix:" *",suffixColor:qn.Attention},optionalInputs:{weight:mr.Bolder}},errorMessage:{color:qn.Attention,weight:mr.Bolder},debounceTimeInMilliSeconds:250},actions:{maxActions:5,spacing:vt.Default,buttonSpacing:10,showCard:{actionMode:ks.Inline,inlineTopMargin:16},actionsOrientation:Dn.Horizontal,actionAlignment:ai.Left},adaptiveCard:{allowCustomStyle:!1},imageSet:{imageSize:Kr.Medium,maxImageHeight:100},factSet:{title:{color:qn.Default,size:Hn.Default,isSubtle:!1,weight:mr.Bolder,wrap:!0,maxWidth:150},value:{color:qn.Default,size:Hn.Default,isSubtle:!1,weight:mr.Default,wrap:!0},spacing:10},carousel:{maxCarouselPages:10,minAutoplayDuration:5e3},textBlock:{headingLevel:2}});class wv{constructor(){this._items={}}findByName(e){return this._items.hasOwnProperty(e)?this._items[e]:void 0}clear(){this._items={}}copyTo(e){const n=Object.keys(this._items);for(const r of n){const i=this._items[r];e.register(i.typeName,i.objectType,i.schemaVersion)}}register(e,n,r=Ee.v1_0){let i=this.findByName(e);i!==void 0?i.objectType=n:i={typeName:e,objectType:n,schemaVersion:r},this._items[e]=i}unregister(e){delete this._items[e]}createInstance(e,n){const r=this.findByName(e);return r&&r.schemaVersion.compareTo(n)<=0?new r.objectType:void 0}getItemCount(){return Object.keys(this._items).length}getItemAt(e){return Object.keys(this._items).map(n=>this._items[n])[e]}}class It{static populateWithDefaultElements(e){e.clear(),It.defaultElements.copyTo(e)}static populateWithDefaultActions(e){e.clear(),It.defaultActions.copyTo(e)}static get elements(){return It._elements||(It._elements=new wv,It.populateWithDefaultElements(It._elements)),It._elements}static get actions(){return It._actions||(It._actions=new wv,It.populateWithDefaultActions(It._actions)),It._actions}static reset(){It._elements=void 0,It._actions=void 0}}It.defaultElements=new wv;It.defaultActions=new wv;var pH=function(t,e,n,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(o=(i<3?s(o):i>3?s(e,n,o):s(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o};class Cme{constructor(){this.allIds={},this.validationEvents=[]}addFailure(e,n,r){this.validationEvents.push({phase:Bu.Validation,source:e,event:n,message:r})}}class qo extends On{constructor(){super(...arguments),this._shouldFallback=!1}getSchemaKey(){return this.getJsonTypeName()}get requires(){return this.getValue(qo.requiresProperty)}contains(e){return this._renderedElement?this._renderedElement.contains(e):!1}preProcessPropertyValue(e,n){const r=n===void 0?this.getValue(e):n;if(yt.allowPreProcessingPropertyValues){let i=this;for(;i&&!i.onPreProcessPropertyValue;)i=i.parent;if(i&&i.onPreProcessPropertyValue)return i.onPreProcessPropertyValue(this,e,r)}return r}setParent(e){this._parent=e}setShouldFallback(e){this._shouldFallback=e}shouldFallback(){return this._shouldFallback||!this.requires.areAllMet(this.hostConfig.hostCapabilities)}getRootObject(){let e=this;for(;e.parent;)e=e.parent;return e}internalValidateProperties(e){this.id&&(e.allIds.hasOwnProperty(this.id)?(e.allIds[this.id]===1&&e.addFailure(this,Ct.DuplicateId,tt.errors.duplicateId(this.id)),e.allIds[this.id]+=1):e.allIds[this.id]=1)}validateProperties(){const e=new Cme;return this.internalValidateProperties(e),e}findDOMNodeOwner(e){return this.contains(e)?this:void 0}releaseDOMResources(){}get parent(){return this._parent}get renderedElement(){return this._renderedElement}}qo.typeNameProperty=new ut(Ee.v1_0,"type",void 0,void 0,void 0,t=>t.getJsonTypeName());qo.idProperty=new ut(Ee.v1_0,"id");qo.requiresProperty=new vd(Ee.v1_2,"requires",nI,!1,new nI);pH([Ae(qo.idProperty)],qo.prototype,"id",void 0);pH([Ae(qo.requiresProperty)],qo.prototype,"requires",null);class gH{constructor(e){this._regularExpression=e}format(e,n){let r;if(n){let i=n;for(;(r=this._regularExpression.exec(n))!=null;)i=i.replace(r[0],this.internalFormat(e,r));return i}else return n}}class Sme extends gH{internalFormat(e,n){const r=new Date(Date.parse(n[1])),i=n[2]!==void 0?n[2].toLowerCase():"compact";return i!=="compact"?r.toLocaleDateString(e,{day:"numeric",weekday:i,month:i,year:"numeric"}):r.toLocaleDateString()}}class Tme extends gH{internalFormat(e,n){return new Date(Date.parse(n[1])).toLocaleTimeString(e,{hour:"numeric",minute:"2-digit"})}}function mH(t,e){const n=[new Sme(/\{{2}DATE\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))(?:, ?(COMPACT|LONG|SHORT))?\)\}{2}/g),new Tme(/\{{2}TIME\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))\)\}{2}/g)];let r=e;for(const i of n)r=i.format(t,r);return r}class mu{}mu.keys={tab:"Tab",enter:"Enter",escape:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",delete:"Delete"};class Eme{click(){this.isEnabled&&this.onClick&&this.onClick(this)}updateCssClasses(){if(this._element){const e=this._hostConfig?this._hostConfig:yd;this._element.className=e.makeCssClassName("ac-ctrl"),this._element.classList.add(e.makeCssClassName(this.isEnabled?"ac-ctrl-dropdown-item":"ac-ctrl-dropdown-item-disabled")),this.isEnabled||this._element.classList.add(e.makeCssClassName("ac-disabled"))}}constructor(e,n,r){this._isEnabled=!0,this.key=e,this._value=n,this._iconUrl=r}toString(){return this.value}render(e){var n,r,i;if(this._hostConfig=e,!this._element){if(this._element=document.createElement("span"),this._element.setAttribute("role","menuitem"),this._element.style.display="flex",this._element.style.alignItems="center",this._element.style.justifyContent="left",this.isEnabled||this._element.setAttribute("aria-disabled","true"),this._iconUrl&&(!((n=this._hostConfig)===null||n===void 0)&&n.actions.showIconInOverflow)){const s=(i=(r=this._hostConfig)===null||r===void 0?void 0:r.actions.iconSize)!==null&&i!==void 0?i:16,l=document.createElement("img");l.style.width=s+"px",l.style.height=s+"px",l.style.marginRight="6px",l.setAttribute("role","presentation"),l.src=this._iconUrl,this._element.appendChild(l)}const o=document.createElement("span");o.style.flex="0 1 auto",o.innerText=this.value,this._element.appendChild(o),this._element.setAttribute("aria-current","false"),this._element.onmouseup=s=>{this.click()},this._element.onkeydown=s=>{s.key===mu.keys.enter&&(s.stopPropagation(),s.preventDefault(),this.click())},this.updateCssClasses()}return this._element}get value(){return this._value}set value(e){this._value=e,this._element&&(this._element.innerText=e)}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this.updateCssClasses())}}class wme{constructor(){this._items=[]}get(e){return this._items[e]}add(e){this._items.push(e),this.onItemAdded&&this.onItemAdded(e)}remove(e){const n=this._items.indexOf(e);n>=0&&(this._items=this._items.splice(n,1),this.onItemRemoved&&this.onItemRemoved(e))}indexOf(e){return this._items.indexOf(e)}get length(){return this._items.length}}class Ime{constructor(){this._isOpen=!1}keyDown(e){switch(e.key){case mu.keys.escape:this.closePopup(!0);break}}render(e){const n=document.createElement("div");return n.tabIndex=0,n.className=this.hostConfig.makeCssClassName("ac-ctrl","ac-ctrl-popup-container"),n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.onkeydown=r=>(this.keyDown(r),!r.cancelBubble),n.appendChild(this.renderContent()),n}focus(){this._popupElement&&this._popupElement.firstElementChild.focus()}popup(e){if(!this._isOpen){this._overlayElement=document.createElement("div"),this._overlayElement.className=this.hostConfig.makeCssClassName("ac-ctrl-overlay"),this._overlayElement.tabIndex=0,this._overlayElement.style.width=document.documentElement.scrollWidth+"px",this._overlayElement.style.height=document.documentElement.scrollHeight+"px",this._overlayElement.onfocus=d=>{this.closePopup(!0)},document.body.appendChild(this._overlayElement);const n=e.getBoundingClientRect();this._popupElement=this.render(n),this._popupElement.classList.remove(...this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideLeftToRight","ac-ctrl-slideRightToLeft","ac-ctrl-slideTopToBottom","ac-ctrl-slideRightToLeft")),window.addEventListener("resize",d=>{this.closePopup(!0)});const r=e.getAttribute("aria-label");r&&this._popupElement.setAttribute("aria-label",r),this._overlayElement.appendChild(this._popupElement);const i=this._popupElement.getBoundingClientRect(),o=window.innerHeight-n.bottom,s=n.top,l=window.innerWidth-n.right,c=n.left;let a=n.left+xc(),u;if(s<i.height&&o<i.height){const d=Math.min(i.height,window.innerHeight);if(this._popupElement.style.maxHeight=d+"px",d<i.height?u=om():u=om()+n.top+(n.height-d)/2,c<i.width&&l<i.width){const f=Math.min(i.width,window.innerWidth);this._popupElement.style.maxWidth=f+"px",f<i.width?a=xc():a=xc()+n.left+(n.width-f)/2}else l>=i.width?(a=xc()+n.right,this._popupElement.classList.add(...this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideLeftToRight"))):(a=xc()+n.left-i.width,this._popupElement.classList.add(...this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideRightToLeft")))}else o>=i.height?(u=om()+n.bottom,this._popupElement.classList.add(...this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideTopToBottom"))):(u=om()+n.top-i.height,this._popupElement.classList.add(...this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideBottomToTop"))),l<i.width&&(a=xc()+n.right-i.width);this._popupElement.style.left=a+"px",this._popupElement.style.top=u+"px",this._popupElement.focus(),this._isOpen=!0}}closePopup(e){this._isOpen&&(document.body.removeChild(this._overlayElement),this._isOpen=!1,this.onClose&&this.onClose(this,e))}get hostConfig(){return this._hostConfig?this._hostConfig:yd}set hostConfig(e){this._hostConfig=e}get isOpen(){return this._isOpen}}class bme extends Ime{constructor(){super(...arguments),this._items=new wme,this._renderedItems=[],this._selectedIndex=-1}renderContent(){const e=document.createElement("div");e.className=this.hostConfig.makeCssClassName("ac-ctrl ac-popup"),e.setAttribute("role","menu");for(let n=0;n<this._items.length;n++){const r=this._items.get(n).render(this.hostConfig);r.tabIndex=0,e.appendChild(r),n==0&&r.setAttribute("aria-expanded","true"),n===this.selectedIndex&&r.focus(),this._renderedItems.push(r)}return e}keyDown(e){super.keyDown(e);let n=this._selectedIndex;switch(e.key){case mu.keys.tab:this.closePopup(!0);break;case mu.keys.up:n<=0?n=this._renderedItems.length-1:(n--,n<0&&(n=this._renderedItems.length-1)),this.selectedIndex=n,this.removeAriaExpanded(n),e.cancelBubble=!0;break;case mu.keys.down:n<0?n=0:(n++,n>=this._renderedItems.length&&(n=0),this.removeAriaExpanded(n)),this.selectedIndex=n,e.cancelBubble=!0;break}}get items(){return this._items}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e>=0&&e<this._renderedItems.length&&(this._renderedItems[e].focus(),this._selectedIndex=e)}removeAriaExpanded(e){this._renderedItems[e].getAttribute("aria-expanded")==="true"&&this._renderedItems[e].removeAttribute("aria-expanded")}}var Re=function(t,e,n,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(o=(i<3?s(o):i>3?s(e,n,o):s(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},gp=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{a(r.next(u))}catch(d){s(d)}}function c(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(l,c)}a((r=r.apply(t,e||[])).next())})},IT,bT;function Iv(t){var e,n;const r=typeof window>"u"?"":(n=(e=window.trustedTypes)===null||e===void 0?void 0:e.emptyHTML)!==null&&n!==void 0?n:"";t.innerHTML=r}function vH(t,e,n){if(e.spacing>0||e.lineThickness&&e.lineThickness>0){const r=document.createElement("div");r.className=t.makeCssClassName("ac-"+(n===Dn.Horizontal?"horizontal":"vertical")+"-separator"),r.setAttribute("aria-hidden","true");const i=e.lineColor?ac(e.lineColor):"";return n===Dn.Horizontal?e.lineThickness?(r.style.paddingTop=e.spacing/2+"px",r.style.marginBottom=e.spacing/2+"px",r.style.borderBottom=e.lineThickness+"px solid "+i):r.style.height=e.spacing+"px":e.lineThickness?(r.style.paddingLeft=e.spacing/2+"px",r.style.marginRight=e.spacing/2+"px",r.style.borderRight=e.lineThickness+"px solid "+i):r.style.width=e.spacing+"px",r.style.overflow="hidden",r.style.flex="0 0 auto",r}else return}class At extends qo{constructor(){super(...arguments),this._truncatedDueToOverflow=!1}get lang(){const e=this.getValue(At.langProperty);return e||(this.parent?this.parent.lang:void 0)}set lang(e){this.setValue(At.langProperty,e)}get isVisible(){return this.getValue(At.isVisibleProperty)}set isVisible(e){yt.useAdvancedCardBottomTruncation&&!e&&this.undoOverflowTruncation(),this.isVisible!==e&&(this.setValue(At.isVisibleProperty,e),this.updateRenderedElementVisibility(),this._renderedElement&&_T(this)),this._renderedElement&&this._renderedElement.setAttribute("aria-expanded",e.toString())}internalRenderSeparator(){const e=vH(this.hostConfig,{spacing:this.hostConfig.getEffectiveSpacing(this.spacing),lineThickness:this.separator?this.hostConfig.separator.lineThickness:void 0,lineColor:this.separator?this.hostConfig.separator.lineColor:void 0},this.separatorOrientation);if(yt.alwaysBleedSeparators&&e&&this.separatorOrientation===Dn.Horizontal){const n=this.getParentContainer();if(n&&n.getEffectivePadding()){const r=this.hostConfig.paddingDefinitionToSpacingDefinition(n.getEffectivePadding());e.style.marginLeft="-"+r.left+"px",e.style.marginRight="-"+r.right+"px"}}return e}updateRenderedElementVisibility(){const e=this.isDesignMode()||this.isVisible?this._defaultRenderedElementDisplayMode:"none";this._renderedElement&&(e?this._renderedElement.style.display=e:this._renderedElement.style.removeProperty("display")),this._separatorElement&&(this.parent&&this.parent.isFirstElement(this)?this._separatorElement.style.display="none":e?this._separatorElement.style.display=e:this._separatorElement.style.removeProperty("display"))}hideElementDueToOverflow(){this._renderedElement&&this.isVisible&&(this._renderedElement.style.visibility="hidden",this.isVisible=!1,_T(this,!1))}showElementHiddenDueToOverflow(){this._renderedElement&&!this.isVisible&&(this._renderedElement.style.removeProperty("visibility"),this.isVisible=!0,_T(this,!1))}handleOverflow(e){if(this.isVisible||this.isHiddenDueToOverflow()){const n=this.truncateOverflow(e);this._truncatedDueToOverflow=n||this._truncatedDueToOverflow,n?n&&!this.isVisible&&this.showElementHiddenDueToOverflow():this.hideElementDueToOverflow()}}resetOverflow(){let e=!1;return this._truncatedDueToOverflow&&(this.undoOverflowTruncation(),this._truncatedDueToOverflow=!1,e=!0),this.isHiddenDueToOverflow()&&this.showElementHiddenDueToOverflow(),e}getDefaultSerializationContext(){return new pf}createPlaceholderElement(){const e=this.getEffectiveStyleDefinition(),n=ac(e.foregroundColors.default.subtle),r=document.createElement("div");return r.style.border="1px dashed "+n,r.style.padding="4px",r.style.minHeight="32px",r.style.fontSize="10px",n&&(r.style.color=n),r.innerText=tt.defaults.emptyElementText(this.getJsonTypeName()),r}adjustRenderedElementSize(e){this.height==="auto"?e.style.flex="0 0 auto":e.style.flex="1 1 auto"}updateInputsVisualState(e){const n=this.getAllInputs(),r=e?to.MouseEnterOnCard:to.MouseLeaveOnCard;n.forEach(i=>i.updateVisualState(r))}isDisplayed(){return this._renderedElement!==void 0&&this.isVisible&&this._renderedElement.offsetHeight>0}overrideInternalRender(){return this.internalRender()}applyPadding(){if(this.separatorElement&&this.separatorOrientation===Dn.Horizontal)if(yt.alwaysBleedSeparators&&!this.isBleeding()){const e=new Vl;this.getImmediateSurroundingPadding(e);const n=this.hostConfig.paddingDefinitionToSpacingDefinition(e);this.separatorElement.style.marginLeft="-"+n.left+"px",this.separatorElement.style.marginRight="-"+n.right+"px"}else this.separatorElement.style.marginRight="0",this.separatorElement.style.marginLeft="0"}truncateOverflow(e){return!1}undoOverflowTruncation(){}getDefaultPadding(){return new Vl}getHasBackground(e=!1){return!1}getHasBorder(){return!1}getPadding(){return this._padding}setPadding(e){this._padding=e}shouldSerialize(e){return e.elementRegistry.findByName(this.getJsonTypeName())!==void 0}get useDefaultSizing(){return!0}get separatorOrientation(){return Dn.Horizontal}get defaultStyle(){return _t.Default}parse(e,n){super.parse(e,n||new pf)}asString(){return""}isBleeding(){return!1}getEffectiveStyle(){return this.parent?this.parent.getEffectiveStyle():this.defaultStyle}getEffectiveStyleDefinition(){return this.hostConfig.containerStyles.getStyleByName(this.getEffectiveStyle())}getEffectiveTextStyleDefinition(){return this.parent?this.parent.getEffectiveTextStyleDefinition():this.hostConfig.textStyles.default}getForbiddenActionTypes(){return[]}getImmediateSurroundingPadding(e,n=!0,r=!0,i=!0,o=!0){if(this.parent){let s=n&&this.parent.isTopElement(this),l=r&&this.parent.isRightMostElement(this),c=i&&this.parent.isBottomElement(this),a=o&&this.parent.isLeftMostElement(this);const u=this.parent.getEffectivePadding();u&&(s&&u.top!==vt.None&&(e.top=u.top,s=!1),l&&u.right!==vt.None&&(e.right=u.right,l=!1),c&&u.bottom!==vt.None&&(e.bottom=u.bottom,c=!1),a&&u.left!==vt.None&&(e.left=u.left,a=!1)),(s||l||c||a)&&this.parent.getImmediateSurroundingPadding(e,s,l,c,a)}}getActionCount(){return 0}getActionAt(e){throw new Error(tt.errors.indexOutOfRange(e))}indexOfAction(e){for(let n=0;n<this.getActionCount();n++)if(this.getActionAt(n)===e)return n;return-1}remove(){return this.parent&&this.parent instanceof Wa?this.parent.removeItem(this):!1}render(){return this._renderedElement=this.overrideInternalRender(),this._separatorElement=this.internalRenderSeparator(),this._renderedElement?(this.id&&(this._renderedElement.id=this.id),this.customCssSelector&&this._renderedElement.classList.add(this.customCssSelector),this._renderedElement.style.boxSizing="border-box",this._defaultRenderedElementDisplayMode=this._renderedElement.style.display?this._renderedElement.style.display:void 0,this.adjustRenderedElementSize(this._renderedElement),this.updateLayout(!1)):this.isDesignMode()&&(this._renderedElement=this.createPlaceholderElement()),this._renderedElement}updateLayout(e=!0){this.updateRenderedElementVisibility(),this.applyPadding()}updateActionsEnabledState(){const e=this.getRootElement().getAllActions();for(let n of e)n.updateEnabledState()}indexOf(e){return-1}isDesignMode(){const e=this.getRootElement();return e instanceof Tt&&e.designMode}isFirstElement(e){return!0}isLastElement(e){return!0}isAtTheVeryLeft(){return this.parent?this.parent.isLeftMostElement(this)&&this.parent.isAtTheVeryLeft():!0}isAtTheVeryRight(){return this.parent?this.parent.isRightMostElement(this)&&this.parent.isAtTheVeryRight():!0}isAtTheVeryTop(){return this.parent?this.parent.isFirstElement(this)&&this.parent.isAtTheVeryTop():!0}isAtTheVeryBottom(){return this.parent?this.parent.isLastElement(this)&&this.parent.isAtTheVeryBottom():!0}isBleedingAtTop(){return!1}isBleedingAtBottom(){return!1}isLeftMostElement(e){return!0}isRightMostElement(e){return!0}isTopElement(e){return this.isFirstElement(e)}isBottomElement(e){return this.isLastElement(e)}isHiddenDueToOverflow(){return this._renderedElement!==void 0&&this._renderedElement.style.visibility==="hidden"}getRootElement(){return this.getRootObject()}getParentContainer(){let e=this.parent;for(;e;){if(e instanceof Lr)return e;e=e.parent}}getAllInputs(e=!0){return[]}getAllActions(){const e=[];for(let n=0;n<this.getActionCount();n++){let r=this.getActionAt(n);r&&e.push(r)}return e}getResourceInformation(){return[]}getElementById(e){return this.id===e?this:void 0}getActionById(e){}getElementByIdFromAction(e){let n;for(let r=0;r<this.getActionCount();r++){const i=this.getActionAt(r);if(i instanceof $s&&(n=i.card.getElementById(e),n))break}return n}getEffectivePadding(){const e=this.getPadding();return e||this.getDefaultPadding()}getEffectiveHorizontalAlignment(){return this.horizontalAlignment!==void 0?this.horizontalAlignment:this.parent?this.parent.getEffectiveHorizontalAlignment():Mn.Left}get hostConfig(){return this._hostConfig?this._hostConfig:this.parent?this.parent.hostConfig:yd}set hostConfig(e){this._hostConfig=e}get index(){return this.parent?this.parent.indexOf(this):0}get isInteractive(){return!1}get isStandalone(){return!0}get isInline(){return!1}get hasVisibleSeparator(){return this.parent&&this.separatorElement?!this.parent.isFirstElement(this)&&(this.isVisible||this.isDesignMode()):!1}get separatorElement(){return this._separatorElement}get parent(){return this._parent}}At.langProperty=new ut(Ee.v1_1,"lang",!0,/^[a-z]{2,3}$/gi);At.isVisibleProperty=new or(Ee.v1_2,"isVisible",!0);At.separatorProperty=new or(Ee.v1_0,"separator",!1);At.heightProperty=new md(Ee.v1_1,"height",[{value:"auto"},{value:"stretch"}],"auto");At.horizontalAlignmentProperty=new sr(Ee.v1_0,"horizontalAlignment",Mn);At.spacingProperty=new sr(Ee.v1_0,"spacing",vt,vt.Default);Re([Ae(At.horizontalAlignmentProperty)],At.prototype,"horizontalAlignment",void 0);Re([Ae(At.spacingProperty)],At.prototype,"spacing",void 0);Re([Ae(At.separatorProperty)],At.prototype,"separator",void 0);Re([Ae(At.heightProperty)],At.prototype,"height",void 0);Re([Ae(At.langProperty)],At.prototype,"lang",null);Re([Ae(At.isVisibleProperty)],At.prototype,"isVisible",null);class oC extends Vn{parse(e,n,r){const i=e;return r.parseAction(i,n[this.name],this.forbiddenActionTypes,i.isDesignMode())}toJSON(e,n,r,i){i.serializeValue(n,this.name,r?r.toJSON(i):void 0,void 0,!0)}constructor(e,n,r=[]){super(e,n,void 0),this.targetVersion=e,this.name=n,this.forbiddenActionTypes=r}}class $t extends At{populateSchema(e){super.populateSchema(e),e.remove($t.selectActionProperty)}get text(){return this.getValue($t.textProperty)}set text(e){this.setText(e)}getFontSize(e){switch(this.effectiveSize){case Hn.Small:return e.fontSizes.small;case Hn.Medium:return e.fontSizes.medium;case Hn.Large:return e.fontSizes.large;case Hn.ExtraLarge:return e.fontSizes.extraLarge;default:return e.fontSizes.default}}getColorDefinition(e,n){switch(n){case qn.Accent:return e.accent;case qn.Dark:return e.dark;case qn.Light:return e.light;case qn.Good:return e.good;case qn.Warning:return e.warning;case qn.Attention:return e.attention;default:return e.default}}setText(e){this.setValue($t.textProperty,e)}constructor(e){super(),this.ariaHidden=!1,e&&(this.text=e)}init(e){this.size=e.size,this.weight=e.weight,this.color=e.color,this.isSubtle=e.isSubtle}asString(){return this.text}applyStylesTo(e){const n=this.hostConfig.getFontTypeDefinition(this.effectiveFontType);n.fontFamily&&(e.style.fontFamily=n.fontFamily);let r;switch(this.effectiveSize){case Hn.Small:r=n.fontSizes.small;break;case Hn.Medium:r=n.fontSizes.medium;break;case Hn.Large:r=n.fontSizes.large;break;case Hn.ExtraLarge:r=n.fontSizes.extraLarge;break;default:r=n.fontSizes.default;break}e.style.fontSize=r+"px";const i=this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors,this.effectiveColor),o=ac(this.effectiveIsSubtle?i.subtle:i.default);o&&(e.style.color=o);let s;switch(this.effectiveWeight){case mr.Lighter:s=n.fontWeights.lighter;break;case mr.Bolder:s=n.fontWeights.bolder;break;default:s=n.fontWeights.default;break}e.style.fontWeight=s.toString(),this.ariaHidden&&e.setAttribute("aria-hidden","true")}getAllActions(){const e=super.getAllActions();return this.selectAction&&e.push(this.selectAction),e}get effectiveColor(){return this.color!==void 0?this.color:this.getEffectiveTextStyleDefinition().color}get effectiveFontType(){return this.fontType!==void 0?this.fontType:this.getEffectiveTextStyleDefinition().fontType}get effectiveIsSubtle(){return this.isSubtle!==void 0?this.isSubtle:this.getEffectiveTextStyleDefinition().isSubtle}get effectiveSize(){return this.size!==void 0?this.size:this.getEffectiveTextStyleDefinition().size}get effectiveWeight(){return this.weight!==void 0?this.weight:this.getEffectiveTextStyleDefinition().weight}}$t.textProperty=new ut(Ee.v1_0,"text",!0);$t.sizeProperty=new sr(Ee.v1_0,"size",Hn);$t.weightProperty=new sr(Ee.v1_0,"weight",mr);$t.colorProperty=new sr(Ee.v1_0,"color",qn);$t.isSubtleProperty=new or(Ee.v1_0,"isSubtle");$t.fontTypeProperty=new sr(Ee.v1_2,"fontType",Ga);$t.selectActionProperty=new oC(Ee.v1_1,"selectAction",["Action.ShowCard"]);Re([Ae($t.sizeProperty)],$t.prototype,"size",void 0);Re([Ae($t.weightProperty)],$t.prototype,"weight",void 0);Re([Ae($t.colorProperty)],$t.prototype,"color",void 0);Re([Ae($t.fontTypeProperty)],$t.prototype,"fontType",void 0);Re([Ae($t.isSubtleProperty)],$t.prototype,"isSubtle",void 0);Re([Ae($t.textProperty)],$t.prototype,"text",null);Re([Ae($t.selectActionProperty)],$t.prototype,"selectAction",void 0);class zn extends $t{constructor(){super(...arguments),this.wrap=!1,this._treatAsPlainText=!0,this.useMarkdown=!0}restoreOriginalContent(){var e,n;if(this.renderedElement!==void 0){this.maxLines&&this.maxLines>0&&(this.renderedElement.style.maxHeight=this._computedLineHeight*this.maxLines+"px");const r=(n=(e=zn._ttRoundtripPolicy)===null||e===void 0?void 0:e.createHTML(this._originalInnerHtml))!==null&&n!==void 0?n:this._originalInnerHtml;this.renderedElement.innerHTML=r}}truncateIfSupported(e){if(this.renderedElement!==void 0){const n=this.renderedElement.children,r=!n.length;if(r||n.length===1&&n[0].tagName.toLowerCase()==="p"&&!n[0].children.length){const o=r?this.renderedElement:n[0];return ame(o,e,this._computedLineHeight),!0}}return!1}setText(e){super.setText(e),this._processedText=void 0}internalRender(){var e,n;if(this._processedText=void 0,this.text){const r=this.preProcessPropertyValue($t.textProperty),i=this.hostConfig;let o;if(this.forElementId){const l=document.createElement("label");l.htmlFor=this.forElementId,o=l}else o=document.createElement("div");if(o.classList.add(i.makeCssClassName("ac-textBlock")),o.style.overflow="hidden",this.applyStylesTo(o),this.style==="heading"){o.setAttribute("role","heading");const l=this.hostConfig.textBlock.headingLevel;l!==void 0&&l>0&&o.setAttribute("aria-level",l.toString())}if(this.selectAction&&i.supportsInteractivity&&(o.onclick=l=>{this.selectAction&&this.selectAction.isEffectivelyEnabled()&&(l.preventDefault(),l.cancelBubble=!0,this.selectAction.execute())},this.selectAction.setupElementForAccessibility(o),this.selectAction.isEffectivelyEnabled()&&o.classList.add(i.makeCssClassName("ac-selectable"))),!this._processedText){this._treatAsPlainText=!0;let l=mH(this.lang,r);if(this.useMarkdown&&l){yt.allowMarkForTextHighlighting&&(l=l.replace(/<mark>/g,"===").replace(/<\/mark>/g,"/==/"));const c=Tt.applyMarkdown(l);if(c.didProcess&&c.outputHtml){if(this._processedText=c.outputHtml,this._treatAsPlainText=!1,yt.allowMarkForTextHighlighting&&this._processedText){let a="";const u=this.getEffectiveStyleDefinition();u.highlightBackgroundColor&&(a+="background-color: "+u.highlightBackgroundColor+";"),u.highlightForegroundColor&&(a+="color: "+u.highlightForegroundColor+";"),a&&(a='style="'+a+'"'),this._processedText=this._processedText.replace(/===/g,"<mark "+a+">").replace(/\/==\//g,"</mark>")}}else this._processedText=l,this._treatAsPlainText=!0}else this._processedText=l,this._treatAsPlainText=!0}if(this._processedText||(this._processedText=""),this._treatAsPlainText)o.innerText=this._processedText;else{const l=(n=(e=zn._ttMarkdownPolicy)===null||e===void 0?void 0:e.createHTML(this._processedText))!==null&&n!==void 0?n:this._processedText;o.innerHTML=l}if(o.firstElementChild instanceof HTMLElement){const l=o.firstElementChild;l.style.marginTop="0px",l.style.width="100%",this.wrap||(l.style.overflow="hidden",l.style.textOverflow="ellipsis")}o.lastElementChild instanceof HTMLElement&&(o.lastElementChild.style.marginBottom="0px");const s=o.getElementsByTagName("a");for(const l of Array.from(s))l.classList.add(i.makeCssClassName("ac-anchor")),l.target="_blank",l.onclick=c=>{jN(this,l,c)&&(c.preventDefault(),c.cancelBubble=!0)},l.oncontextmenu=c=>jN(this,l,c)?(c.preventDefault(),c.cancelBubble=!0,!1):!0;return this.wrap?(o.style.wordWrap="break-word",this.maxLines&&this.maxLines>0&&(o.style.overflow="hidden",rme()||!yt.useWebkitLineClamp?o.style.maxHeight=this._computedLineHeight*this.maxLines+"px":(o.style.removeProperty("line-height"),o.style.display="-webkit-box",o.style.webkitBoxOrient="vertical",o.style.webkitLineClamp=this.maxLines.toString()))):(o.style.whiteSpace="nowrap",o.style.textOverflow="ellipsis"),(yt.useAdvancedTextBlockTruncation||yt.useAdvancedCardBottomTruncation)&&(this._originalInnerHtml=o.innerHTML),o}else return}truncateOverflow(e){return e>=this._computedLineHeight?this.truncateIfSupported(e):!1}undoOverflowTruncation(){if(this.restoreOriginalContent(),yt.useAdvancedTextBlockTruncation&&this.maxLines){const e=this._computedLineHeight*this.maxLines;this.truncateIfSupported(e)}}applyStylesTo(e){switch(super.applyStylesTo(e),this.getEffectiveHorizontalAlignment()){case Mn.Center:e.style.textAlign="center";break;case Mn.Right:e.style.textAlign="end";break;default:e.style.textAlign="start";break}const n=this.hostConfig.lineHeights;if(n)switch(this.effectiveSize){case Hn.Small:this._computedLineHeight=n.small;break;case Hn.Medium:this._computedLineHeight=n.medium;break;case Hn.Large:this._computedLineHeight=n.large;break;case Hn.ExtraLarge:this._computedLineHeight=n.extraLarge;break;default:this._computedLineHeight=n.default;break}else this._computedLineHeight=this.getFontSize(this.hostConfig.getFontTypeDefinition(this.effectiveFontType))*1.33;e.style.lineHeight=this._computedLineHeight+"px"}getJsonTypeName(){return"TextBlock"}getEffectiveTextStyleDefinition(){return this.style?this.hostConfig.textStyles.getStyleByName(this.style):super.getEffectiveTextStyleDefinition()}updateLayout(e=!1){super.updateLayout(e),yt.useAdvancedTextBlockTruncation&&this.maxLines&&this.isDisplayed()&&(this.restoreOriginalContent(),this.truncateIfSupported(this._computedLineHeight*this.maxLines))}}zn.wrapProperty=new or(Ee.v1_0,"wrap",!1);zn.maxLinesProperty=new fs(Ee.v1_0,"maxLines");zn.styleProperty=new md(Ee.v1_5,"style",[{value:"default"},{value:"columnHeader"},{value:"heading"}]);zn._ttMarkdownPolicy=typeof window>"u"||(IT=window.trustedTypes)===null||IT===void 0?void 0:IT.createPolicy("adaptivecards#markdownPassthroughPolicy",{createHTML:t=>t});zn._ttRoundtripPolicy=typeof window>"u"||(bT=window.trustedTypes)===null||bT===void 0?void 0:bT.createPolicy("adaptivecards#restoreContentsPolicy",{createHTML:t=>t});Re([Ae(zn.wrapProperty)],zn.prototype,"wrap",void 0);Re([Ae(zn.maxLinesProperty)],zn.prototype,"maxLines",void 0);Re([Ae(zn.styleProperty)],zn.prototype,"style",void 0);class xr extends $t{constructor(){super(...arguments),this.italic=!1,this.strikethrough=!1,this.highlight=!1,this.underline=!1}populateSchema(e){super.populateSchema(e),e.add($t.selectActionProperty)}internalRender(){if(this.text){const e=this.preProcessPropertyValue($t.textProperty),n=this.hostConfig;let r=mH(this.lang,e);r||(r="");const i=document.createElement("span");if(i.classList.add(n.makeCssClassName("ac-textRun")),this.applyStylesTo(i),this.selectAction&&n.supportsInteractivity){const o=document.createElement("a");o.classList.add(n.makeCssClassName("ac-anchor"));const s=this.selectAction.getHref();o.href=s||"",o.target="_blank",o.onclick=l=>{this.selectAction&&this.selectAction.isEffectivelyEnabled()&&(l.preventDefault(),l.cancelBubble=!0,this.selectAction.execute())},this.selectAction.setupElementForAccessibility(o),o.innerText=r,i.appendChild(o)}else i.innerText=r;return i}else return}applyStylesTo(e){if(super.applyStylesTo(e),this.italic&&(e.style.fontStyle="italic"),this.strikethrough&&(e.style.textDecoration="line-through"),this.highlight){const n=this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors,this.effectiveColor),r=ac(this.effectiveIsSubtle?n.highlightColors.subtle:n.highlightColors.default);r&&(e.style.backgroundColor=r)}this.underline&&(e.style.textDecoration="underline")}getJsonTypeName(){return"TextRun"}get isStandalone(){return!1}get isInline(){return!0}}xr.italicProperty=new or(Ee.v1_2,"italic",!1);xr.strikethroughProperty=new or(Ee.v1_2,"strikethrough",!1);xr.highlightProperty=new or(Ee.v1_2,"highlight",!1);xr.underlineProperty=new or(Ee.v1_3,"underline",!1);Re([Ae(xr.italicProperty)],xr.prototype,"italic",void 0);Re([Ae(xr.strikethroughProperty)],xr.prototype,"strikethrough",void 0);Re([Ae(xr.highlightProperty)],xr.prototype,"highlight",void 0);Re([Ae(xr.underlineProperty)],xr.prototype,"underline",void 0);class yH extends At{constructor(){super(...arguments),this._inlines=[]}internalAddInline(e,n=!1){if(!e.isInline)throw new Error(tt.errors.elementCannotBeUsedAsInline());if(!(e.parent===void 0||n)&&e.parent!==this)throw new Error(tt.errors.inlineAlreadyParented());e.setParent(this),this._inlines.push(e)}internalParse(e,n){if(super.internalParse(e,n),this._inlines=[],Array.isArray(e.inlines))for(const r of e.inlines){let i;if(typeof r=="string"){const o=new xr;o.text=r,i=o}else i=n.parseElement(this,r,[],!1);i&&this.internalAddInline(i,!0)}}internalToJSON(e,n){if(super.internalToJSON(e,n),this._inlines.length>0){const r=[];for(const i of this._inlines)r.push(i.toJSON(n));n.serializeValue(e,"inlines",r)}}internalRender(){if(this._inlines.length>0){let e;if(this.forElementId){const r=document.createElement("label");r.htmlFor=this.forElementId,e=r}else e=document.createElement("div");switch(e.className=this.hostConfig.makeCssClassName("ac-richTextBlock"),this.getEffectiveHorizontalAlignment()){case Mn.Center:e.style.textAlign="center";break;case Mn.Right:e.style.textAlign="end";break;default:e.style.textAlign="start";break}let n=0;for(const r of this._inlines){const i=r.render();i&&(e.appendChild(i),n++)}if(n>0)return e}}asString(){let e="";for(const n of this._inlines)e+=n.asString();return e}getJsonTypeName(){return"RichTextBlock"}getInlineCount(){return this._inlines.length}getInlineAt(e){if(e>=0&&e<this._inlines.length)return this._inlines[e];throw new Error(tt.errors.indexOutOfRange(e))}addInline(e){typeof e=="string"?this.internalAddInline(new xr(e)):this.internalAddInline(e)}removeInline(e){const n=this._inlines.indexOf(e);return n>=0?(this._inlines[n].setParent(void 0),this._inlines.splice(n,1),!0):!1}}class Gl extends On{getSchemaKey(){return"Fact"}constructor(e,n){super(),this.name=e,this.value=n}}Gl.titleProperty=new ut(Ee.v1_0,"title");Gl.valueProperty=new ut(Ee.v1_0,"value");Re([Ae(Gl.titleProperty)],Gl.prototype,"name",void 0);Re([Ae(Gl.valueProperty)],Gl.prototype,"value",void 0);class bv extends At{get useDefaultSizing(){return!1}internalRender(){let e;const n=this.hostConfig;if(this.facts.length>0){e=document.createElement("table"),e.style.borderWidth="0px",e.style.borderSpacing="0px",e.style.borderStyle="none",e.style.borderCollapse="collapse",e.style.display="block",e.style.overflow="hidden",e.classList.add(n.makeCssClassName("ac-factset")),e.setAttribute("role","presentation");for(let r=0;r<this.facts.length;r++){const i=document.createElement("tr");r>0&&(i.style.marginTop=n.factSet.spacing+"px");let o=document.createElement("td");o.style.padding="0",o.classList.add(n.makeCssClassName("ac-fact-title")),n.factSet.title.maxWidth&&(o.style.maxWidth=n.factSet.title.maxWidth+"px"),o.style.verticalAlign="top";let s=new zn;s.setParent(this),s.text=!this.facts[r].name&&this.isDesignMode()?"Title":this.facts[r].name,s.size=n.factSet.title.size,s.color=n.factSet.title.color,s.isSubtle=n.factSet.title.isSubtle,s.weight=n.factSet.title.weight,s.wrap=n.factSet.title.wrap,s.spacing=vt.None,Ht(o,s.render()),Ht(i,o),o=document.createElement("td"),o.style.width="10px",Ht(i,o),o=document.createElement("td"),o.style.padding="0",o.style.verticalAlign="top",o.classList.add(n.makeCssClassName("ac-fact-value")),s=new zn,s.setParent(this),s.text=this.facts[r].value,s.size=n.factSet.value.size,s.color=n.factSet.value.color,s.isSubtle=n.factSet.value.isSubtle,s.weight=n.factSet.value.weight,s.wrap=n.factSet.value.wrap,s.spacing=vt.None,Ht(o,s.render()),Ht(i,o),Ht(e,i)}}return e}getJsonTypeName(){return"FactSet"}}bv.factsProperty=new lc(Ee.v1_0,"facts",Gl);Re([Ae(bv.factsProperty)],bv.prototype,"facts",void 0);class CH extends Vn{getInternalName(){return this.internalName}parse(e,n,r){let i;const o=n[this.name];if(o===void 0)return this.defaultValue;let s=!1;if(typeof o=="string"){try{const l=Oi.parse(o,!0);l.unit===Mr.Pixel&&(i=l.physicalSize,s=!0)}catch{}!s&&this.fallbackProperty&&(s=this.fallbackProperty.isValidValue(o,r))}return s||r.logParseEvent(e,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(o,this.name)),i}toJSON(e,n,r,i){i.serializeValue(n,this.name,typeof r=="number"&&!isNaN(r)?r+"px":void 0)}constructor(e,n,r,i){super(e,n),this.targetVersion=e,this.name=n,this.internalName=r,this.fallbackProperty=i}}let Ft=class iI extends At{constructor(){super(...arguments),this.size=Kr.Auto,this.style=Fu.Default}populateSchema(e){super.populateSchema(e),e.remove(At.heightProperty)}applySize(e){if(this.pixelWidth||this.pixelHeight)this.pixelWidth&&(e.style.width=this.pixelWidth+"px"),this.pixelHeight&&(e.style.height=this.pixelHeight+"px");else if(this.maxHeight)e.style.height=this.hostConfig.getEffectiveImageSize(this.size)+"px",e.style.maxHeight=this.maxHeight+"px";else{switch(this.size){case Kr.Stretch:e.style.width="100%";break;case Kr.Auto:e.style.maxWidth="100%";break;default:e.style.width=this.hostConfig.getEffectiveImageSize(this.size)+"px";break}e.style.maxHeight="100%"}}get useDefaultSizing(){return!1}internalRender(){let e;if(this.url){e=document.createElement("div"),e.style.display="flex",e.style.alignItems="flex-start";const n=this.hostConfig;switch(this.getEffectiveHorizontalAlignment()){case Mn.Center:e.style.justifyContent="center";break;case Mn.Right:e.style.justifyContent="flex-end";break;default:e.style.justifyContent="flex-start";break}const r=document.createElement("img");this.renderedImageElement=r,r.onload=s=>{qN(this)},r.onerror=s=>{if(this.renderedElement){const l=this.getRootElement();if(Iv(this.renderedElement),l&&l.designMode){const c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.backgroundColor="#EEEEEE",c.style.color="black",c.innerText=":-(",c.style.padding="10px",this.applySize(c),this.renderedElement.appendChild(c)}}qN(this)},r.style.minWidth="0",r.classList.add(n.makeCssClassName("ac-image")),this.selectAction&&n.supportsInteractivity&&(r.onkeypress=s=>{this.selectAction&&this.selectAction.isEffectivelyEnabled()&&(s.code==="Enter"||s.code==="Space")&&(s.preventDefault(),s.cancelBubble=!0,this.selectAction.execute())},r.onclick=s=>{this.selectAction&&this.selectAction.isEffectivelyEnabled()&&(s.preventDefault(),s.cancelBubble=!0,this.selectAction.execute())},this.selectAction.setupElementForAccessibility(r),this.selectAction.isEffectivelyEnabled()&&r.classList.add(n.makeCssClassName("ac-selectable"))),this.applySize(r),this.style===Fu.Person&&(r.style.borderRadius="50%",r.style.backgroundPosition="50% 50%",r.style.backgroundRepeat="no-repeat");const i=ac(this.backgroundColor);i&&(r.style.backgroundColor=i),this.setImageSource(r);const o=this.preProcessPropertyValue(iI.altTextProperty);o&&(r.alt=o),e.appendChild(r)}return e}getJsonTypeName(){return"Image"}getAllActions(){const e=super.getAllActions();return this.selectAction&&e.push(this.selectAction),e}getActionById(e){let n=super.getActionById(e);return!n&&this.selectAction&&(n=this.selectAction.getActionById(e)),n}getResourceInformation(){return this.url?[{url:this.url,mimeType:"image"}]:[]}setImageSource(e){const n=new _me(this.forceLoad,this.url);n.configureImage(this),e.src=this.preProcessPropertyValue(iI.urlProperty),n.resetImage(this)}};Ft.urlProperty=new ut(Ee.v1_0,"url");Ft.altTextProperty=new ut(Ee.v1_0,"altText");Ft.backgroundColorProperty=new ut(Ee.v1_1,"backgroundColor");Ft.styleProperty=new sr(Ee.v1_0,"style",Fu,Fu.Default);Ft.sizeProperty=new sr(Ee.v1_0,"size",Kr,Kr.Auto);Ft.pixelWidthProperty=new CH(Ee.v1_1,"width","pixelWidth");Ft.pixelHeightProperty=new CH(Ee.v1_1,"height","pixelHeight",At.heightProperty);Ft.selectActionProperty=new oC(Ee.v1_1,"selectAction",["Action.ShowCard"]);Ft.shouldForceLoadProperty=new or(Ee.v1_6,"forceLoad",!1);Re([Ae(Ft.urlProperty)],Ft.prototype,"url",void 0);Re([Ae(Ft.altTextProperty)],Ft.prototype,"altText",void 0);Re([Ae(Ft.backgroundColorProperty)],Ft.prototype,"backgroundColor",void 0);Re([Ae(Ft.sizeProperty)],Ft.prototype,"size",void 0);Re([Ae(Ft.styleProperty)],Ft.prototype,"style",void 0);Re([Ae(Ft.pixelWidthProperty)],Ft.prototype,"pixelWidth",void 0);Re([Ae(Ft.pixelHeightProperty)],Ft.prototype,"pixelHeight",void 0);Re([Ae(Ft.selectActionProperty)],Ft.prototype,"selectAction",void 0);Re([Ae(Ft.shouldForceLoadProperty)],Ft.prototype,"forceLoad",void 0);class _me{constructor(e,n){this.doForceLoad=e,this.url=n,n&&n.length&&e&&(this.uniqueHash="?"+Date.now(),this.urlWithForceLoadOption=n+this.uniqueHash)}configureImage(e){this.urlWithForceLoadOption&&this.urlWithForceLoadOption.length&&(e.url=this.urlWithForceLoadOption)}resetImage(e){e.url=this.url}}class Wa extends At{constructor(){super(...arguments),this.allowVerticalOverflow=!1}populateSchema(e){super.populateSchema(e),this.isSelectable||e.remove(Wa.selectActionProperty)}isElementAllowed(e){return this.hostConfig.supportsInteractivity||!e.isInteractive}applyPadding(){if(super.applyPadding(),!this.renderedElement)return;let e=new VA;this.getEffectivePadding()&&(e=this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding())),this.renderedElement.style.paddingTop=e.top+"px",this.renderedElement.style.paddingRight=e.right+"px",this.renderedElement.style.paddingBottom=e.bottom+"px",this.renderedElement.style.paddingLeft=e.left+"px",this.renderedElement.style.marginRight="0",this.renderedElement.style.marginLeft="0"}get isSelectable(){return!1}forbiddenChildElements(){return[]}releaseDOMResources(){super.releaseDOMResources();for(let e=0;e<this.getItemCount();e++)this.getItemAt(e).releaseDOMResources()}internalValidateProperties(e){super.internalValidateProperties(e);for(let n=0;n<this.getItemCount();n++){const r=this.getItemAt(n);!this.hostConfig.supportsInteractivity&&r.isInteractive&&e.addFailure(this,Ct.InteractivityNotAllowed,tt.errors.interactivityNotAllowed()),this.isElementAllowed(r)||e.addFailure(this,Ct.InteractivityNotAllowed,tt.errors.elementTypeNotAllowed(r.getJsonTypeName())),r.internalValidateProperties(e)}this._selectAction&&this._selectAction.internalValidateProperties(e)}render(){const e=super.render();if(e){const n=this.hostConfig;this.allowVerticalOverflow&&(e.style.overflowX="hidden",e.style.overflowY="auto"),e&&this.isSelectable&&this._selectAction&&n.supportsInteractivity&&(e.onclick=r=>{this._selectAction&&this._selectAction.isEffectivelyEnabled()&&(r.preventDefault(),r.cancelBubble=!0,this._selectAction.execute())},e.onkeypress=r=>{this._selectAction&&this._selectAction.isEffectivelyEnabled()&&(r.code==="Enter"||r.code==="Space")&&(r.preventDefault(),r.cancelBubble=!0,this._selectAction.execute())},this._selectAction.setupElementForAccessibility(e),this._selectAction.isEffectivelyEnabled()&&e.classList.add(n.makeCssClassName("ac-selectable")))}return e}updateLayout(e=!0){if(super.updateLayout(e),e)for(let n=0;n<this.getItemCount();n++)this.getItemAt(n).updateLayout()}getAllInputs(e=!0){let n=[];for(let r=0;r<this.getItemCount();r++)n.push(...this.getItemAt(r).getAllInputs(e));return n}getAllActions(){const e=super.getAllActions();for(let n=0;n<this.getItemCount();n++)e.push(...this.getItemAt(n).getAllActions());return this._selectAction&&e.push(this._selectAction),e}getResourceInformation(){let e=[];for(let n=0;n<this.getItemCount();n++)e.push(...this.getItemAt(n).getResourceInformation());return e}getElementById(e){let n=super.getElementById(e);if(!n)for(let r=0;r<this.getItemCount()&&(n=this.getItemAt(r).getElementById(e),!n);r++);return n}findDOMNodeOwner(e){var n;let r;for(let i=0;i<this.getItemCount();i++)if(r=this.getItemAt(i).findDOMNodeOwner(e),r)return r;for(let i=0;i<this.getActionCount();i++)if(r=(n=this.getActionAt(i))===null||n===void 0?void 0:n.findDOMNodeOwner(e),r)return r;return super.findDOMNodeOwner(e)}}Wa.selectActionProperty=new oC(Ee.v1_1,"selectAction",["Action.ShowCard"]);Re([Ae(Wa.selectActionProperty)],Wa.prototype,"_selectAction",void 0);class Hi extends Wa{constructor(){super(...arguments),this._images=[],this.imageSize=Dl.Medium,this.presentationStyle=Nl.Default,this.pixelOffset=0}internalRender(){var e;let n;if(this._images.length>0){const r=this.presentationStyle===Nl.Grid;n=document.createElement("div"),n.style.display="flex",n.style.flexWrap="wrap",n.classList.add(this.hostConfig.makeCssClassName("ac-imageSet")),n.classList.toggle(this.hostConfig.makeCssClassName("ac-imageSetStyle-grid"),r),n.style.gap="5px";let i;switch(this.imageSize){case Dl.Small:i=Kr.Small;break;case Dl.Large:i=Kr.Large;break;default:i=Kr.Medium;break}const o=this.hostConfig.getEffectiveImageSize(i);for(const s of this._images){s.maxHeight=this.hostConfig.imageSet.maxImageHeight,r?s.pixelWidth=o:s.size=i;const l=s.render();if(l){if(l.style.display="inline-flex",l.style.margin="0px",r){l.style.flexBasis=o+"px",l.style.height=o+"px",l.style.flexGrow="0",l.style.flexShrink="0";const c=(e=s.renderedImageElement)===null||e===void 0?void 0:e.style;c&&(c.width="100%",c.height="100%",c.objectFit="cover",c.verticalAlign="middle")}Ht(n,l)}}this.presentationStyle==Nl.Stacked&&this.applyStackedPresentationStyle()}return n}applyStackedPresentationStyle(){if(this._images[0].renderedImageElement){let e=HN.parseNumericPixelDimension(this._images[0].renderedImageElement.style.height),n=this.getEffectiveBackgroundColor();e&&new HN(this.pixelOffset,e,n).configureImagesArrayAsStackedLayout(this._images)}}getEffectiveBackgroundColor(){let e=this.getParentContainer(),n=e==null?void 0:e.getEffectiveStyle();const r=this.hostConfig.containerStyles.getStyleByName(n,this.hostConfig.containerStyles.getStyleByName(this.defaultStyle));return ac(r.backgroundColor)}getItemCount(){return this._images.length}getItemAt(e){return this._images[e]}getFirstVisibleRenderedItem(){return this._images&&this._images.length>0?this._images[0]:void 0}getLastVisibleRenderedItem(){return this._images&&this._images.length>0?this._images[this._images.length-1]:void 0}removeItem(e){if(e instanceof Ft){const n=this._images.indexOf(e);if(n>=0)return this._images.splice(n,1),e.setParent(void 0),this.updateLayout(),!0}return!1}getJsonTypeName(){return"ImageSet"}addImage(e){if(!e.parent)this._images.push(e),e.setParent(this);else throw new Error("This image already belongs to another ImageSet")}indexOf(e){return e instanceof Ft?this._images.indexOf(e):-1}}Hi.imagesProperty=new lc(Ee.v1_0,"images",Ft,(t,e)=>{e.setParent(t)});Hi.imageSizeProperty=new sr(Ee.v1_0,"imageSize",Dl,Dl.Medium);Hi.imagePresentationStyle=new sr(Ee.v1_6,"style",Nl,Nl.Default);Hi.pixelOffset=new fs(Ee.v1_6,"offset",0,void 0);Re([Ae(Hi.imagesProperty)],Hi.prototype,"_images",void 0);Re([Ae(Hi.imageSizeProperty)],Hi.prototype,"imageSize",void 0);Re([Ae(Hi.imagePresentationStyle)],Hi.prototype,"presentationStyle",void 0);Re([Ae(Hi.pixelOffset)],Hi.prototype,"pixelOffset",void 0);class HN{constructor(e,n,r){this.sign45=.7071,this.maxImageCounts=2,this.offset=0,this.normalizationConstant=0,this.border=5,this.dimension=0,this.dimension=n,this.normalizationConstant=(n*this.sign45-.5*n)*2,this.offset=this.sign45*(Math.max(e,-n)-this.normalizationConstant),this.style=r||""}moveImageRight(e){e.style.marginLeft=this.offset+"px"}moveImageUp(e){e.style.marginBottom=this.offset+this.dimension+"px"}moveImageDown(e){e.style.marginTop=this.offset+this.dimension+"px"}makeImageRound(e){e.style.borderRadius="50%",e.style.backgroundPosition="50% 50%",e.style.backgroundRepeat="no-repeat"}applyBorder(e){e.style.height=this.dimension+this.border*2+"px",e.style.border=this.border+"px solid "+this.style}configureImageForBottomLeft(e){this.moveImageDown(e),this.makeImageRound(e),this.applyBorder(e),e.style.zIndex="2"}configureImageForTopRight(e){this.moveImageUp(e),this.moveImageRight(e),this.makeImageRound(e),e.style.zIndex="1"}configureImagesArrayAsStackedLayout(e){e.length==1?e[0].renderedImageElement&&this.makeImageRound(e[0].renderedImageElement):e.length<=this.maxImageCounts&&e[0].renderedImageElement&&e[1].renderedImageElement&&(this.configureImageForBottomLeft(e[0].renderedImageElement),this.configureImageForTopRight(e[1].renderedImageElement))}static parseNumericPixelDimension(e){if((e==null?void 0:e.substring(e.length-2))=="px")return parseInt(e.substring(0,e.length-2))}}class Ka extends On{constructor(e,n){super(),this.url=e,this.mimeType=n}isValid(){return!!(this.mimeType&&this.url)}}Ka.mimeTypeProperty=new ut(Ee.v1_1,"mimeType");Ka.urlProperty=new ut(Ee.v1_1,"url");Re([Ae(Ka.mimeTypeProperty)],Ka.prototype,"mimeType",void 0);Re([Ae(Ka.urlProperty)],Ka.prototype,"url",void 0);class _v extends Ka{constructor(e,n,r){super(e,n),this.label=r}getSchemaKey(){return"CaptionSource"}render(){let e;return this.isValid()&&(e=document.createElement("track"),e.src=this.url,e.kind="captions",e.label=this.label),e}}_v.labelProperty=new ut(Ee.v1_6,"label");Re([Ae(_v.labelProperty)],_v.prototype,"label",void 0);class Ame extends Ka{getSchemaKey(){return"MediaSource"}render(){let e;return this.isValid()&&(e=document.createElement("source"),e.src=this.url,e.type=this.mimeType),e}}class SH{play(){}get posterUrl(){return this._posterUrl}set posterUrl(e){this._posterUrl=e}get selectedMediaType(){}}class ff extends SH{processSources(){this._selectedSources=[],this._captionSources=[],this._selectedMediaType=void 0;for(const e of this.owner.sources){const n=e.mimeType?e.mimeType.split("/"):[];if(n.length===2){if(!this._selectedMediaType){const r=ff.supportedMediaTypes.indexOf(n[0]);r>=0&&(this._selectedMediaType=ff.supportedMediaTypes[r])}n[0]===this._selectedMediaType&&this._selectedSources.push(e)}}this._captionSources.push(...this.owner.captionSources)}constructor(e){super(),this.owner=e,this._selectedSources=[],this._captionSources=[],this.processSources()}canPlay(){return this._selectedSources.length>0}fetchVideoDetails(){return gp(this,void 0,void 0,function*(){})}render(){this._selectedMediaType==="video"?this._mediaElement=document.createElement("video"):this._mediaElement=document.createElement("audio"),this._mediaElement.setAttribute("aria-label",this.owner.altText?this.owner.altText:tt.defaults.mediaPlayerAriaLabel()),this._mediaElement.setAttribute("webkit-playsinline",""),this._mediaElement.setAttribute("playsinline",""),this._mediaElement.setAttribute("crossorigin",""),this._mediaElement.autoplay=!0,this._mediaElement.controls=!0,ime()&&(this._mediaElement.muted=!0),this._mediaElement.preload="none",this._mediaElement.style.width="100%";for(const e of this.owner.sources){const n=e.render();Ht(this._mediaElement,n)}for(const e of this.owner.captionSources)if(e.mimeType=="vtt"){const n=e.render();Ht(this._mediaElement,n)}return this._mediaElement}play(){this._mediaElement&&this._mediaElement.play()}get selectedMediaType(){return this._selectedMediaType}}ff.supportedMediaTypes=["audio","video"];class Rme extends SH{constructor(e){super()}}class JA extends Rme{constructor(e,n){super(e),this.iFrameTitle=n,e.length>=2&&(this._videoId=e[1])}canPlay(){return this._videoId!==void 0}render(){let e=document.createElement("div");e.style.position="relative",e.style.width="100%",e.style.height="0",e.style.paddingBottom="56.25%";let n=document.createElement("iframe");return n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.src=this.getEmbedVideoUrl(),n.frameBorder="0",this.iFrameTitle&&(n.title=this.iFrameTitle),n.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",n.allowFullscreen=!0,e.appendChild(n),e}get videoId(){return this._videoId}}class kme extends JA{fetchVideoDetails(){return gp(this,void 0,void 0,function*(){const e=`https://vimeo.com/api/oembed.json?url=${this.getEmbedVideoUrl()}`;let n=yield fetch(e);if(n.ok){let r=yield n.json();this.posterUrl=r.thumbnail_url}})}getEmbedVideoUrl(){return`https://player.vimeo.com/video/${this.videoId}?autoplay=1`}}class Pme extends JA{fetchVideoDetails(){return gp(this,void 0,void 0,function*(){const e=`https://api.dailymotion.com/video/${this.videoId}?fields=thumbnail_720_url`;let n=yield fetch(e);if(n.ok){let r=yield n.json();this.posterUrl=r.thumbnail_720_url}})}getEmbedVideoUrl(){return`https://www.dailymotion.com/embed/video/${this.videoId}?autoplay=1`}}class Ome extends JA{constructor(e,n){super(e,n),this.iFrameTitle=n,e.length>=3&&e[2]!==void 0&&(this._startTimeIndex=parseInt(e[2]))}fetchVideoDetails(){return gp(this,void 0,void 0,function*(){this.posterUrl=this.videoId?`https://img.youtube.com/vi/${this.videoId}/maxresdefault.jpg`:void 0})}getEmbedVideoUrl(){let e=`https://www.youtube.com/embed/${this.videoId}?autoplay=1`;return this._startTimeIndex!==void 0&&(e+=`&start=${this._startTimeIndex}`),e}}class yr extends At{constructor(){super(...arguments),this.sources=[],this.captionSources=[]}createMediaPlayer(){for(let e of yr.customMediaPlayers)for(let n of this.sources)if(n.url)for(let r of e.urlPatterns){let i=r.exec(n.url);if(i!==null)return e.createMediaPlayer(i)}return new ff(this)}handlePlayButtonInvoke(e){if(this.hostConfig.media.allowInlinePlayback){if(e.preventDefault(),e.cancelBubble=!0,this.renderedElement){const n=this._mediaPlayer.render();Iv(this.renderedElement),this.renderedElement.appendChild(n),this._mediaPlayer.play(),n.focus()}}else yr.onPlay&&(e.preventDefault(),e.cancelBubble=!0,yr.onPlay(this))}displayPoster(){return gp(this,void 0,void 0,function*(){if(this.renderedElement){const r=document.createElement("div");r.className=this.hostConfig.makeCssClassName("ac-media-poster"),r.setAttribute("role","contentinfo"),r.setAttribute("aria-label",this.altText?this.altText:tt.defaults.mediaPlayerAriaLabel()),r.style.position="relative",r.style.display="flex";let i=this.poster?this.poster:this._mediaPlayer.posterUrl;if(i||(i=this.hostConfig.media.defaultPoster),i){const o=document.createElement("img");o.style.width="100%",o.style.height="100%",o.setAttribute("role","presentation"),o.onerror=s=>{o.parentNode&&o.parentNode.removeChild(o),r.classList.add("empty"),r.style.minHeight="150px"},o.src=i,r.appendChild(o)}else r.classList.add("empty"),r.style.minHeight="150px";if(this.hostConfig.supportsInteractivity&&this._mediaPlayer.canPlay()){const o=document.createElement("div");o.tabIndex=0,o.setAttribute("role","button"),o.setAttribute("aria-label",tt.defaults.mediaPlayerPlayMedia()),o.className=this.hostConfig.makeCssClassName("ac-media-playButton"),o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.onclick=c=>{this.handlePlayButtonInvoke(c)},o.onkeypress=c=>{(c.code==="Enter"||c.code==="Space")&&this.handlePlayButtonInvoke(c)};const s=document.createElement("div");s.className=this.hostConfig.makeCssClassName("ac-media-playButton-arrow"),s.style.width="12px",s.style.height="15px",s.style.borderTopWidth=15/2+"px",s.style.borderBottomWidth=15/2+"px",s.style.borderLeftWidth="12px",s.style.borderRightWidth="0",s.style.borderStyle="solid",s.style.borderTopColor="transparent",s.style.borderRightColor="transparent",s.style.borderBottomColor="transparent",s.style.transform="translate("+12/10+"px,0px)",o.appendChild(s);const l=document.createElement("div");l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.appendChild(o),r.appendChild(l)}Iv(this.renderedElement),this.renderedElement.appendChild(r)}})}internalRender(){const e=document.createElement("div");return e.className=this.hostConfig.makeCssClassName("ac-media"),e}render(){let e=super.render();return e&&(this._mediaPlayer=this.createMediaPlayer(),this._mediaPlayer.fetchVideoDetails().then(()=>this.displayPoster())),e}releaseDOMResources(){super.releaseDOMResources(),this.displayPoster()}getJsonTypeName(){return"Media"}getResourceInformation(){const e=[];if(this._mediaPlayer){const n=this.poster?this.poster:this.hostConfig.media.defaultPoster;n&&e.push({url:n,mimeType:"image"})}for(const n of this.sources)n.isValid()&&e.push({url:n.url,mimeType:n.mimeType});for(const n of this.captionSources)n.isValid()&&e.push({url:n.url,mimeType:n.mimeType});return e}get selectedMediaType(){return this._mediaPlayer.selectedMediaType}}yr.customMediaPlayers=[{urlPatterns:[/^(?:https?:\/\/)?(?:www.)?youtube.com\/watch\?(?=.*v=([\w\d-_]+))(?=(?:.*t=(\d+))?).*/gi,/^(?:https?:\/\/)?youtu.be\/([\w\d-_]+)(?:\?t=(\d+))?/gi],createMediaPlayer:t=>new Ome(t,tt.defaults.youTubeVideoPlayer())},{urlPatterns:[/^(?:https?:\/\/)?vimeo.com\/([\w\d-_]+).*/gi],createMediaPlayer:t=>new kme(t,tt.defaults.vimeoVideoPlayer())},{urlPatterns:[/^(?:https?:\/\/)?(?:www.)?dailymotion.com\/video\/([\w\d-_]+).*/gi],createMediaPlayer:t=>new Pme(t,tt.defaults.dailymotionVideoPlayer())}];yr.sourcesProperty=new lc(Ee.v1_1,"sources",Ame);yr.captionSourcesProperty=new lc(Ee.v1_6,"captionSources",_v);yr.posterProperty=new ut(Ee.v1_1,"poster");yr.altTextProperty=new ut(Ee.v1_1,"altText");Re([Ae(yr.sourcesProperty)],yr.prototype,"sources",void 0);Re([Ae(yr.captionSourcesProperty)],yr.prototype,"captionSources",void 0);Re([Ae(yr.posterProperty)],yr.prototype,"poster",void 0);Re([Ae(yr.altTextProperty)],yr.prototype,"altText",void 0);var to;(function(t){t[t.InitialRender=0]="InitialRender",t[t.MouseEnterOnCard=1]="MouseEnterOnCard",t[t.MouseLeaveOnCard=2]="MouseLeaveOnCard",t[t.FocusLeave=3]="FocusLeave"})(to||(to={}));class hn extends At{constructor(){super(...arguments),this.inputStyle=No.Default}getAllLabelIds(){const e=[];return this.labelledBy&&e.push(this.labelledBy),this._renderedLabelElement&&e.push(this._renderedLabelElement.id),this._renderedErrorMessageElement&&e.push(this._renderedErrorMessageElement.id),e}updateInputControlAriaLabelledBy(){if(this._renderedInputControlElement){const e=this.getAllLabelIds();e.length>0?this._renderedInputControlElement.setAttribute("aria-labelledby",e.join(" ")):this._renderedInputControlElement.removeAttribute("aria-labelledby")}}get isNullable(){return!0}get renderedInputControlElement(){return this._renderedInputControlElement}get inputControlContainerElement(){return this._inputControlContainerElement}overrideInternalRender(){const e=this.hostConfig;this._outerContainerElement=document.createElement("div"),this._outerContainerElement.style.display="flex",this.labelPosition===Ps.Inline?this._outerContainerElement.style.flexDirection="row":this._outerContainerElement.style.flexDirection="column";const n=Fa();if(this.label){const r=new yH;r.setParent(this),r.forElementId=n;const i=new xr(this.label);if(r.addInline(i),this.isRequired){i.init(e.inputs.label.requiredInputs);const o=new xr(e.inputs.label.requiredInputs.suffix);o.color=e.inputs.label.requiredInputs.suffixColor,o.ariaHidden=!0,r.addInline(o)}else i.init(e.inputs.label.optionalInputs);this._renderedLabelElement=r.render(),this._renderedLabelElement&&(this._renderedLabelElement.id=Fa(),this.labelPosition===Ps.Inline?this._renderedLabelElement.style.alignSelf="center":this._renderedLabelElement.style.marginBottom=e.getEffectiveSpacing(e.inputs.label.inputSpacing)+"px",this._outerContainerElement.appendChild(this._renderedLabelElement))}if(this._inputControlContainerElement=document.createElement("div"),this._inputControlContainerElement.className=e.makeCssClassName("ac-input-container"),this._inputControlContainerElement.style.display="flex",this.height==="stretch"&&(this._inputControlContainerElement.style.alignItems="stretch",this._inputControlContainerElement.style.flex="1 1 auto"),this._renderedInputControlElement=this.internalRender(),this._renderedInputControlElement){if(this._renderedInputControlElement.id=n,this._renderedInputControlElement.style.minWidth="0px",this.isNullable&&this.isRequired&&(this._renderedInputControlElement.classList.add(e.makeCssClassName("ac-input-required")),(this._renderedInputControlElement instanceof HTMLInputElement||this._renderedInputControlElement instanceof HTMLSelectElement)&&this._renderedInputControlElement.setAttribute("aria-required","true")),this._inputControlContainerElement.appendChild(this._renderedInputControlElement),this._outerContainerElement.appendChild(this._inputControlContainerElement),this._renderedLabelElement&&this.labelPosition===Ps.Inline)if(this.labelWidth){if(this.labelWidth.unit==Mr.Weight){const r=this.labelWidth.physicalSize;this._renderedLabelElement.style.width=r.toString()+"%",this._inputControlContainerElement.style.width=(100-r).toString()+"%"}else if(this.labelWidth.unit==Mr.Pixel){const r=this.labelWidth.physicalSize;this._renderedLabelElement.style.width=r.toString()+"px"}}else{const r=e.inputs.label.width;this._renderedLabelElement.style.width=r.toString()+"%",this._inputControlContainerElement.style.width=100-r+"%"}return this.updateVisualState(to.InitialRender),this._renderedInputControlElement&&(this._renderedInputControlElement.onblur=r=>{this.updateVisualState(to.FocusLeave)}),this.updateInputControlAriaLabelledBy(),this._outerContainerElement}this.resetDirtyState()}valueChanged(){this.getRootElement().updateActionsEnabledState(),this.isValid()&&this.resetValidationFailureCue(),this.onValueChanged&&this.onValueChanged(this),xme(this)}resetValidationFailureCue(){this.renderedInputControlElement&&(this instanceof Ut&&this.isDynamicTypeahead()?this.removeValidationFailureCue():this.renderedInputControlElement.classList.remove(this.hostConfig.makeCssClassName("ac-input-validation-failed")),this.updateInputControlAriaLabelledBy(),this._renderedErrorMessageElement&&(this._outerContainerElement.removeChild(this._renderedErrorMessageElement),this._renderedErrorMessageElement=void 0))}showValidationErrorMessage(){if(this.renderedElement&&this.errorMessage&&yt.displayInputValidationErrors){const e=new zn;e.setParent(this),e.text=this.errorMessage,e.wrap=!0,e.init(this.hostConfig.inputs.errorMessage),this._renderedErrorMessageElement=e.render(),this._renderedErrorMessageElement&&(this._renderedErrorMessageElement.id=Fa(),this._outerContainerElement.appendChild(this._renderedErrorMessageElement),this.updateInputControlAriaLabelledBy())}}get allowRevealOnHoverStyle(){return this.hostConfig.inputs&&this.hostConfig.inputs.allowRevealOnHoverStyle}shouldHideInputAdornersForRevealOnHover(e,n){const r=e===document.activeElement,i=this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onhover"),o=e.classList.contains(i);return n===to.InitialRender||n===to.FocusLeave&&!o||n===to.MouseLeaveOnCard&&!r}updateVisualState(e){!this.allowRevealOnHoverStyle||!this._renderedInputControlElement||this.inputStyle!==No.RevealOnHover||(e===to.InitialRender?this._renderedInputControlElement.classList.add(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onrender")):e===to.MouseEnterOnCard?this._renderedInputControlElement.classList.add(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onhover")):e===to.MouseLeaveOnCard&&this._renderedInputControlElement.classList.remove(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onhover")))}focus(){this._renderedInputControlElement&&this._renderedInputControlElement.focus()}isValid(){return!0}isDirty(){return this.value!==this._oldValue}resetDirtyState(){this._oldValue=this.value}internalValidateProperties(e){super.internalValidateProperties(e),this.id||e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.inputsMustHaveUniqueId()),this.isRequired&&(this.label||e.addFailure(this,Ct.RequiredInputsShouldHaveLabel,"Required inputs should have a label"),this.errorMessage||e.addFailure(this,Ct.RequiredInputsShouldHaveErrorMessage,"Required inputs should have an error message"))}validateValue(){this.resetValidationFailureCue();const e=this.isRequired?this.isSet()&&this.isValid():this.isValid();return!e&&this.renderedInputControlElement&&(this instanceof Ut&&this.isDynamicTypeahead()?this.showValidationFailureCue():this.renderedInputControlElement.classList.add(this.hostConfig.makeCssClassName("ac-input-validation-failed")),this.showValidationErrorMessage()),e}getAllInputs(e=!0){return[this]}render(){let e=super.render();return this.resetDirtyState(),e}get isInteractive(){return!0}}hn.labelProperty=new ut(Ee.v1_3,"label",!0);hn.isRequiredProperty=new or(Ee.v1_3,"isRequired",!1);hn.errorMessageProperty=new ut(Ee.v1_3,"errorMessage",!0);hn.inputStyleProperty=new sr(Ee.v1_6,"inputStyle",No,No.Default,[{value:No.RevealOnHover},{value:No.Default}]);hn.labelWidthProperty=new cc(Ee.v1_6,"labelWidth",(t,e,n,r)=>{let i=e.defaultValue;const o=n[e.name];let s=!1;if(typeof o=="number"&&!isNaN(o))i=new Oi(o,Mr.Weight),(i.physicalSize<0||i.physicalSize>100)&&(s=!0);else if(typeof o=="string")try{i=Oi.parse(o)}catch{s=!0}else s=!0;return s&&(r.logParseEvent(t,Ct.InvalidPropertyValue,tt.errors.invalidInputLabelWidth()),i=void 0),i},(t,e,n,r,i)=>{r instanceof Oi&&(r.unit===Mr.Pixel?i.serializeValue(n,"labelWidth",r.physicalSize+"px"):i.serializeNumber(n,"labelWidth",r.physicalSize))},void 0);hn.labelPositionProperty=new sr(Ee.v1_6,"labelPosition",Ps,Ps.Above,[{value:Ps.Inline},{value:Ps.Above}]);Re([Ae(hn.labelProperty)],hn.prototype,"label",void 0);Re([Ae(hn.isRequiredProperty)],hn.prototype,"isRequired",void 0);Re([Ae(hn.errorMessageProperty)],hn.prototype,"errorMessage",void 0);Re([Ae(hn.inputStyleProperty)],hn.prototype,"inputStyle",void 0);Re([Ae(hn.labelWidthProperty)],hn.prototype,"labelWidth",void 0);Re([Ae(hn.labelPositionProperty)],hn.prototype,"labelPosition",void 0);class In extends hn{constructor(){super(...arguments),this.isMultiline=!1,this.style=no.Text}setupInput(e){e.style.flex="1 1 auto",e.tabIndex=this.isDesignMode()?-1:0,this.placeholder&&(e.placeholder=this.placeholder,e.setAttribute("aria-label",this.placeholder)),this.defaultValue&&(e.value=this.defaultValue),this.maxLength&&this.maxLength>0&&(e.maxLength=this.maxLength),e.oninput=()=>{this.valueChanged()},e.onkeypress=n=>{n.ctrlKey&&n.code==="Enter"&&this.inlineAction&&this.inlineAction.isEffectivelyEnabled()&&this.inlineAction.execute()}}internalRender(){let e;return this.isMultiline&&this.style!==no.Password?(e=document.createElement("textarea"),e.className=this.hostConfig.makeCssClassName("ac-input","ac-textInput","ac-multiline"),this.height==="stretch"&&(e.style.height="initial")):(e=document.createElement("input"),e.className=this.hostConfig.makeCssClassName("ac-input","ac-textInput"),e.type=no[this.style].toLowerCase()),this.setupInput(e),e}overrideInternalRender(){const e=super.overrideInternalRender();if(this.inlineAction){const n=document.createElement("button");if(n.className=this.hostConfig.makeCssClassName(this.inlineAction.isEffectivelyEnabled()?"ac-inlineActionButton":"ac-inlineActionButton-disabled"),n.onclick=r=>{this.inlineAction&&this.inlineAction.isEffectivelyEnabled()&&(r.preventDefault(),r.cancelBubble=!0,this.inlineAction.execute())},this.inlineAction.iconUrl){n.classList.add("iconOnly");const r=document.createElement("img");r.style.height="100%",r.setAttribute("role","presentation"),r.style.display="none",r.onload=()=>{r.style.removeProperty("display")},r.onerror=()=>{n.removeChild(r),n.classList.remove("iconOnly"),n.classList.add("textOnly"),n.textContent=this.inlineAction&&this.inlineAction.title?this.inlineAction.title:tt.defaults.inlineActionTitle()},r.src=this.inlineAction.iconUrl,n.appendChild(r),n.title=this.inlineAction.title?this.inlineAction.title:tt.defaults.inlineActionTitle()}else n.classList.add("textOnly"),n.textContent=this.inlineAction.title?this.inlineAction.title:tt.defaults.inlineActionTitle();this.inlineAction.setupElementForAccessibility(n,!0),n.style.marginLeft="8px",this.inputControlContainerElement.appendChild(n)}return e}updateVisualState(e){this.allowRevealOnHoverStyle&&(this.inlineAction||this.isMultiline||super.updateVisualState(e))}getJsonTypeName(){return"Input.Text"}getAllActions(){const e=super.getAllActions();return this.inlineAction&&e.push(this.inlineAction),e}getActionById(e){let n=super.getActionById(e);return!n&&this.inlineAction&&(n=this.inlineAction.getActionById(e)),n}isSet(){return!!this.value}isValid(){return this.value&&this.regex?new RegExp(this.regex,"g").test(this.value):!0}get value(){if(this.renderedInputControlElement)return this.isMultiline?this.renderedInputControlElement.value:this.renderedInputControlElement.value}}In.valueProperty=new ut(Ee.v1_0,"value");In.maxLengthProperty=new fs(Ee.v1_0,"maxLength");In.isMultilineProperty=new or(Ee.v1_0,"isMultiline",!1);In.placeholderProperty=new ut(Ee.v1_0,"placeholder");In.styleProperty=new sr(Ee.v1_0,"style",no,no.Text,[{value:no.Text},{value:no.Tel},{value:no.Url},{value:no.Email},{value:no.Password,targetVersion:Ee.v1_5}]);In.inlineActionProperty=new oC(Ee.v1_0,"inlineAction",["Action.ShowCard"]);In.regexProperty=new ut(Ee.v1_3,"regex",!0);Re([Ae(In.valueProperty)],In.prototype,"defaultValue",void 0);Re([Ae(In.maxLengthProperty)],In.prototype,"maxLength",void 0);Re([Ae(In.isMultilineProperty)],In.prototype,"isMultiline",void 0);Re([Ae(In.placeholderProperty)],In.prototype,"placeholder",void 0);Re([Ae(In.styleProperty)],In.prototype,"style",void 0);Re([Ae(In.inlineActionProperty)],In.prototype,"inlineAction",void 0);Re([Ae(In.regexProperty)],In.prototype,"regex",void 0);class Xr extends hn{constructor(){super(...arguments),this.valueOn="true",this.valueOff="false",this.wrap=!1}updateInputControlAriaLabelledBy(){if(this._checkboxInputElement){let e=this.getAllLabelIds().join(" ");this._checkboxInputLabelElement&&this._checkboxInputLabelElement.id&&(e+=" "+this._checkboxInputLabelElement.id),e?this._checkboxInputElement.setAttribute("aria-labelledby",e):this._checkboxInputElement.removeAttribute("aria-labelledby")}}internalRender(){const e=document.createElement("div");if(e.className=this.hostConfig.makeCssClassName("ac-input","ac-toggleInput"),e.style.width="100%",e.style.display="flex",e.style.alignItems="center",this._checkboxInputElement=document.createElement("input"),this._checkboxInputElement.id=Fa(),this._checkboxInputElement.type="checkbox",this._checkboxInputElement.style.display="inline-block",this._checkboxInputElement.style.verticalAlign="middle",this._checkboxInputElement.style.margin="0",this._checkboxInputElement.style.flex="0 0 auto",this.title&&this._checkboxInputElement.setAttribute("aria-label",this.title),this.isRequired&&this._checkboxInputElement.setAttribute("aria-required","true"),this._checkboxInputElement.tabIndex=this.isDesignMode()?-1:0,this.defaultValue===this.valueOn&&(this._checkboxInputElement.checked=!0),this._oldCheckboxValue=this._checkboxInputElement.checked,this._checkboxInputElement.onchange=()=>{this.valueChanged()},Ht(e,this._checkboxInputElement),this.title||this.isDesignMode()){const n=new zn;if(n.setParent(this),n.forElementId=this._checkboxInputElement.id,n.hostConfig=this.hostConfig,n.text=this.title?this.title:this.getJsonTypeName(),n.useMarkdown=yt.useMarkdownInRadioButtonAndCheckbox,n.wrap=this.wrap,this._checkboxInputLabelElement=n.render(),this._checkboxInputLabelElement){this._checkboxInputLabelElement.id=Fa(),this._checkboxInputLabelElement.style.display="inline-block",this._checkboxInputLabelElement.style.flex="1 1 auto",this._checkboxInputLabelElement.style.marginLeft="6px",this._checkboxInputLabelElement.style.verticalAlign="middle";const r=document.createElement("div");r.style.width="6px",Ht(e,r),Ht(e,this._checkboxInputLabelElement)}}return e}get isNullable(){return!1}updateVisualState(e){}getJsonTypeName(){return"Input.Toggle"}focus(){this._checkboxInputElement&&this._checkboxInputElement.focus()}isSet(){return this.isRequired?this.value===this.valueOn:!!this.value}isDirty(){return this._checkboxInputElement?this._checkboxInputElement.checked!==this._oldCheckboxValue:!1}get value(){if(this._checkboxInputElement)return this._checkboxInputElement.checked?this.valueOn:this.valueOff}}Xr.valueProperty=new ut(Ee.v1_0,"value");Xr.titleProperty=new ut(Ee.v1_0,"title");Xr.valueOnProperty=new ut(Ee.v1_0,"valueOn",!0,void 0,"true",t=>"true");Xr.valueOffProperty=new ut(Ee.v1_0,"valueOff",!0,void 0,"false",t=>"false");Xr.wrapProperty=new or(Ee.v1_2,"wrap",!1);Re([Ae(Xr.valueProperty)],Xr.prototype,"defaultValue",void 0);Re([Ae(Xr.titleProperty)],Xr.prototype,"title",void 0);Re([Ae(Xr.valueOnProperty)],Xr.prototype,"valueOn",void 0);Re([Ae(Xr.valueOffProperty)],Xr.prototype,"valueOff",void 0);Re([Ae(Xr.wrapProperty)],Xr.prototype,"wrap",void 0);class Wl extends On{getSchemaKey(){return"Choice"}constructor(e,n){super(),this.title=e,this.value=n}}Wl.titleProperty=new ut(Ee.v1_0,"title");Wl.valueProperty=new ut(Ee.v1_0,"value");Re([Ae(Wl.titleProperty)],Wl.prototype,"title",void 0);Re([Ae(Wl.valueProperty)],Wl.prototype,"value",void 0);class qi extends On{getSchemaKey(){return"choices.data"}}qi.typeProperty=new ut(Ee.v1_6,"type",!0,new RegExp("^Data.Query$"));qi.datasetProperty=new ut(Ee.v1_6,"dataset");qi.countProperty=new fs(Ee.v1_6,"count");qi.skipProperty=new fs(Ee.v1_6,"skip");Re([Ae(qi.typeProperty)],qi.prototype,"type",void 0);Re([Ae(qi.datasetProperty)],qi.prototype,"dataset",void 0);Re([Ae(qi.countProperty)],qi.prototype,"count",void 0);Re([Ae(qi.skipProperty)],qi.prototype,"skip",void 0);class Ut extends hn{constructor(){super(...arguments),this.isMultiSelect=!1,this.wrap=!1,this.choices=[]}get isCompact(){return!this.style||this.style==="compact"}set isCompact(e){this.style=e?void 0:"expanded"}static getUniqueCategoryName(){const e="__ac-category"+Ut._uniqueCategoryCounter;return Ut._uniqueCategoryCounter++,e}isDynamicTypeahead(){return this.hostConfig.inputs.allowDynamicallyFilteredChoiceSet&&!!this.choicesData&&!!this.choicesData.dataset&&this.choicesData.type==="Data.Query"}getFilterForDynamicSearch(){var e;return(e=this._textInput)===null||e===void 0?void 0:e.value}getDropdownElement(){var e;return(e=this._filteredChoiceSet)===null||e===void 0?void 0:e.dropdown}renderChoices(e,n){var r;(r=this._filteredChoiceSet)===null||r===void 0||r.processResponse(e,n)}showLoadingIndicator(){var e;(e=this._filteredChoiceSet)===null||e===void 0||e.showLoadingIndicator()}removeLoadingIndicator(){var e;(e=this._filteredChoiceSet)===null||e===void 0||e.removeLoadingIndicator()}showErrorIndicator(e,n){var r;(r=this._filteredChoiceSet)===null||r===void 0||r.showErrorIndicator(e,n)}showValidationFailureCue(){var e;(e=this._textInput)===null||e===void 0||e.classList.add(this.hostConfig.makeCssClassName("ac-input-validation-failed"))}removeValidationFailureCue(){var e;(e=this._textInput)===null||e===void 0||e.classList.remove(this.hostConfig.makeCssClassName("ac-input-validation-failed"))}createPlaceholderOptionWhenValueDoesNotExist(){if(!this.value){const e=document.createElement("option");return e.selected=!0,e.disabled=!0,e.hidden=!0,e.value="",this.placeholder&&(e.text=this.placeholder),e}}internalApplyAriaCurrent(){if(this._selectElement){const e=this._selectElement.options;if(e)for(const n of Array.from(e))n.selected?n.setAttribute("aria-current","true"):n.removeAttribute("aria-current")}}renderCompoundInput(e,n,r){const i=document.createElement("div");i.className=this.hostConfig.makeCssClassName("ac-input",e),i.style.width="100%",this._toggleInputs=[],this._labels=[];for(const o of this.choices){const s=document.createElement("input");s.id=Fa(),s.type=n,s.style.margin="0",s.style.display="inline-block",s.style.verticalAlign="middle",s.style.flex="0 0 auto",s.name=this.id?this.id:this._uniqueCategoryName,this.isRequired&&s.setAttribute("aria-required","true"),s.tabIndex=this.isDesignMode()?-1:0,o.value&&(s.value=o.value),o.title&&s.setAttribute("aria-label",o.title),r&&o.value&&r.indexOf(o.value)>=0&&(s.checked=!0),s.onchange=()=>{this.valueChanged()},this._toggleInputs.push(s);const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",Ht(l,s);const c=new zn;c.setParent(this),c.forElementId=s.id,c.hostConfig=this.hostConfig,c.text=o.title?o.title:"Choice "+this._toggleInputs.length,c.useMarkdown=yt.useMarkdownInRadioButtonAndCheckbox,c.wrap=this.wrap;const a=c.render();if(this._labels.push(a),a){a.id=Fa(),a.style.display="inline-block",a.style.flex="1 1 auto",a.style.marginLeft="6px",a.style.verticalAlign="middle";const u=document.createElement("div");u.style.width="6px",Ht(l,u),Ht(l,a)}Ht(i,l)}return i}updateInputControlAriaLabelledBy(){if((this.isMultiSelect||this.style==="expanded")&&this._toggleInputs&&this._labels){const e=this.getAllLabelIds();for(let n=0;n<this._toggleInputs.length;n++){let r="";n===0&&(r=e.join(" "));const i=this._labels[n];i&&i.id&&(r+=" "+i.id),r!==""?this._toggleInputs[n].setAttribute("aria-labelledby",r):this._toggleInputs[n].removeAttribute("aria-labelledby")}}else super.updateInputControlAriaLabelledBy()}internalRender(){if(this._uniqueCategoryName=Ut.getUniqueCategoryName(),this.isDynamicTypeahead()){const e=new Mme(Ut._uniqueCategoryCounter,this.choices,this.hostConfig);if(e.render(),e.textInput){this._textInput=e.textInput,this.defaultValue&&(this._textInput.value=this.defaultValue),this.placeholder&&!this._textInput.value&&(this._textInput.placeholder=this.placeholder,this._textInput.setAttribute("aria-label",this.placeholder)),this._textInput.tabIndex=this.isDesignMode()?-1:0;const n=dme(()=>{e.processChoices(),this.valueChanged(),this._textInput&&(this.value?(this._textInput.removeAttribute("placeholder"),this._textInput.removeAttribute("aria-label")):this.placeholder&&(this._textInput.placeholder=this.placeholder,this._textInput.setAttribute("aria-label",this.placeholder)))},this.hostConfig.inputs.debounceTimeInMilliSeconds);this._textInput.onclick=n,this._textInput.oninput=n}return e.parent=this,this._filteredChoiceSet=e,e.renderedElement}else{if(this.isMultiSelect)return this.renderCompoundInput("ac-choiceSetInput-multiSelect","checkbox",this.defaultValue?this.defaultValue.split(this.hostConfig.choiceSetInputValueSeparator):void 0);if(this.style==="expanded")return this.renderCompoundInput("ac-choiceSetInput-expanded","radio",this.defaultValue?[this.defaultValue]:void 0);if(this.style==="filtered"){const e=document.createElement("div");e.style.width="100%",this._textInput=document.createElement("input"),this._textInput.className=this.hostConfig.makeCssClassName("ac-input","ac-multichoiceInput","ac-choiceSetInput-filtered"),this._textInput.type="text",this._textInput.style.width="100%",this._textInput.oninput=()=>{this.valueChanged(),this._textInput&&(this.value?(this._textInput.removeAttribute("placeholder"),this._textInput.removeAttribute("aria-label")):this.placeholder&&(this._textInput.placeholder=this.placeholder,this._textInput.setAttribute("aria-label",this.placeholder)))},this.defaultValue&&(this._textInput.value=this.defaultValue),this.placeholder&&!this._textInput.value&&(this._textInput.placeholder=this.placeholder,this._textInput.setAttribute("aria-label",this.placeholder)),this._textInput.tabIndex=this.isDesignMode()?-1:0;const n=document.createElement("datalist");n.id=Fa();for(const r of this.choices){const i=document.createElement("option");r.title&&(i.value=r.title,i.setAttribute("aria-label",r.title)),i.tabIndex=this.isDesignMode()?-1:0,n.appendChild(i)}return this._textInput.setAttribute("list",n.id),e.append(this._textInput,n),e}else{this._selectElement=document.createElement("select"),this._selectElement.className=this.hostConfig.makeCssClassName("ac-input","ac-multichoiceInput","ac-choiceSetInput-compact"),this._selectElement.style.width="100%",this._selectElement.tabIndex=this.isDesignMode()?-1:0;const e=this.createPlaceholderOptionWhenValueDoesNotExist();Ht(this._selectElement,e);for(const n of this.choices){const r=document.createElement("option");r.value=n.value,n.title&&(r.text=n.title,r.setAttribute("aria-label",n.title)),r.tabIndex=this.isDesignMode()?-1:0,n.value===this.defaultValue&&(r.selected=!0),Ht(this._selectElement,r)}return this._selectElement.onchange=()=>{this.internalApplyAriaCurrent(),this.valueChanged()},this.internalApplyAriaCurrent(),this._selectElement}}}updateVisualState(e){this.allowRevealOnHoverStyle&&!this.isMultiSelect&&this.isCompact&&(super.updateVisualState(e),this._selectElement&&this.inputStyle===No.RevealOnHover&&(this.shouldHideInputAdornersForRevealOnHover(this._selectElement,e)?(this._selectElement.style.appearance="none",this._selectElement.classList.remove(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus"))):(this._selectElement.style.appearance="auto",this._selectElement.classList.add(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus")))))}getJsonTypeName(){return"Input.ChoiceSet"}focus(){this._toggleInputs&&(this.isMultiSelect||this.style==="expanded")?this._toggleInputs.length>0&&this._toggleInputs[0].focus():this._textInput?this._textInput.focus():super.focus()}internalValidateProperties(e){super.internalValidateProperties(e),this.choices.length===0&&e.addFailure(this,Ct.CollectionCantBeEmpty,tt.errors.choiceSetMustHaveAtLeastOneChoice());for(const n of this.choices)(!n.title||!n.value)&&e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.choiceSetChoicesMustHaveTitleAndValue())}isSet(){return!!this.value}isValid(){if(this._textInput){if(this.value===""||this.value===this.placeholder)return!0;for(const e of this.choices)if(this.value===e.value)return!0;if(this.dynamicChoices){for(const e of this.dynamicChoices)if(this.value===e)return!0}return!1}return super.isValid()}get value(){if(this.isMultiSelect){if(!this._toggleInputs||this._toggleInputs.length===0)return;let e="";for(const n of this._toggleInputs)n.checked&&(e!==""&&(e+=this.hostConfig.choiceSetInputValueSeparator),e+=n.value);return e||void 0}else{if(this._selectElement)return this._selectElement.selectedIndex>0?this._selectElement.value:void 0;if(this._textInput){for(const e of this.choices)if(e.title&&this._textInput.value===e.title)return e.value;return this._textInput.value}else if(this._toggleInputs&&this._toggleInputs.length>0){for(const e of this._toggleInputs)if(e.checked)return e.value}return}}get dynamicChoices(){var e;return(e=this._filteredChoiceSet)===null||e===void 0?void 0:e.dynamicChoices}}Ut.valueProperty=new ut(Ee.v1_0,"value");Ut.choicesProperty=new lc(Ee.v1_0,"choices",Wl);Ut.choicesDataProperty=new vd(Ee.v1_6,"choices.data",qi);Ut.styleProperty=new md(Ee.v1_0,"style",[{value:"compact"},{value:"expanded"},{value:"filtered",targetVersion:Ee.v1_5}],"compact");Ut.isMultiSelectProperty=new or(Ee.v1_0,"isMultiSelect",!1);Ut.placeholderProperty=new ut(Ee.v1_0,"placeholder");Ut.wrapProperty=new or(Ee.v1_2,"wrap",!1);Ut._uniqueCategoryCounter=0;Re([Ae(Ut.valueProperty)],Ut.prototype,"defaultValue",void 0);Re([Ae(Ut.styleProperty)],Ut.prototype,"style",void 0);Re([Ae(Ut.isMultiSelectProperty)],Ut.prototype,"isMultiSelect",void 0);Re([Ae(Ut.placeholderProperty)],Ut.prototype,"placeholder",void 0);Re([Ae(Ut.wrapProperty)],Ut.prototype,"wrap",void 0);Re([Ae(Ut.choicesProperty)],Ut.prototype,"choices",void 0);Re([Ae(Ut.choicesDataProperty)],Ut.prototype,"choicesData",void 0);class Mme{constructor(e,n,r){this._choiceSetId=e,this._choices=n,this._dynamicChoices=[],this._visibleChoiceCount=0,this._highlightedChoiceId=-1,this._hostConfig=r}render(){const e=document.createElement("div");e.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-filtered-container"),this._textInput=document.createElement("input"),this._textInput.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-filtered-textbox"),this._textInput.type="text",this._textInput.onkeydown=n=>{if(n.key==="ArrowDown")n.preventDefault(),this.highlightChoice(this._highlightedChoiceId+1);else if(n.key==="ArrowUp")n.preventDefault(),this.highlightChoice(this._highlightedChoiceId-1);else if(n.key==="Enter"){const r=document.getElementById(`ac-choiceSetInput-${this._choiceSetId}-choice-${this._highlightedChoiceId}`);r==null||r.click()}},this._dropdown=document.createElement("div"),this._dropdown.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-filtered-dropdown"),e.append(this._textInput,this._dropdown),this._renderedElement=e}createChoice(e,n,r){const i=document.createElement("span");i.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-choice"),i.id=`ac-choiceSetInput-${this._choiceSetId}-choice-${r}`;const o=e.indexOf(n);if(o===-1){const s=document.createElement("span");s.innerText=e,i.appendChild(s)}else{if(o>0){const l=e.substring(0,o),c=document.createElement("span");c.innerText=l,i.appendChild(c)}const s=document.createElement("span");if(s.innerText=n,s.style.fontWeight="bold",i.appendChild(s),o+n.length<e.length){const l=e.substring(o+n.length),c=document.createElement("span");c.innerText=l,i.appendChild(c)}}return i.tabIndex=-1,i.onclick=()=>{i.classList.remove(this.hostConfig.makeCssClassName("ac-choiceSetInput-choice-highlighted")),this._highlightedChoiceId=-1,this._textInput&&(this._textInput.value=i.innerText,this._textInput.focus()),this._dropdown&&this._dropdown.classList.remove(this.hostConfig.makeCssClassName("ac-choiceSetInput-filtered-dropdown-open"))},i.onmousemove=()=>{this._highlightedChoiceId!==r&&this.highlightChoice(r,!1)},i}highlightChoice(e,n=!0){if(this._visibleChoiceCount>0){const r=document.getElementById(`ac-choiceSetInput-${this._choiceSetId}-choice-${this._highlightedChoiceId}`),i=document.getElementById(`ac-choiceSetInput-${this._choiceSetId}-choice-${e}`);i?(r==null||r.classList.remove(this.hostConfig.makeCssClassName("ac-choiceSetInput-choice-highlighted")),i.classList.add(this.hostConfig.makeCssClassName("ac-choiceSetInput-choice-highlighted")),n&&i.scrollIntoView(),this._highlightedChoiceId=e):r&&this._highlightedChoiceId!==0?this.highlightChoice(0):this.highlightChoice(this._visibleChoiceCount-1)}}filterChoices(){var e,n;const r=((e=this._textInput)===null||e===void 0?void 0:e.value.toLowerCase().trim())||"",i=[...this._choices,...this._dynamicChoices];for(const o of i)if(o.title){const s=o.title.toLowerCase().indexOf(r);if(s!==-1){const l=o.title.substring(s,s+r.length),c=this.createChoice(o.title,l,this._visibleChoiceCount++);(n=this._dropdown)===null||n===void 0||n.appendChild(c)}}}getStatusIndicator(e){if(e){if(!this._errorIndicator){const n=document.createElement("div");n.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-statusIndicator","ac-choiceSetInput-errorIndicator"),this._errorIndicator=n}return this._errorIndicator.innerText=e,this._errorIndicator}else{if(!this._loadingIndicator){const n=document.createElement("div");n.className=this.hostConfig.makeCssClassName("ac-input","ac-choiceSetInput-statusIndicator"),this._loadingIndicator=n}return this._loadingIndicator.innerText=this._visibleChoiceCount===0?"Loading...":"Loading more...",this._loadingIndicator}}resetDropdown(){this._dropdown&&(ume(this._dropdown),this._visibleChoiceCount=0,this._highlightedChoiceId=-1)}showDropdown(){var e;!((e=this._dropdown)===null||e===void 0)&&e.hasChildNodes()&&this._dropdown.classList.add(this.hostConfig.makeCssClassName("ac-choiceSetInput-filtered-dropdown-open"))}processChoices(){this.resetDropdown(),this.filterChoices(),this.showDropdown()}processResponse(e,n){var r;e===((r=this._textInput)===null||r===void 0?void 0:r.value)&&(this.resetDropdown(),this._dynamicChoices=n,this.filterChoices(),this._visibleChoiceCount===0&&this.showErrorIndicator(e,"No results found"))}showLoadingIndicator(){var e;const n=this.getStatusIndicator();(e=this._dropdown)===null||e===void 0||e.appendChild(n),this.showDropdown()}removeLoadingIndicator(){var e,n;this._loadingIndicator&&(!((e=this._dropdown)===null||e===void 0)&&e.contains(this._loadingIndicator))&&((n=this._dropdown)===null||n===void 0||n.removeChild(this._loadingIndicator))}showErrorIndicator(e,n){var r,i;if(e===((r=this._textInput)===null||r===void 0?void 0:r.value)){this.processChoices();const o=this.getStatusIndicator(n);(i=this._dropdown)===null||i===void 0||i.appendChild(o),o.scrollIntoView()}}get dynamicChoices(){var e;return(e=this._dynamicChoices)===null||e===void 0?void 0:e.map(n=>n.title)}get hostConfig(){return this._hostConfig?this._hostConfig:this.parent?this.parent.hostConfig:yd}set parent(e){this._parent=e}get parent(){return this._parent}get renderedElement(){return this._renderedElement}get textInput(){return this._textInput}get dropdown(){return this._dropdown}}class ji extends hn{internalRender(){return this._numberInputElement=document.createElement("input"),this._numberInputElement.setAttribute("type","number"),this.min!==void 0&&this._numberInputElement.setAttribute("min",this.min.toString()),this.max!==void 0&&this._numberInputElement.setAttribute("max",this.max.toString()),this._numberInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-numberInput"),this._numberInputElement.style.width="100%",this._numberInputElement.tabIndex=this.isDesignMode()?-1:0,this.defaultValue!==void 0&&(this._numberInputElement.valueAsNumber=this.defaultValue),this.placeholder&&(this._numberInputElement.placeholder=this.placeholder,this._numberInputElement.setAttribute("aria-label",this.placeholder)),this._numberInputElement.oninput=()=>{this.valueChanged()},this._numberInputElement}getJsonTypeName(){return"Input.Number"}isSet(){return this.value!==void 0&&!isNaN(this.value)}isValid(){if(this.value===void 0)return!this.isRequired;let e=!0;return this.min!==void 0&&(e=e&&this.value>=this.min),this.max!==void 0&&(e=e&&this.value<=this.max),e}get value(){return this._numberInputElement?this._numberInputElement.valueAsNumber:void 0}set value(e){e&&this._numberInputElement&&(this._numberInputElement.value=e.toString())}}ji.valueProperty=new fs(Ee.v1_0,"value");ji.placeholderProperty=new ut(Ee.v1_0,"placeholder");ji.minProperty=new fs(Ee.v1_0,"min");ji.maxProperty=new fs(Ee.v1_0,"max");Re([Ae(ji.valueProperty)],ji.prototype,"defaultValue",void 0);Re([Ae(ji.minProperty)],ji.prototype,"min",void 0);Re([Ae(ji.maxProperty)],ji.prototype,"max",void 0);Re([Ae(ji.placeholderProperty)],ji.prototype,"placeholder",void 0);class Vi extends hn{internalRender(){return this._dateInputElement=document.createElement("input"),this._dateInputElement.setAttribute("type","date"),this.min&&this._dateInputElement.setAttribute("min",this.min),this.max&&this._dateInputElement.setAttribute("max",this.max),this.placeholder&&(this._dateInputElement.placeholder=this.placeholder,this._dateInputElement.setAttribute("aria-label",this.placeholder)),this._dateInputElement.tabIndex=this.isDesignMode()?-1:0,this._dateInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-dateInput"),this._dateInputElement.style.width="100%",this._dateInputElement.oninput=()=>{this.valueChanged()},this.defaultValue&&(this._dateInputElement.value=this.defaultValue),this._dateInputElement}updateVisualState(e){if(this.allowRevealOnHoverStyle&&(super.updateVisualState(e),this._dateInputElement&&this.inputStyle===No.RevealOnHover)){const n=this.shouldHideInputAdornersForRevealOnHover(this._dateInputElement,e);n?this._dateInputElement.classList.remove(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus")):this._dateInputElement.classList.add(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus")),bH(this._dateInputElement,n)}}getJsonTypeName(){return"Input.Date"}isSet(){return!!this.value}isValid(){if(!this.value)return!this.isRequired;const e=new Date(this.value);let n=!0;if(this.min){const r=new Date(this.min);n=n&&e>=r}if(this.max){const r=new Date(this.max);n=n&&e<=r}return n}get value(){return this._dateInputElement?this._dateInputElement.value:void 0}}Vi.valueProperty=new ut(Ee.v1_0,"value");Vi.placeholderProperty=new ut(Ee.v1_0,"placeholder");Vi.minProperty=new ut(Ee.v1_0,"min");Vi.maxProperty=new ut(Ee.v1_0,"max");Re([Ae(Vi.valueProperty)],Vi.prototype,"defaultValue",void 0);Re([Ae(Vi.minProperty)],Vi.prototype,"min",void 0);Re([Ae(Vi.maxProperty)],Vi.prototype,"max",void 0);Re([Ae(Vi.placeholderProperty)],Vi.prototype,"placeholder",void 0);class QA extends cc{constructor(e,n){super(e,n,(r,i,o,s)=>{const l=o[i.name];if(typeof l=="string"&&l&&/^[0-9]{2}:[0-9]{2}$/.test(l))return l},(r,i,o,s,l)=>{l.serializeValue(o,i.name,s)}),this.targetVersion=e,this.name=n}}class Dr extends hn{static convertTimeStringToDate(e){return new Date("1973-09-04T"+e+":00Z")}internalRender(){return this._timeInputElement=document.createElement("input"),this._timeInputElement.setAttribute("type","time"),this.min&&this._timeInputElement.setAttribute("min",this.min),this.max&&this._timeInputElement.setAttribute("max",this.max),this._timeInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-timeInput"),this._timeInputElement.style.width="100%",this._timeInputElement.oninput=()=>{this.valueChanged()},this.placeholder&&(this._timeInputElement.placeholder=this.placeholder,this._timeInputElement.setAttribute("aria-label",this.placeholder)),this._timeInputElement.tabIndex=this.isDesignMode()?-1:0,this.defaultValue&&(this._timeInputElement.value=this.defaultValue),this._timeInputElement}updateVisualState(e){if(this.allowRevealOnHoverStyle&&(super.updateVisualState(e),this._timeInputElement&&this.inputStyle===No.RevealOnHover)){const n=this.shouldHideInputAdornersForRevealOnHover(this._timeInputElement,e);n?this._timeInputElement.classList.remove(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus")):this._timeInputElement.classList.add(this.hostConfig.makeCssClassName("ac-inputStyle-revealOnHover-onfocus")),bH(this._timeInputElement,n)}}getJsonTypeName(){return"Input.Time"}isSet(){return!!this.value}isValid(){if(!this.value)return!this.isRequired;const e=Dr.convertTimeStringToDate(this.value);let n=!0;if(this.min){const r=Dr.convertTimeStringToDate(this.min);n=n&&e>=r}if(this.max){const r=Dr.convertTimeStringToDate(this.max);n=n&&e<=r}return n}get value(){return this._timeInputElement?this._timeInputElement.value:void 0}}Dr.valueProperty=new QA(Ee.v1_0,"value");Dr.placeholderProperty=new ut(Ee.v1_0,"placeholder");Dr.minProperty=new QA(Ee.v1_0,"min");Dr.maxProperty=new QA(Ee.v1_0,"max");Re([Ae(Dr.valueProperty)],Dr.prototype,"defaultValue",void 0);Re([Ae(Dr.minProperty)],Dr.prototype,"min",void 0);Re([Ae(Dr.maxProperty)],Dr.prototype,"max",void 0);Re([Ae(Dr.placeholderProperty)],Dr.prototype,"placeholder",void 0);class Vt extends qo{constructor(){super(...arguments),this.style=Li.Default,this.mode=Ml.Primary,this._state=0,this._isFocusable=!0}renderButtonContent(){if(this.renderedElement){const e=this.hostConfig,n=document.createElement("div");if(n.style.overflow="hidden",n.style.textOverflow="ellipsis",e.actions.iconPlacement===xl.AboveTitle||e.actions.allowTitleToWrap||(n.style.whiteSpace="nowrap"),this.title&&(n.innerText=this.title),!this.iconUrl)this.renderedElement.classList.add("noIcon"),this.renderedElement.appendChild(n);else{const r=document.createElement("img");r.src=this.iconUrl,r.style.width=e.actions.iconSize+"px",r.style.height=e.actions.iconSize+"px",r.style.flex="0 0 auto",r.setAttribute("role","presentation"),e.actions.iconPlacement===xl.AboveTitle?(this.renderedElement.classList.add("iconAbove"),this.renderedElement.style.flexDirection="column",this.title&&(r.style.marginBottom="6px")):(this.renderedElement.classList.add("iconLeft"),r.style.maxHeight="100%",this.title&&(r.style.marginRight="6px")),this.renderedElement.appendChild(r),this.renderedElement.appendChild(n)}}}getParentContainer(){return this.parent instanceof Lr?this.parent:this.parent?this.parent.getParentContainer():void 0}isDesignMode(){const e=this.getRootObject();return e instanceof At&&e.isDesignMode()}updateCssClasses(){if(this.parent&&this.renderedElement){const e=this.parent.hostConfig;this.renderedElement.className=e.makeCssClassName(this.isEffectivelyEnabled()?"ac-pushButton":"ac-pushButton-disabled");const n=this.getParentContainer();if(n){const r=n.getEffectiveStyle();r&&this.renderedElement.classList.add("style-"+r)}switch(this.renderedElement.tabIndex=!this.isDesignMode()&&this.isFocusable?0:-1,this._state){case 0:break;case 1:this.renderedElement.classList.add(e.makeCssClassName("expanded"));break;case 2:this.renderedElement.classList.add(e.makeCssClassName("subdued"));break}this.style&&this.isEffectivelyEnabled()&&(this.style===Li.Positive?this.renderedElement.classList.add(...e.makeCssClassNames("primary","style-positive")):this.renderedElement.classList.add(...e.makeCssClassNames("style-"+this.style.toLowerCase())))}}getDefaultSerializationContext(){return new pf}internalGetReferencedInputs(){return{}}internalPrepareForExecution(e){}internalValidateInputs(e){const n=[];if(e)for(const r of Object.keys(e)){const i=e[r];i.validateValue()||n.push(i)}return n}shouldSerialize(e){return e.actionRegistry.findByName(this.getJsonTypeName())!==void 0}raiseExecuteActionEvent(){this.onExecute&&this.onExecute(this),Nme(this)}internalAfterExecute(){let e=this.getRootObject();e instanceof At&&e.updateActionsEnabledState()}getHref(){return""}getAriaRole(){let e=this.getAriaRoleFromEnum();return e??"button"}getAriaRoleFromEnum(){switch(this.role){case ma.Button:return"button";case ma.Link:return"link";case ma.Menu:return"menu";case ma.MenuItem:return"menuitem";case ma.Tab:return"tab";default:return}}setupElementForAccessibility(e,n=!1){e.tabIndex=this.isEffectivelyEnabled()&&!this.isDesignMode()?0:-1,e.setAttribute("role",this.getAriaRole()),e instanceof HTMLButtonElement&&(e.disabled=!this.isEffectivelyEnabled()),this.isEffectivelyEnabled()?(e.removeAttribute("aria-disabled"),e.classList.add(this.hostConfig.makeCssClassName("ac-selectable"))):e.setAttribute("aria-disabled","true"),this.title?(e.setAttribute("aria-label",this.title),e.title=this.title):(e.removeAttribute("aria-label"),e.removeAttribute("title")),this.tooltip&&(n&&!this.title&&e.setAttribute("aria-label",this.tooltip),e.title=this.tooltip)}parse(e,n){return super.parse(e,n||new pf)}render(){const e=document.createElement("button");e.type="button",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.onclick=n=>{this.isEffectivelyEnabled()&&(n.preventDefault(),n.cancelBubble=!0,this.execute())},this._renderedElement=e,this.renderButtonContent(),this.updateCssClasses(),this.setupElementForAccessibility(e)}execute(){this._actionCollection&&this._actionCollection.actionExecuted(this),this.raiseExecuteActionEvent(),this.internalAfterExecute()}prepareForExecution(){const e=this.getReferencedInputs(),n=this.internalValidateInputs(e);return n.length>0?(n[0].focus(),!1):(this.internalPrepareForExecution(e),!0)}remove(){return this._actionCollection?this._actionCollection.removeAction(this):!1}getAllInputs(e=!0){return[]}getAllActions(){return[this]}getResourceInformation(){return this.iconUrl?[{url:this.iconUrl,mimeType:"image"}]:[]}getActionById(e){return this.id===e?this:void 0}getReferencedInputs(){return this.internalGetReferencedInputs()}validateInputs(){return this.internalValidateInputs(this.getReferencedInputs())}updateEnabledState(){}isEffectivelyEnabled(){return this.isEnabled}get isPrimary(){return this.style===Li.Positive}set isPrimary(e){e?this.style=Li.Positive:this.style===Li.Positive&&(this.style=Li.Default)}get hostConfig(){return this.parent?this.parent.hostConfig:yd}get parent(){return this._parent}get state(){return this._state}set state(e){this._state!==e&&(this._state=e,this.updateCssClasses())}get isFocusable(){return this._isFocusable}set isFocusable(e){this._isFocusable!==e&&(this._isFocusable=e,this.updateCssClasses())}}Vt.titleProperty=new ut(Ee.v1_0,"title");Vt.iconUrlProperty=new ut(Ee.v1_1,"iconUrl");Vt.styleProperty=new md(Ee.v1_2,"style",[{value:Li.Default},{value:Li.Positive},{value:Li.Destructive}],Li.Default);Vt.modeProperty=new md(Ee.v1_5,"mode",[{value:Ml.Primary},{value:Ml.Secondary}],Ml.Primary);Vt.tooltipProperty=new ut(Ee.v1_5,"tooltip");Vt.isEnabledProperty=new or(Ee.v1_5,"isEnabled",!0);Vt.roleProperty=new sr(Ee.v1_6,"role",ma);Re([Ae(Vt.titleProperty)],Vt.prototype,"title",void 0);Re([Ae(Vt.iconUrlProperty)],Vt.prototype,"iconUrl",void 0);Re([Ae(Vt.styleProperty)],Vt.prototype,"style",void 0);Re([Ae(Vt.modeProperty)],Vt.prototype,"mode",void 0);Re([Ae(Vt.tooltipProperty)],Vt.prototype,"tooltip",void 0);Re([Ae(Vt.isEnabledProperty)],Vt.prototype,"isEnabled",void 0);Re([Ae(Vt.roleProperty)],Vt.prototype,"role",void 0);class jo extends Vt{constructor(){super(...arguments),this.disabledUnlessAssociatedInputsChange=!1,this._isPrepared=!1,this._areReferencedInputsDirty=!1}internalGetReferencedInputs(){const e={};if(this.associatedInputs!=="none"){let n=this.parent,r=[];for(;n;)r.push(...n.getAllInputs(!1)),n=n.parent;for(const i of r)i.id&&(e[i.id]=i)}return e}internalPrepareForExecution(e){if(this._originalData?this._processedData=JSON.parse(JSON.stringify(this._originalData)):this._processedData={},this._processedData&&e)for(const n of Object.keys(e)){const r=e[n];r.id&&r.isSet()&&(this._processedData[r.id]=typeof r.value=="string"?r.value:r.value.toString())}this._isPrepared=!0}internalAfterExecute(){yt.resetInputsDirtyStateAfterActionExecution&&this.resetReferencedInputsDirtyState()}resetReferencedInputsDirtyState(){let e=this.getReferencedInputs();if(this._areReferencedInputsDirty=!1,e)for(const n of Object.keys(e))e[n].resetDirtyState()}updateEnabledState(){this._areReferencedInputsDirty=!1;let e=this.getReferencedInputs();if(e){for(const n of Object.keys(e))if(e[n].isDirty()){this._areReferencedInputsDirty=!0;break}}this.updateCssClasses(),this._renderedElement&&this.setupElementForAccessibility(this._renderedElement)}isEffectivelyEnabled(){let e=super.isEffectivelyEnabled();return this.disabledUnlessAssociatedInputsChange?e&&this._areReferencedInputsDirty:e}get data(){return this._isPrepared?this._processedData:this._originalData}set data(e){this._originalData=e,this._isPrepared=!1}}jo.dataProperty=new Vn(Ee.v1_0,"data");jo.associatedInputsProperty=new cc(Ee.v1_3,"associatedInputs",(t,e,n,r)=>{const i=n[e.name];if(i!==void 0&&typeof i=="string")return i.toLowerCase()==="none"?"none":"auto"},(t,e,n,r,i)=>{i.serializeValue(n,e.name,r)});jo.disabledUnlessAssociatedInputsChangeProperty=new or(Ee.v1_6,"disabledUnlessAssociatedInputsChange",!1);Re([Ae(jo.dataProperty)],jo.prototype,"_originalData",void 0);Re([Ae(jo.associatedInputsProperty)],jo.prototype,"associatedInputs",void 0);Re([Ae(jo.disabledUnlessAssociatedInputsChangeProperty)],jo.prototype,"disabledUnlessAssociatedInputsChange",void 0);class Hu extends jo{getJsonTypeName(){return Hu.JsonTypeName}}Hu.JsonTypeName="Action.Submit";class TH extends jo{}class Bs extends TH{getJsonTypeName(){return Bs.JsonTypeName}}Bs.JsonTypeName="Action.Execute";Bs.verbProperty=new ut(Ee.v1_4,"verb");Re([Ae(Bs.verbProperty)],Bs.prototype,"verb",void 0);class di extends TH{getJsonTypeName(){return di.JsonTypeName}get isStandalone(){return!1}}di.JsonTypeName="Data.Query";di.datasetProperty=new ut(Ee.v1_6,"dataset");di.filterProperty=new ut(Ee.v1_6,"filter");di.countProperty=new fs(Ee.v1_6,"count");di.skipProperty=new fs(Ee.v1_6,"skip");Re([Ae(di.datasetProperty)],di.prototype,"dataset",void 0);Re([Ae(di.filterProperty)],di.prototype,"filter",void 0);Re([Ae(di.countProperty)],di.prototype,"count",void 0);Re([Ae(di.skipProperty)],di.prototype,"skip",void 0);class Ja extends Vt{getJsonTypeName(){return Ja.JsonTypeName}getAriaRole(){let e=this.getAriaRoleFromEnum();return e??"link"}internalValidateProperties(e){super.internalValidateProperties(e),this.url||e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.propertyMustBeSet("url"))}getHref(){return this.url}}Ja.urlProperty=new ut(Ee.v1_0,"url");Ja.JsonTypeName="Action.OpenUrl";Re([Ae(Ja.urlProperty)],Ja.prototype,"url",void 0);class Qa extends Vt{constructor(){super(...arguments),this.targetElements={}}updateAriaControlsAttribute(){if(this.targetElements){const e=Object.keys(this.targetElements);this._renderedElement&&(e.length>0?this._renderedElement.setAttribute("aria-controls",e.join(" ")):this._renderedElement.removeAttribute("aria-controls"))}}internalValidateProperties(e){super.internalValidateProperties(e),this.targetElements||e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.propertyMustBeSet("targetElements"))}getJsonTypeName(){return Qa.JsonTypeName}render(){super.render(),this.updateAriaControlsAttribute()}execute(){if(super.execute(),this.parent)for(const e of Object.keys(this.targetElements)){const n=this.parent.getRootElement().getElementById(e);n&&(typeof this.targetElements[e]=="boolean"?n.isVisible=this.targetElements[e]:n.isVisible=!n.isVisible)}}addTargetElement(e,n=void 0){this.targetElements[e]=n,this.updateAriaControlsAttribute()}removeTargetElement(e){delete this.targetElements[e],this.updateAriaControlsAttribute()}}Qa.targetElementsProperty=new cc(Ee.v1_2,"targetElements",(t,e,n,r)=>{const i={};if(Array.isArray(n[e.name])){for(const o of n[e.name])if(typeof o=="string")i[o]=void 0;else if(typeof o=="object"){const s=o.elementId;typeof s=="string"&&(i[s]=WA(o.isVisible))}}return i},(t,e,n,r,i)=>{const o=[];for(const s of Object.keys(r))typeof r[s]=="boolean"?o.push({elementId:s,isVisible:r[s]}):o.push(s);i.serializeArray(n,e.name,o)},{},t=>({}));Qa.JsonTypeName="Action.ToggleVisibility";Re([Ae(Qa.targetElementsProperty)],Qa.prototype,"targetElements",void 0);class XA extends Vn{parse(e,n,r){const i=new bN;return i.set(zA(n[this.name])),i}toJSON(e,n,r,i){i.serializeValue(n,this.name,r.getOriginal())}constructor(e,n){super(e,n,void 0,()=>new bN),this.targetVersion=e,this.name=n}}class Kl extends On{getSchemaKey(){return"HttpHeader"}constructor(e="",n=""){super(),this.name=e,this.value=n}getReferencedInputs(e,n){this._value.getReferencedInputs(e,n)}prepareForExecution(e){this._value.substituteInputValues(e,hf.applicationXWwwFormUrlencoded)}get value(){return this._value.get()}set value(e){this._value.set(e)}}Kl.nameProperty=new ut(Ee.v1_0,"name");Kl.valueProperty=new XA(Ee.v1_0,"value");Re([Ae(Kl.nameProperty)],Kl.prototype,"name",void 0);Re([Ae(Kl.valueProperty)],Kl.prototype,"_value",void 0);class Cr extends Vt{constructor(){super(...arguments),this._ignoreInputValidation=!1}internalGetReferencedInputs(){const e=this.parent?this.parent.getRootElement().getAllInputs():[],n={};this._url.getReferencedInputs(e,n);for(const r of this.headers)r.getReferencedInputs(e,n);return this._body.getReferencedInputs(e,n),n}internalPrepareForExecution(e){if(e){this._url.substituteInputValues(e,hf.applicationXWwwFormUrlencoded);let n=hf.applicationJson;for(const r of this.headers)r.prepareForExecution(e),r.name&&r.name.toLowerCase()==="content-type"&&(n=r.value);this._body.substituteInputValues(e,n)}}getJsonTypeName(){return Cr.JsonTypeName}internalValidateProperties(e){if(super.internalValidateProperties(e),this.url||e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.propertyMustBeSet("url")),this.headers.length>0)for(const n of this.headers)n.name||e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.actionHttpHeadersMustHaveNameAndValue())}get ignoreInputValidation(){return this._ignoreInputValidation}set ignoreInputValidation(e){this._ignoreInputValidation=e}get url(){return this._url.get()}set url(e){this._url.set(e)}get body(){return this._body.get()}set body(e){this._body.set(e)}}Cr.urlProperty=new XA(Ee.v1_0,"url");Cr.bodyProperty=new XA(Ee.v1_0,"body");Cr.methodProperty=new ut(Ee.v1_0,"method");Cr.headersProperty=new lc(Ee.v1_0,"headers",Kl);Cr.ignoreInputValidationProperty=new or(Ee.v1_3,"ignoreInputValidation",!1);Cr.JsonTypeName="Action.Http";Re([Ae(Cr.urlProperty)],Cr.prototype,"_url",void 0);Re([Ae(Cr.bodyProperty)],Cr.prototype,"_body",void 0);Re([Ae(Cr.methodProperty)],Cr.prototype,"method",void 0);Re([Ae(Cr.headersProperty)],Cr.prototype,"headers",void 0);Re([Ae(Cr.ignoreInputValidationProperty)],Cr.prototype,"_ignoreInputValidation",void 0);class $s extends Vt{constructor(){super(...arguments),this.card=new Bme}updateCssClasses(){if(super.updateCssClasses(),this.renderedElement){const e=this.parent?this.parent.hostConfig:yd;this.renderedElement.classList.add(e.makeCssClassName("expandable")),this.renderedElement.setAttribute("aria-expanded",(this.state===1).toString())}}internalParse(e,n){super.internalParse(e,n);const r=e.card;r?this.card.parse(r,n):n.logParseEvent(this,Ct.PropertyCantBeNull,tt.errors.showCardMustHaveCard())}internalToJSON(e,n){super.internalToJSON(e,n),this.card&&n.serializeValue(e,"card",this.card.toJSON(n))}raiseExecuteActionEvent(){this.hostConfig.actions.showCard.actionMode===ks.Popup&&super.raiseExecuteActionEvent()}releaseDOMResources(){super.releaseDOMResources(),this.card.releaseDOMResources()}getJsonTypeName(){return $s.JsonTypeName}internalValidateProperties(e){super.internalValidateProperties(e),this.card.internalValidateProperties(e)}setParent(e){super.setParent(e),this.card.setParent(e)}getAllInputs(e=!0){return this.card.getAllInputs(e)}getAllActions(){const e=super.getAllActions();return e.push(...this.card.getAllActions()),e}getResourceInformation(){let e=super.getResourceInformation();return e.push(...this.card.getResourceInformation()),e}getActionById(e){let n=super.getActionById(e);return n||(n=this.card.getActionById(e)),n}}$s.JsonTypeName="Action.ShowCard";class EH extends Vt{constructor(e){super(),this._actions=e,this.title=tt.defaults.overflowButtonText(),this.tooltip=tt.defaults.overflowButtonTooltip()}getActions(){return this._actions}getAllActions(){const e=super.getAllActions();return e.push(...this._actions),e}getJsonTypeName(){return $s.JsonTypeName}execute(){var e;if(!Lme(this,this.renderedElement)&&this.renderedElement){const r=new bme;r.hostConfig=this.hostConfig;for(let i=0;i<this._actions.length;i++){const o=new Eme(i.toString(),(e=this._actions[i].title)!==null&&e!==void 0?e:"",this._actions[i].iconUrl);o.isEnabled=this._actions[i].isEnabled,o.onClick=()=>{const s=this._actions[i];r.closePopup(!1),s.isEnabled&&s.execute()},r.items.add(o)}r.onClose=()=>{var i,o;(i=this.renderedElement)===null||i===void 0||i.focus(),(o=this.renderedElement)===null||o===void 0||o.setAttribute("aria-expanded","false")},this.renderedElement.setAttribute("aria-expanded","true"),r.popup(this.renderedElement),r.selectedIndex=0}}setupElementForAccessibility(e,n=!1){super.setupElementForAccessibility(e,n),e.setAttribute("aria-label",tt.defaults.overflowButtonTooltip()),e.setAttribute("aria-expanded","false")}}EH.JsonTypeName="Action.Overflow";class wH{isActionAllowed(e){const n=this._owner.getForbiddenActionTypes();if(n){for(const r of n)if(e.constructor===r)return!1}return!0}refreshContainer(){if(Iv(this._actionCardContainer),!this._actionCard){this._actionCardContainer.style.marginTop="0px";return}this._actionCardContainer.style.marginTop=this.renderedActionCount>0?this._owner.hostConfig.actions.showCard.inlineTopMargin+"px":"0px";const e=this._owner.getEffectivePadding();this._owner.getImmediateSurroundingPadding(e);const n=this._owner.hostConfig.paddingDefinitionToSpacingDefinition(e);this._actionCard&&(this._actionCard.style.paddingLeft=n.left+"px",this._actionCard.style.paddingRight=n.right+"px",this._actionCard.style.marginLeft="-"+n.left+"px",this._actionCard.style.marginRight="-"+n.right+"px",n.bottom!==0&&!this._owner.isDesignMode()&&(this._actionCard.style.paddingBottom=n.bottom+"px",this._actionCard.style.marginBottom="-"+n.bottom+"px"),Ht(this._actionCardContainer,this._actionCard))}layoutChanged(){this._owner.getRootElement().updateLayout()}showActionCard(e,n=!1,r=!0){e.card.suppressStyle=n;const i=e.card.renderedElement&&!this._owner.isDesignMode()?e.card.renderedElement:e.card.render();this._actionCard=i,this._expandedAction=e,this.refreshContainer(),r&&(this.layoutChanged(),VN(e,!0))}collapseExpandedAction(){for(const n of this._renderedActions)n.state=0;const e=this._expandedAction;this._expandedAction=void 0,this._actionCard=void 0,this.refreshContainer(),e&&(this.layoutChanged(),VN(e,!1))}expandShowCardAction(e,n){let r=!1;for(const i of this._renderedActions)this._owner.hostConfig.actions.actionsOrientation==Dn.Horizontal&&r&&(i.isFocusable=!1),i!==e?i.state=2:(i.state=1,r=!0,i.renderedElement&&(i.renderedElement.onblur=o=>{for(const s of this._renderedActions)s.isFocusable=!0}));this.showActionCard(e,!(this._owner.isAtTheVeryLeft()&&this._owner.isAtTheVeryRight()),n)}constructor(e){this._items=[],this._renderedActions=[],this._owner=e}releaseDOMResources(){for(let e of this._renderedActions)e.releaseDOMResources()}actionExecuted(e){e instanceof $s?e===this._expandedAction?this.collapseExpandedAction():this._owner.hostConfig.actions.showCard.actionMode===ks.Inline&&this.expandShowCardAction(e,!0):this.collapseExpandedAction()}parse(e,n){if(this.clear(),Array.isArray(e))for(const r of e){let i=[];this._owner instanceof _H&&(i=this._owner.getForbiddenActionNames());const o=n.parseAction(this._owner,r,i,!this._owner.isDesignMode());o&&this.addAction(o)}}toJSON(e,n,r){r.serializeArray(e,n,this._items)}getActionAt(e){return this._items[e]}getActionCount(){return this._items.length}getActionById(e){let n;for(const r of this._items)if(n=r.getActionById(e),n)break;return n}validateProperties(e){this._owner.hostConfig.actions.maxActions&&this._items.length>this._owner.hostConfig.actions.maxActions&&e.addFailure(this._owner,Ct.TooManyActions,tt.errors.tooManyActions(this._owner.hostConfig.actions.maxActions)),this._items.length>0&&!this._owner.hostConfig.supportsInteractivity&&e.addFailure(this._owner,Ct.InteractivityNotAllowed,tt.errors.interactivityNotAllowed());for(const n of this._items)this.isActionAllowed(n)||e.addFailure(this._owner,Ct.ActionTypeNotAllowed,tt.errors.actionTypeNotAllowed(n.getJsonTypeName())),n.internalValidateProperties(e)}render(e){const n=this._owner.hostConfig;if(!n.supportsInteractivity)return;const r=document.createElement("div"),i=n.actions.maxActions?Math.min(n.actions.maxActions,this._items.length):this._items.length;if(this._actionCardContainer=document.createElement("div"),this._renderedActions=[],n.actions.preExpandSingleShowCardAction&&i===1&&this._items[0]instanceof $s&&this.isActionAllowed(this._items[0]))this.showActionCard(this._items[0],!0),this._renderedActions.push(this._items[0]);else{const o=document.createElement("div");if(o.className=n.makeCssClassName("ac-actionSet"),o.style.display="flex",e===Dn.Horizontal)if(o.style.flexDirection="row",this._owner.horizontalAlignment&&n.actions.actionAlignment!==ai.Stretch)switch(this._owner.horizontalAlignment){case Mn.Center:o.style.justifyContent="center";break;case Mn.Right:o.style.justifyContent="flex-end";break;default:o.style.justifyContent="flex-start";break}else switch(n.actions.actionAlignment){case ai.Center:o.style.justifyContent="center";break;case ai.Right:o.style.justifyContent="flex-end";break;default:o.style.justifyContent="flex-start";break}else if(o.style.flexDirection="column",this._owner.horizontalAlignment&&n.actions.actionAlignment!==ai.Stretch)switch(this._owner.horizontalAlignment){case Mn.Center:o.style.alignItems="center";break;case Mn.Right:o.style.alignItems="flex-end";break;default:o.style.alignItems="flex-start";break}else switch(n.actions.actionAlignment){case ai.Center:o.style.alignItems="center";break;case ai.Right:o.style.alignItems="flex-end";break;case ai.Stretch:o.style.alignItems="stretch";break;default:o.style.alignItems="flex-start";break}const s=this._items.filter(this.isActionAllowed.bind(this));let l=[];const c=[];if(this._owner.isDesignMode())l=s;else{s.forEach(f=>f.mode===Ml.Secondary?c.push(f):l.push(f));const u=l.splice(n.actions.maxActions);yt.allowMoreThanMaxActionsInOverflowMenu&&c.push(...u);let d=!0;if(c.length>0){this._overflowAction||(this._overflowAction=new EH(c),this._overflowAction.setParent(this._owner),this._overflowAction._actionCollection=this);const f=this._owner instanceof Tt&&!this._owner.parent;d=!Ume(this._overflowAction,f)}this._overflowAction&&d&&l.push(this._overflowAction)}for(let u=0;u<l.length;u++){const d=l[u];if(d.render(),d.renderedElement&&(n.actions.actionsOrientation===Dn.Horizontal&&n.actions.actionAlignment===ai.Stretch?d.renderedElement.style.flex="0 1 100%":d.renderedElement.style.flex="0 1 auto",o.appendChild(d.renderedElement),this._renderedActions.push(d),u<l.length-1&&n.actions.buttonSpacing>0)){const f=document.createElement("div");e===Dn.Horizontal?(f.style.flex="0 0 auto",f.style.width=n.actions.buttonSpacing+"px"):f.style.height=n.actions.buttonSpacing+"px",Ht(o,f)}}const a=document.createElement("div");a.style.overflow="hidden",a.appendChild(o),Ht(r,a)}Ht(r,this._actionCardContainer);for(const o of this._renderedActions)if(o.state===1){this.expandShowCardAction(o,!1);break}return this._renderedActions.length>0?r:void 0}addAction(e){if(!e)throw new Error("The action parameter cannot be null.");if((!e.parent||e.parent===this._owner)&&this._items.indexOf(e)<0)this._items.push(e),e.parent||e.setParent(this._owner),e._actionCollection=this;else throw new Error(tt.errors.actionAlreadyParented())}removeAction(e){this.expandedAction&&this._expandedAction===e&&this.collapseExpandedAction();const n=this._items.indexOf(e);if(n>=0){this._items.splice(n,1),e.setParent(void 0),e._actionCollection=void 0;for(let r=0;r<this._renderedActions.length;r++)if(this._renderedActions[r]===e){this._renderedActions.splice(r,1);break}return!0}return!1}clear(){this._items=[],this._renderedActions=[],this._expandedAction=void 0}getAllInputs(e=!0){let n=[];if(e)for(const r of this._items)n.push(...r.getAllInputs());return n}getResourceInformation(){let e=[];for(const n of this._items)e.push(...n.getResourceInformation());return e}get renderedActionCount(){return this._renderedActions.length}get expandedAction(){return this._expandedAction}}class Av extends At{internalParse(e,n){super.internalParse(e,n),this._actionCollection.parse(e.actions,n)}internalToJSON(e,n){super.internalToJSON(e,n),this._actionCollection.toJSON(e,"actions",n)}internalRender(){return this._actionCollection.render(this.orientation!==void 0?this.orientation:this.hostConfig.actions.actionsOrientation)}constructor(){super(),this._actionCollection=new wH(this)}releaseDOMResources(){super.releaseDOMResources(),this._actionCollection.releaseDOMResources()}isBleedingAtBottom(){return this._actionCollection.renderedActionCount===0?super.isBleedingAtBottom():this._actionCollection.getActionCount()===1?this._actionCollection.expandedAction!==void 0&&!this.hostConfig.actions.preExpandSingleShowCardAction:this._actionCollection.expandedAction!==void 0}getJsonTypeName(){return"ActionSet"}getActionCount(){return this._actionCollection.getActionCount()}getActionAt(e){return e>=0&&e<this.getActionCount()?this._actionCollection.getActionAt(e):super.getActionAt(e)}getActionById(e){const n=this._actionCollection.getActionById(e);return n||super.getActionById(e)}getAllActions(){const e=super.getAllActions();for(let n=0;n<this.getActionCount();n++){let r=this.getActionAt(n);r&&e.push(r)}return e}internalValidateProperties(e){super.internalValidateProperties(e),this._actionCollection.validateProperties(e)}addAction(e){this._actionCollection.addAction(e)}getAllInputs(e=!0){return e?this._actionCollection.getAllInputs():[]}getResourceInformation(){return this._actionCollection.getResourceInformation()}findDOMNodeOwner(e){let n;for(let r=0;r<this.getActionCount();r++){const i=this.getActionAt(r);if(i&&(n=i.findDOMNodeOwner(e),n))return n}return super.findDOMNodeOwner(e)}getElementById(e){let n=super.getElementById(e);return n||(n=this.getElementByIdFromAction(e)),n}get isInteractive(){return!0}}Av.orientationProperty=new sr(Ee.v1_1,"orientation",Dn);Re([Ae(Av.orientationProperty)],Av.prototype,"orientation",void 0);class Dme extends md{constructor(e,n,r,i){super(e,n,[{value:_t.Default},{value:_t.Emphasis},{targetVersion:Ee.v1_2,value:_t.Accent},{targetVersion:Ee.v1_2,value:_t.Good},{targetVersion:Ee.v1_2,value:_t.Attention},{targetVersion:Ee.v1_2,value:_t.Warning}],r,i),this.targetVersion=e,this.name=n,this.defaultValue=r,this.onGetInitialValue=i}}class os extends Wa{get style(){if(this.allowCustomStyle){const e=this.getValue(os.styleProperty);if(e&&this.hostConfig.containerStyles.getStyleByName(e))return e}}set style(e){this.setValue(os.styleProperty,e)}get allowCustomStyle(){return!0}get hasExplicitStyle(){return this.getValue(os.styleProperty)!==void 0}applyBorder(){}applyBackground(){if(this.renderedElement){const e=this.hostConfig.containerStyles.getStyleByName(this.style,this.hostConfig.containerStyles.getStyleByName(this.defaultStyle));if(e.backgroundColor){const n=ac(e.backgroundColor);n&&(this.renderedElement.style.backgroundColor=n)}}}applyPadding(){if(super.applyPadding(),!this.renderedElement)return;let e=new VA;if(this.getEffectivePadding()&&(e=this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding())),this.renderedElement.style.paddingTop=e.top+"px",this.renderedElement.style.paddingRight=e.right+"px",this.renderedElement.style.paddingBottom=e.bottom+"px",this.renderedElement.style.paddingLeft=e.left+"px",this.isBleeding()){const n=new Vl;this.getImmediateSurroundingPadding(n);const r=this.hostConfig.paddingDefinitionToSpacingDefinition(n);this.renderedElement.style.marginRight="-"+r.right+"px",this.renderedElement.style.marginLeft="-"+r.left+"px",this.isDesignMode()||(this.renderedElement.style.marginTop="-"+r.top+"px",this.renderedElement.style.marginBottom="-"+r.bottom+"px"),this.separatorElement&&this.separatorOrientation===Dn.Horizontal&&(this.separatorElement.style.marginLeft="-"+r.left+"px",this.separatorElement.style.marginRight="-"+r.right+"px")}else this.renderedElement.style.marginRight="0",this.renderedElement.style.marginLeft="0",this.renderedElement.style.marginTop="0",this.renderedElement.style.marginBottom="0",this.separatorElement&&this.separatorOrientation===Dn.Horizontal&&(this.separatorElement.style.marginRight="0",this.separatorElement.style.marginLeft="0")}getHasBackground(e=!1){let n=this.parent;for(;n;){let r=!1;if(e?r=!1:r=n instanceof Lr?n.backgroundImage.isValid():!1,n instanceof os&&this.hasExplicitStyle&&(n.getEffectiveStyle()!==this.getEffectiveStyle()||r))return!0;n=n.parent}return!1}getDefaultPadding(){return this.getHasBackground()||this.getHasBorder()?new Vl(vt.Padding,vt.Padding,vt.Padding,vt.Padding):super.getDefaultPadding()}internalValidateProperties(e){super.internalValidateProperties(e);const n=this.getValue(os.styleProperty);n!==void 0&&(this.hostConfig.containerStyles.getStyleByName(n)||e.addFailure(this,Ct.InvalidPropertyValue,tt.errors.invalidPropertyValue(n,"style")))}render(){const e=super.render();return e&&this.getHasBackground()&&this.applyBackground(),this.applyBorder(),e}getEffectiveStyle(){const e=this.style;return e||super.getEffectiveStyle()}}os.styleProperty=new Dme(Ee.v1_0,"style");Re([Ae(os.styleProperty)],os.prototype,"style",null);class Xa extends os{constructor(){super(...arguments),this._bleed=!1}adjustRenderedElementSize(e){super.adjustRenderedElementSize(e),this.minPixelHeight&&(e.style.minHeight=this.minPixelHeight+"px")}getHasExpandedAction(){return!1}getBleed(){return this._bleed}setBleed(e){this._bleed=e}get renderedActionCount(){return 0}isBleeding(){return(this.getHasBackground()||this.hostConfig.alwaysAllowBleed)&&this.getBleed()}}Xa.bleedProperty=new or(Ee.v1_2,"bleed",!1);Xa.minHeightProperty=new hme(Ee.v1_2,"minHeight");Re([Ae(Xa.bleedProperty)],Xa.prototype,"_bleed",void 0);Re([Ae(Xa.minHeightProperty)],Xa.prototype,"minPixelHeight",void 0);class hi extends On{getSchemaKey(){return"BackgroundImage"}internalParse(e,n){if(typeof e=="string")this.resetDefaultValues(),this.url=e;else return super.internalParse(e,n)}apply(e){if(this.url&&e.renderedElement){switch(e.renderedElement.style.backgroundImage="url('"+e.preProcessPropertyValue(hi.urlProperty,this.url)+"')",this.fillMode){case Ta.Repeat:e.renderedElement.style.backgroundRepeat="repeat";break;case Ta.RepeatHorizontally:e.renderedElement.style.backgroundRepeat="repeat-x";break;case Ta.RepeatVertically:e.renderedElement.style.backgroundRepeat="repeat-y";break;case Ta.Cover:default:e.renderedElement.style.backgroundRepeat="no-repeat",e.renderedElement.style.backgroundSize="cover";break}switch(this.horizontalAlignment){case Mn.Left:break;case Mn.Center:e.renderedElement.style.backgroundPositionX="center";break;case Mn.Right:e.renderedElement.style.backgroundPositionX="right";break}switch(this.verticalAlignment){case $o.Top:break;case $o.Center:e.renderedElement.style.backgroundPositionY="center";break;case $o.Bottom:e.renderedElement.style.backgroundPositionY="bottom";break}}}isValid(){return!!this.url}}hi.urlProperty=new ut(Ee.v1_0,"url");hi.fillModeProperty=new sr(Ee.v1_2,"fillMode",Ta,Ta.Cover);hi.horizontalAlignmentProperty=new sr(Ee.v1_2,"horizontalAlignment",Mn,Mn.Left);hi.verticalAlignmentProperty=new sr(Ee.v1_2,"verticalAlignment",$o,$o.Top);Re([Ae(hi.urlProperty)],hi.prototype,"url",void 0);Re([Ae(hi.fillModeProperty)],hi.prototype,"fillMode",void 0);Re([Ae(hi.horizontalAlignmentProperty)],hi.prototype,"horizontalAlignment",void 0);Re([Ae(hi.verticalAlignmentProperty)],hi.prototype,"verticalAlignment",void 0);class Lr extends Xa{constructor(){super(...arguments),this._items=[],this._renderedItems=[]}get backgroundImage(){return this.getValue(Lr.backgroundImageProperty)}insertItemAt(e,n,r){if(!e.parent||r)if(e.isStandalone)n<0||n>=this._items.length?this._items.push(e):this._items.splice(n,0,e),e.setParent(this);else throw new Error(tt.errors.elementTypeNotStandalone(e.getJsonTypeName()));else throw new Error(tt.errors.elementAlreadyParented())}getItemsCollectionPropertyName(){return"items"}applyBackground(){this.backgroundImage.isValid()&&this.renderedElement&&this.backgroundImage.apply(this),super.applyBackground()}applyRTL(e){this.rtl!==void 0&&(e.dir=this.rtl?"rtl":"ltr")}internalRender(){this._renderedItems=[];const e=this.hostConfig,n=document.createElement("div");switch(this.applyRTL(n),n.classList.add(e.makeCssClassName("ac-container")),n.style.display="flex",n.style.flexDirection="column",yt.useAdvancedCardBottomTruncation&&(n.style.minHeight="-webkit-min-content"),this.getEffectiveVerticalContentAlignment()){case $o.Center:n.style.justifyContent="center";break;case $o.Bottom:n.style.justifyContent="flex-end";break;default:n.style.justifyContent="flex-start";break}if(this._items.length>0)for(const r of this._items){const i=this.isElementAllowed(r)?r.render():void 0;i&&(this._renderedItems.length>0&&r.separatorElement&&(r.separatorElement.style.flex="0 0 auto",Ht(n,r.separatorElement)),Ht(n,i),this._renderedItems.push(r))}else if(this.isDesignMode()){const r=this.createPlaceholderElement();r.style.width="100%",r.style.height="100%",n.appendChild(r)}return n}truncateOverflow(e){if(this.renderedElement){const n=this.renderedElement.offsetTop+e+1,r=i=>{const o=i.renderedElement;if(o)switch(cme(o,n)){case Ua.FullyInContainer:i.resetOverflow()&&r(i);break;case Ua.Overflowing:const l=n-o.offsetTop;i.handleOverflow(l);break;case Ua.FullyOutOfContainer:i.handleOverflow(0);break}};for(const i of this._items)r(i);return!0}return!1}undoOverflowTruncation(){for(const e of this._items)e.resetOverflow()}getHasBackground(e=!1){return(e?!1:this.backgroundImage.isValid())||super.getHasBackground(e)}internalParse(e,n){super.internalParse(e,n),this.clear(),this.setShouldFallback(!1);let r=e[this.getItemsCollectionPropertyName()];if(Array.isArray(r))for(const i of r){const o=n.parseElement(this,i,this.forbiddenChildElements(),!this.isDesignMode());o&&this.insertItemAt(o,-1,!0)}}internalToJSON(e,n){super.internalToJSON(e,n);const r=this.getItemsCollectionPropertyName();n.serializeArray(e,r,this._items)}get isSelectable(){return!0}getEffectivePadding(){return yt.removePaddingFromContainersWithBackgroundImage&&!this.getHasBackground(!0)?new Vl:super.getEffectivePadding()}getEffectiveVerticalContentAlignment(){if(this.verticalContentAlignment!==void 0)return this.verticalContentAlignment;const e=this.getParentContainer();return e?e.getEffectiveVerticalContentAlignment():$o.Top}getItemCount(){return this._items.length}getItemAt(e){return this._items[e]}getFirstVisibleRenderedItem(){if(this.renderedElement&&this._renderedItems&&this._renderedItems.length>0){for(const e of this._renderedItems)if(e.isVisible)return e}}getLastVisibleRenderedItem(){if(this.renderedElement&&this._renderedItems&&this._renderedItems.length>0){for(let e=this._renderedItems.length-1;e>=0;e--)if(this._renderedItems[e].isVisible)return this._renderedItems[e]}}getJsonTypeName(){return"Container"}isFirstElement(e){const n=this.isDesignMode();for(const r of this._items)if(r.isVisible||n)return r===e;return!1}isLastElement(e){const n=this.isDesignMode();for(let r=this._items.length-1;r>=0;r--)if(this._items[r].isVisible||n)return this._items[r]===e;return!1}isRtl(){if(this.rtl!==void 0)return this.rtl;{const e=this.getParentContainer();return e?e.isRtl():!1}}isBleedingAtTop(){const e=this.getFirstVisibleRenderedItem();return this.isBleeding()||(e?e.isBleedingAtTop():!1)}isBleedingAtBottom(){const e=this.getLastVisibleRenderedItem();return this.isBleeding()||(e?e.isBleedingAtBottom()&&e.getEffectiveStyle()===this.getEffectiveStyle():!1)}indexOf(e){return this._items.indexOf(e)}addItem(e){this.insertItemAt(e,-1,!1)}insertItemBefore(e,n){this.insertItemAt(e,this._items.indexOf(n),!1)}insertItemAfter(e,n){this.insertItemAt(e,this._items.indexOf(n)+1,!1)}removeItem(e){const n=this._items.indexOf(e);return n>=0?(this._items.splice(n,1),e.setParent(void 0),this.updateLayout(),!0):!1}clear(){this._items=[],this._renderedItems=[]}getResourceInformation(){const e=super.getResourceInformation();return this.backgroundImage.isValid()&&e.push({url:this.backgroundImage.url,mimeType:"image"}),e}getActionById(e){let n=super.getActionById(e);if(!n&&(this.selectAction&&(n=this.selectAction.getActionById(e)),!n)){for(const r of this._items)if(n=r.getActionById(e),n)break}return n}get padding(){return this.getPadding()}set padding(e){this.setPadding(e)}get selectAction(){return this._selectAction}set selectAction(e){this._selectAction=e}get bleed(){return this.getBleed()}set bleed(e){this.setBleed(e)}}Lr.backgroundImageProperty=new vd(Ee.v1_0,"backgroundImage",hi);Lr.verticalContentAlignmentProperty=new sr(Ee.v1_1,"verticalContentAlignment",$o);Lr.rtlProperty=new or(Ee.v1_0,"rtl");Re([Ae(Lr.backgroundImageProperty)],Lr.prototype,"backgroundImage",null);Re([Ae(Lr.verticalContentAlignmentProperty)],Lr.prototype,"verticalContentAlignment",void 0);Re([Ae(Lr.rtlProperty)],Lr.prototype,"rtl",void 0);class vu extends Lr{adjustRenderedElementSize(e){this.isDesignMode()?(e.style.minWidth="20px",e.style.minHeight=(this.minPixelHeight?Math.max(this.minPixelHeight,20):20)+"px"):(e.style.minWidth="0",this.minPixelHeight&&(e.style.minHeight=this.minPixelHeight+"px")),this.width==="auto"?e.style.flex="0 1 auto":this.width==="stretch"?e.style.flex="1 1 50px":this.width instanceof Oi&&(this.width.unit===Mr.Pixel?(e.style.flex="0 0 auto",e.style.width=this.width.physicalSize+"px"):e.style.flex="1 1 "+(this._computedWeight>0?this._computedWeight:this.width.physicalSize)+"%")}shouldSerialize(e){return!0}get separatorOrientation(){return Dn.Vertical}constructor(e="stretch"){super(),this.width="stretch",this._computedWeight=0,this.width=e}getJsonTypeName(){return"Column"}get hasVisibleSeparator(){return this.parent&&this.parent instanceof IH?this.separatorElement!==void 0&&!this.parent.isLeftMostElement(this):!1}get isStandalone(){return!1}}vu.widthProperty=new cc(Ee.v1_0,"width",(t,e,n,r)=>{let i=e.defaultValue;const o=n[e.name];let s=!1;if(typeof o=="number"&&!isNaN(o))i=new Oi(o,Mr.Weight);else if(o==="auto"||o==="stretch")i=o;else if(typeof o=="string")try{i=Oi.parse(o),i.unit===Mr.Pixel&&e.targetVersion.compareTo(r.targetVersion)>0&&(s=!0)}catch{s=!0}else s=!0;return s&&(r.logParseEvent(t,Ct.InvalidPropertyValue,tt.errors.invalidColumnWidth(o)),i="auto"),i},(t,e,n,r,i)=>{r instanceof Oi?r.unit===Mr.Pixel?i.serializeValue(n,"width",r.physicalSize+"px"):i.serializeNumber(n,"width",r.physicalSize):i.serializeValue(n,"width",r)},"stretch");Re([Ae(vu.widthProperty)],vu.prototype,"width",void 0);class IH extends Xa{constructor(){super(...arguments),this._columns=[]}createColumnInstance(e,n){return n.parseCardObject(this,e,[],!this.isDesignMode(),r=>!r||r==="Column"?new vu:void 0,(r,i)=>{n.logParseEvent(void 0,Ct.ElementTypeNotAllowed,tt.errors.elementTypeNotAllowed(r))})}internalRender(){if(this._renderedColumns=[],this._columns.length>0){const e=this.hostConfig,n=document.createElement("div");switch(n.className=e.makeCssClassName("ac-columnSet"),n.style.display="flex",yt.useAdvancedCardBottomTruncation&&(n.style.minHeight="-webkit-min-content"),this.getEffectiveHorizontalAlignment()){case Mn.Center:n.style.justifyContent="center";break;case Mn.Right:n.style.justifyContent="flex-end";break;default:n.style.justifyContent="flex-start";break}let r=0;for(const i of this._columns)i.width instanceof Oi&&i.width.unit===Mr.Weight&&(r+=i.width.physicalSize);for(const i of this._columns){if(i.width instanceof Oi&&i.width.unit===Mr.Weight&&r>0){const s=100/r*i.width.physicalSize;i._computedWeight=s}const o=i.render();o&&(this._renderedColumns.length>0&&i.separatorElement&&(i.separatorElement.style.flex="0 0 auto",Ht(n,i.separatorElement)),Ht(n,o),this._renderedColumns.push(i))}return this._renderedColumns.length>0?n:void 0}else return}truncateOverflow(e){for(const n of this._columns)n.handleOverflow(e);return!0}undoOverflowTruncation(){for(const e of this._columns)e.resetOverflow()}get isSelectable(){return!0}internalParse(e,n){super.internalParse(e,n),this._columns=[],this._renderedColumns=[];const r=e.columns;if(Array.isArray(r))for(const i of r){const o=this.createColumnInstance(i,n);o&&this._columns.push(o)}}internalToJSON(e,n){super.internalToJSON(e,n),n.serializeArray(e,"columns",this._columns)}isFirstElement(e){for(const n of this._columns)if(n.isVisible)return n===e;return!1}isBleedingAtTop(){if(this.isBleeding())return!0;if(this._renderedColumns&&this._renderedColumns.length>0){for(const e of this._columns)if(e.isBleedingAtTop())return!0}return!1}isBleedingAtBottom(){if(this.isBleeding())return!0;if(this._renderedColumns&&this._renderedColumns.length>0){for(const e of this._columns)if(e.isBleedingAtBottom())return!0}return!1}getItemCount(){return this._columns.length}getFirstVisibleRenderedItem(){if(this.renderedElement&&this._renderedColumns&&this._renderedColumns.length>0)return this._renderedColumns[0]}getLastVisibleRenderedItem(){if(this.renderedElement&&this._renderedColumns&&this._renderedColumns.length>0)return this._renderedColumns[this._renderedColumns.length-1]}getColumnAt(e){return this._columns[e]}getItemAt(e){return this.getColumnAt(e)}getJsonTypeName(){return"ColumnSet"}internalValidateProperties(e){super.internalValidateProperties(e);let n=0,r=0;for(const i of this._columns)typeof i.width=="number"?n++:i.width==="stretch"&&r++;n>0&&r>0&&e.addFailure(this,Ct.Hint,tt.hints.dontUseWeightedAndStrecthedColumnsInSameSet())}addColumn(e){if(!e.parent)this._columns.push(e),e.setParent(this);else throw new Error(tt.errors.columnAlreadyBelongsToAnotherSet())}removeItem(e){if(e instanceof vu){const n=this._columns.indexOf(e);if(n>=0)return this._columns.splice(n,1),e.setParent(void 0),this.updateLayout(),!0}return!1}indexOf(e){return e instanceof vu?this._columns.indexOf(e):-1}isLeftMostElement(e){return this._columns.indexOf(e)===0}isRightMostElement(e){return this._columns.indexOf(e)===this._columns.length-1}isTopElement(e){return this._columns.indexOf(e)>=0}isBottomElement(e){return this._columns.indexOf(e)>=0}getActionById(e){let n;for(const r of this._columns)if(n=r.getActionById(e),n)break;return n}get bleed(){return this.getBleed()}set bleed(e){this.setBleed(e)}get padding(){return this.getPadding()}set padding(e){this.setPadding(e)}get selectAction(){return this._selectAction}set selectAction(e){this._selectAction=e}}function qN(t){const e=t.getRootElement(),n=e&&e.onImageLoaded?e.onImageLoaded:Tt.onImageLoaded;n&&n(t)}function jN(t,e,n){const r=t.getRootElement(),i=r&&r.onAnchorClicked?r.onAnchorClicked:Tt.onAnchorClicked;return i!==void 0?i(t,e,n):!1}function Nme(t){const e=t.parent?t.parent.getRootElement():void 0,n=e&&e.onExecuteAction?e.onExecuteAction:Tt.onExecuteAction;t.prepareForExecution()&&n&&n(t)}function VN(t,e){const n=t.parent?t.parent.getRootElement():void 0,r=n&&n.onInlineCardExpanded?n.onInlineCardExpanded:Tt.onInlineCardExpanded;r&&r(t,e)}function xme(t){const e=t.getRootElement(),n=e&&e.onInputValueChanged?e.onInputValueChanged:Tt.onInputValueChanged;n&&n(t)}function _T(t,e=!0){const n=t.getRootElement();e&&n.updateLayout();const r=n,i=r&&r.onElementVisibilityChanged?r.onElementVisibilityChanged:Tt.onElementVisibilityChanged;i!==void 0&&i(t)}function bH(t,e){e?(t.readOnly=!0,t.required=!0):(t.readOnly=!1,t.required=!1)}function Lme(t,e){const n=t.parent?t.parent.getRootElement():void 0,r=n&&n.onDisplayOverflowActionMenu?n.onDisplayOverflowActionMenu:Tt.onDisplayOverflowActionMenu;return r!==void 0?r(t.getActions(),e):!1}function Ume(t,e){const n=t.parent?t.parent.getRootElement():void 0,r=n&&n.onRenderOverflowActions?n.onRenderOverflowActions:Tt.onRenderOverflowActions;return r!==void 0?r(t.getActions(),e):!1}class _H extends Lr{internalParse(e,n){super.internalParse(e,n),this.parseActions(e,n)}parseActions(e,n){this._actionCollection.parse(e.actions,n)}internalToJSON(e,n){super.internalToJSON(e,n),this._actionCollection.toJSON(e,"actions",n)}internalRender(){const e=super.internalRender();if(e){const n=this._actionCollection.render(this.hostConfig.actions.actionsOrientation);return n&&(Ht(e,vH(this.hostConfig,{spacing:this.hostConfig.getEffectiveSpacing(this.hostConfig.actions.spacing)},Dn.Horizontal)),Ht(e,n)),this.renderIfEmpty||e.children.length>0?e:void 0}else return}getHasExpandedAction(){return this.renderedActionCount===0?!1:this.renderedActionCount===1?this._actionCollection.expandedAction!==void 0&&!this.hostConfig.actions.preExpandSingleShowCardAction:this._actionCollection.expandedAction!==void 0}get renderedActionCount(){return this._actionCollection.renderedActionCount}get renderIfEmpty(){return!1}constructor(){super(),this._actionCollection=new wH(this)}releaseDOMResources(){super.releaseDOMResources(),this._actionCollection.releaseDOMResources()}getActionCount(){return this._actionCollection.getActionCount()}getActionAt(e){return e>=0&&e<this.getActionCount()?this._actionCollection.getActionAt(e):super.getActionAt(e)}getActionById(e){const n=this._actionCollection.getActionById(e);return n||super.getActionById(e)}internalValidateProperties(e){super.internalValidateProperties(e),this._actionCollection&&this._actionCollection.validateProperties(e)}isLastElement(e){return super.isLastElement(e)&&this._actionCollection.getActionCount()===0}addAction(e){this._actionCollection.addAction(e)}clear(){super.clear(),this._actionCollection.clear()}getAllInputs(e=!0){let n=super.getAllInputs(e);return e&&n.push(...this._actionCollection.getAllInputs(e)),n}getResourceInformation(){let e=super.getResourceInformation();return e.push(...this._actionCollection.getResourceInformation()),e}isBleedingAtBottom(){return this._actionCollection.renderedActionCount===0?super.isBleedingAtBottom():this._actionCollection.getActionCount()===1?this._actionCollection.expandedAction!==void 0&&!this.hostConfig.actions.preExpandSingleShowCardAction:this._actionCollection.expandedAction!==void 0}getForbiddenActionNames(){return[]}getElementById(e){let n=super.getElementById(e);return n||(n=this.getElementByIdFromAction(e)),n}get isStandalone(){return!1}}class Fme extends Vn{parse(e,n,r){const i=r.parseAction(e.parent,n[this.name],[],!1);if(i!==void 0){if(i instanceof Bs)return i;r.logParseEvent(e,Ct.ActionTypeNotAllowed,tt.errors.actionTypeNotAllowed(i.getJsonTypeName()))}r.logParseEvent(e,Ct.PropertyCantBeNull,tt.errors.propertyMustBeSet("action"))}toJSON(e,n,r,i){i.serializeValue(n,this.name,r?r.toJSON(i):void 0,void 0,!0)}constructor(e,n){super(e,n,void 0),this.targetVersion=e,this.name=n}}class ls extends On{get action(){return this.getValue(ls.actionProperty)}set action(e){this.setValue(ls.actionProperty,e),e&&e.setParent(this.parent)}getSchemaKey(){return"RefreshDefinition"}}ls.actionProperty=new Fme(Ee.v1_4,"action");ls.userIdsProperty=new fme(Ee.v1_4,"userIds");Re([Ae(ls.actionProperty)],ls.prototype,"action",null);Re([Ae(ls.userIdsProperty)],ls.prototype,"userIds",void 0);class zi extends On{getSchemaKey(){return"AuthCardButton"}}zi.typeProperty=new ut(Ee.v1_4,"type");zi.titleProperty=new ut(Ee.v1_4,"title");zi.imageProperty=new ut(Ee.v1_4,"image");zi.valueProperty=new ut(Ee.v1_4,"value");Re([Ae(zi.typeProperty)],zi.prototype,"type",void 0);Re([Ae(zi.titleProperty)],zi.prototype,"title",void 0);Re([Ae(zi.imageProperty)],zi.prototype,"image",void 0);Re([Ae(zi.valueProperty)],zi.prototype,"value",void 0);class cs extends On{getSchemaKey(){return"TokenExchangeResource"}}cs.idProperty=new ut(Ee.v1_4,"id");cs.uriProperty=new ut(Ee.v1_4,"uri");cs.providerIdProperty=new ut(Ee.v1_4,"providerId");Re([Ae(cs.idProperty)],cs.prototype,"id",void 0);Re([Ae(cs.uriProperty)],cs.prototype,"uri",void 0);Re([Ae(cs.providerIdProperty)],cs.prototype,"providerId",void 0);class Gi extends On{getSchemaKey(){return"Authentication"}}Gi.textProperty=new ut(Ee.v1_4,"text");Gi.connectionNameProperty=new ut(Ee.v1_4,"connectionName");Gi.buttonsProperty=new lc(Ee.v1_4,"buttons",zi);Gi.tokenExchangeResourceProperty=new vd(Ee.v1_4,"tokenExchangeResource",cs,!0);Re([Ae(Gi.textProperty)],Gi.prototype,"text",void 0);Re([Ae(Gi.connectionNameProperty)],Gi.prototype,"connectionName",void 0);Re([Ae(Gi.buttonsProperty)],Gi.prototype,"buttons",void 0);Re([Ae(Gi.tokenExchangeResourceProperty)],Gi.prototype,"tokenExchangeResource",void 0);class Tt extends _H{constructor(){super(...arguments),this.designMode=!1}get refresh(){return this.getValue(Tt.refreshProperty)}set refresh(e){this.setValue(Tt.refreshProperty,e),e&&(e.parent=this)}static get processMarkdown(){throw new Error(tt.errors.processMarkdownEventRemoved())}static set processMarkdown(e){throw new Error(tt.errors.processMarkdownEventRemoved())}static applyMarkdown(e){const n={didProcess:!1};if(Tt.onProcessMarkdown)Tt.onProcessMarkdown(e,n);else if(window.markdownit){const r=window.markdownit;n.outputHtml=r().render(e),n.didProcess=!0}else Tt._haveWarnedAboutNoMarkdownProcessing||(console.warn(tt.errors.markdownProcessingNotEnabled),Tt._haveWarnedAboutNoMarkdownProcessing=!0);return n}isVersionSupported(){return this.bypassVersionCheck?!0:!(!this.version||!this.version.isValid||this.maxVersion.major<this.version.major||this.maxVersion.major===this.version.major&&this.maxVersion.minor<this.version.minor)}getDefaultSerializationContext(){return new pf(this.version)}getItemsCollectionPropertyName(){return"body"}internalParse(e,n){this._fallbackCard=void 0;const r=n.parseElement(void 0,e.fallback,this.forbiddenChildElements(),!this.isDesignMode());r&&(this._fallbackCard=new Tt,this._fallbackCard.addItem(r)),super.internalParse(e,n)}internalToJSON(e,n){this.setValue(Tt.versionProperty,n.targetVersion),super.internalToJSON(e,n)}internalRender(){const e=super.internalRender();return yt.useAdvancedCardBottomTruncation&&e&&e.style.removeProperty("minHeight"),e}getHasBackground(e=!1){return!0}getDefaultPadding(){return new Vl(vt.Padding,vt.Padding,vt.Padding,vt.Padding)}shouldSerialize(e){return!0}get renderIfEmpty(){return!0}get bypassVersionCheck(){return!1}get allowCustomStyle(){return this.hostConfig.adaptiveCard&&this.hostConfig.adaptiveCard.allowCustomStyle}get hasBackground(){return!0}getJsonTypeName(){return"AdaptiveCard"}internalValidateProperties(e){super.internalValidateProperties(e),this.getValue(At.typeNameProperty)!=="AdaptiveCard"&&e.addFailure(this,Ct.MissingCardType,tt.errors.invalidCardType()),!this.bypassVersionCheck&&!this.version?e.addFailure(this,Ct.PropertyCantBeNull,tt.errors.propertyMustBeSet("version")):this.isVersionSupported()||e.addFailure(this,Ct.UnsupportedCardVersion,tt.errors.unsupportedCardVersion(this.version.toString(),this.maxVersion.toString()))}render(e){let n;this.shouldFallback()&&this._fallbackCard?(this._fallbackCard.hostConfig=this.hostConfig,n=this._fallbackCard.render()):(n=super.render(),n&&(n.classList.add(this.hostConfig.makeCssClassName("ac-adaptiveCard")),yt.setTabIndexAtCardRoot&&(n.tabIndex=0),this.speak&&n.setAttribute("aria-label",this.speak),n.onmouseenter=i=>{this.updateInputsVisualState(!0)},n.onmouseleave=i=>{this.updateInputsVisualState(!1)},this.getRootElement().updateActionsEnabledState())),e&&(Ht(e,n),this.updateLayout());const r=this.getAllInputs();return document.onclick=i=>{r.forEach(o=>{var s,l;o instanceof Ut&&!(!((s=o.renderedElement)===null||s===void 0)&&s.contains(i.target))&&((l=o.getDropdownElement())===null||l===void 0||l.classList.remove(this.hostConfig.makeCssClassName("ac-choiceSetInput-filtered-dropdown-open")))})},n}updateLayout(e=!0){if(super.updateLayout(e),yt.useAdvancedCardBottomTruncation&&this.isDisplayed()){const n=this.hostConfig.getEffectiveSpacing(vt.Default);this.handleOverflow(this.renderedElement.offsetHeight-n)}}shouldFallback(){return super.shouldFallback()||!this.isVersionSupported()}get hasVisibleSeparator(){return!1}}Tt.schemaUrl="http://adaptivecards.io/schemas/adaptive-card.json";Tt.$schemaProperty=new cc(Ee.v1_0,"$schema",(t,e,n,r)=>Tt.schemaUrl,(t,e,n,r,i)=>{i.serializeValue(n,e.name,Tt.schemaUrl)});Tt.versionProperty=new cc(Ee.v1_0,"version",(t,e,n,r)=>{let i=vo.parse(n[e.name],r);return i===void 0&&(i=Ee.latest,r.logParseEvent(t,Ct.InvalidPropertyValue,tt.errors.invalidCardVersion(i.toString()))),i},(t,e,n,r,i)=>{r!==void 0&&i.serializeValue(n,e.name,r.toString())},Ee.v1_0);Tt.fallbackTextProperty=new ut(Ee.v1_0,"fallbackText");Tt.speakProperty=new ut(Ee.v1_0,"speak");Tt.refreshProperty=new vd(Ee.v1_4,"refresh",ls,!0);Tt.authenticationProperty=new vd(Ee.v1_4,"authentication",Gi,!0);Tt._haveWarnedAboutNoMarkdownProcessing=!1;Re([Ae(Tt.versionProperty)],Tt.prototype,"version",void 0);Re([Ae(Tt.fallbackTextProperty)],Tt.prototype,"fallbackText",void 0);Re([Ae(Tt.speakProperty)],Tt.prototype,"speak",void 0);Re([Ae(Tt.refreshProperty)],Tt.prototype,"refresh",null);Re([Ae(Tt.authenticationProperty)],Tt.prototype,"authentication",void 0);class Bme extends Tt{constructor(){super(...arguments),this.suppressStyle=!1}getSchemaKey(){return"InlineAdaptiveCard"}populateSchema(e){super.populateSchema(e),e.remove(Tt.$schemaProperty,Tt.versionProperty)}getDefaultPadding(){return new Vl(this.suppressStyle?vt.None:vt.Padding,vt.Padding,this.suppressStyle?vt.None:vt.Padding,vt.Padding)}get bypassVersionCheck(){return!0}get defaultStyle(){return this.suppressStyle?_t.Default:this.hostConfig.actions.showCard.style?this.hostConfig.actions.showCard.style:_t.Emphasis}render(e){const n=super.render(e);return n&&(n.setAttribute("aria-live","polite"),n.removeAttribute("tabindex")),n}}class pf extends KA{constructor(){super(...arguments),this._forbiddenTypes=new Set}internalParseCardObject(e,n,r,i,o,s){let l;if(n&&typeof n=="object"){const c=new Set;this._forbiddenTypes.forEach(u=>{c.add(u)}),r.forEach(u=>{this._forbiddenTypes.add(u)});const a=zA(n.type);if(a&&this._forbiddenTypes.has(a))s(a,su.ForbiddenType);else{let u=!1;if(l=o(a),l?(l.setParent(e),l.parse(n,this),u=yt.enableFallback&&i&&l.shouldFallback()):(u=yt.enableFallback&&i,s(a,su.UnknownType)),u){const d=n.fallback;!d&&e&&e.setShouldFallback(!0),typeof d=="string"&&d.toLowerCase()==="drop"?l=void 0:typeof d=="object"&&(l=this.internalParseCardObject(e,d,r,!0,o,s))}}this._forbiddenTypes=c}return l}cardObjectParsed(e,n){e instanceof Vt&&this.onParseAction?this.onParseAction(e,n,this):e instanceof At&&this.onParseElement&&this.onParseElement(e,n,this)}shouldSerialize(e){return e instanceof Vt?this.actionRegistry.findByName(e.getJsonTypeName())!==void 0:e instanceof At?this.elementRegistry.findByName(e.getJsonTypeName())!==void 0:!0}parseCardObject(e,n,r,i,o,s){const l=new Set(r),c=this.internalParseCardObject(e,n,l,i,o,s);return c!==void 0&&this.cardObjectParsed(c,n),c}parseElement(e,n,r,i){return this.parseCardObject(e,n,r,i,o=>this.elementRegistry.createInstance(o,this.targetVersion),(o,s)=>{s===su.UnknownType?this.logParseEvent(void 0,Ct.UnknownElementType,tt.errors.unknownElementType(o)):this.logParseEvent(void 0,Ct.ElementTypeNotAllowed,tt.errors.elementTypeNotAllowed(o))})}parseAction(e,n,r,i){return this.parseCardObject(e,n,r,i,o=>this.actionRegistry.createInstance(o,this.targetVersion),(o,s)=>{s===su.UnknownType?this.logParseEvent(void 0,Ct.UnknownActionType,tt.errors.unknownActionType(o)):this.logParseEvent(void 0,Ct.ActionTypeNotAllowed,tt.errors.actionTypeNotAllowed(o))})}get elementRegistry(){var e;return(e=this._elementRegistry)!==null&&e!==void 0?e:It.elements}setElementRegistry(e){this._elementRegistry=e}get actionRegistry(){var e;return(e=this._actionRegistry)!==null&&e!==void 0?e:It.actions}setActionRegistry(e){this._actionRegistry=e}}It.defaultElements.register("Container",Lr);It.defaultElements.register("TextBlock",zn);It.defaultElements.register("RichTextBlock",yH,Ee.v1_2);It.defaultElements.register("TextRun",xr,Ee.v1_2);It.defaultElements.register("Image",Ft);It.defaultElements.register("ImageSet",Hi);It.defaultElements.register("Media",yr,Ee.v1_1);It.defaultElements.register("FactSet",bv);It.defaultElements.register("ColumnSet",IH);It.defaultElements.register("ActionSet",Av,Ee.v1_2);It.defaultElements.register("Input.Text",In);It.defaultElements.register("Input.Date",Vi);It.defaultElements.register("Input.Time",Dr);It.defaultElements.register("Input.Number",ji);It.defaultElements.register("Input.ChoiceSet",Ut);It.defaultElements.register("Input.Toggle",Xr);It.defaultActions.register(Ja.JsonTypeName,Ja);It.defaultActions.register(Hu.JsonTypeName,Hu);It.defaultActions.register($s.JsonTypeName,$s);It.defaultActions.register(Qa.JsonTypeName,Qa,Ee.v1_2);It.defaultActions.register(Bs.JsonTypeName,Bs,Ee.v1_4);/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:AH,setPrototypeOf:zN,isFrozen:$me,getPrototypeOf:Hme,getOwnPropertyDescriptor:qme}=Object;let{freeze:fi,seal:fo,create:oI}=Object,{apply:sI,construct:aI}=typeof Reflect<"u"&&Reflect;fi||(fi=function(e){return e});fo||(fo=function(e){return e});sI||(sI=function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return e.apply(n,i)});aI||(aI=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new e(...r)});const sm=pi(Array.prototype.forEach),jme=pi(Array.prototype.lastIndexOf),GN=pi(Array.prototype.pop),ih=pi(Array.prototype.push),Vme=pi(Array.prototype.splice),Mm=pi(String.prototype.toLowerCase),AT=pi(String.prototype.toString),RT=pi(String.prototype.match),oh=pi(String.prototype.replace),zme=pi(String.prototype.indexOf),Gme=pi(String.prototype.trim),Io=pi(Object.prototype.hasOwnProperty),oi=pi(RegExp.prototype.test),sh=Wme(TypeError);function pi(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return sI(t,e,r)}}function Wme(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return aI(t,n)}}function bt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Mm;zN&&zN(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const o=n(i);o!==i&&($me(e)||(e[r]=o),i=o)}t[i]=!0}return t}function Kme(t){for(let e=0;e<t.length;e++)Io(t,e)||(t[e]=null);return t}function ns(t){const e=oI(null);for(const[n,r]of AH(t))Io(t,n)&&(Array.isArray(r)?e[n]=Kme(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=ns(r):e[n]=r);return e}function ah(t,e){for(;t!==null;){const r=qme(t,e);if(r){if(r.get)return pi(r.get);if(typeof r.value=="function")return pi(r.value)}t=Hme(t)}function n(){return null}return n}const WN=fi(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),kT=fi(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),PT=fi(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Jme=fi(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),OT=fi(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Qme=fi(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),KN=fi(["#text"]),JN=fi(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),MT=fi(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),QN=fi(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),am=fi(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Xme=fo(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Yme=fo(/<%[\w\W]*|[\w\W]*%>/gm),Zme=fo(/\$\{[\w\W]*/gm),eve=fo(/^data-[\-\w.\u00B7-\uFFFF]+$/),tve=fo(/^aria-[\-\w]+$/),RH=fo(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),nve=fo(/^(?:\w+script|data):/i),rve=fo(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),kH=fo(/^html$/i),ive=fo(/^[a-z][.\w]*(-[.\w]+)+$/i);var XN=Object.freeze({__proto__:null,ARIA_ATTR:tve,ATTR_WHITESPACE:rve,CUSTOM_ELEMENT:ive,DATA_ATTR:eve,DOCTYPE_NAME:kH,ERB_EXPR:Yme,IS_ALLOWED_URI:RH,IS_SCRIPT_OR_DATA:nve,MUSTACHE_EXPR:Xme,TMPLIT_EXPR:Zme});const lh={element:1,text:3,progressingInstruction:7,comment:8,document:9},ove=function(){return typeof window>"u"?null:window},sve=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},YN=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function PH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ove();const e=lt=>PH(lt);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==lh.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:l,Element:c,NodeFilter:a,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:f,trustedTypes:h}=t,g=c.prototype,E=ah(g,"cloneNode"),D=ah(g,"remove"),w=ah(g,"nextSibling"),p=ah(g,"childNodes"),b=ah(g,"parentNode");if(typeof s=="function"){const lt=n.createElement("template");lt.content&&lt.content.ownerDocument&&(n=lt.content.ownerDocument)}let j,K="";const{implementation:M,createNodeIterator:ne,createDocumentFragment:G,getElementsByTagName:oe}=n,{importNode:J}=r;let X=YN();e.isSupported=typeof AH=="function"&&typeof b=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:B,ERB_EXPR:q,TMPLIT_EXPR:F,DATA_ATTR:x,ARIA_ATTR:P,IS_SCRIPT_OR_DATA:v,ATTR_WHITESPACE:T,CUSTOM_ELEMENT:_}=XN;let{IS_ALLOWED_URI:N}=XN,I=null;const A=bt({},[...WN,...kT,...PT,...OT,...KN]);let S=null;const H=bt({},[...JN,...MT,...QN,...am]);let L=Object.seal(oI(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),C=null,y=null;const k=Object.seal(oI(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Y=!0,V=!0,z=!1,W=!0,le=!1,re=!0,$=!1,m=!1,R=!1,Z=!1,ie=!1,se=!1,ue=!0,Te=!1;const Se="user-content-";let Q=!0,O=!1,U={},ae=null;const ce=bt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let fe=null;const ve=bt({},["audio","video","img","source","image","track"]);let Pe=null;const Me=bt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ke="http://www.w3.org/1998/Math/MathML",Ne="http://www.w3.org/2000/svg",Oe="http://www.w3.org/1999/xhtml";let Qe=Oe,et=!1,Xe=null;const Nt=bt({},[ke,Ne,Oe],AT);let kt=bt({},["mi","mo","mn","ms","mtext"]),Fr=bt({},["annotation-xml"]);const ps=bt({},["title","style","font","a","script"]);let Jt=null;const Yt=["application/xhtml+xml","text/html"],Cd="text/html";let pn=null,Go=null;const dc=n.createElement("form"),Ys=function(Ce){return Ce instanceof RegExp||Ce instanceof Function},gs=function(){let Ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Go&&Go===Ce)){if((!Ce||typeof Ce!="object")&&(Ce={}),Ce=ns(Ce),Jt=Yt.indexOf(Ce.PARSER_MEDIA_TYPE)===-1?Cd:Ce.PARSER_MEDIA_TYPE,pn=Jt==="application/xhtml+xml"?AT:Mm,I=Io(Ce,"ALLOWED_TAGS")?bt({},Ce.ALLOWED_TAGS,pn):A,S=Io(Ce,"ALLOWED_ATTR")?bt({},Ce.ALLOWED_ATTR,pn):H,Xe=Io(Ce,"ALLOWED_NAMESPACES")?bt({},Ce.ALLOWED_NAMESPACES,AT):Nt,Pe=Io(Ce,"ADD_URI_SAFE_ATTR")?bt(ns(Me),Ce.ADD_URI_SAFE_ATTR,pn):Me,fe=Io(Ce,"ADD_DATA_URI_TAGS")?bt(ns(ve),Ce.ADD_DATA_URI_TAGS,pn):ve,ae=Io(Ce,"FORBID_CONTENTS")?bt({},Ce.FORBID_CONTENTS,pn):ce,C=Io(Ce,"FORBID_TAGS")?bt({},Ce.FORBID_TAGS,pn):ns({}),y=Io(Ce,"FORBID_ATTR")?bt({},Ce.FORBID_ATTR,pn):ns({}),U=Io(Ce,"USE_PROFILES")?Ce.USE_PROFILES:!1,Y=Ce.ALLOW_ARIA_ATTR!==!1,V=Ce.ALLOW_DATA_ATTR!==!1,z=Ce.ALLOW_UNKNOWN_PROTOCOLS||!1,W=Ce.ALLOW_SELF_CLOSE_IN_ATTR!==!1,le=Ce.SAFE_FOR_TEMPLATES||!1,re=Ce.SAFE_FOR_XML!==!1,$=Ce.WHOLE_DOCUMENT||!1,Z=Ce.RETURN_DOM||!1,ie=Ce.RETURN_DOM_FRAGMENT||!1,se=Ce.RETURN_TRUSTED_TYPE||!1,R=Ce.FORCE_BODY||!1,ue=Ce.SANITIZE_DOM!==!1,Te=Ce.SANITIZE_NAMED_PROPS||!1,Q=Ce.KEEP_CONTENT!==!1,O=Ce.IN_PLACE||!1,N=Ce.ALLOWED_URI_REGEXP||RH,Qe=Ce.NAMESPACE||Oe,kt=Ce.MATHML_TEXT_INTEGRATION_POINTS||kt,Fr=Ce.HTML_INTEGRATION_POINTS||Fr,L=Ce.CUSTOM_ELEMENT_HANDLING||{},Ce.CUSTOM_ELEMENT_HANDLING&&Ys(Ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(L.tagNameCheck=Ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Ce.CUSTOM_ELEMENT_HANDLING&&Ys(Ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(L.attributeNameCheck=Ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Ce.CUSTOM_ELEMENT_HANDLING&&typeof Ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(L.allowCustomizedBuiltInElements=Ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),le&&(V=!1),ie&&(Z=!0),U&&(I=bt({},KN),S=[],U.html===!0&&(bt(I,WN),bt(S,JN)),U.svg===!0&&(bt(I,kT),bt(S,MT),bt(S,am)),U.svgFilters===!0&&(bt(I,PT),bt(S,MT),bt(S,am)),U.mathMl===!0&&(bt(I,OT),bt(S,QN),bt(S,am))),Ce.ADD_TAGS&&(typeof Ce.ADD_TAGS=="function"?k.tagCheck=Ce.ADD_TAGS:(I===A&&(I=ns(I)),bt(I,Ce.ADD_TAGS,pn))),Ce.ADD_ATTR&&(typeof Ce.ADD_ATTR=="function"?k.attributeCheck=Ce.ADD_ATTR:(S===H&&(S=ns(S)),bt(S,Ce.ADD_ATTR,pn))),Ce.ADD_URI_SAFE_ATTR&&bt(Pe,Ce.ADD_URI_SAFE_ATTR,pn),Ce.FORBID_CONTENTS&&(ae===ce&&(ae=ns(ae)),bt(ae,Ce.FORBID_CONTENTS,pn)),Ce.ADD_FORBID_CONTENTS&&(ae===ce&&(ae=ns(ae)),bt(ae,Ce.ADD_FORBID_CONTENTS,pn)),Q&&(I["#text"]=!0),$&&bt(I,["html","head","body"]),I.table&&(bt(I,["tbody"]),delete C.tbody),Ce.TRUSTED_TYPES_POLICY){if(typeof Ce.TRUSTED_TYPES_POLICY.createHTML!="function")throw sh('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Ce.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw sh('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');j=Ce.TRUSTED_TYPES_POLICY,K=j.createHTML("")}else j===void 0&&(j=sve(h,i)),j!==null&&typeof K=="string"&&(K=j.createHTML(""));fi&&fi(Ce),Go=Ce}},hc=bt({},[...kT,...PT,...Jme]),fc=bt({},[...OT,...Qme]),Ji=function(Ce){let $e=b(Ce);(!$e||!$e.tagName)&&($e={namespaceURI:Qe,tagName:"template"});const ot=Mm(Ce.tagName),Wt=Mm($e.tagName);return Xe[Ce.namespaceURI]?Ce.namespaceURI===Ne?$e.namespaceURI===Oe?ot==="svg":$e.namespaceURI===ke?ot==="svg"&&(Wt==="annotation-xml"||kt[Wt]):!!hc[ot]:Ce.namespaceURI===ke?$e.namespaceURI===Oe?ot==="math":$e.namespaceURI===Ne?ot==="math"&&Fr[Wt]:!!fc[ot]:Ce.namespaceURI===Oe?$e.namespaceURI===Ne&&!Fr[Wt]||$e.namespaceURI===ke&&!kt[Wt]?!1:!fc[ot]&&(ps[ot]||!hc[ot]):!!(Jt==="application/xhtml+xml"&&Xe[Ce.namespaceURI]):!1},ti=function(Ce){ih(e.removed,{element:Ce});try{b(Ce).removeChild(Ce)}catch{D(Ce)}},me=function(Ce,$e){try{ih(e.removed,{attribute:$e.getAttributeNode(Ce),from:$e})}catch{ih(e.removed,{attribute:null,from:$e})}if($e.removeAttribute(Ce),Ce==="is")if(Z||ie)try{ti($e)}catch{}else try{$e.setAttribute(Ce,"")}catch{}},qe=function(Ce){let $e=null,ot=null;if(R)Ce="<remove></remove>"+Ce;else{const En=RT(Ce,/^[\r\n\t ]+/);ot=En&&En[0]}Jt==="application/xhtml+xml"&&Qe===Oe&&(Ce='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Ce+"</body></html>");const Wt=j?j.createHTML(Ce):Ce;if(Qe===Oe)try{$e=new f().parseFromString(Wt,Jt)}catch{}if(!$e||!$e.documentElement){$e=M.createDocument(Qe,"template",null);try{$e.documentElement.innerHTML=et?K:Wt}catch{}}const ar=$e.body||$e.documentElement;return Ce&&ot&&ar.insertBefore(n.createTextNode(ot),ar.childNodes[0]||null),Qe===Oe?oe.call($e,$?"html":"body")[0]:$?$e.documentElement:ar},Ke=function(Ce){return ne.call(Ce.ownerDocument||Ce,Ce,a.SHOW_ELEMENT|a.SHOW_COMMENT|a.SHOW_TEXT|a.SHOW_PROCESSING_INSTRUCTION|a.SHOW_CDATA_SECTION,null)},ft=function(Ce){return Ce instanceof d&&(typeof Ce.nodeName!="string"||typeof Ce.textContent!="string"||typeof Ce.removeChild!="function"||!(Ce.attributes instanceof u)||typeof Ce.removeAttribute!="function"||typeof Ce.setAttribute!="function"||typeof Ce.namespaceURI!="string"||typeof Ce.insertBefore!="function"||typeof Ce.hasChildNodes!="function")},Bt=function(Ce){return typeof l=="function"&&Ce instanceof l};function gt(lt,Ce,$e){sm(lt,ot=>{ot.call(e,Ce,$e,Go)})}const ni=function(Ce){let $e=null;if(gt(X.beforeSanitizeElements,Ce,null),ft(Ce))return ti(Ce),!0;const ot=pn(Ce.nodeName);if(gt(X.uponSanitizeElement,Ce,{tagName:ot,allowedTags:I}),re&&Ce.hasChildNodes()&&!Bt(Ce.firstElementChild)&&oi(/<[/\w!]/g,Ce.innerHTML)&&oi(/<[/\w!]/g,Ce.textContent)||Ce.nodeType===lh.progressingInstruction||re&&Ce.nodeType===lh.comment&&oi(/<[/\w]/g,Ce.data))return ti(Ce),!0;if(!(k.tagCheck instanceof Function&&k.tagCheck(ot))&&(!I[ot]||C[ot])){if(!C[ot]&&Zs(ot)&&(L.tagNameCheck instanceof RegExp&&oi(L.tagNameCheck,ot)||L.tagNameCheck instanceof Function&&L.tagNameCheck(ot)))return!1;if(Q&&!ae[ot]){const Wt=b(Ce)||Ce.parentNode,ar=p(Ce)||Ce.childNodes;if(ar&&Wt){const En=ar.length;for(let Jn=En-1;Jn>=0;--Jn){const _n=E(ar[Jn],!0);_n.__removalCount=(Ce.__removalCount||0)+1,Wt.insertBefore(_n,w(Ce))}}}return ti(Ce),!0}return Ce instanceof c&&!Ji(Ce)||(ot==="noscript"||ot==="noembed"||ot==="noframes")&&oi(/<\/no(script|embed|frames)/i,Ce.innerHTML)?(ti(Ce),!0):(le&&Ce.nodeType===lh.text&&($e=Ce.textContent,sm([B,q,F],Wt=>{$e=oh($e,Wt," ")}),Ce.textContent!==$e&&(ih(e.removed,{element:Ce.cloneNode()}),Ce.textContent=$e)),gt(X.afterSanitizeElements,Ce,null),!1)},Er=function(Ce,$e,ot){if(ue&&($e==="id"||$e==="name")&&(ot in n||ot in dc))return!1;if(!(V&&!y[$e]&&oi(x,$e))){if(!(Y&&oi(P,$e))){if(!(k.attributeCheck instanceof Function&&k.attributeCheck($e,Ce))){if(!S[$e]||y[$e]){if(!(Zs(Ce)&&(L.tagNameCheck instanceof RegExp&&oi(L.tagNameCheck,Ce)||L.tagNameCheck instanceof Function&&L.tagNameCheck(Ce))&&(L.attributeNameCheck instanceof RegExp&&oi(L.attributeNameCheck,$e)||L.attributeNameCheck instanceof Function&&L.attributeNameCheck($e,Ce))||$e==="is"&&L.allowCustomizedBuiltInElements&&(L.tagNameCheck instanceof RegExp&&oi(L.tagNameCheck,ot)||L.tagNameCheck instanceof Function&&L.tagNameCheck(ot))))return!1}else if(!Pe[$e]){if(!oi(N,oh(ot,T,""))){if(!(($e==="src"||$e==="xlink:href"||$e==="href")&&Ce!=="script"&&zme(ot,"data:")===0&&fe[Ce])){if(!(z&&!oi(v,oh(ot,T,"")))){if(ot)return!1}}}}}}}return!0},Zs=function(Ce){return Ce!=="annotation-xml"&&RT(Ce,_)},vp=function(Ce){gt(X.beforeSanitizeAttributes,Ce,null);const{attributes:$e}=Ce;if(!$e||ft(Ce))return;const ot={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:S,forceKeepAttr:void 0};let Wt=$e.length;for(;Wt--;){const ar=$e[Wt],{name:En,namespaceURI:Jn,value:_n}=ar,Wo=pn(En),pc=_n;let cn=En==="value"?pc:Gme(pc);if(ot.attrName=Wo,ot.attrValue=cn,ot.keepAttr=!0,ot.forceKeepAttr=void 0,gt(X.uponSanitizeAttribute,Ce,ot),cn=ot.attrValue,Te&&(Wo==="id"||Wo==="name")&&(me(En,Ce),cn=Se+cn),re&&oi(/((--!?|])>)|<\/(style|title|textarea)/i,cn)){me(En,Ce);continue}if(Wo==="attributename"&&RT(cn,"href")){me(En,Ce);continue}if(ot.forceKeepAttr)continue;if(!ot.keepAttr){me(En,Ce);continue}if(!W&&oi(/\/>/i,cn)){me(En,Ce);continue}le&&sm([B,q,F],Cp=>{cn=oh(cn,Cp," ")});const Sd=pn(Ce.nodeName);if(!Er(Sd,Wo,cn)){me(En,Ce);continue}if(j&&typeof h=="object"&&typeof h.getAttributeType=="function"&&!Jn)switch(h.getAttributeType(Sd,Wo)){case"TrustedHTML":{cn=j.createHTML(cn);break}case"TrustedScriptURL":{cn=j.createScriptURL(cn);break}}if(cn!==pc)try{Jn?Ce.setAttributeNS(Jn,En,cn):Ce.setAttribute(En,cn),ft(Ce)?ti(Ce):GN(e.removed)}catch{me(En,Ce)}}gt(X.afterSanitizeAttributes,Ce,null)},yp=function lt(Ce){let $e=null;const ot=Ke(Ce);for(gt(X.beforeSanitizeShadowDOM,Ce,null);$e=ot.nextNode();)gt(X.uponSanitizeShadowNode,$e,null),ni($e),vp($e),$e.content instanceof o&&lt($e.content);gt(X.afterSanitizeShadowDOM,Ce,null)};return e.sanitize=function(lt){let Ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},$e=null,ot=null,Wt=null,ar=null;if(et=!lt,et&&(lt="<!-->"),typeof lt!="string"&&!Bt(lt))if(typeof lt.toString=="function"){if(lt=lt.toString(),typeof lt!="string")throw sh("dirty is not a string, aborting")}else throw sh("toString is not a function");if(!e.isSupported)return lt;if(m||gs(Ce),e.removed=[],typeof lt=="string"&&(O=!1),O){if(lt.nodeName){const _n=pn(lt.nodeName);if(!I[_n]||C[_n])throw sh("root node is forbidden and cannot be sanitized in-place")}}else if(lt instanceof l)$e=qe("<!---->"),ot=$e.ownerDocument.importNode(lt,!0),ot.nodeType===lh.element&&ot.nodeName==="BODY"||ot.nodeName==="HTML"?$e=ot:$e.appendChild(ot);else{if(!Z&&!le&&!$&&lt.indexOf("<")===-1)return j&&se?j.createHTML(lt):lt;if($e=qe(lt),!$e)return Z?null:se?K:""}$e&&R&&ti($e.firstChild);const En=Ke(O?lt:$e);for(;Wt=En.nextNode();)ni(Wt),vp(Wt),Wt.content instanceof o&&yp(Wt.content);if(O)return lt;if(Z){if(ie)for(ar=G.call($e.ownerDocument);$e.firstChild;)ar.appendChild($e.firstChild);else ar=$e;return(S.shadowroot||S.shadowrootmode)&&(ar=J.call(r,ar,!0)),ar}let Jn=$?$e.outerHTML:$e.innerHTML;return $&&I["!doctype"]&&$e.ownerDocument&&$e.ownerDocument.doctype&&$e.ownerDocument.doctype.name&&oi(kH,$e.ownerDocument.doctype.name)&&(Jn="<!DOCTYPE "+$e.ownerDocument.doctype.name+`>
`+Jn),le&&sm([B,q,F],_n=>{Jn=oh(Jn,_n," ")}),j&&se?j.createHTML(Jn):Jn},e.setConfig=function(){let lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gs(lt),m=!0},e.clearConfig=function(){Go=null,m=!1},e.isValidAttribute=function(lt,Ce,$e){Go||gs({});const ot=pn(lt),Wt=pn(Ce);return Er(ot,Wt,$e)},e.addHook=function(lt,Ce){typeof Ce=="function"&&ih(X[lt],Ce)},e.removeHook=function(lt,Ce){if(Ce!==void 0){const $e=jme(X[lt],Ce);return $e===-1?void 0:Vme(X[lt],$e,1)[0]}return GN(X[lt])},e.removeHooks=function(lt){X[lt]=[]},e.removeAllHooks=function(){X=YN()},e}var ave=PH();function YA(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var uc=YA();function OH(t){uc=t}var Hh={exec:()=>null};function Lt(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(i,o)=>{let s=typeof o=="string"?o:o.source;return s=s.replace(li.caret,"$1"),n=n.replace(i,s),r},getRegex:()=>new RegExp(n,e)};return r}var lve=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),li={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},cve=/^(?:[ \t]*(?:\n|$))+/,uve=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,dve=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,mp=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,hve=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ZA=/(?:[*+-]|\d{1,9}[.)])/,MH=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,DH=Lt(MH).replace(/bull/g,ZA).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),fve=Lt(MH).replace(/bull/g,ZA).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),eR=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,pve=/^[^\n]+/,tR=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,gve=Lt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",tR).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),mve=Lt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ZA).getRegex(),sC="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",nR=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,vve=Lt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",nR).replace("tag",sC).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),NH=Lt(eR).replace("hr",mp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",sC).getRegex(),yve=Lt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",NH).getRegex(),rR={blockquote:yve,code:uve,def:gve,fences:dve,heading:hve,hr:mp,html:vve,lheading:DH,list:mve,newline:cve,paragraph:NH,table:Hh,text:pve},ZN=Lt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",mp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",sC).getRegex(),Cve={...rR,lheading:fve,table:ZN,paragraph:Lt(eR).replace("hr",mp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ZN).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",sC).getRegex()},Sve={...rR,html:Lt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",nR).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Hh,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Lt(eR).replace("hr",mp).replace("heading",` *#{1,6} *[^
]`).replace("lheading",DH).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Tve=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Eve=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,xH=/^( {2,}|\\)\n(?!\s*$)/,wve=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,aC=/[\p{P}\p{S}]/u,iR=/[\s\p{P}\p{S}]/u,LH=/[^\s\p{P}\p{S}]/u,Ive=Lt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,iR).getRegex(),UH=/(?!~)[\p{P}\p{S}]/u,bve=/(?!~)[\s\p{P}\p{S}]/u,_ve=/(?:[^\s\p{P}\p{S}]|~)/u,Ave=Lt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",lve?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),FH=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Rve=Lt(FH,"u").replace(/punct/g,aC).getRegex(),kve=Lt(FH,"u").replace(/punct/g,UH).getRegex(),BH="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Pve=Lt(BH,"gu").replace(/notPunctSpace/g,LH).replace(/punctSpace/g,iR).replace(/punct/g,aC).getRegex(),Ove=Lt(BH,"gu").replace(/notPunctSpace/g,_ve).replace(/punctSpace/g,bve).replace(/punct/g,UH).getRegex(),Mve=Lt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,LH).replace(/punctSpace/g,iR).replace(/punct/g,aC).getRegex(),Dve=Lt(/\\(punct)/,"gu").replace(/punct/g,aC).getRegex(),Nve=Lt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),xve=Lt(nR).replace("(?:-->|$)","-->").getRegex(),Lve=Lt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",xve).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Rv=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Uve=Lt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Rv).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),$H=Lt(/^!?\[(label)\]\[(ref)\]/).replace("label",Rv).replace("ref",tR).getRegex(),HH=Lt(/^!?\[(ref)\](?:\[\])?/).replace("ref",tR).getRegex(),Fve=Lt("reflink|nolink(?!\\()","g").replace("reflink",$H).replace("nolink",HH).getRegex(),ex=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,oR={_backpedal:Hh,anyPunctuation:Dve,autolink:Nve,blockSkip:Ave,br:xH,code:Eve,del:Hh,emStrongLDelim:Rve,emStrongRDelimAst:Pve,emStrongRDelimUnd:Mve,escape:Tve,link:Uve,nolink:HH,punctuation:Ive,reflink:$H,reflinkSearch:Fve,tag:Lve,text:wve,url:Hh},Bve={...oR,link:Lt(/^!?\[(label)\]\((.*?)\)/).replace("label",Rv).getRegex(),reflink:Lt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Rv).getRegex()},lI={...oR,emStrongRDelimAst:Ove,emStrongLDelim:kve,url:Lt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ex).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Lt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ex).getRegex()},$ve={...lI,br:Lt(xH).replace("{2,}","*").getRegex(),text:Lt(lI.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},lm={normal:rR,gfm:Cve,pedantic:Sve},ch={normal:oR,gfm:lI,breaks:$ve,pedantic:Bve},Hve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tx=t=>Hve[t];function Es(t,e){if(e){if(li.escapeTest.test(t))return t.replace(li.escapeReplace,tx)}else if(li.escapeTestNoEncode.test(t))return t.replace(li.escapeReplaceNoEncode,tx);return t}function nx(t){try{t=encodeURI(t).replace(li.percentDecode,"%")}catch{return null}return t}function rx(t,e){var o;let n=t.replace(li.findPipe,(s,l,c)=>{let a=!1,u=l;for(;--u>=0&&c[u]==="\\";)a=!a;return a?"|":" |"}),r=n.split(li.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!((o=r.at(-1))!=null&&o.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(li.slashPipe,"|");return r}function uh(t,e,n){let r=t.length;if(r===0)return"";let i=0;for(;i<r&&t.charAt(r-i-1)===e;)i++;return t.slice(0,r-i)}function qve(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function ix(t,e,n,r,i){let o=e.href,s=e.title||null,l=t[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let c={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:s,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,c}function jve(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(o=>{let s=o.match(n.other.beginningSpace);if(s===null)return o;let[l]=s;return l.length>=i.length?o.slice(i.length):o}).join(`
`)}var kv=class{constructor(t){Ye(this,"options");Ye(this,"rules");Ye(this,"lexer");this.options=t||uc}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:uh(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=jve(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=uh(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:uh(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=uh(e[0],`
`).split(`
`),r="",i="",o=[];for(;n.length>0;){let s=!1,l=[],c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))l.push(n[c]),s=!0;else if(!s)l.push(n[c]);else break;n=n.slice(c);let a=l.join(`
`),u=a.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${a}`:a,i=i?`${i}
${u}`:u;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,o,!0),this.lexer.state.top=d,n.length===0)break;let f=o.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){let h=f,g=h.raw+`
`+n.join(`
`),E=this.blockquote(g);o[o.length-1]=E,r=r.substring(0,r.length-h.raw.length)+E.raw,i=i.substring(0,i.length-h.text.length)+E.text;break}else if((f==null?void 0:f.type)==="list"){let h=f,g=h.raw+`
`+n.join(`
`),E=this.list(g);o[o.length-1]=E,r=r.substring(0,r.length-f.raw.length)+E.raw,i=i.substring(0,i.length-h.raw.length)+E.raw,n=g.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:o,text:i}}}list(t){var n,r;let e=this.rules.block.list.exec(t);if(e){let i=e[1].trim(),o=i.length>1,s={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");let l=this.rules.other.listItemRegex(i),c=!1;for(;t;){let u=!1,d="",f="";if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;d=e[0],t=t.substring(d.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,w=>" ".repeat(3*w.length)),g=t.split(`
`,1)[0],E=!h.trim(),D=0;if(this.options.pedantic?(D=2,f=h.trimStart()):E?D=e[1].length+1:(D=e[2].search(this.rules.other.nonSpaceChar),D=D>4?1:D,f=h.slice(D),D+=e[1].length),E&&this.rules.other.blankLine.test(g)&&(d+=g+`
`,t=t.substring(g.length+1),u=!0),!u){let w=this.rules.other.nextBulletRegex(D),p=this.rules.other.hrRegex(D),b=this.rules.other.fencesBeginRegex(D),j=this.rules.other.headingBeginRegex(D),K=this.rules.other.htmlBeginRegex(D);for(;t;){let M=t.split(`
`,1)[0],ne;if(g=M,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),ne=g):ne=g.replace(this.rules.other.tabCharGlobal,"    "),b.test(g)||j.test(g)||K.test(g)||w.test(g)||p.test(g))break;if(ne.search(this.rules.other.nonSpaceChar)>=D||!g.trim())f+=`
`+ne.slice(D);else{if(E||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||b.test(h)||j.test(h)||p.test(h))break;f+=`
`+g}!E&&!g.trim()&&(E=!0),d+=M+`
`,t=t.substring(M.length+1),h=ne.slice(D)}}s.loose||(c?s.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(c=!0)),s.items.push({type:"list_item",raw:d,task:!!this.options.gfm&&this.rules.other.listIsTask.test(f),loose:!1,text:f,tokens:[]}),s.raw+=d}let a=s.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let u of s.items){if(this.lexer.state.top=!1,u.tokens=this.lexer.blockTokens(u.text,[]),u.task){if(u.text=u.text.replace(this.rules.other.listReplaceTask,""),((n=u.tokens[0])==null?void 0:n.type)==="text"||((r=u.tokens[0])==null?void 0:r.type)==="paragraph"){u.tokens[0].raw=u.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),u.tokens[0].text=u.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let f=this.lexer.inlineQueue.length-1;f>=0;f--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[f].src)){this.lexer.inlineQueue[f].src=this.lexer.inlineQueue[f].src.replace(this.rules.other.listReplaceTask,"");break}}let d=this.rules.other.listTaskCheckbox.exec(u.raw);if(d){let f={type:"checkbox",raw:d[0]+" ",checked:d[0]!=="[ ]"};u.checked=f.checked,s.loose?u.tokens[0]&&["paragraph","text"].includes(u.tokens[0].type)&&"tokens"in u.tokens[0]&&u.tokens[0].tokens?(u.tokens[0].raw=f.raw+u.tokens[0].raw,u.tokens[0].text=f.raw+u.tokens[0].text,u.tokens[0].tokens.unshift(f)):u.tokens.unshift({type:"paragraph",raw:f.raw,text:f.raw,tokens:[f]}):u.tokens.unshift(f)}}if(!s.loose){let d=u.tokens.filter(h=>h.type==="space"),f=d.length>0&&d.some(h=>this.rules.other.anyLine.test(h.raw));s.loose=f}}if(s.loose)for(let u of s.items){u.loose=!0;for(let d of u.tokens)d.type==="text"&&(d.type="paragraph")}return s}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:i}}}table(t){var s;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=rx(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(s=e[3])!=null&&s.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let l of r)this.rules.other.tableAlignRight.test(l)?o.align.push("right"):this.rules.other.tableAlignCenter.test(l)?o.align.push("center"):this.rules.other.tableAlignLeft.test(l)?o.align.push("left"):o.align.push(null);for(let l=0;l<n.length;l++)o.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:o.align[l]});for(let l of i)o.rows.push(rx(l,o.header.length).map((c,a)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:o.align[a]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=uh(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=qve(e[2],"()");if(o===-2)return;if(o>-1){let s=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,s).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(r);o&&(r=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),ix(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return ix(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...r[0]].length-1,o,s,l=i,c=0,a=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(a.lastIndex=0,e=e.slice(-1*t.length+i);(r=a.exec(e))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(s=[...o].length,r[3]||r[4]){l+=s;continue}else if((r[5]||r[6])&&i%3&&!((i+s)%3)){c+=s;continue}if(l-=s,l>0)continue;s=Math.min(s,s+l+c);let u=[...r[0]][0].length,d=t.slice(0,i+r.index+u+s);if(Math.min(i,s)%2){let h=d.slice(1,-1);return{type:"em",raw:d,text:h,tokens:this.lexer.inlineTokens(h)}}let f=d.slice(2,-2);return{type:"strong",raw:d,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,i;if(e[2]==="@")r=e[0],i="mailto:"+r;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);r=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Po=class cI{constructor(e){Ye(this,"tokens");Ye(this,"options");Ye(this,"state");Ye(this,"inlineQueue");Ye(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||uc,this.options.tokenizer=this.options.tokenizer||new kv,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:li,block:lm.normal,inline:ch.normal};this.options.pedantic?(n.block=lm.pedantic,n.inline=ch.pedantic):this.options.gfm&&(n.block=lm.gfm,this.options.breaks?n.inline=ch.breaks:n.inline=ch.gfm),this.tokenizer.rules=n}static get rules(){return{block:lm,inline:ch}}static lex(e,n){return new cI(n).lex(e)}static lexInline(e,n){return new cI(n).inlineTokens(e)}lex(e){e=e.replace(li.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var i,o,s;for(this.options.pedantic&&(e=e.replace(li.tabCharGlobal,"    ").replace(li.spaceLine,""));e;){let l;if((o=(i=this.options.extensions)==null?void 0:i.block)!=null&&o.some(a=>(l=a.call({lexer:this},e,n))?(e=e.substring(l.raw.length),n.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);let a=n.at(-1);l.raw.length===1&&a!==void 0?a.raw+=`
`:n.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);let a=n.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+l.raw,a.text+=`
`+l.text,this.inlineQueue.at(-1).src=a.text):n.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);let a=n.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+l.raw,a.text+=`
`+l.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title},n.push(l));continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),n.push(l);continue}let c=e;if((s=this.options.extensions)!=null&&s.startBlock){let a=1/0,u=e.slice(1),d;this.options.extensions.startBlock.forEach(f=>{d=f.call({lexer:this},u),typeof d=="number"&&d>=0&&(a=Math.min(a,d))}),a<1/0&&a>=0&&(c=e.substring(0,a+1))}if(this.state.top&&(l=this.tokenizer.paragraph(c))){let a=n.at(-1);r&&(a==null?void 0:a.type)==="paragraph"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+l.raw,a.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):n.push(l),r=c.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);let a=n.at(-1);(a==null?void 0:a.type)==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+l.raw,a.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):n.push(l);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var c,a,u,d,f;let r=e,i=null;if(this.tokens.links){let h=Object.keys(this.tokens.links);if(h.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)h.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)o=i[2]?i[2].length:0,r=r.slice(0,i.index+o)+"["+"a".repeat(i[0].length-o-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((a=(c=this.options.hooks)==null?void 0:c.emStrongMask)==null?void 0:a.call({lexer:this},r))??r;let s=!1,l="";for(;e;){s||(l=""),s=!1;let h;if((d=(u=this.options.extensions)==null?void 0:u.inline)!=null&&d.some(E=>(h=E.call({lexer:this},e,n))?(e=e.substring(h.raw.length),n.push(h),!0):!1))continue;if(h=this.tokenizer.escape(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.tag(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.link(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(h.raw.length);let E=n.at(-1);h.type==="text"&&(E==null?void 0:E.type)==="text"?(E.raw+=h.raw,E.text+=h.text):n.push(h);continue}if(h=this.tokenizer.emStrong(e,r,l)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.codespan(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.br(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.del(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.autolink(e)){e=e.substring(h.raw.length),n.push(h);continue}if(!this.state.inLink&&(h=this.tokenizer.url(e))){e=e.substring(h.raw.length),n.push(h);continue}let g=e;if((f=this.options.extensions)!=null&&f.startInline){let E=1/0,D=e.slice(1),w;this.options.extensions.startInline.forEach(p=>{w=p.call({lexer:this},D),typeof w=="number"&&w>=0&&(E=Math.min(E,w))}),E<1/0&&E>=0&&(g=e.substring(0,E+1))}if(h=this.tokenizer.inlineText(g)){e=e.substring(h.raw.length),h.raw.slice(-1)!=="_"&&(l=h.raw.slice(-1)),s=!0;let E=n.at(-1);(E==null?void 0:E.type)==="text"?(E.raw+=h.raw,E.text+=h.text):n.push(h);continue}if(e){let E="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(E);break}else throw new Error(E)}}return n}},Pv=class{constructor(t){Ye(this,"options");Ye(this,"parser");this.options=t||uc}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let r=(o=(e||"").match(li.notSpaceStart))==null?void 0:o[0],i=t.replace(li.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Es(r)+'">'+(n?i:Es(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:Es(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let s=0;s<t.items.length;s++){let l=t.items[s];r+=this.listitem(l)}let i=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+i+o+`>
`+r+"</"+i+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let i=0;i<t.header.length;i++)n+=this.tablecell(t.header[i]);e+=this.tablerow({text:n});let r="";for(let i=0;i<t.rows.length;i++){let o=t.rows[i];n="";for(let s=0;s<o.length;s++)n+=this.tablecell(o[s]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Es(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),i=nx(t);if(i===null)return r;t=i;let o='<a href="'+t+'"';return e&&(o+=' title="'+Es(e)+'"'),o+=">"+r+"</a>",o}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let i=nx(t);if(i===null)return Es(n);t=i;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Es(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Es(t.text)}},sR=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Oo=class uI{constructor(e){Ye(this,"options");Ye(this,"renderer");Ye(this,"textRenderer");this.options=e||uc,this.options.renderer=this.options.renderer||new Pv,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new sR}static parse(e,n){return new uI(n).parse(e)}static parseInline(e,n){return new uI(n).parseInline(e)}parse(e){var r,i;let n="";for(let o=0;o<e.length;o++){let s=e[o];if((i=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&i[s.type]){let c=s,a=this.options.extensions.renderers[c.type].call({parser:this},c);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(c.type)){n+=a||"";continue}}let l=s;switch(l.type){case"space":{n+=this.renderer.space(l);break}case"hr":{n+=this.renderer.hr(l);break}case"heading":{n+=this.renderer.heading(l);break}case"code":{n+=this.renderer.code(l);break}case"table":{n+=this.renderer.table(l);break}case"blockquote":{n+=this.renderer.blockquote(l);break}case"list":{n+=this.renderer.list(l);break}case"checkbox":{n+=this.renderer.checkbox(l);break}case"html":{n+=this.renderer.html(l);break}case"def":{n+=this.renderer.def(l);break}case"paragraph":{n+=this.renderer.paragraph(l);break}case"text":{n+=this.renderer.text(l);break}default:{let c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,n=this.renderer){var i,o;let r="";for(let s=0;s<e.length;s++){let l=e[s];if((o=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&o[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){r+=a||"";continue}}let c=l;switch(c.type){case"escape":{r+=n.text(c);break}case"html":{r+=n.html(c);break}case"link":{r+=n.link(c);break}case"image":{r+=n.image(c);break}case"checkbox":{r+=n.checkbox(c);break}case"strong":{r+=n.strong(c);break}case"em":{r+=n.em(c);break}case"codespan":{r+=n.codespan(c);break}case"br":{r+=n.br(c);break}case"del":{r+=n.del(c);break}case"text":{r+=n.text(c);break}default:{let a='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},cm,Th=(cm=class{constructor(t){Ye(this,"options");Ye(this,"block");this.options=t||uc}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Po.lex:Po.lexInline}provideParser(){return this.block?Oo.parse:Oo.parseInline}},Ye(cm,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),Ye(cm,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),cm),Vve=class{constructor(...t){Ye(this,"defaults",YA());Ye(this,"options",this.setOptions);Ye(this,"parse",this.parseMarkdown(!0));Ye(this,"parseInline",this.parseMarkdown(!1));Ye(this,"Parser",Oo);Ye(this,"Renderer",Pv);Ye(this,"TextRenderer",sR);Ye(this,"Lexer",Po);Ye(this,"Tokenizer",kv);Ye(this,"Hooks",Th);this.use(...t)}walkTokens(t,e){var r,i;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let s=o;for(let l of s.header)n=n.concat(this.walkTokens(l.tokens,e));for(let l of s.rows)for(let c of l)n=n.concat(this.walkTokens(c.tokens,e));break}case"list":{let s=o;n=n.concat(this.walkTokens(s.items,e));break}default:{let s=o;(i=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&i[s.type]?this.defaults.extensions.childTokens[s.type].forEach(l=>{let c=s[l].flat(1/0);n=n.concat(this.walkTokens(c,e))}):s.tokens&&(n=n.concat(this.walkTokens(s.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...s){let l=i.renderer.apply(this,s);return l===!1&&(l=o.apply(this,s)),l}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),n.renderer){let i=this.defaults.renderer||new Pv(this.defaults);for(let o in n.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let s=o,l=n.renderer[s],c=i[s];i[s]=(...a)=>{let u=l.apply(i,a);return u===!1&&(u=c.apply(i,a)),u||""}}r.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new kv(this.defaults);for(let o in n.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let s=o,l=n.tokenizer[s],c=i[s];i[s]=(...a)=>{let u=l.apply(i,a);return u===!1&&(u=c.apply(i,a)),u}}r.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new Th;for(let o in n.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let s=o,l=n.hooks[s],c=i[s];Th.passThroughHooks.has(o)?i[s]=a=>{if(this.defaults.async&&Th.passThroughHooksRespectAsync.has(o))return(async()=>{let d=await l.call(i,a);return c.call(i,d)})();let u=l.call(i,a);return c.call(i,u)}:i[s]=(...a)=>{if(this.defaults.async)return(async()=>{let d=await l.apply(i,a);return d===!1&&(d=await c.apply(i,a)),d})();let u=l.apply(i,a);return u===!1&&(u=c.apply(i,a)),u}}r.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,o=n.walkTokens;r.walkTokens=function(s){let l=[];return l.push(o.call(this,s)),i&&(l=l.concat(i.call(this,s))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Po.lex(t,e??this.defaults)}parser(t,e){return Oo.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},i={...this.defaults,...r},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=t),i.async)return(async()=>{let s=i.hooks?await i.hooks.preprocess(e):e,l=await(i.hooks?await i.hooks.provideLexer():t?Po.lex:Po.lexInline)(s,i),c=i.hooks?await i.hooks.processAllTokens(l):l;i.walkTokens&&await Promise.all(this.walkTokens(c,i.walkTokens));let a=await(i.hooks?await i.hooks.provideParser():t?Oo.parse:Oo.parseInline)(c,i);return i.hooks?await i.hooks.postprocess(a):a})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let s=(i.hooks?i.hooks.provideLexer():t?Po.lex:Po.lexInline)(e,i);i.hooks&&(s=i.hooks.processAllTokens(s)),i.walkTokens&&this.walkTokens(s,i.walkTokens);let l=(i.hooks?i.hooks.provideParser():t?Oo.parse:Oo.parseInline)(s,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(s){return o(s)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+Es(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},Jl=new Vve;function qt(t,e){return Jl.parse(t,e)}qt.options=qt.setOptions=function(t){return Jl.setOptions(t),qt.defaults=Jl.defaults,OH(qt.defaults),qt};qt.getDefaults=YA;qt.defaults=uc;qt.use=function(...t){return Jl.use(...t),qt.defaults=Jl.defaults,OH(qt.defaults),qt};qt.walkTokens=function(t,e){return Jl.walkTokens(t,e)};qt.parseInline=Jl.parseInline;qt.Parser=Oo;qt.parser=Oo.parse;qt.Renderer=Pv;qt.TextRenderer=sR;qt.Lexer=Po;qt.lexer=Po.lex;qt.Tokenizer=kv;qt.Hooks=Th;qt.parse=qt;qt.options;qt.setOptions;qt.use;qt.walkTokens;qt.parseInline;Oo.parse;Po.lex;const zve=t=>t.split(/[\s-_]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),Gve=t=>{const e="Copilot",r=(t||window.location.hostname||"").replace(/^https?:\/\//,"").replace(/^www\./,"").split("/")[0].split("?")[0];if(!r)return e;const i=r.split(".").filter(Boolean);let o;const s=i.length>=2&&i[i.length-1].length===2,l=i[i.length-2],c=["com","co","net","org","gov","edu","ac"];return i.length>=3&&s&&c.includes(l)?o=i[i.length-3]:i.length>=2?o=l:o=i[0],zve(o.replace(/[^a-zA-Z0-9-_ ]/g," "))||e},Wve=(t,e,n,r,i,o)=>{const s=Math.min(o,r/2,i/2);t.beginPath(),t.moveTo(e+s,n),t.lineTo(e+r-s,n),t.quadraticCurveTo(e+r,n,e+r,n+s),t.lineTo(e+r,n+i-s),t.quadraticCurveTo(e+r,n+i,e+r-s,n+i),t.lineTo(e+s,n+i),t.quadraticCurveTo(e,n+i,e,n+i-s),t.lineTo(e,n+s),t.quadraticCurveTo(e,n,e+s,n),t.closePath()},Kve=(t,e)=>{const n=document.createElement("canvas");n.width=e,n.height=e;const r=n.getContext("2d");if(!r)return null;r.fillStyle="#ffffff",Wve(r,0,0,e,e,e*.28),r.fill();const i=e*.14,o=Math.max(t.naturalWidth,t.naturalHeight),s=(e-i*2)/o,l=t.naturalWidth*s,c=t.naturalHeight*s,a=(e-l)/2,u=(e-c)/2;return r.drawImage(t,a,u,l,c),n.toDataURL("image/png")},ox=(t,e)=>new Promise((n,r)=>{const i=new Image;e&&(i.crossOrigin="anonymous"),i.onload=()=>n(i),i.onerror=r,i.src=t}),Jve=async(t,e)=>{let n=null;try{n=await ox(t,!0)}catch(o){console.warn("Logo load failed with CORS, falling back to bundled icon",o);try{n=await ox(e,!1)}catch(s){return console.error("Fallback icon failed to load",s),null}}const i=[192,256,512].map(o=>Kve(n,o));return i.some(o=>!o)?null:{small:i[0],medium:i[1],large:i[2]}},sx=(t,e,n,r)=>{let i=document.getElementById(t);i||(i=document.createElement("link"),i.id=t,i.rel=e,document.head.appendChild(i)),r&&(i.sizes.value=r),i.href=n},Qve=({card:t,onSubmit:e,colors:n})=>{const r=pt.useRef(null),i=(n==null?void 0:n.primary)||"#1d4ed8";return pt.useEffect(()=>{if(!r.current||!t)return;r.current.innerHTML="";const o=new Tt;o.hostConfig=new fH({fontFamily:"'Segoe UI Variable Display','Segoe UI',system-ui,-apple-system,sans-serif",supportsInteractivity:!0,spacing:{small:6,default:10,medium:14,large:18,extraLarge:22,padding:16},fontStyles:{default:{fontFamily:"'Segoe UI Variable Display','Segoe UI',system-ui,-apple-system,sans-serif",fontSizes:{small:11,default:12,medium:13,large:14,extraLarge:15},fontWeights:{lighter:300,default:400,bolder:600}}},containerStyles:{default:{backgroundColor:"#ffffff",foregroundColors:{default:{default:"#0f172a",subtle:"#475569"},accent:{default:i,subtle:i},good:{default:"#22c55e",subtle:"#16a34a"},warning:{default:"#f59e0b",subtle:"#d97706"},attention:{default:"#ef4444",subtle:"#dc2626"}}}},actions:{maxActions:5,buttonSpacing:8,actionsOrientation:"horizontal",actionAlignment:"stretch",showCard:{actionMode:"popup",inlineTopMargin:12}},imageSizes:{small:60,medium:120,large:180},inputs:{errorMessage:{size:"small",color:"attention"}}}),o.onExecuteAction=async l=>{var c,a;try{const u=(c=l==null?void 0:l.getJsonTypeName)==null?void 0:c.call(l);if(u==="Action.Submit"||l instanceof Hu){const d={...(l==null?void 0:l.data)||{}};(((a=l==null?void 0:l.getInputs)==null?void 0:a.call(l))||[]).forEach(h=>{h!=null&&h.id&&(d[h.id]=h.value)}),await e(d,l==null?void 0:l.title)}else if(u==="Action.OpenUrl"){const d=l==null?void 0:l.url;d&&window.open(d,"_blank","noopener,noreferrer")}}catch(u){console.error("Adaptive card action failed",u)}},o.parse(t);const s=o.render();return s&&r.current&&r.current.appendChild(s),()=>{r.current&&(r.current.innerHTML="")}},[t,e]),pe.jsx("div",{className:"adaptive-card-container",ref:r,style:{"--ac-primary":i}})},Xve=(t,e="#ffffff",n,r="Copilot")=>{const i=window.location.href;sx("dynamic-favicon","icon",t.small,"32x32"),sx("dynamic-apple-touch-icon","apple-touch-icon",t.large,"180x180");const o=`${r} Chat`.trim(),s=`${r} Chat`.trim(),l={name:o,short_name:s,start_url:i,display:"standalone",theme_color:e,background_color:"#ffffff",icons:[{src:t.small,sizes:"192x192",type:"image/png",purpose:"any maskable"},{src:t.medium,sizes:"256x256",type:"image/png",purpose:"any maskable"},{src:t.large,sizes:"512x512",type:"image/png",purpose:"any maskable"}]},c=new Blob([JSON.stringify(l)],{type:"application/json"}),a=URL.createObjectURL(c);if(n!=null&&n.current)try{URL.revokeObjectURL(n.current)}catch(f){console.warn("Failed to revoke old manifest URL",f)}n&&(n.current=a);const u="dynamic-manifest";let d=document.getElementById(u);d||(d=document.createElement("link"),d.id=u,d.rel="manifest",document.head.appendChild(d)),d.href=a},Yve=t=>{const e=parseInt(t.replace("#",""),16),n=e>>16&255,r=e>>8&255,i=e>>0&255,[o,s,l]=[n,r,i].map(c=>(c=c/255,c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)));return .2126*o+.7152*s+.0722*l},Zve=t=>Yve(t)>.5?"#1e293b":"#ffffff",Uc=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,eye=(t,e)=>t?typeof t=="string"?t:t.text?t.text:Object.entries(t).map(([r,i])=>`${r}: ${i}`).join(", ")||e||"Submitted response":e||"Submitted response",qH=t=>{if(!t)return"";const e=qt.parse(t,{breaks:!0,gfm:!0});return ave.sanitize(e)},tye=t=>{if(!t)return"";const e=qH(t),n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""},nye=[{id:"general",name:"General Support",description:"Get help with common questions",icon:""},{id:"technical",name:"Technical Support",description:"Solve technical issues",icon:""},{id:"sales",name:"Sales & Products",description:"Learn about our offerings",icon:""},{id:"billing",name:"Billing & Account",description:"Manage payments and account",icon:""},{id:"feedback",name:"Feedback & Suggestions",description:"Share your thoughts",icon:""},{id:"emergency",name:"Urgent Assistance",description:"Priority support needed",icon:""}];function rye(){var ti;const[t,e]=pt.useState([]),[n,r]=pt.useState(""),[i,o]=pt.useState("idle"),[s,l]=pt.useState(!1),[c,a]=pt.useState(""),[u,d]=pt.useState(!0),[f,h]=pt.useState([]),[g,E]=pt.useState(!1),[D,w]=pt.useState(!1),[p,b]=pt.useState(navigator.onLine),[j,K]=pt.useState(!1),[M,ne]=pt.useState(nye),[G,oe]=pt.useState("general"),[J,X]=pt.useState(null),[B,q]=pt.useState(null),[F,x]=pt.useState(null),[P,v]=pt.useState(!1),[T,_]=pt.useState(!1),[N,I]=pt.useState(!1),[A,S]=pt.useState(null),[H,L]=pt.useState(null),[C,y]=pt.useState(""),[k,Y]=pt.useState(!1),[V,z]=pt.useState(!1),[W,le]=pt.useState(""),[re,$]=pt.useState(!1),m=pt.useRef(null),R=pt.useRef(null),Z=pt.useRef(null),ie=pt.useRef(null),se=pt.useRef(null),ue=uH(),Te=ue.isValid,[Se,Q]=pt.useState(ca),[O,U]=pt.useState(null),[ae,ce]=pt.useState(!0);pt.useEffect(()=>{if(ue.company){const me=jge(ue.company),qe=new Image;qe.onload=()=>{qe.naturalWidth>=32&&qe.naturalHeight>=32&&Q(me)},qe.onerror=()=>{console.log("Company logo failed to load, using ai.png")},qe.src=me}},[ue.company]),pt.useEffect(()=>{const me=Vge(ue.company);ue.customColors?(console.log("Using custom colors from query params"),U(ue.customColors),im(ue.customColors)):me?(console.log("Using predefined colors for",ue.company,me),U(me),im(me)):Se&&Se!==ca&&(console.log("Extracting colors from logo:",Se),Jge(Se,ue.company||window.location.hostname).then(qe=>{console.log("Extracted colors:",qe),U(qe),im(qe)}).catch(qe=>{console.error("Failed to extract colors:",qe);const Ke={primary:"#3b82f6",secondary:"#0ea5e9",light:"#e0f2ff",dark:"#1d4ed8"};U(Ke),im(Ke)}))},[Se,ue.company,ue.customColors]),pt.useEffect(()=>{const me=()=>b(!0),qe=()=>b(!1);return window.addEventListener("online",me),window.addEventListener("offline",qe),()=>{window.removeEventListener("online",me),window.removeEventListener("offline",qe)}},[]),pt.useEffect(()=>{const me=window.SpeechRecognition||window.webkitSpeechRecognition;if(me){const qe=new me;qe.continuous=!1,qe.interimResults=!1,qe.lang="en-US",qe.onresult=async Ke=>{const ft=Ke.results[0][0].transcript;w(!1);const Bt={id:Uc(),from:"user",text:ft,timestamp:Date.now()};e(gt=>[...gt,Bt]),l(!0);try{await wo.sendMessage(ft)}catch(gt){console.error(gt),a("Message failed to send."),l(!1)}},qe.onerror=()=>{w(!1)},qe.onend=()=>{w(!1)},R.current=qe}},[]),pt.useEffect(()=>{(async()=>{if(ue.agentsUrl)try{const qe=await fetch(ue.agentsUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company:ue.company})});if(qe.ok){const Ke=await qe.json();Ke.agents&&Array.isArray(Ke.agents)&&(ne(Ke.agents),console.log("Dynamic agents loaded:",Ke.agents))}}catch(qe){console.log("Using default agents, could not fetch dynamic agents:",qe)}})()},[ue.agentsUrl,ue.company]),pt.useEffect(()=>{let me=!1;return(async()=>{Y(!1);const Ke=Se||ca;try{const ft=await Jve(Ke,ca);if(me||!ft)return;const Bt=(O==null?void 0:O.primary)||"#ffffff",gt=Gve(ue.company);Xve(ft,Bt,se,gt),document.title=`${gt} Chat`,Y(!0)}catch(ft){console.error("Icon generation failed",ft)}})(),()=>{me=!0}},[Se,O]),pt.useEffect(()=>{if(Te&&i==="idle"&&u&&!N){const me=setTimeout(()=>{fe()},800);return()=>clearTimeout(me)}},[Te,N]);const fe=async()=>{a(""),o("connecting"),console.log("Starting chat with config:",{orgId:ue.orgId,orgUrl:ue.orgUrl,widgetId:ue.widgetId});try{await wo.startChat(),e([]),o("connected")}catch(me){console.error("Chat initialization error:",me),console.error("Error details:",{message:me==null?void 0:me.message,stack:me==null?void 0:me.stack,response:me==null?void 0:me.response});const qe=(me==null?void 0:me.message)||(me==null?void 0:me.toString())||"Could not start chat";a(`Connection failed: ${qe}. Please verify your Organization ID, URL, and Widget ID are correct.`),o("idle"),d(!1)}},ve=()=>{if(console.log("Minimize chat requested"),console.log("window.parent:",window.parent),console.log("window.parent === window:",window.parent===window),console.log("window.top:",window.top),window.parent&&window.parent!==window){console.log("Sending minimizeChat message to parent with origin *");try{window.parent.postMessage({action:"minimizeChat"},"*"),console.log("Message sent successfully")}catch(me){console.error("Error sending message:",me)}}else console.log("Not in iframe, cannot minimize")},Pe=()=>{v(!0)},Me=async()=>{console.log("End chat confirmed"),v(!1),_(!0),I(!0),d(!1),l(!1),o("idle"),console.log("Calling chatClient.endChat()");try{await wo.endChat(),console.log("chatClient.endChat() completed successfully")}catch(me){console.error("Error ending chat:",me)}if(e([]),S(null),L("bot"),q(null),x(null),h([]),r(""),a(""),await new Promise(me=>setTimeout(me,300)),window.parent&&window.parent!==window){console.log("Sending endChat message to parent");try{window.parent.postMessage({action:"endChat"},"*"),console.log("endChat message sent")}catch(me){console.error("Error sending endChat message:",me)}}},ke=()=>{v(!1)},Ne=async()=>{const me=n.trim();if(!me)return;const qe={id:Uc(),from:"user",text:me,timestamp:Date.now()};e(Ke=>[...Ke,qe]),r(""),l(!0);try{await wo.sendMessage(me)}catch(Ke){console.error(Ke),a("Message failed to send."),l(!1)}},Oe=me=>{me.preventDefault(),i==="connected"&&Ne()},Qe=()=>{if(!R.current){a("Speech recognition not supported in this browser");return}D?(R.current.stop(),w(!1)):(R.current.start(),w(!0))},et=me=>{a(me),setTimeout(()=>a(""),4e3)},Xe=me=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(me.trim()),Nt=()=>{if(i!=="connected"){et("Connect to chat to email the transcript.");return}le(""),$(!1),z(!0)},kt=()=>{z(!1),$(!1)},Fr=async()=>{const me=W.trim();if(!Xe(me)){et("Enter a valid email address.");return}$(!0);try{await wo.emailTranscript(me),z(!1),et(`Transcript will be emailed to ${me}`)}catch(qe){console.error("Failed to email transcript",qe),et("Could not send transcript. Try again.")}finally{$(!1)}},ps=pt.useCallback(async(me,qe)=>{const Ke=eye(me,qe),ft={id:Uc(),from:"user",text:Ke,timestamp:Date.now()};e(Bt=>[...Bt,ft]),l(!0);try{await wo.sendMessage(JSON.stringify({type:"adaptiveCardSubmit",data:me}))}catch(Bt){console.error("Adaptive card submit failed",Bt),a("Message failed to send."),l(!1)}},[]);pt.useEffect(()=>{const me=qe=>{if(!qe.data||typeof qe.data!="object")return;const Ke=qe.data;Ke.action==="copyLinkResult"&&(Ke.success?(y("copied"),setTimeout(()=>y(""),1600)):et("Could not copy the link. Copy manually."))};return window.addEventListener("message",me),()=>window.removeEventListener("message",me)},[]);const Jt=(me,qe)=>{if(window.speechSynthesis.cancel(),J===me){X(null);return}const Ke=tye(qe).trim();if(!Ke){et("No readable text to speak.");return}const ft=new SpeechSynthesisUtterance(Ke);ft.rate=.9,ft.pitch=1,ft.volume=1,ft.onend=()=>{X(null)},ft.onerror=()=>{X(null)},X(me),window.speechSynthesis.speak(ft)},Yt=()=>{var qe;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||et("Camera access is limited on desktop. Please select an image from your files."),(qe=Z.current)==null||qe.click()},Cd=()=>{var me;(me=ie.current)==null||me.click()},pn=async me=>{var Ke;const qe=(Ke=me.target.files)==null?void 0:Ke[0];if(qe){if(qe.size>5*1024*1024){et("Image must be less than 5MB");return}if(!["image/jpeg","image/jpg","image/png"].includes(qe.type)){et("Only JPG, JPEG, and PNG images are allowed");return}await dc(qe)}me.target.value=""},Go=async me=>{var Ke;const qe=(Ke=me.target.files)==null?void 0:Ke[0];if(qe){if(qe.size>5*1024*1024){et("File must be less than 5MB");return}if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(qe.type)){et("Only PDF, JPG, JPEG, and PNG files are allowed");return}await dc(qe)}me.target.value=""},dc=async me=>{const qe=me.type.startsWith("image/")?URL.createObjectURL(me):void 0,Ke={id:Uc(),from:"user",text:n.trim()||"",timestamp:Date.now(),fileMetadata:{name:me.name,type:me.type,size:me.size,url:qe},uploading:!0};e(ft=>[...ft,Ke]),r("");try{await wo.uploadFileAttachment(me),e(ft=>ft.map(Bt=>Bt.id===Ke.id?{...Bt,uploading:!1}:Bt))}catch(ft){console.error("File upload failed:",ft),et("Failed to upload file. Please try again."),e(Bt=>Bt.filter(gt=>gt.id!==Ke.id)),qe&&URL.revokeObjectURL(qe)}},Ys=me=>{const qe=M.find(Ke=>Ke.id===me);qe&&(oe(me),K(!1),et(`Switched to ${qe.name}`))},gs=async()=>{const me=window.location.href,qe=()=>{y("copied"),setTimeout(()=>y(""),1600)};try{await navigator.clipboard.writeText(me),qe();return}catch(Ke){console.error("Failed to copy URL via Clipboard API:",Ke);try{const ft=document.createElement("textarea");ft.value=me,ft.setAttribute("readonly",""),ft.style.position="fixed",ft.style.opacity="0",document.body.appendChild(ft),ft.select(),document.execCommand("copy"),document.body.removeChild(ft),qe();return}catch(ft){if(console.error("Fallback copy failed:",ft),window.parent&&window.parent!==window){window.parent.postMessage({action:"copyLink",url:me},"*");return}et("Could not copy the link. Copy manually.")}}},hc=async me=>{r(me);const qe={id:Uc(),from:"user",text:me,timestamp:Date.now()};e(Ke=>[...Ke,qe]),r(""),l(!0);try{await wo.sendMessage(me)}catch(Ke){console.error(Ke),a("Message failed to send."),l(!1)}},fc=async me=>{if(ue.pauUrl){E(!0);try{const Ke=await(await fetch(ue.pauUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({botResponse:me,companyName:ue.company||"",url:ue.company||""})})).json(),Bt=(Object.values(Ke).find(gt=>Array.isArray(gt))||[]).map(gt=>({question:gt.item||gt})).filter(gt=>typeof gt.question=="string"&&gt.question.trim()!=="").slice(0,2);h(Bt)}catch(qe){console.error("Error fetching follow-up questions:",qe)}finally{E(!1)}}};pt.useEffect(()=>{if(i!=="connected")return;const me=wo.onNewMessage(Ke=>{var Bt;const ft=((Bt=Ke.text)==null?void 0:Bt.toLowerCase())||"";if(ft.includes("position")&&ft.includes("queue")){const gt=ft.match(/position.*?(\d+)/i);gt&&gt[1]&&q(parseInt(gt[1]))}if(ft.includes("average")||ft.includes("wait")){const gt=ft.match(/(\d+)\s*(min|minute)/i);gt&&gt[1]&&x(parseInt(gt[1])*60)}e(gt=>{const ni=gt.findIndex(Er=>Er.id===Ke.id);if(ni!==-1){console.log("Updating existing message at index:",ni,"with ID:",Ke.id,"downloading:",Ke.downloading);const Er=[...gt];return Er[ni]=Ke,Er}return console.log("Adding new message with ID:",Ke.id,"downloading:",Ke.downloading),[...gt,Ke]}),l(!1),ce(!1),Ke.from==="agent"&&(Ke.agentName&&!Ke.agentName.includes("_")&&Ke.agentName.length<50&&(S(Ke.agentName),L(Ke.agentType||"bot")),q(null),x(null),fc(Ke.text))}),qe=wo.onTyping(Ke=>{var Bt;console.log("Typing event received:",Ke);const ft=(Bt=Ke==null?void 0:Ke.typingIndicator)==null?void 0:Bt.state;console.log("Typing state:",ft),l(ft==="typing")});return()=>{me==null||me(),qe==null||qe()}},[i]),pt.useEffect(()=>{var me;(me=m.current)==null||me.scrollTo({top:m.current.scrollHeight,behavior:"smooth"})},[t,s]);const Ji=i==="connected";return p?Te?pe.jsx("div",{className:"page",children:pe.jsxs("div",{className:"frame",children:[pe.jsxs("header",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"white",borderBottom:"1px solid #f1f5f9"},children:[pe.jsx("img",{src:Se,alt:"Company Logo",style:{height:"28px",maxWidth:"100px",objectFit:"contain"},onError:me=>{Se!==ca&&Q(ca)},onLoad:me=>{const qe=me.target;(qe.naturalWidth<32||qe.naturalHeight<32)&&Se!==ca&&!Se.includes("ai.png")&&Q(ca)}}),pe.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:i==="connected"&&t.length>0&&pe.jsxs(pe.Fragment,{children:[pe.jsx("button",{onClick:ve,title:"Minimize chat",style:{background:"transparent",border:"none",padding:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"background 0.2s",color:"#94a3b8"},onMouseEnter:me=>me.currentTarget.style.background="#f8fafc",onMouseLeave:me=>me.currentTarget.style.background="transparent",children:pe.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:pe.jsx("path",{d:"M19 12H5"})})}),pe.jsx("button",{onClick:Pe,title:"End chat",style:{background:"transparent",border:"none",padding:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"background 0.2s",color:"#94a3b8"},onMouseEnter:me=>{me.currentTarget.style.background="#fef2f2",me.currentTarget.style.color="#ef4444"},onMouseLeave:me=>{me.currentTarget.style.background="transparent",me.currentTarget.style.color="#94a3b8"},children:pe.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:pe.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})})]}),i==="connected"&&(B!==null||F!==null)&&pe.jsx("div",{className:"queue-banner",children:pe.jsxs("div",{className:"queue-content",children:[pe.jsx("div",{className:"queue-spinner",children:pe.jsx("div",{className:"spinner-ring"})}),pe.jsxs("div",{className:"queue-text",children:[pe.jsx("div",{className:"queue-message",children:"Connecting you with an agent"}),pe.jsxs("div",{className:"queue-details",children:[B!==null&&B>0&&pe.jsxs("span",{children:["Position in queue: ",B]}),F!==null&&F>0&&pe.jsxs("span",{children:[B!==null&&B>0?"  ":"","Estimated wait: ",Math.ceil(F/60)," min"]}),(B===null||B===0)&&(F===null||F===0)&&pe.jsx("span",{children:"Please wait..."})]})]})]})}),j&&pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"menu-backdrop",onClick:()=>K(!1)}),pe.jsxs("div",{className:"agents-panel",children:[pe.jsxs("div",{className:"agents-panel-header",children:[pe.jsxs("div",{children:[pe.jsx("h3",{children:"Choose Your Assistant"}),pe.jsx("p",{children:((ti=M.find(me=>me.id===G))==null?void 0:ti.name)||"General Support"})]}),pe.jsx("button",{className:"panel-close",onClick:()=>K(!1),children:pe.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),pe.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),pe.jsx("div",{className:"agents-grid",children:M.map(me=>pe.jsxs("div",{className:`agent-tile ${G===me.id?"active":""}`,onClick:()=>Ys(me.id),style:G===me.id&&O?{background:`linear-gradient(135deg, ${O.primary}08, ${O.primary}04)`,borderColor:O.primary,boxShadow:`0 0 0 1px ${O.primary}30`}:void 0,children:[pe.jsx("div",{className:"agent-icon-indicator",style:G===me.id&&O?{background:O.primary}:void 0}),pe.jsxs("div",{className:"agent-info",children:[pe.jsx("div",{className:"agent-name",style:G===me.id&&O?{color:O.primary}:void 0,children:me.name}),pe.jsx("div",{className:"agent-desc",children:me.description})]})]},me.id))}),pe.jsxs("div",{className:"agents-panel-footer",children:[pe.jsx("button",{className:"floating-return-button",onClick:()=>K(!1),children:"Return to Chat"}),pe.jsxs("button",{className:"copy-link",type:"button",onClick:gs,"aria-label":"Copy chat link",children:[pe.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l2.57-2.57a5 5 0 0 0-7.07-7.07L11 5"}),pe.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54L3.89 13a5 5 0 1 0 7.07 7.07L13 19"})]}),pe.jsx("span",{children:"Copy chat link"}),C==="copied"&&pe.jsx("span",{className:"copy-link-status",children:"Copied"})]}),pe.jsx("div",{style:{fontSize:"11px",color:"#94a3b8",marginTop:"6px"},children:k?"Home screen icon ready for Add to Home Screen.":"Preparing home screen icon..."})]})]})]}),pe.jsxs("section",{className:"chat-shell",children:[pe.jsxs("div",{className:"transcript",ref:m,children:[ae&&t.length===0&&pe.jsxs("div",{className:"skeleton-loader",children:[pe.jsxs("div",{className:"skeleton-status",children:[pe.jsx("div",{className:"skeleton-status-dot"}),pe.jsx("span",{children:"Connecting to assistant..."})]}),pe.jsxs("div",{className:"skeleton-bubble-row",children:[pe.jsx("div",{className:"skeleton-avatar"}),pe.jsx("div",{className:"skeleton-bubble skeleton-shimmer"})]}),pe.jsxs("div",{className:"skeleton-bubble-row",children:[pe.jsx("div",{className:"skeleton-avatar"}),pe.jsx("div",{className:"skeleton-bubble skeleton-bubble-short skeleton-shimmer"})]})]}),t.map((me,qe)=>{var Bt;const Ke=qe>0?t[qe-1]:null,ft=me.from==="agent"&&me.agentName&&me.agentType==="human"&&!me.agentName.includes("_")&&me.agentName.length<50&&(!Ke||Ke.agentName!==me.agentName);return pe.jsxs("div",{children:[ft&&pe.jsx("div",{className:"agent-name-label",children:me.agentName}),pe.jsxs("div",{className:`bubble-row ${me.from}`,children:[me.from==="agent"&&Se&&pe.jsx("div",{className:"agent-avatar",title:me.agentName&&!me.agentName.includes("_")?me.agentName:"AI Assistant",children:pe.jsx("img",{src:Se,alt:"Agent"})}),pe.jsxs("div",{className:"bubble-container",children:[me.fileMetadata&&pe.jsxs("a",{href:me.fileMetadata.url,download:me.fileMetadata.name,target:"_blank",rel:"noopener noreferrer",className:`file-preview ${me.uploading||me.downloading?"uploading":""} ${(Bt=me.fileMetadata)!=null&&Bt.type.startsWith("image/")?"image-preview":""}`,onClick:gt=>{var ni;if(me.uploading||me.downloading||!((ni=me.fileMetadata)!=null&&ni.url)){gt.preventDefault();return}if(me.fileMetadata&&(!me.fileMetadata.type.startsWith("image/")||gt.ctrlKey||gt.metaKey)){gt.preventDefault();const Er=document.createElement("a");Er.href=me.fileMetadata.url,Er.download=me.fileMetadata.name,Er.click()}},children:[me.fileMetadata.type.startsWith("image/")&&me.fileMetadata.url?pe.jsxs(pe.Fragment,{children:[pe.jsx("img",{src:me.fileMetadata.url,alt:me.fileMetadata.name,className:"file-thumbnail"}),pe.jsx("div",{className:"file-info-overlay",children:pe.jsxs("div",{className:"file-size",children:[(me.fileMetadata.size/1024).toFixed(0)," KB"]})})]}):pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"file-icon",children:pe.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[pe.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),pe.jsx("polyline",{points:"14 2 14 8 20 8"})]})}),pe.jsxs("div",{className:"file-info",children:[pe.jsx("div",{className:"file-name",children:me.fileMetadata.name}),pe.jsx("div",{className:"file-size",children:me.downloading?pe.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[pe.jsx("div",{className:"progress-spinner",style:{width:"12px",height:"12px"}}),"Downloading..."]}):`${(me.fileMetadata.size/1024).toFixed(0)} KB`})]})]}),me.uploading&&pe.jsx("div",{className:"upload-progress",children:pe.jsx("div",{className:"progress-spinner"})})]}),(me.text||me.suggestedActions||me.adaptiveCard)&&pe.jsxs("div",{className:"bubble",style:me.from==="user"&&O?{background:O.primary,color:Zve(O.primary)}:void 0,children:[me.text&&pe.jsx("div",{className:"message-text",dangerouslySetInnerHTML:{__html:qH(me.text)}}),me.suggestedActions&&me.suggestedActions.length>0&&pe.jsx("div",{className:"suggested-actions",children:me.suggestedActions.map((gt,ni)=>pe.jsx("button",{className:"suggested-action-button",style:O?{borderColor:O.primary,color:O.primary}:void 0,onClick:async()=>{const Er={id:Uc(),from:"user",text:gt.value,timestamp:Date.now()};e(Zs=>[...Zs,Er]),l(!0);try{await wo.sendMessage(gt.value)}catch(Zs){console.error(Zs),a("Message failed to send."),l(!1)}},children:gt.title},ni))}),me.adaptiveCard&&pe.jsx("div",{className:"adaptive-card-wrapper",children:pe.jsx(Qve,{card:me.adaptiveCard,onSubmit:ps,colors:O||void 0})})]})]}),me.from==="agent"&&pe.jsx("button",{className:`speak-button ${J===me.id?"speaking":""}`,onClick:()=>Jt(me.id,me.text),title:J===me.id?"Stop reading":"Read aloud",children:pe.jsx("img",{src:nme,alt:""})})]})]},me.id)}),s&&pe.jsxs("div",{className:"bubble-row agent",children:[Se&&pe.jsx("div",{className:"agent-avatar",title:A||"AI Assistant",children:pe.jsx("img",{src:Se,alt:"Agent"})}),pe.jsxs("div",{className:"typing",children:[pe.jsx("span",{}),pe.jsx("span",{}),pe.jsx("span",{})]})]})]}),g&&pe.jsxs("div",{className:"suggestions",children:[pe.jsx("div",{className:"suggestions-header",children:"Not Sure? Questions to Help"}),pe.jsxs("div",{className:"suggestions-grid",children:[pe.jsx("div",{className:"suggestion-card-skeleton skeleton-shimmer"}),pe.jsx("div",{className:"suggestion-card-skeleton skeleton-shimmer"})]})]}),!g&&f.length>0&&pe.jsxs("div",{className:"suggestions",children:[pe.jsx("div",{className:"suggestions-header",children:"Not Sure? Questions to Help"}),pe.jsx("div",{className:"suggestions-grid",children:f.map((me,qe)=>pe.jsx("div",{className:"suggestion-card",onClick:()=>hc(me.question),style:O?{transition:"all 0.2s ease"}:void 0,onMouseEnter:Ke=>{O&&(Ke.currentTarget.style.borderColor=O.primary,Ke.currentTarget.style.background=`${O.primary}08`)},onMouseLeave:Ke=>{Ke.currentTarget.style.borderColor="#e2e8f0",Ke.currentTarget.style.background="white"},children:pe.jsx("div",{className:"suggestion-text",children:me.question})},qe))})]}),pe.jsxs("div",{className:"action-toolbar",children:[pe.jsx("button",{type:"button",className:"action-btn",onClick:Qe,disabled:!Ji,"aria-label":"Voice input",title:"Voice input",children:pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),pe.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),pe.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}),pe.jsx("button",{type:"button",className:"action-btn",onClick:Yt,disabled:!Ji,"aria-label":"Camera",title:"Camera",children:pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),pe.jsx("circle",{cx:"12",cy:"13",r:"3"})]})}),pe.jsx("button",{type:"button",className:"action-btn",onClick:Cd,disabled:!Ji,"aria-label":"Attach file",title:"Attach file",children:pe.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:pe.jsx("path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"})})}),pe.jsx("button",{type:"button",className:"action-btn",onClick:Nt,disabled:!Ji,"aria-label":"Send email",title:"Send email",children:pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),pe.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]})}),pe.jsx("button",{type:"button",className:"action-btn",onClick:()=>K(!j),disabled:!Ji,"aria-label":"More options",title:"More options",children:pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("circle",{cx:"12",cy:"12",r:"1"}),pe.jsx("circle",{cx:"19",cy:"12",r:"1"}),pe.jsx("circle",{cx:"5",cy:"12",r:"1"})]})})]}),pe.jsxs("form",{className:"composer",onSubmit:Oe,children:[pe.jsx("input",{ref:Z,type:"file",accept:"image/jpeg,image/jpg,image/png",capture:"user",style:{display:"none"},onChange:pn}),pe.jsx("input",{ref:ie,type:"file",accept:".pdf,.png,.jpg,.jpeg,image/png,image/jpeg,application/pdf",style:{display:"none"},onChange:Go}),pe.jsx("input",{type:"text",placeholder:Ji?D?"Listening...":"Ask a question":"Connecting...",value:n,onChange:me=>r(me.target.value),disabled:!Ji}),pe.jsx("button",{type:"submit",className:"primary",disabled:!Ji||!n.trim(),children:""})]}),pe.jsxs("div",{className:"powered-by",children:[pe.jsx("img",{src:tme,alt:"Microsoft Copilot Studio"}),pe.jsx("span",{children:"Powered by Microsoft Copilot Studio"})]})]}),c&&pe.jsxs("div",{className:"toast-notification",children:[pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("circle",{cx:"12",cy:"12",r:"10"}),pe.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),pe.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),pe.jsx("span",{children:c})]}),P&&pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"menu-backdrop",onClick:ke}),pe.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 10px 40px rgba(0,0,0,0.2)",zIndex:10001,maxWidth:"360px",width:"90%"},children:[pe.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"End Chat Session?"}),pe.jsx("p",{style:{margin:"0 0 24px 0",fontSize:"14px",color:"#64748b",lineHeight:"1.5"},children:"Are you sure you want to end this chat? This will close your conversation and you won't be able to reconnect to this session."}),pe.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[pe.jsx("button",{onClick:ke,style:{padding:"10px 20px",borderRadius:"8px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:me=>me.currentTarget.style.background="#f8fafc",onMouseLeave:me=>me.currentTarget.style.background="white",children:"Cancel"}),pe.jsx("button",{onClick:Me,style:{padding:"10px 20px",borderRadius:"8px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:me=>me.currentTarget.style.background="#dc2626",onMouseLeave:me=>me.currentTarget.style.background="#ef4444",children:"End Chat"})]})]})]}),V&&pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"menu-backdrop",onClick:kt}),pe.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",borderRadius:"16px",padding:"22px",boxShadow:"0 20px 60px rgba(15,23,42,0.16)",zIndex:10001,width:"92%",maxWidth:"420px",display:"flex",flexDirection:"column",gap:"14px"},children:[pe.jsx("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",gap:"12px"},children:pe.jsxs("div",{children:[pe.jsx("div",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Email transcript"}),pe.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Well send the chat transcript to your email."})]})}),pe.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[pe.jsx("label",{style:{fontSize:"11px",fontWeight:600,color:"#475569",letterSpacing:"0.01em"},children:"Email address"}),pe.jsx("input",{type:"email",value:W,onChange:me=>le(me.target.value),placeholder:"you@example.com",style:{width:"100%",padding:"12px 14px",borderRadius:"12px",border:"1px solid #e2e8f0",background:"#f5f7fb",fontSize:"13px",color:"#0f172a",outline:"none",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.8)",transition:"border-color 0.15s ease, box-shadow 0.15s ease"},onKeyDown:me=>{me.key==="Enter"&&(me.preventDefault(),Fr())},autoFocus:!0})]}),pe.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"6px"},children:[pe.jsx("button",{onClick:kt,style:{padding:"12px 18px",borderRadius:"12px",border:"1px solid #e2e8f0",background:"#fff",color:"#475569",fontSize:"13px",fontWeight:600,cursor:"pointer",minWidth:"110px",boxShadow:"0 10px 22px rgba(15,23,42,0.04)"},children:"Cancel"}),pe.jsx("button",{onClick:Fr,disabled:re,style:{padding:"12px 20px",borderRadius:"12px",border:"none",background:(O==null?void 0:O.primary)||"#f59e0b",color:"#fff",fontSize:"13px",fontWeight:700,cursor:re?"wait":"pointer",minWidth:"130px",boxShadow:"0 14px 30px rgba(0,0,0,0.14)",opacity:re?.85:1,transition:"transform 0.12s ease"},children:re?"Sending...":"Send"})]})]})]}),T&&pe.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(255, 255, 255, 0.95)",zIndex:10002,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px"},children:[pe.jsx("div",{className:"progress-spinner",style:{width:"40px",height:"40px"}}),pe.jsx("div",{style:{fontSize:"16px",fontWeight:"500",color:"#64748b"},children:"Ending conversation..."})]})]})}):pe.jsx("div",{className:"page",children:pe.jsx("div",{className:"frame config-frame",children:pe.jsxs("div",{className:"config-container",children:[pe.jsx("div",{className:"config-icon-wrapper",children:pe.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"config-icon",children:[pe.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),pe.jsx("path",{d:"M12 8v4"}),pe.jsx("path",{d:"M12 16h.01"})]})}),pe.jsx("h1",{className:"config-title",children:"Configuration Required"}),pe.jsx("p",{className:"config-subtitle",children:"Add Omnichannel parameters to the URL to get started"}),pe.jsxs("div",{className:"config-card",children:[pe.jsxs("div",{className:"config-card-header",children:[pe.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),pe.jsx("path",{d:"M9 3v18"})]}),pe.jsx("span",{children:"Required Parameters"})]}),pe.jsxs("div",{className:"config-params",children:[pe.jsxs("div",{className:"config-param",children:[pe.jsx("code",{children:"orgId"}),pe.jsx("span",{children:"Organization ID"})]}),pe.jsxs("div",{className:"config-param",children:[pe.jsx("code",{children:"orgUrl"}),pe.jsx("span",{children:"Organization URL"})]}),pe.jsxs("div",{className:"config-param",children:[pe.jsx("code",{children:"widgetId"}),pe.jsx("span",{children:"Chat widget ID"})]})]}),pe.jsxs("div",{className:"config-card-header optional",children:[pe.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("circle",{cx:"12",cy:"12",r:"10"}),pe.jsx("path",{d:"M12 16v-4"}),pe.jsx("path",{d:"M12 8h.01"})]}),pe.jsx("span",{children:"Optional Parameters"})]}),pe.jsx("div",{className:"config-params",children:pe.jsxs("div",{className:"config-param",children:[pe.jsx("code",{children:"company"}),pe.jsx("span",{children:"Company domain for branding"})]})})]}),pe.jsxs("div",{className:"config-example",children:[pe.jsx("div",{className:"config-example-header",children:"Example URL"}),pe.jsxs("div",{className:"config-example-code",children:[pe.jsx("span",{className:"config-url-base",children:"https://yourapp.com/"}),pe.jsx("span",{className:"config-url-param",children:"?orgId=abc123"}),pe.jsx("span",{className:"config-url-param",children:"&orgUrl=https://org.dynamics.com"}),pe.jsx("span",{className:"config-url-param",children:"&widgetId=xyz789"}),pe.jsx("span",{className:"config-url-param optional",children:"&company=contoso.com"})]})]}),pe.jsxs("div",{className:"config-tip",children:[pe.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[pe.jsx("circle",{cx:"12",cy:"12",r:"10"}),pe.jsx("path",{d:"m9 12 2 2 4-4"})]}),pe.jsxs("span",{children:["Find these values in ",pe.jsx("strong",{children:"Dynamics 365 Customer Service"})," under Chat  Widget settings"]})]})]})})}):pe.jsx("div",{className:"page",children:pe.jsx("div",{className:"frame config-frame",children:pe.jsxs("div",{className:"config-container",children:[pe.jsx("div",{className:"config-icon-wrapper",children:pe.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"config-icon",children:[pe.jsx("path",{d:"M2 10s3-3 10-3 10 3 10 3"}),pe.jsx("path",{d:"M12 2v5"}),pe.jsx("circle",{cx:"12",cy:"17",r:"3"}),pe.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23",strokeWidth:"2"})]})}),pe.jsx("h1",{className:"config-title",children:"No Internet Connection"}),pe.jsx("p",{className:"config-subtitle",children:"Please check your network connection and try again"}),pe.jsxs("div",{className:"config-status-badge offline",children:[pe.jsx("span",{className:"status-dot"}),"Offline"]})]})})})}requestAnimationFrame(()=>{document.body.classList.add("react-loaded"),setTimeout(()=>{const t=document.getElementById("initialSkeleton");t&&t.remove()},300)});DT.createRoot(document.getElementById("root")).render(pe.jsx(Rq.StrictMode,{children:pe.jsx(rye,{})}));
